<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="private,clippings," />










<meta name="description" content="区块链概述区块链并非单一创新技术，而是将许多跨领域技术凑在一起，包括密码学、数学、演算法与经济模型，并结合点对点网路关系，利用数学基础就能建立信任效果，成为一个不需基于彼此信任基础、也不需仰赖单一中心化机构就能够运作的分散式系统，而比特币便是第一个采用区块链技术而打造出的一套P2P电子现金系统，用来实现一个可去中心化，并确保交易安全性、可追踪性的数位货币体系。 区块链:一种特殊的公开的分布式数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="区块链入门笔记">
<meta property="og:url" content="http://shenbh.github.io/posts/92f9f6d1/index.html">
<meta property="og:site_name" content="积跬步">
<meta property="og:description" content="区块链概述区块链并非单一创新技术，而是将许多跨领域技术凑在一起，包括密码学、数学、演算法与经济模型，并结合点对点网路关系，利用数学基础就能建立信任效果，成为一个不需基于彼此信任基础、也不需仰赖单一中心化机构就能够运作的分散式系统，而比特币便是第一个采用区块链技术而打造出的一套P2P电子现金系统，用来实现一个可去中心化，并确保交易安全性、可追踪性的数位货币体系。 区块链:一种特殊的公开的分布式数据库">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%8F%91%E5%B1%95.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E7%A7%81%E9%92%A5%E5%92%8C%E5%85%AC%E9%92%A5.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E5%88%86%E5%8F%89%E8%A7%A3%E5%86%B3.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%BF%87%E7%A8%8B.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E5%9F%BA%E6%9C%AC%E8%BF%87%E7%A8%8B.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%92%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC.png">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E9%93%BE%E5%BC%8F%E7%BB%93%E6%9E%84%E5%9B%BE.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/HashNet%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6.webp">
<meta property="og:image" content="http://shenbh.github.io/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A1%B9%E7%9B%AE%E5%88%86%E7%B1%BB.JPEG">
<meta property="article:published_time" content="2025-07-03T02:57:28.909Z">
<meta property="article:modified_time" content="2025-07-04T01:21:40.064Z">
<meta property="article:author" content="阿炳">
<meta property="article:tag" content="private">
<meta property="article:tag" content="clippings">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://shenbh.github.io/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%8F%91%E5%B1%95.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/92f9f6d1/"/>





  <title>区块链入门笔记 | 积跬步</title><meta name="robots" content="noindex">
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">积跬步</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Just do IT Now.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/92f9f6d1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="积跬步">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">区块链入门笔记</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2025-07-03T10:57:28+08:00">
                2025-07-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="区块链概述"><a href="#区块链概述" class="headerlink" title="区块链概述"></a>区块链概述</h2><p>区块链并非单一创新技术，而是将许多跨领域技术凑在一起，包括密码学、数学、演算法与经济模型，并结合点对点网路关系，利用数学基础就能建立信任效果，成为一个不需基于彼此信任基础、也不需仰赖单一中心化机构就能够运作的分散式系统，而比特币便是第一个采用区块链技术而打造出的一套P2P电子现金系统，用来实现一个可去中心化，并确保交易安全性、可追踪性的数位货币体系。</p>
<p>区块链:一种特殊的公开的分布式数据库,具有分布式存储，分布式记录，去中心化，分布式维护等特性。</p>
<ul>
<li>全民记账</li>
<li>不可篡改（只能增查,不能改删）</li>
<li>可追溯</li>
<li>去中心化</li>
</ul>
<p>核心技术：</p>
<ul>
<li>区块链底层</li>
<li>智能合约</li>
<li>密码学和数字签名用于身份地址标识</li>
<li>共识算法用于工作量证明</li>
<li>分布式存储技术用于存储交易记录和区块，分布式网络技术用于网络通信和节点发现</li>
</ul>
<p>区块链分类:</p>
<ul>
<li>共有链</li>
<li>私有链</li>
<li>联盟链</li>
</ul>
<p>区块链版本：</p>
<ul>
<li>区块链1.0-可编程货币：数字货币去中心化，数字化货币及支付系统</li>
<li>区块链2.0-可编程金融：智能合约，数字资产，金融应用</li>
<li>区块链3.0-可编程社会：去中心化互信网络，去中心化信任机制，公证，仲裁，审计，物流，医疗等领域</li>
</ul>
<p>区块链2.0是指智能合约,智能合约与货币相结合,对金融领域提供了更加广泛的应用场景，代表是’以太坊’，以太坊 &#x3D; 区块链 + 智能合约。</p>
<p><img src="/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%8F%91%E5%B1%95.png"></p>
<h2 id="账本验证"><a href="#账本验证" class="headerlink" title="账本验证"></a>账本验证</h2><ul>
<li>Hash</li>
</ul>
<h2 id="账户所有权"><a href="#账户所有权" class="headerlink" title="账户所有权"></a>账户所有权</h2><p>非对称加密：公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。</p>
<ul>
<li>账户用一个地址（Hash值）来标识</li>
<li>一个地址拥有一个私钥（如果私钥丢失了，比特币可能会丢失；私钥丢失了的话，是不能找回的；私钥可以通过两次哈希处理得到地址，而地址不能推导出私钥；非对称）</li>
<li>不泄露私钥的情况下证明我们拥有某个地址的私钥：通过交易签名（非对称）的方式<ul>
<li>把交易进行Hash得到摘要</li>
<li>用私钥对摘要进行签名（加密）,同时私钥也生成付款方的公钥</li>
<li>广播交易，验证信息</li>
<li>用签名和付款方的公钥进行验证，返回交易摘要，验证是否是原始的交易信息（解密）</li>
</ul>
</li>
</ul>
<p>私钥-公钥关系:</p>
<ul>
<li>公钥和私钥成对出现</li>
<li>公开的密钥叫公钥，只有自己知道的叫私钥</li>
<li>用公钥加密的数据只有对应的私钥可以解密</li>
<li>用私钥加密的数据只有对应的公钥可以解密</li>
<li>如果可以用公钥解密，则必然是对应的私钥加的密</li>
<li>如果可以用私钥解密，则必然是对应的公钥加的密<br><img src="/posts/92f9f6d1/%E7%A7%81%E9%92%A5%E5%92%8C%E5%85%AC%E9%92%A5.png"></li>
</ul>
<h2 id="钱包"><a href="#钱包" class="headerlink" title="钱包"></a>钱包</h2><p>加密数字货币是一种基于区块链技术的数字货币，加密数字货币钱包是专门用来管理这些资产的应用。加密数字货币钱包提供钱包地址的创建、加密数字货币转账、每个钱包地址交易历史的查询等基础金融功能。钱包应用按照密码学原理创建1个或多个钱包地址，每个钱包地址都对应1个密钥对：私钥和公钥。公钥是根据私钥进行一定的数学运算生成，与私钥一一对应。公钥主要是对外交易使用，每次交易都必须使用私钥对交易记录进行签名以证明对相关钱包地址里面的资产有控制权。私钥是唯一能够证明对于数字资产有控制权的凭证,因此对于数字资产钱包来说，私钥是最重要的。私钥的生成和存储方式决定了资产安全与否。因此，通常意义上的数字资产安全其实就是私钥的安全，一个钱包是不是安全主要看它能否安全的管理和使用私钥。</p>
<h2 id="挖矿（记账）"><a href="#挖矿（记账）" class="headerlink" title="挖矿（记账）"></a>挖矿（记账）</h2><ul>
<li>记账：Hash打包过程</li>
<li>节点消耗资源，有奖励</li>
</ul>
<p>挖矿-工作量证明：</p>
<ol>
<li>一段时间内，只有一人可以记账成功</li>
<li>通过解决密码学难题（即工作量证明）竞争获得唯一记账权</li>
<li>其他节点复制记账结果</li>
</ol>
<p>普通的hash打包过程会获得一个摘要信息（hash值），规定获得的摘要信息必须以特定值开头才能算作挖矿成功，获得唯一记账权，故需要引入一个“随机数”作为Hash运算的参数。</p>
<h2 id="共识机制"><a href="#共识机制" class="headerlink" title="共识机制"></a>共识机制</h2><ul>
<li>两个节点同时完成工作量证明，使用谁的区块，使用共识机制。</li>
<li>节点工作量只有在其他得节点认同其是有效的，因此会主动遵守规定</li>
<li>每个节点会选择一条累计工作量最大（最长）的区块链，延长最长链<br><img src="/posts/92f9f6d1/%E5%88%86%E5%8F%89%E8%A7%A3%E5%86%B3.png"></li>
</ul>
<p>例如，两个节点同时完成工作量证明，分别打包成3458A和3458B，周围的节点选择出累计工作量最大（&#x2F;最长）的区块链为3458A后进行广播，以3458A作为主链，3458B作为备用链。若之后节点接收到3458B传来的3459B区块，周围的节点选择出累计工作量最大（&#x2F;最长）的区块链为3458B&lt;——3459B，此时再把备用链3458B作为主链，3458B&lt;——3459B接入区块链。有时候某些节点先接收了3459B，此时会将3459B作为孤块保存，一旦该节点接收到3458B，就会将3458B&lt;——3459B接入区块链。</p>
<h2 id="交易原理"><a href="#交易原理" class="headerlink" title="交易原理"></a>交易原理</h2><p>当你发起一笔比特币交易后，将交易广播到全网，挖矿节点接收到交易后，先将其放入本地内存池进行一些基本验证，比如该笔交易发费的比特币是否是未被花费的交易，如果验证成功，则将其放入”未确认交易池“等待被打包，如果验证失败，则被标记为”无效交易“不会被打包，也就是说，旷工在寻找nonce的同时还需要及时验证每笔交易。</p>
<p>所谓比特币交易就是从一个比特币钱包向另一个中转账，每笔交易都有数字签名来保证安全。一个交易一旦发生那么就是对所有人都公开的，每个交易的历史可以最终追溯到相应的比特币最初被挖出来的那个点。</p>
<p>比特币转账需要支付给旷工手续费，按交易所占的字节数计费，旷工一般会优先打包手续费高的交易到区块里。</p>
<h3 id="比特币的UTXO模型"><a href="#比特币的UTXO模型" class="headerlink" title="比特币的UTXO模型"></a>比特币的UTXO模型</h3><p>比特币系统没有余额的概念，它使用的是UTXO模型（Unspent Transaction Outputs，未使用过的交易输出），我们在交易过程中经常说的钱包余额，实际上是一个钱包地址的UTXO集合。所以，在比特币网络中，存储比特币余额的是交易输出，准确点说就是未使用过的交易输出，而每一笔交易的输入实际上引用的是上一笔交易的输出。所以，要计算一个用户的比特币余额，就需要遍历整个交易的历史。而以太坊由于采用了Account模型，也就是采用余额的概念，所以不需要溯源整个交易历史。</p>
<p><img src="/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%BF%87%E7%A8%8B.jpg"></p>
<h3 id="交易分类"><a href="#交易分类" class="headerlink" title="交易分类"></a>交易分类</h3><p>交易分为2类：</p>
<ul>
<li>Coinbase交易：挖矿奖励，没有输入，只有输出</li>
<li>普通交易：用户之间的普通转账交易</li>
</ul>
<h3 id="交易过程"><a href="#交易过程" class="headerlink" title="交易过程"></a>交易过程</h3><p><img src="/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E8%BE%93%E5%85%A5%E7%BB%93%E6%9E%84.png"> <img src="/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%84.png"></p>
<p>假设，由于Alice挖矿被奖励了12.5个比特币。而Alice在一笔交易中，需要转账给Bob10个比特币。而Bob最终确认并接收了Alice发送的10个比特币，而同时由于多出了2.5个比特币。其实这笔交易最终是生成了2个输出，一个是发送给Bob的10个比特币，另一个是找零产生的发给Alice的2.5个比特币（备注：这里不考虑交易费）。</p>
<p><img src="/posts/92f9f6d1/%E4%BA%A4%E6%98%93%E5%9F%BA%E6%9C%AC%E8%BF%87%E7%A8%8B.png"></p>
<p>Alice的锁定脚本的作用是，设定成只有Alice才能使用这笔输出。而要使用这个UTXO，就必须要证明自己是Alice。</p>
<p>比特币交易解码后的内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    &quot;version&quot;: 1,    </span><br><span class="line"></span><br><span class="line">    &quot;locktime&quot;: 0,    </span><br><span class="line"></span><br><span class="line">    #交易输入(input)部分</span><br><span class="line"></span><br><span class="line">    &quot;vin&quot;: [           </span><br><span class="line"></span><br><span class="line">    &#123;    </span><br><span class="line"></span><br><span class="line">        #输入引用的交易(transaction)HASH</span><br><span class="line"></span><br><span class="line">        &quot;txid&quot;: &quot;7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18&quot;,       </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        #引用交易中的UTXO索引（第一个为0，此处代表上述txid交易中的第一个UTXO）</span><br><span class="line"></span><br><span class="line">        &quot;vout&quot;: 0,                                    </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        #解锁脚本，用于解锁UTXO的脚本（这是可以花费这笔UTXO的关键信息）</span><br><span class="line"></span><br><span class="line">        &quot;scriptSig&quot;: &quot;3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</span><br><span class="line"></span><br><span class="line">        [ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf&quot;,          </span><br><span class="line"></span><br><span class="line">        &quot;sequence&quot;: 4294967295            </span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    ],    </span><br><span class="line"></span><br><span class="line">    #交易输出(output)部分 </span><br><span class="line"></span><br><span class="line">    &quot;vout&quot;: [         </span><br><span class="line"></span><br><span class="line">    &#123;    </span><br><span class="line"></span><br><span class="line">        #第一个输出的比特币数量</span><br><span class="line"></span><br><span class="line">        &quot;value&quot;: 0.01500000,             </span><br><span class="line"></span><br><span class="line">        #锁定脚本，后续的交易如要使用该输出，必须解锁锁定脚本</span><br><span class="line"></span><br><span class="line">        &quot;scriptPubKey&quot;: &quot;OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG&quot;          </span><br><span class="line"></span><br><span class="line">    &#125;,    </span><br><span class="line"></span><br><span class="line">    &#123;    </span><br><span class="line"></span><br><span class="line">        #第二个输出的比特币数量</span><br><span class="line"></span><br><span class="line">        &quot;value&quot;: 0.08450000,             </span><br><span class="line"></span><br><span class="line">        &quot;scriptPubKey&quot;: &quot;OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG&quot;,    </span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    ]    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="交易脚本"><a href="#交易脚本" class="headerlink" title="交易脚本"></a>交易脚本</h3><p>比特币客户端使用一个用类Forth脚本语言编写的脚本去验证比特币的交易，这个脚本语言不是图灵完备的，不具备循环等复杂的特性。它是一种基于堆栈的执行语言，该脚本语言的简单特性，虽然使得它不能实现复杂的功能，但是也提高了交易脚本的安全性（设计简单，减少了攻击面）。而以太坊就是诟病比特币交易脚本功能有限，所以设计了一个图灵完备的脚本语言，也就是我们常说的智能合约脚本语言，能实现更复杂的功能，但同时也增加了安全隐患。</p>
<p>当一笔比特币交易被验证时，每一个输入中的解锁脚本与其所引用的输出中的锁定脚本同时执行，从而检查这笔交易是否有效。如图所示，是最为常见类型的比特币交易的解锁和锁定脚本:</p>
<p><img src="/posts/92f9f6d1/%E8%A7%A3%E9%94%81%E8%84%9A%E6%9C%AC%E5%92%8C%E9%94%81%E5%AE%9A%E8%84%9A%E6%9C%AC.png"></p>
<p>验证过程:当我们拿到一笔交易时，将当前输入的解锁脚本，和该输入所引用的上一笔交易输出的锁定脚本进行特定的验证过程，最终若返回TRUE，说明交易有效。</p>
<h2 id="区块链架构模型"><a href="#区块链架构模型" class="headerlink" title="区块链架构模型"></a>区块链架构模型</h2><p><img src="/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B.jpg"></p>
<ul>
<li>数据层：封装了底层数据区块的链式结构，以及相关的非对称的公钥私钥加密技术和时间戳技术；是整个区块链最底层的数据结构。</li>
<li>网络层：P2P机制，数据传播机制，数据间认证机制</li>
<li>共识层：共识机制算法</li>
<li>激励层：用于公有链，联盟链</li>
<li>合约层：智能合约</li>
<li>应用层：与上述区块链核心架构分开部署，通过RPC（Remote Procedure Call:远程过程调用)互联</li>
</ul>
<h2 id="链式结构"><a href="#链式结构" class="headerlink" title="链式结构"></a>链式结构</h2><p><img src="/posts/92f9f6d1/%E9%93%BE%E5%BC%8F%E7%BB%93%E6%9E%84%E5%9B%BE.jpg"></p>
<p>Hash函数:</p>
<ul>
<li>MD系列:已经不再安全</li>
<li>SHA系列:推荐SHA256, SHA3<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func hash(input string) string  &#123;</span><br><span class="line"></span><br><span class="line">    // func Sum256(data []byte) [Size]byte</span><br><span class="line"></span><br><span class="line">    hashInByte :=sha256.Sum256([]byte (input))</span><br><span class="line"></span><br><span class="line">    // func EncodeToString(src []byte) string</span><br><span class="line"></span><br><span class="line">    return hex.EncodeToString(hashInByte[:])</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ICO和IPO"><a href="#ICO和IPO" class="headerlink" title="ICO和IPO"></a>ICO和IPO</h2><ul>
<li>ICO（Initial Coin Offering），首次币发行，源自股票市场的首次公开发行（IPO）概念，是区块链项目首次发行代币，募集比特币、以太坊等通用数字货币的行为。</li>
<li>IPO（Initial Public Offerings），首次公开募股，是指一家企业或公司 （股份有限公司）第一次将它的股份向公众出售（首次公开发行，指股份公司首次向社会公众公开招股的发行方式）。</li>
</ul>
<h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><p>智能合约是一套以数字形式定义的承诺，包括合约参与方可以在上面执行这些承诺的协议，也就是说智能合约是一套能够自动执行某些手动才能完成任务的协议。其实智能合约相当于在计算机系统中构建一份参与方均可读的合同。只有当某一事件触发后，则会立即执行。例如，A向B付款XX元，B则给予A货物。</p>
<p>智能合约并不是一定要依赖于区块链来实现，而区块链的部分基础特性决定了智能合约更加适合于在区块链上来实现。比如去中心化，数据的防篡改，高可用性等。去中心化能够保证数据的全网备份与不可受第三方机构的干扰，无需担心数据会被篡改。同时也立于以后的审计工作。高可用性不会存在如目前的中心服务或者中心存储系统受到攻击或其他问题而发生合约不执行的问题。其实综合来说,区块链给予智能合约最好的特性就是“信任机制。</p>
<p>目前来说，智能合约同样也有很多的局限性。例如线下的问题解决起来还是无法与线上的问题相提并论的。如商品问题，给予的商品质量如何评估与上链，是否还需要依赖于第三方？ 同时智能合约的编写者对于合约的细节把控必须特别的严谨。一是合约漏洞，不严谨的合约造成对某个参与者的损失。二是可能会出现Bug，而如果bug被黑客所利用那么就会造成重大的损失。同样智能合约的法律问题也是要考虑的重点。</p>
<h2 id="以太坊"><a href="#以太坊" class="headerlink" title="以太坊"></a>以太坊</h2><p>以太坊（英文Ethereum）是一个开源的有智能合约功能的公共区块链平台，通过其专用加密货币以太币（Ether）提供去中心化的虚拟机（“以太虚拟机” Ethereum Virtual Machine）来处理点对点合约。</p>
<p>比特币并不完美，其中协议的扩展性是一项不足，例如比特币网络里只有一种符号——比特币，用户无法自定义另外的符号，这些符号可以是代表公司的股票，或者是债务凭证等，这就损失了一些功能。另外，比特币协议里使用了一套基于堆栈的脚本语言，这语言虽然具有一定灵活性，使得像多重签名这样的功能得以实现，然而却不足以构建更高级的应用，例如去中心化交易所等。以太坊从设计上就是为了解决比特币扩展性不足的问题。</p>
<p>以太坊是一个平台，它上面提供各种模块让用户来搭建应用。具体来说，以太坊通过一套图灵完备的脚本语言（EthereumVirtual Machinecode，简称EVM语言）来建立应用，它类似于汇编语言，但以太坊里的编程并不需要直接使用EVM语言，而是类似C语言、Python、Lisp等高级语言，再通过编译器转成EVM语言。</p>
<p>上面所说的平台之上的应用，其实就是合约，这是以太坊的核心。合约是一个活在以太坊系统里的自动代理人，他有一个自己的以太币地址，当用户向合约的地址里发送一笔交易后，该合约就被激活，然后根据交易中的额外信息，合约会运行自身的代码，最后返回一个结果，这个结果可能是从合约的地址发出另外一笔交易。需要指出的是，以太坊中的交易，不单只是发送以太币而已，它还可以嵌入相当多的额外信息。如果一笔交易是发送给合约的，那么这些信息就非常重要，因为合约将根据这些信息来完成自身的业务逻辑。合约所能提供的业务，几乎是无穷无尽的，它的边界就是你的想象力，因为图灵完备的语言提供了完整的自由度，让用户搭建各种应用。</p>
<p>比特币网络事实上是一套分布式的数据库，而以太坊则更进一步，她可以看作是一台分布式的计算机：区块链是计算机的ROM，合约是程序，而以太坊的矿工们则负责计算，担任CPU的角色。这台计算机不是、也不可能是免费使用的，不然任何人都可以往里面存储各种垃圾信息和执行各种鸡毛蒜皮的计算，使用它至少需要支付计算费和存储费，当然还有其它一些费用。</p>
<h2 id="分叉"><a href="#分叉" class="headerlink" title="分叉"></a>分叉</h2><p>比特币社区开发者一直在致力于改进比特币,但是不像传统软件的升级，一个分布式共识系统的升级是非常困难的，需要协调好所有的系统参与者。每次升级可能会伴随着区块链的共识规则改变，这会导致整个网络中升级了软件的节点与未升级软件的节点运行在不同的规则下，于是分叉就产生了。</p>
<h3 id="硬分叉"><a href="#硬分叉" class="headerlink" title="硬分叉"></a>硬分叉</h3><p>如果区块链软件的共识规则被改变，并且这种规则改变无法向前兼容，旧节点无法认可新节点产生的区块，即为硬分叉。这时候旧节点会拒绝新规则的区块，于是新节点和旧节点会开始在不同的区块链上运行（挖矿、交易、验证等），由于新旧节点可能长期存在，这种分叉也可能会长期持续下去。</p>
<h3 id="软分叉"><a href="#软分叉" class="headerlink" title="软分叉"></a>软分叉</h3><p>如果区块链的共识规则改变后，这种改变是向前兼容的，旧节点可以兼容新节点产生的区块，即为软分叉。实际上，软分叉通常刚开始并不会产生两条区块链，因为新规则下产生的块会被旧节点接受，旧节点只是无法识别新规则的真实意义。所以新旧节点仍然处于同一条区块链上，对整个系统的影响也就较小。</p>
<h2 id="共识算法"><a href="#共识算法" class="headerlink" title="共识算法"></a>共识算法</h2><h3 id="PoW"><a href="#PoW" class="headerlink" title="PoW"></a>PoW</h3><p>POW（Proof of Work）：工作量证明，即你能够获得的币的数量，取决于你挖矿贡献的有效工作，也就是说，你用于挖矿的矿机的性能越好，分给你的收益就会越多，这就是根据你的工作证明来执行币的分配方式。通俗的说，PoW 的意思就是社会主义，按劳分配，多劳多得。</p>
<p>PoW 的优势与劣势：</p>
<ul>
<li>PoW机制的设计目的是保证安全。无论是在中心化还是非中心化系统中，防止作弊都是很重要的。</li>
<li>PoW 假设大多数人不会作弊，如果你想作弊，你要有压倒大多数人的算力（51%攻击），但不能防止矿工抱团取暖。</li>
</ul>
<h3 id="PoS"><a href="#PoS" class="headerlink" title="PoS"></a>PoS</h3><p>PoS（Proof of Stake）：权益证明，类似比特币这样的 PoW 币种挖矿带来了巨大的电力能源消耗，为了解决这种情况，所以有了 PoS。PoS 试图解决 PoW 机制中大量资源被浪费的情况。这种机制通过计算你持有占总币数的百分比以及占有币数的时间来决定记账权。在现实世界中 PoS 很普遍，最为熟知的例子就是股票。股票是用来记录股权的证明，股票持有量多的，拥有更高更多的投票权和收益权。通俗的说，PoS 就是资本主义，按钱分配，钱生钱。</p>
<ul>
<li>Proof of Deposit：这次挖到矿的旷工投入的币会锁定一段时间才能接着投入。如果有分叉的话锁定的币只会在当前分支起锁定效果。</li>
</ul>
<p>PoS 的优势与劣势：</p>
<ul>
<li>Pos 当然也能防作弊，因为如果一名持有 51%以上股权的人作弊，相当于他坑了自己，因为一个人自己不会杀死自己的钱。</li>
<li>PoS 机制由股东自己保证安全，工作原理是利益捆绑。在这个模式下，不持有 PoS 的人无法对 PoS 构成威胁。PoS 的安全取决于持有者，和其他任何因素无关。</li>
</ul>
<h3 id="DPoS"><a href="#DPoS" class="headerlink" title="DPoS"></a>DPoS</h3><h4 id="算法概述"><a href="#算法概述" class="headerlink" title="算法概述"></a>算法概述</h4><p>DPoS（Delegated Proof of Stake）：委托股权证明，是 PoS 的进化方案，由 Dan Larimer 发明。（例子：比特股 BTS）</p>
<p>在常规 PoW 和 PoS 中，一大影响效率之处在于任何一个新加入的 Block，都需要被整个网络所有节点做确认。DPoS 优化方案在于：通过不同的策略，不定时的选中一小群节点，这一小群节点做新区块的创建，验证，签名和相互监督，这样就大幅度的减少了区块创建和确认所需要消耗的时间和算力成本。</p>
<p>DPOS算法分为两部分：选择一组块生产者和调度生产。选举过程确保利益相关方最终得到控制，因为当网络不能顺利运行时，利益相关方的损失最大。选举方法对实际运行中如何达成共识几乎没有影响，因此主要介绍如何在块生产者被选择之后达成共识。</p>
<p>假设3个块生产者A，B和C。因为共识（的达成）需要2&#x2F;3+1多数来解决所有情况，这个简化的模型将假设生产者C是打破僵局的那个人。在现实世界中，将有21个或更多的块生产者。像工作量证明一样，一般规则是最长链胜出。任何时候当一个诚实的对等节点看到一个有效的更长链，它都会从当前分叉切换到更长的这条链。</p>
<h4 id="正常操作"><a href="#正常操作" class="headerlink" title="正常操作"></a>正常操作</h4><p>在正常操作模式下，块生产者每3秒钟轮流生成一个块。假设没有人错过自己的轮次，那么这将产生最长链。块生产者在被调度轮次之外的任何时间段出块都是无效的。</p>
<h4 id="少数分叉"><a href="#少数分叉" class="headerlink" title="少数分叉"></a>少数分叉</h4><p>不超过节点总数三分之一的恶意或故障节点可能创建少数分叉。在这种情况下，少数分叉每9秒只能产生一个块，而多数分叉每9秒可以产生两个块。这样，诚实的2&#x2F;3多数将永远比少数（的链）更长。</p>
<h4 id="离线少数的多重生产"><a href="#离线少数的多重生产" class="headerlink" title="离线少数的多重生产"></a>离线少数的多重生产</h4><p>（离线的）少数人可以试图产生无限数量的分叉，但是他们的所有分叉都将比多数人的那条链短，因为少数人在出块速度上注定比多数人来的更慢。</p>
<h4 id="网络碎片化"><a href="#网络碎片化" class="headerlink" title="网络碎片化"></a>网络碎片化</h4><p>网络完全有可能碎片化，导致没有任何分叉拥有多数块生成者。在这种情况下，最长的链将倒向最大的那个少数群体。当网络连通性恢复时，较小的少数群体会自然切换到最长的那条链，明确的共识将恢复。</p>
<p>有可能存在这样三个分叉，其中两个最长的分叉长度相同。在这种情况下，第3个（较小）分叉的块生产者重新加入网络时会打破平局。块生产者总数为奇数，因此不可能长时间保持平局。稍后我们还会讲到生产者“洗牌”，它使得出块顺序随机化，从而确保即使是生产者数目相同的两个分叉也会以不同的步长增长，最终导致一个分叉超过另一个。</p>
<h4 id="在线少数的多重生产"><a href="#在线少数的多重生产" class="headerlink" title="在线少数的多重生产"></a>在线少数的多重生产</h4><p>在这种场景下，少数节点B在其时间段内产生了两个或更多可供选择的块。下一个计划生产者（C）可以选择基于B产生的任何一种方案继续构建链条。一旦如此，这个选择就成为最长的链，而所有选择B1的节点都将切换分叉。少数不良生产者企图广播再多的替代块也无关紧要，它们作为最长链的一部分永远不会超过一轮。</p>
<h4 id="最后不可逆块"><a href="#最后不可逆块" class="headerlink" title="最后不可逆块"></a>最后不可逆块</h4><p>在网络碎片化的情况下，多个分叉都有可能持续不断增长相当长的时间。长远来看最长的链终将获胜，但观察者需要一种确切的手段来判定一个块是否绝对处于增长最快的那条链。这可以通过观察来自2&#x2F;3+1多数块生产者的确认来决定。</p>
<h4 id="多数生产者舞弊"><a href="#多数生产者舞弊" class="headerlink" title="多数生产者舞弊"></a>多数生产者舞弊</h4><p>如果多数生产者变得腐败，那么他们可以产生无限数量的分叉，每个分叉都看起来以2&#x2F;3多数确认向前走。这种情况下，最后不可逆块算法蜕变为最长链算法。最长链就是为最大多数所批准的那条链，而这将由少数剩下的诚实节点决定。这种行为不会持续很长时间，因为利益相关方最终会投票替换生产者。</p>
<h4 id="确定性生产者洗牌"><a href="#确定性生产者洗牌" class="headerlink" title="确定性生产者洗牌"></a>确定性生产者洗牌</h4><p>在上面所有例子中，我们展示的都是块生产者按循环调度出块。实际上，每出N个块（N是生产者数量），块生产者集合都会洗牌一次。这种随机性确保块生成者B不会总是忽略块生成者A，每当形成多个拥有相同数量生产者的分叉时，平局最终都会被打破。</p>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>在每一个我们能想到的自然网络分裂的情况下，委托权益证明都是强健的，甚至在面对相当数量生产者舞弊的情形时也是安全的。不像其它共识算法，当大多数生产者不合格时，DPOS还是可以继续工作。在此过程中，社区可以投票替换掉不合格的生产者，直到恢复100％参与率。</p>
<p>说到底，DPOS引人注目的安全性来自于其选择块生产者和验证节点质量的算法。运用赞成投票的过程可以确保一个人即使拥有50％的有效投票权也不能独自挑选哪怕一个生产者。DPOS旨在优化拥有强壮网络连接的诚实节点100％参与（共识过程）的名义条件。这使得DPOS有能力在平均只有1.5秒的时间内以99.9％的确定性确认交易，同时以优雅和可检测的方式降级 – 从降级中恢复正常也不过是小事一桩。</p>
<h3 id="PoW-PoS-混合机制"><a href="#PoW-PoS-混合机制" class="headerlink" title="PoW + PoS 混合机制"></a>PoW + PoS 混合机制</h3><p>为了结合两种挖矿方式的优点，开始有了基于 PoW+PoS 混合共识机制的币。例如 Hcash，以及以太坊 ETH 也正在向 PoW+PoS 混合挖升级矿转变。</p>
<p>PoW + PoS 混合机制的优势：</p>
<ul>
<li>假设一个币它的机制是PoW + PoS 的混合机制。那么持有该币的用户与矿工均可以参与到投票中，共同参与该币社区的重大决定，持币者与矿工都可以影响预先编制好的更新，如隔离见证（SegWit）、增大区块等等。如果这些更新被广泛认可，无需开发者干预，链就会自动分叉以配合更新。而这才是真正的去中心化。</li>
<li>以混合机制来实现广义上的 DAO（去中心化自治组织）的高效运行。通过 PoW+PoS 公平的按持币数量与工作量分配投票权重，实现社区自治。</li>
</ul>
<h3 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p>DAG：Directed Acyclic Graph，即“有向无环图”。区块链是每个区块记多笔交易，而DAG是每个区块存一笔交易，所以它们的本质相同。在IOTA白皮书里，把结扎在一起的交易称为缠结（Tangle）。</p>
<p>使用者每发起一笔交易，必须验证之前的两笔交易。如果一笔交易不被后来的交易所验证，它就会在账本里失去合法性。交易发起者自己选择两笔合法交易，花2秒钟找出一个随机数，让“随机数+信息”的哈希值符合系统要求。</p>
<p>验证所需的工作量与前手交易权重成正比，交易权重相当于验证难度，难度越高验证时间越长。IOTA中，权重是以3为底的指数增长：3的1次方、3的2次方、3的3次方……被验证次数越多的交易权重越大。所以，不用担心验证完两笔正确交易却没人来验证你，因为验证新鲜交易更容易，如果验证靠前的陈旧交易，工作量会指数级地翻上去.</p>
<p>如果只往前验证一笔，网络会被大算力操控。算力强者很容易抬高交易权重，拉长尾巴，以堵死后面的验证通路，让随后的诚实交易不得不屈从大算力；可验太多交易又会耗时过长。所以，验两笔能兼顾安全和效率。</p>
<p>于是，发起者一边提交自己的交易，一边验证别人的交易，以此编织着一个去中心化网络。</p>
<h4 id="DAG保证账本安全"><a href="#DAG保证账本安全" class="headerlink" title="DAG保证账本安全"></a>DAG保证账本安全</h4><p>假如A转给B价值100万元的IOTA，B确认后把100万元货物交给A，A靠算力发起攻击，用一笔权重更大的交易验证合法交易之前的交易。只要超过主体诚实的DAG，随后的交易都会接在A的DAG后面生长，这样就赖掉之前的交易，白白从B手里拿走100万元的货。此时需要汇聚34%才能实现双重支付？</p>
<p>IOTA团队说，网络还没成熟，所以先找了个协管员看场子，这名协管员就是一台名叫Coordinator的服务器。所有交易是否合法，暂时全由这位协管员拍板，拍板后告诉其他节点，该验证哪些交易。</p>
<p>影响账本安全的另一个因素是数字签名，因为攻击者无法使用他们没有的私钥签出和你一样的数字签名，而保障这件事的是哈希算法.IOTA使用了自己开发的哈希算法curl，但是curl算法的哈希值极易发生碰撞，于是就能伪造数字签名。</p>
<p>IOTA的DAG是靠后手保护前手，一旦攻击者成功伪造数字签名，后手挑不出伪造者的错，非法交易就能大摇大摆地通过验证，这意味着别人用其他私钥也能撬走你账户里的钱。现在IOTA有协管员保护，但如果撤下协管员，签名能否会被仿冒，就完全得寄希望于攻击者没有哈希出和你一样的签名。而协管员自己也有私钥，一旦泄露，造成的结果将比服务器电源插座被拔还要严重，因为此时持有私钥者具备改动任意交易的技术可能，这就是集中管账的风险。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>DAG是一种数据存储结构，从它被发明的30多年来一直都有人使用，本身并没有问题。但它和区块链的区别在于DAG没有传统意义上的共识，每笔交易的可信与否取决于相信这笔交易的人数。所以采用DAG技术的核心问题在于如何保护全网达成的一致.</p>
<p>IOTA使用了中心化方案：先协管员看护，以后慢慢放开。同样采用DAG的另一种加密货币Byteball就很淳朴，12名矿工通过收交易手续费的方式保护系统安全。</p>
<p>DAG曾经作为比特币扩容的方案，但最终没被采用，因为基于DAG的分布式网络在保护共识方面很难比区块更有效。</p>
<h3 id="HashNet"><a href="#HashNet" class="headerlink" title="HashNet"></a>HashNet</h3><p><img src="/posts/92f9f6d1/HashNet%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6.webp"></p>
<p>HashNet采用分层分片共识机制, 上层网络中的节点称为全节点（full node），主要负责下层分片建立、下层分片重组、新局部全节点加入、局部全节点退出，不参与全局共识，也不参与记账，这避免了形成性能瓶颈的风险，极大的提高了交易吞吐量。下层网络中的节点称为局部全节点（local full node），形成各个分片，片内进行交易达成共识，采用后缀匹配法确保每笔交易只由一个特定的分片处理，避免了双重支付，同时片间通过异步机制同步各个片内的共识结果，从而达到每个局部全节点拥有全局账本。</p>
<p>HashNet共识机制的主要优势在于：</p>
<ol>
<li>全节点和局部全节点具有较强的稳定性和处理能力，能够有效避免HashGraph长时间无法达成共识的问题，也能够避免因网络被分割造成的恶意节点攻击问题；</li>
<li>与当前其他带分片的区块链项目相比，HashNet采用分布式异步分片重组，完全打破了集中式分片重组的机制，极大地提高了重组时的安全性；</li>
<li>交易共识不需要上层节点参与，交易达成速度极快（交易确认时间仅仅依赖于片内节点数量），更重要的是，交易吞吐量，即TPS，与下层分片数量成正比，即分片数量越多，TPS越高；</li>
<li>片内和片间节点均为对等，没有所谓的Leader，避免了潜在的中心化可能和性能瓶颈。</li>
</ol>
<h2 id="区块链项目"><a href="#区块链项目" class="headerlink" title="区块链项目"></a>区块链项目</h2><p><img src="/posts/92f9f6d1/%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A1%B9%E7%9B%AE%E5%88%86%E7%B1%BB.JPEG"></p>
<h2 id="实践一-创建区块链"><a href="#实践一-创建区块链" class="headerlink" title="实践一-创建区块链"></a>实践一-创建区块链</h2><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_1">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_1</a></p>
<h3 id="创建Block"><a href="#创建Block" class="headerlink" title="创建Block"></a>创建Block</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">package code</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line"></span><br><span class="line">    &quot;crypto/sha256&quot;</span><br><span class="line"></span><br><span class="line">    &quot;encoding/hex&quot;</span><br><span class="line"></span><br><span class="line">    &quot;time&quot;</span><br><span class="line"></span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type Block struct &#123;</span><br><span class="line"></span><br><span class="line">    Index        int64  // 区块编号</span><br><span class="line"></span><br><span class="line">    Timestamp    int64  // 区块时间戳</span><br><span class="line"></span><br><span class="line">    PreBlockHash string // 上一个区块Hash值</span><br><span class="line"></span><br><span class="line">    Hash         string // 当前区块Hash值</span><br><span class="line"></span><br><span class="line">    Data         string //区块数据</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (block *Block) Print()  &#123;</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;Index: %d\n&quot;, block.Index)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;PreHash: %s\n&quot;, block.PreBlockHash)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;CurHash: %s\n&quot;, block.Hash)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;Data: %s\n&quot;, block.Data)</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;Timestamp: %d\n&quot;, block.Timestamp)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** 计算Hash值 */</span><br><span class="line"></span><br><span class="line">func calculateHash(b Block) string &#123;</span><br><span class="line"></span><br><span class="line">    blockData := string(b.Index) + string(b.Timestamp) + string(b.PreBlockHash) + string(b.Data)</span><br><span class="line"></span><br><span class="line">    hashByte := sha256.Sum256([]byte(blockData))</span><br><span class="line"></span><br><span class="line">    return hex.EncodeToString(hashByte[:])</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** 生成下一个区块 */</span><br><span class="line"></span><br><span class="line">func GenNewBlock(preBlock Block, data string) Block &#123;</span><br><span class="line"></span><br><span class="line">    newBlock := Block&#123;&#125;</span><br><span class="line"></span><br><span class="line">    newBlock.Index = preBlock.Index + 1</span><br><span class="line"></span><br><span class="line">    newBlock.Timestamp = time.Now().Unix()</span><br><span class="line"></span><br><span class="line">    newBlock.PreBlockHash = preBlock.Hash</span><br><span class="line"></span><br><span class="line">    newBlock.Data = data</span><br><span class="line"></span><br><span class="line">    newBlock.Hash = calculateHash(newBlock)</span><br><span class="line"></span><br><span class="line">    return newBlock</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** 生成创始区块 */</span><br><span class="line"></span><br><span class="line">func GenGenesisBlock() Block &#123;</span><br><span class="line"></span><br><span class="line">    preBlock := Block&#123;&#125;</span><br><span class="line"></span><br><span class="line">    preBlock.Index = -1</span><br><span class="line"></span><br><span class="line">    preBlock.Hash = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    return GenNewBlock(preBlock, &quot;Genesis Block&quot;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建BlockChain"><a href="#创建BlockChain" class="headerlink" title="创建BlockChain"></a>创建BlockChain</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">package code</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line"></span><br><span class="line">    &quot;log&quot;</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">type BlockChain struct &#123;</span><br><span class="line"></span><br><span class="line">    Blocks []*Block</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (bc *BlockChain) Print() &#123;</span><br><span class="line"></span><br><span class="line">    for _, block := range bc.Blocks &#123;</span><br><span class="line"></span><br><span class="line">        block.Print()</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (bc *BlockChain) SendData(data string) &#123;</span><br><span class="line"></span><br><span class="line">    preBlock := bc.Blocks[len(bc.Blocks)-1]</span><br><span class="line"></span><br><span class="line">    newBlock := GenNewBlock(*preBlock, data)</span><br><span class="line"></span><br><span class="line">    bc.appendBlock(&amp;newBlock)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (bc *BlockChain) appendBlock(newBlock *Block) &#123;</span><br><span class="line"></span><br><span class="line">    if len(bc.Blocks) == 0 &#123;</span><br><span class="line"></span><br><span class="line">        bc.Blocks = append(bc.Blocks, newBlock)</span><br><span class="line"></span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if isValid(*newBlock, *bc.Blocks[len(bc.Blocks)-1]) &#123;</span><br><span class="line"></span><br><span class="line">        bc.Blocks = append(bc.Blocks, newBlock)</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        log.Print(&quot;invalid block!&quot;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func isValid(newBlock Block, oldBlock Block) bool &#123;</span><br><span class="line"></span><br><span class="line">    return (newBlock.Index-1 == oldBlock.Index) &amp;&amp;</span><br><span class="line"></span><br><span class="line">        (newBlock.PreBlockHash == oldBlock.Hash) &amp;&amp;</span><br><span class="line"></span><br><span class="line">        (calculateHash(newBlock) == newBlock.Hash)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewBlockChain() *BlockChain &#123;</span><br><span class="line"></span><br><span class="line">    genesisBLock := GenGenesisBlock()</span><br><span class="line"></span><br><span class="line">    blockChain := BlockChain&#123;&#125;</span><br><span class="line"></span><br><span class="line">    blockChain.appendBlock(&amp;genesisBLock)</span><br><span class="line"></span><br><span class="line">    return &amp;blockChain</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实践二-工作量证明"><a href="#实践二-工作量证明" class="headerlink" title="实践二-工作量证明"></a>实践二-工作量证明</h2><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_2">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_2</a></p>
<h3 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line"></span><br><span class="line">    &quot;time&quot;</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// Block keeps block headers</span><br><span class="line"></span><br><span class="line">type Block struct &#123;</span><br><span class="line"></span><br><span class="line">    Timestamp     int64</span><br><span class="line"></span><br><span class="line">    Data          []byte</span><br><span class="line"></span><br><span class="line">    PrevBlockHash []byte</span><br><span class="line"></span><br><span class="line">    Hash          []byte</span><br><span class="line"></span><br><span class="line">    Nonce         int   // 跟工作量证明相关</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewBlock creates and returns Block</span><br><span class="line"></span><br><span class="line">func NewBlock(data string, prevBlockHash []byte) *Block &#123;</span><br><span class="line"></span><br><span class="line">    block := &amp;Block&#123;time.Now().Unix(), []byte(data), prevBlockHash, []byte&#123;&#125;, 0&#125;</span><br><span class="line"></span><br><span class="line">    pow := NewProofOfWork(block)</span><br><span class="line"></span><br><span class="line">    nonce, hash := pow.Run()</span><br><span class="line"></span><br><span class="line">    block.Hash = hash[:]</span><br><span class="line"></span><br><span class="line">    block.Nonce = nonce</span><br><span class="line"></span><br><span class="line">    return block</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewGenesisBlock creates and returns genesis Block</span><br><span class="line"></span><br><span class="line">func NewGenesisBlock() *Block &#123;</span><br><span class="line"></span><br><span class="line">    return NewBlock(&quot;Genesis Block&quot;, []byte&#123;&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BlockChain"><a href="#BlockChain" class="headerlink" title="BlockChain"></a>BlockChain</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">// Blockchain keeps a sequence of Blocks</span><br><span class="line"></span><br><span class="line">type Blockchain struct &#123;</span><br><span class="line"></span><br><span class="line">    blocks []*Block</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// AddBlock saves provided data as a block in the blockchain</span><br><span class="line"></span><br><span class="line">func (bc *Blockchain) AddBlock(data string) &#123;</span><br><span class="line"></span><br><span class="line">    prevBlock := bc.blocks[len(bc.blocks)-1]</span><br><span class="line"></span><br><span class="line">    newBlock := NewBlock(data, prevBlock.Hash)</span><br><span class="line"></span><br><span class="line">    bc.blocks = append(bc.blocks, newBlock)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewBlockchain creates a new Blockchain with genesis Block</span><br><span class="line"></span><br><span class="line">func NewBlockchain() *Blockchain &#123;</span><br><span class="line"></span><br><span class="line">    return &amp;Blockchain&#123;[]*Block&#123;NewGenesisBlock()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ProofOfWork"><a href="#ProofOfWork" class="headerlink" title="ProofOfWork"></a>ProofOfWork</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line"></span><br><span class="line">    &quot;bytes&quot;</span><br><span class="line"></span><br><span class="line">    &quot;crypto/sha256&quot;</span><br><span class="line"></span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">    &quot;math&quot;</span><br><span class="line"></span><br><span class="line">    &quot;math/big&quot;</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">var (</span><br><span class="line"></span><br><span class="line">    maxNonce = math.MaxInt64</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const targetBits = 24</span><br><span class="line"></span><br><span class="line">// ProofOfWork represents a proof-of-work</span><br><span class="line"></span><br><span class="line">type ProofOfWork struct &#123;</span><br><span class="line"></span><br><span class="line">    block  *Block</span><br><span class="line"></span><br><span class="line">    target *big.Int</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// NewProofOfWork builds and returns a ProofOfWork</span><br><span class="line"></span><br><span class="line">func NewProofOfWork(b *Block) *ProofOfWork &#123;</span><br><span class="line"></span><br><span class="line">    target := big.NewInt(1)</span><br><span class="line"></span><br><span class="line">    target.Lsh(target, uint(256-targetBits))</span><br><span class="line"></span><br><span class="line">    pow := &amp;ProofOfWork&#123;b, target&#125;</span><br><span class="line"></span><br><span class="line">    return pow</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (pow *ProofOfWork) prepareData(nonce int) []byte &#123;</span><br><span class="line"></span><br><span class="line">    data := bytes.Join(</span><br><span class="line"></span><br><span class="line">        [][]byte&#123;</span><br><span class="line"></span><br><span class="line">            pow.block.PrevBlockHash,</span><br><span class="line"></span><br><span class="line">            pow.block.Data,</span><br><span class="line"></span><br><span class="line">            IntToHex(pow.block.Timestamp),</span><br><span class="line"></span><br><span class="line">            IntToHex(int64(targetBits)),</span><br><span class="line"></span><br><span class="line">            IntToHex(int64(nonce)),</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        []byte&#123;&#125;,</span><br><span class="line"></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    return data</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Run performs a proof-of-work</span><br><span class="line"></span><br><span class="line">func (pow *ProofOfWork) Run() (int, []byte) &#123;</span><br><span class="line"></span><br><span class="line">    var hashInt big.Int</span><br><span class="line"></span><br><span class="line">    var hash [32]byte</span><br><span class="line"></span><br><span class="line">    nonce := 0</span><br><span class="line"></span><br><span class="line">    fmt.Printf(&quot;Mining the block containing \&quot;%s\&quot;\n&quot;, pow.block.Data)</span><br><span class="line"></span><br><span class="line">    for nonce &lt; maxNonce &#123;</span><br><span class="line"></span><br><span class="line">        data := pow.prepareData(nonce)</span><br><span class="line"></span><br><span class="line">        hash = sha256.Sum256(data)</span><br><span class="line"></span><br><span class="line">        fmt.Printf(&quot;\r%x&quot;, hash)</span><br><span class="line"></span><br><span class="line">        hashInt.SetBytes(hash[:])</span><br><span class="line"></span><br><span class="line">        if hashInt.Cmp(pow.target) == -1 &#123;</span><br><span class="line"></span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            nonce++</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Print(&quot;\n\n&quot;)</span><br><span class="line"></span><br><span class="line">    return nonce, hash[:]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Validate validates block&#x27;s PoW</span><br><span class="line"></span><br><span class="line">func (pow *ProofOfWork) Validate() bool &#123;</span><br><span class="line"></span><br><span class="line">    var hashInt big.Int</span><br><span class="line"></span><br><span class="line">    data := pow.prepareData(pow.block.Nonce)</span><br><span class="line"></span><br><span class="line">    hash := sha256.Sum256(data)</span><br><span class="line"></span><br><span class="line">    hashInt.SetBytes(hash[:])</span><br><span class="line"></span><br><span class="line">    isValid := hashInt.Cmp(pow.target) == -1</span><br><span class="line"></span><br><span class="line">    return isValid</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实践三-持久化-bolt"><a href="#实践三-持久化-bolt" class="headerlink" title="实践三-持久化(bolt)"></a>实践三-持久化(bolt)</h2><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_3">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_3</a></p>
<h2 id="实践四-交易"><a href="#实践四-交易" class="headerlink" title="实践四-交易"></a>实践四-交易</h2><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_4">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_4</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">type Block struct &#123;</span><br><span class="line"></span><br><span class="line">    Timestamp     int64</span><br><span class="line"></span><br><span class="line">    Transactions  []*Transaction</span><br><span class="line"></span><br><span class="line">    PrevBlockHash []byte</span><br><span class="line"></span><br><span class="line">    Hash          []byte</span><br><span class="line"></span><br><span class="line">    Nonce         int</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// Transaction represents a Bitcoin transaction</span><br><span class="line"></span><br><span class="line">type Transaction struct &#123;</span><br><span class="line"></span><br><span class="line">    ID   []byte</span><br><span class="line"></span><br><span class="line">    Vin  []TXInput</span><br><span class="line"></span><br><span class="line">    Vout []TXOutput</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TXInput represents a transaction input</span><br><span class="line"></span><br><span class="line">type TXInput struct &#123;</span><br><span class="line"></span><br><span class="line">    Txid      []byte</span><br><span class="line"></span><br><span class="line">    Vout      int</span><br><span class="line"></span><br><span class="line">    ScriptSig string</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TXOutput represents a transaction output</span><br><span class="line"></span><br><span class="line">type TXOutput struct &#123;</span><br><span class="line"></span><br><span class="line">    Value        int</span><br><span class="line"></span><br><span class="line">    ScriptPubKey string</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实践五-地址及身份标识"><a href="#实践五-地址及身份标识" class="headerlink" title="实践五-地址及身份标识"></a>实践五-地址及身份标识</h2><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_5">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_5</a></p>
<h2 id="实践六-钱包-x2F-交易-x2F-RPC"><a href="#实践六-钱包-x2F-交易-x2F-RPC" class="headerlink" title="实践六-钱包&#x2F;交易&#x2F;RPC"></a>实践六-钱包&#x2F;交易&#x2F;RPC</h2><p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_6">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_6</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/part_7">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;part_7</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ljd1996/blockchain_go/tree/master">https://github.com/ljd1996/blockchain_go&#x2F;tree&#x2F;master</a></p>
<!-- flag of hidden posts -->
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/private/" rel="tag"># private</a>
          
            <a href="/tags/clippings/" rel="tag"># clippings</a>
          
        </div>
      

      
      
      

      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">276</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%E6%A6%82%E8%BF%B0"><span class="nav-text">区块链概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%A6%E6%9C%AC%E9%AA%8C%E8%AF%81"><span class="nav-text">账本验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%A6%E6%88%B7%E6%89%80%E6%9C%89%E6%9D%83"><span class="nav-text">账户所有权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%92%B1%E5%8C%85"><span class="nav-text">钱包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%96%E7%9F%BF%EF%BC%88%E8%AE%B0%E8%B4%A6%EF%BC%89"><span class="nav-text">挖矿（记账）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B1%E8%AF%86%E6%9C%BA%E5%88%B6"><span class="nav-text">共识机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%A4%E6%98%93%E5%8E%9F%E7%90%86"><span class="nav-text">交易原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E7%89%B9%E5%B8%81%E7%9A%84UTXO%E6%A8%A1%E5%9E%8B"><span class="nav-text">比特币的UTXO模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%98%93%E5%88%86%E7%B1%BB"><span class="nav-text">交易分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%98%93%E8%BF%87%E7%A8%8B"><span class="nav-text">交易过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%98%93%E8%84%9A%E6%9C%AC"><span class="nav-text">交易脚本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B"><span class="nav-text">区块链架构模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%93%BE%E5%BC%8F%E7%BB%93%E6%9E%84"><span class="nav-text">链式结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ICO%E5%92%8CIPO"><span class="nav-text">ICO和IPO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="nav-text">智能合约</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A"><span class="nav-text">以太坊</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%8F%89"><span class="nav-text">分叉</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AC%E5%88%86%E5%8F%89"><span class="nav-text">硬分叉</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AF%E5%88%86%E5%8F%89"><span class="nav-text">软分叉</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95"><span class="nav-text">共识算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PoW"><span class="nav-text">PoW</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PoS"><span class="nav-text">PoS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DPoS"><span class="nav-text">DPoS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%97%E6%B3%95%E6%A6%82%E8%BF%B0"><span class="nav-text">算法概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A3%E5%B8%B8%E6%93%8D%E4%BD%9C"><span class="nav-text">正常操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%91%E6%95%B0%E5%88%86%E5%8F%89"><span class="nav-text">少数分叉</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A6%BB%E7%BA%BF%E5%B0%91%E6%95%B0%E7%9A%84%E5%A4%9A%E9%87%8D%E7%94%9F%E4%BA%A7"><span class="nav-text">离线少数的多重生产</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E7%A2%8E%E7%89%87%E5%8C%96"><span class="nav-text">网络碎片化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E7%BA%BF%E5%B0%91%E6%95%B0%E7%9A%84%E5%A4%9A%E9%87%8D%E7%94%9F%E4%BA%A7"><span class="nav-text">在线少数的多重生产</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E4%B8%8D%E5%8F%AF%E9%80%86%E5%9D%97"><span class="nav-text">最后不可逆块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E6%95%B0%E7%94%9F%E4%BA%A7%E8%80%85%E8%88%9E%E5%BC%8A"><span class="nav-text">多数生产者舞弊</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E6%80%A7%E7%94%9F%E4%BA%A7%E8%80%85%E6%B4%97%E7%89%8C"><span class="nav-text">确定性生产者洗牌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-text">结论</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PoW-PoS-%E6%B7%B7%E5%90%88%E6%9C%BA%E5%88%B6"><span class="nav-text">PoW + PoS 混合机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DAG"><span class="nav-text">DAG</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-text">概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DAG%E4%BF%9D%E8%AF%81%E8%B4%A6%E6%9C%AC%E5%AE%89%E5%85%A8"><span class="nav-text">DAG保证账本安全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HashNet"><span class="nav-text">HashNet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A1%B9%E7%9B%AE"><span class="nav-text">区块链项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%B8%80-%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="nav-text">实践一-创建区块链</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BABlock"><span class="nav-text">创建Block</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BABlockChain"><span class="nav-text">创建BlockChain</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%BA%8C-%E5%B7%A5%E4%BD%9C%E9%87%8F%E8%AF%81%E6%98%8E"><span class="nav-text">实践二-工作量证明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Block"><span class="nav-text">Block</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BlockChain"><span class="nav-text">BlockChain</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProofOfWork"><span class="nav-text">ProofOfWork</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%B8%89-%E6%8C%81%E4%B9%85%E5%8C%96-bolt"><span class="nav-text">实践三-持久化(bolt)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E5%9B%9B-%E4%BA%A4%E6%98%93"><span class="nav-text">实践四-交易</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E4%BA%94-%E5%9C%B0%E5%9D%80%E5%8F%8A%E8%BA%AB%E4%BB%BD%E6%A0%87%E8%AF%86"><span class="nav-text">实践五-地址及身份标识</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E5%85%AD-%E9%92%B1%E5%8C%85-x2F-%E4%BA%A4%E6%98%93-x2F-RPC"><span class="nav-text">实践六-钱包&#x2F;交易&#x2F;RPC</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>