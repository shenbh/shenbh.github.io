<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="安卓问题," />










<meta name="description" content="问题收录：第三方登录、第三方支付、推送、分享、ARouter路由、地图等">
<meta property="og:type" content="article">
<meta property="og:title" content="第三方相关问题">
<meta property="og:url" content="http://shenbh.github.io/posts/187306977/index.html">
<meta property="og:site_name" content="AB">
<meta property="og:description" content="问题收录：第三方登录、第三方支付、推送、分享、ARouter路由、地图等">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/981009fdly1gi4aaukt3xj21ha15jtd4.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/981009fdly1gjvmcwvaa2j20z706w74p.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/187306977/%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A41.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/187306977/%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A42.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/187306977/%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A43.png">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/981009fdly1gjmj1ghuucj226i12ualt.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/981009fdly1gjmj1y8pgwj226w16ynav.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/981009fdly1gjmj2gohrbj21tm0r013t.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/981009fdly1gjmj2or30rj21zg0ua16w.jpg">
<meta property="og:image" content="http://shenbh.github.io/posts/187306977/%E6%8F%90%E7%A4%BA%E5%8F%8B%E7%9B%9F%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E5%BA%93%E7%89%88%E6%9C%AC%E5%A4%AA%E4%BD%8E.png">
<meta property="article:published_time" content="2021-04-30T05:46:00.000Z">
<meta property="article:modified_time" content="2022-12-21T07:32:53.634Z">
<meta property="article:author" content="阿炳">
<meta property="article:tag" content="安卓问题">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/981009fdly1gi4aaukt3xj21ha15jtd4.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/187306977/"/>





  <title>第三方相关问题 | AB</title>
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AB</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Just do IT Now.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/187306977/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AB">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">第三方相关问题</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-04-30T13:46:00+08:00">
                2021-04-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>问题收录：第三方登录、第三方支付、推送、分享、ARouter路由、地图等</p>
<span id="more"></span>


<h1 id="第三方登录"><a href="#第三方登录" class="headerlink" title="第三方登录"></a>第三方登录</h1><h2 id="友盟-微信登录授权不走回调"><a href="#友盟-微信登录授权不走回调" class="headerlink" title="友盟 微信登录授权不走回调"></a>友盟 微信登录授权不走回调</h2><p>问题：微信登录没有获取到用户信息、没有反应</p>
<p>解决：</p>
<ol>
<li>确认能否进入微信客户端授权确认页面</li>
</ol>
<p>如果不能进入微信授权页面，或者在微信客户端账号未登录状态下只能进入输入账号密码页面，说明签名验证失败，请检查签名是否一致。</p>
<ol start="2">
<li>进入微信授权确认页面，点击后没有返回对应的用户资料</li>
</ol>
<p>进入这一步多半是由于微信回调配置错误导致，首先打开 Debug 模式日志，查看回调Activity（<code>WXEntryActivity.java</code>） 配置是否正常。</p>
<p>如果确认回调 Activity 及<code>AndroidManifest.xml</code>中微信相关配置都正确，需要确认 <code>WXEntryActivity.java</code>中有无复写其他 SDK（如支付、微信原生登录）的回调逻辑，<code>UShare SDK</code>要求留一个空类，相关回调结果在<code>jar</code>中实现，如微信精简版中 Demo 里的配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WXEntryActivity</span> <span class="keyword">extends</span> <span class="title class_">WXCallbackActivity</span>&#123;&#125;</span><br></pre></td></tr></table></figure>





<h1 id="支付相关"><a href="#支付相关" class="headerlink" title="支付相关"></a>支付相关</h1><h2 id="微信支付相关"><a href="#微信支付相关" class="headerlink" title="微信支付相关"></a>微信支付相关</h2><h3 id="微信支付调用不起来的问题（AsyncTask的坑）"><a href="#微信支付调用不起来的问题（AsyncTask的坑）" class="headerlink" title="微信支付调用不起来的问题（AsyncTask的坑）"></a>微信支付调用不起来的问题（AsyncTask的坑）</h3><p>AsyncTask如果有 4、5个线程，则会阻塞。<br>解决：可换成 RxJava</p>
<p><img src="http://ww1.sinaimg.cn/large/981009fdly1gi4aaukt3xj21ha15jtd4.jpg" alt="微信支付调用不起来的问题(AsyncTask的坑).png"></p>
<h3 id="WXPayEntryActivity-不回调问题"><a href="#WXPayEntryActivity-不回调问题" class="headerlink" title="WXPayEntryActivity 不回调问题"></a>WXPayEntryActivity 不回调问题</h3><ol>
<li>注意包名：平台注册的包名+.wxapi.WXPayEntryActivity （完整com.xxx.wxapi.WXPayEntryActivity）</li>
<li>注意类名 WXPayEntryActivity 不能写错，在清单文件中进行注册</li>
<li>在清单文件中检查WXPayEntryActivity是否有<code>android:exported=&quot;true&quot;</code>属性（此属性作用是标记可被别的Application组件调用）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多渠道的情况下，包名不一致，底下的yyy.yyy等导入信息是共用的</span></span><br><span class="line"><span class="keyword">package</span> xxx.xxx.test.wxapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tencent.mm.opensdk.constants.ConstantsAPI;</span><br><span class="line"><span class="keyword">import</span> com.tencent.mm.opensdk.modelbase.BaseReq;</span><br><span class="line"><span class="keyword">import</span> com.tencent.mm.opensdk.modelbase.BaseResp;</span><br><span class="line"><span class="keyword">import</span> com.tencent.mm.opensdk.openapi.IWXAPI;</span><br><span class="line"><span class="keyword">import</span> com.tencent.mm.opensdk.openapi.IWXAPIEventHandler;</span><br><span class="line"><span class="keyword">import</span> com.tencent.mm.opensdk.openapi.WXAPIFactory;</span><br><span class="line"><span class="keyword">import</span> com.u1city.androidframe.common.toast.ToastUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> yyy.yyy.R;</span><br><span class="line"><span class="keyword">import</span> yyy.yyy.core.Constants;</span><br><span class="line"><span class="keyword">import</span> yyy.yyy.sdk.pay.IPayCallBack;</span><br><span class="line"><span class="keyword">import</span> yyy.yyy.sdk.pay.WXPayHelper;</span><br><span class="line"><span class="keyword">import</span> yyy.yyy.view.DaogouBaseActivity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> * 微信支付结果回调</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WXPayEntryActivity</span> <span class="keyword">extends</span> <span class="title class_">DaogouBaseActivity</span> <span class="keyword">implements</span> <span class="title class_">IWXAPIEventHandler</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IWXAPI m_WXApi;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState, R.layout.activity_wxpay_entry, R.layout.title_default);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initView</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        context = <span class="built_in">this</span>;</span><br><span class="line">        m_WXApi = WXAPIFactory.createWXAPI(<span class="built_in">this</span>, Constants.APP_ID);</span><br><span class="line">        m_WXApi.handleIntent(getIntent(), <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onNewIntent</span><span class="params">(Intent intent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>.onNewIntent(intent);</span><br><span class="line">        setIntent(intent);</span><br><span class="line">        m_WXApi.handleIntent(intent, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreateOptionsMenu</span><span class="params">(Menu menu)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.wxpay_entry, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReq</span><span class="params">(BaseReq arg0)</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResp</span><span class="params">(BaseResp p_BaseResp)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (p_BaseResp.getType() == ConstantsAPI.COMMAND_PAY_BY_WX)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m_PayResult</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (p_BaseResp.errCode == -<span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                ToastUtil.showToast(context, <span class="string">&quot;您取消了支付&quot;</span>);</span><br><span class="line">                m_PayResult = -<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (p_BaseResp.errCode == -<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">m_ErroInfor</span> <span class="operator">=</span> StringUtils.isEmpty(p_BaseResp.errStr) ? <span class="string">&quot;未返回具体原因&quot;</span> : p_BaseResp.errStr;</span><br><span class="line">                ToastUtil.showToast(context, <span class="string">&quot;支付失败:&quot;</span> + m_ErroInfor);</span><br><span class="line">                m_PayResult = -<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">IPayCallBack</span> <span class="variable">m_IPayCallBack</span> <span class="operator">=</span> WXPayHelper.getIPayCallBack();</span><br><span class="line">            <span class="keyword">if</span> (m_IPayCallBack != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                m_IPayCallBack.payCallBack(m_PayResult);</span><br><span class="line">            &#125;</span><br><span class="line">            finishAnimation();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="微信支付回调java-lang-IllegalStateException-Already-attached"><a href="#微信支付回调java-lang-IllegalStateException-Already-attached" class="headerlink" title="微信支付回调java.lang.IllegalStateException: Already attached"></a>微信支付回调<code>java.lang.IllegalStateException: Already attached</code></h3><p>解决：在<code>WXPayEntryActivity.java</code>的<code>onCreate</code>中用了自定义的<code>super.onCreate(savedInstanceState, R.layout.activity_wxpay_entry, R.layout.title_default);</code>改成系统的<code>super.onCreate(savedInstanceState);</code>即可</p>
<h3 id="微信支付：弹起支付页面但是原来的页面走了onPause没有走onStop方法"><a href="#微信支付：弹起支付页面但是原来的页面走了onPause没有走onStop方法" class="headerlink" title="微信支付：弹起支付页面但是原来的页面走了onPause没有走onStop方法"></a>微信支付：弹起支付页面但是原来的页面走了onPause没有走onStop方法</h3><p>命令<code>adb shell dumpsys activity | findstr Run</code>查看当前运行的Activity</p>
<p><img src="http://ww1.sinaimg.cn/large/981009fdly1gjvmcwvaa2j20z706w74p.jpg" alt="调微信支付本身页面不走onStop.png"></p>
<p>猜测<code>com.tencent.mm/.plugin.wallet_index.ui.OrderHandlerUI</code>是个Activity当成加载的loading（dialog），此时底部的<code>PayActivity</code>还处于可见状态（调起<code>onPause()</code>），之后<code>OrderHandlerUI</code>自身又调起<code>com.tencent.mm/.framework.app.UIPageFragmentActivity</code>这个Activity，使得<code>PayActivity</code>不可见</p>
<p>但<code>UIPageFragmentActivity</code>和<code>PayActivity</code>不是相邻的（中间隔了一个<code>OrderHandlerUI</code>）所以影响不到<code>PayActivity</code>的生命周期，即不会触发<code>PayActivity</code>的<code>onStop</code>方法</p>
<h3 id="App微信支付“支付验证签名失败”"><a href="#App微信支付“支付验证签名失败”" class="headerlink" title="App微信支付“支付验证签名失败”"></a>App微信支付“支付验证签名失败”</h3><ol>
<li><p>断点查看，appid等是否需要加解密（即接口返回的appId是否是加密过的），最终调起微信sdk的时候appId是”wx…”开头的（未加密的）</p>
</li>
<li><p>接口需要返回的字段有（其中sign要和统一下单的时一样签名过；且生成sign的参数顺序按下方的顺序）</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000017867855">https://segmentfault.com/a/1190000017867855</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payBean.setAppId((String) data.get(<span class="string">&quot;appid&quot;</span>));</span><br><span class="line">payBean.setNonceStr((String) data.get(<span class="string">&quot;noncestr&quot;</span>));</span><br><span class="line">payBean.setSign((String) data.get(<span class="string">&quot;sign&quot;</span>));</span><br><span class="line">payBean.setPrepayId((String) data.get(<span class="string">&quot;prepayid&quot;</span>));</span><br><span class="line">payBean.setPartnerId((String) data.get(<span class="string">&quot;partnerid&quot;</span>));</span><br><span class="line">payBean.setTimeStamp((String) data.get(<span class="string">&quot;timestamp&quot;</span>));</span><br><span class="line">payBean.setPackages((String) data.get(<span class="string">&quot;package&quot;</span>));<span class="comment">//固定值&quot;Sing=WXPay&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="微信WAP支付提示”商家参数格式有误，请联系商家解决”"><a href="#微信WAP支付提示”商家参数格式有误，请联系商家解决”" class="headerlink" title="微信WAP支付提示”商家参数格式有误，请联系商家解决”"></a>微信WAP支付提示”商家参数格式有误，请联系商家解决”</h2><p>问题：安卓<code>webView</code>内的外部商家开发的链接，点立即购买后调起微信这一步出现“商家参数格式有误，请联系商家解决”</p>
<p>解决：找到<a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_4">微信官方给出的文档</a> </p>
<p>另外参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cfba1d7179e3">另一篇解决方案</a></p>
<p>在<code>WebView</code>的<code>shouldOverrideUrlLoading</code>内加上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">MyWebViewClient</span> <span class="keyword">extends</span> <span class="title class_">WebViewClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (url.startsWith(<span class="string">&quot;https://wx.tenpay.com&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//H5微信支付要用，不然说&quot;商家参数格式有误&quot;</span></span><br><span class="line">            Map&lt;String, String&gt; extraHeaders = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">            extraHeaders.put(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;http://yx.dagangcheng.com&quot;</span>);<span class="comment">//替换成自己的“商户申请H5时提交的授权域名”</span></span><br><span class="line">            view.loadUrl(url, extraHeaders);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url.startsWith(<span class="string">&quot;weixin://wap/pay?&quot;</span>) || url.startsWith(<span class="string">&quot;http://weixin/wap/pay&quot;</span>) ) &#123;<span class="comment">//上面的代码校验通过后会组装成“:weixin://wap/pay?prepayid...”格式的链接来调起微信支付（通过weixin://wap/pay?的协议调起的，其中weixin:与http类似）</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="string">&quot;android.intent.action.VIEW&quot;</span>, Uri.parse(url)));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">//做些其他的错误提示，比如以下的</span></span><br><span class="line">                <span class="comment">/*new CancelOrOkDialog(H5PayActivity.this, getString(R.string.h5_pay_no_pay_app)) &#123;</span></span><br><span class="line"><span class="comment">                       @Override</span></span><br><span class="line"><span class="comment">                       public void ok() &#123;</span></span><br><span class="line"><span class="comment">                           Intent intent = new Intent(H5PayActivity.this, MainActivity.class);</span></span><br><span class="line"><span class="comment">                           intent.putExtra(Constants.SELECTTAB, 0);</span></span><br><span class="line"><span class="comment">                           startActivity(intent);</span></span><br><span class="line"><span class="comment">                       &#125;</span></span><br><span class="line"><span class="comment">                   &#125;;*/</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="微信小程序支付，无法返回应用"><a href="#微信小程序支付，无法返回应用" class="headerlink" title="微信小程序支付，无法返回应用"></a>微信小程序支付，无法返回应用</h2><p>问题：App调用微信小程序支付，跳到小程序窗口后，部分手机（如vivo）点击“返回应用”无反应</p>
<p>解决：在App内点微信分享后再次小程序支付，可以返回App，所以分析应该是微信没有保存App信息到本地的原因。无法解决。</p>
<h2 id="集成支付宝-sdk-遇到的问题"><a href="#集成支付宝-sdk-遇到的问题" class="headerlink" title="集成支付宝 sdk 遇到的问题"></a>集成支付宝 sdk 遇到的问题</h2><ol>
<li><code>Duplicate zip entry[classes.jar:com/ut/device/UTDevice.class]</code></li>
</ol>
<p>原因：支付 sdk 和友盟 sdk 都有这个文件</p>
<p>解决：支付 sdk 下载个不再 utdevice 的 aar 包</p>
<ol start="2">
<li><code>Failed to resolve::alipaySdk-15.6.8-20191021122455-noUtdid:Open File</code></li>
</ol>
<p>原因：alipay 项目找不到这个 aar 文件</p>
<p>解决：在项目的根目录 <code>build.gradle</code>中增加（<code>flatDir</code>）如下代码：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* allprojects 代码块用来配置工程中所有 modules 都要使用的仓库和依赖</span></span><br><span class="line"><span class="comment">* 但是你应该在每个 module 级的 build 文件中配置 module 独有的依赖。</span></span><br><span class="line"><span class="comment">* 对于一个新工程，Android Studio 默认会让所有 modules 使用 JCenter 仓库和 Google 的 Maven 仓库</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral()</span><br><span class="line">        <span class="comment">//使用开源中国的maven库代替jcenter()</span></span><br><span class="line">        <span class="comment">//阿里云的(速度飞快)：http://maven.aliyun.com/nexus/content/groups/public/</span></span><br><span class="line"><span class="comment">//        maven &#123;</span></span><br><span class="line"><span class="comment">//            url &#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        maven &#123; url <span class="string">&quot;https://jitpack.io&quot;</span> &#125;</span><br><span class="line">        maven &#123; url <span class="string">&#x27;https://oss.sonatype.org/content/repositories/snapshots&#x27;</span> &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="string">&#x27;https://maven.google.com/&#x27;</span></span><br><span class="line">            name <span class="string">&#x27;Google&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">//支付宝需要增加这个</span></span><br><span class="line">        flatDir &#123;</span><br><span class="line">            dirs <span class="string">&#x27;libs&#x27;</span></span><br><span class="line">            dirs <span class="string">&#x27;../AliSDK/libs&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//全局设定编码与java版本</span></span><br><span class="line">    tasks.withType(JavaCompile) &#123;</span><br><span class="line">        options.encoding = <span class="string">&quot;UTF-8&quot;</span></span><br><span class="line">        sourceCompatibility = JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility = JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="集成威富通支付遇到的问题"><a href="#集成威富通支付遇到的问题" class="headerlink" title="集成威富通支付遇到的问题"></a>集成威富通支付遇到的问题</h2><p>注意：别坚信demo，别坚信文档！！！（豹奔–膳闯项目）</p>
<ol>
<li><p>android端，本地不做预下单（不安全）。预下单是后台做的。查询订单也是后台的。android端做的：接收后台提供的token_id，并结合微信appid调起支付的sdk就ok了（注意在注册清单文件中对应页面的Activity里要写上这个微信appid）</p>
</li>
<li><p>后台的坑：appid要改成sub_appid，demo和文档要结合着来看。</p>
</li>
</ol>
<h2 id="支付宝支付"><a href="#支付宝支付" class="headerlink" title="支付宝支付"></a>支付宝支付</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/s_nshine/article/details/97006855">集成支付宝支付出现{resultStatus&#x3D;4000, result&#x3D;, memo&#x3D;系统繁忙,请稍后再试}</a></p>
<ol>
<li><p>{resultStatus&#x3D;4000, result&#x3D;, memo&#x3D;系统繁忙,请稍后再试}</p>
<p>如果APPID，PID，TARGET_ID，RSA2_PRIVATE都正确的情况下，看手机<strong>是否已安装支付宝应用</strong></p>
</li>
<li><p>{resultStatus&#x3D;4000, result&#x3D;{“alipay_trade_app_pay_response”:{“code”:”40006”,”msg”:”Insufficient Permissions”,”sub_code”:”isv.insufficient-isv-permissions”,”sub_msg”:”ISV权限不足，建议在开发者中心检查应用是否上线”}}, memo&#x3D;}</p>
<p>应用没有上线的原因</p>
</li>
</ol>
<h1 id="推送相关"><a href="#推送相关" class="headerlink" title="推送相关"></a>推送相关</h1><h2 id="友盟无法推送问题"><a href="#友盟无法推送问题" class="headerlink" title="友盟无法推送问题"></a>友盟无法推送问题</h2><h3 id="排查步骤："><a href="#排查步骤：" class="headerlink" title="排查步骤："></a>排查步骤：</h3><ol>
<li>ios和安卓是否都不可以，排查是否是后台问题</li>
<li>看参数，是否加IP白名单<br>2.1. 看gradle中配置的参数、看友盟控制台配置的参数、看后台配置的参数（注意正式线还是测试线）<br> 2.2. 在友盟控制台模拟发送，（从AS取友盟Token）发送给特定用户</li>
<li>ios证书是否配置了</li>
</ol>
<h3 id="又一城安卓友盟推送问题排查步骤"><a href="#又一城安卓友盟推送问题排查步骤" class="headerlink" title="又一城安卓友盟推送问题排查步骤"></a>又一城安卓友盟推送问题排查步骤</h3><ol>
<li><p>确认安卓和ios是否单端出现问题，如果单端出现问题，那么大概率是APP端的问题，需要各自排查问题；</p>
</li>
<li><p>单端出现问题的情况下，需要先排查与友盟的对接是否出现问题，先在友盟的后台通过推送测试消息，<br>可同时测试独立用户（设备码）和特定用户（别名），如果无法推送成功，那么就是与友盟的对接出现了问题，需要排查参数的配置是否出错；</p>
</li>
<li><p>排查参数配置时需要排查代码、友盟后台、后台的AppKey、MasterSecret、MessageSecret的参数配置，<br>IOS还需要排查证书；其中后台的配置地址为：<br>后台顾客端参数配置：域名&#x2F;weChat&#x2F;appGenerationSuccess<br>后台导购端参数配置：域名&#x2F;appPackage&#x2F;guideAppGenerationSuccess<br>如果参数配置没有问题，通过友盟后台推送还是失败，那可能是代码中出现错误；</p>
</li>
<li><p>在双端友盟推送能够成功，并且在确定各端友盟对应应用已配置了IP白名单（IP为域名对外访问对应的IP。比如阿里云给的IP）的情况下<br>(注：需要确定友盟控制台已添加IP白名单)在确定白名单已经配置的情况下，<br>Android端和IOS端会同时出现问题，那么大概率可能是后台的问题，需要告知后台帮忙排查解决问题</p>
</li>
<li><p>推送失败信息如下：<br>什么是DeviceTokenNotForTopic</p>
<ul>
<li>DeviceToken和当前的bundleID不匹配<br>一般是推送证书有问题，需要重新上传证书。<br>注：在项目未发布的时候就要针对推送进行测试，及时发现问题并解决，如果发现了推送问题，可参照以上的步骤进行排查</li>
</ul>
</li>
<li><p>关于友盟后台推送可以收到，又一城后台推送收不到</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 排查参数：查看友盟后台登记的参数、app中的参数、又一城后台登记的第三方参数（注意：<span class="strong">**有可能message和secret参数顺序填反**</span>）</span><br><span class="line"><span class="bullet">2.</span> 排查友盟后台是否有填IP白名单</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="友盟推送问题排查步骤"><a href="#友盟推送问题排查步骤" class="headerlink" title="友盟推送问题排查步骤"></a>友盟推送问题排查步骤</h3><p>1：先排查是Android端会出现问题，还是IOS端会出现问题，如果是单端出现问题（Android端或者IOS端），那么大概率是APP端的问题，需要各自排查问题；</p>
<p>2：单端（Android或者IOS端）出现问题的情况下，需要先排查与友盟的对接是否出现问题，先在友盟的后台通过推送测试消息，可同时测试独立用户（设备码）和特定用户（别名），如果无法推送成功，那么就是与友盟的对接出现了问题，需要排查参数的配置是否出错；</p>
<p><img src="/posts/187306977/%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A41.jpg" alt="img"> </p>
<p>3：排查参数配置时需要排查代码、友盟后台、后台的AppKey、MasterSecret、MessageSecret的参数配置，IOS还需要排查证书；其中后台的配置地址为：</p>
<p>后台顾客端参数配置：域名&#x2F;weChat&#x2F;appGenerationSuccess</p>
<p>后台导购端参数配置：域名&#x2F;appPackage&#x2F;guideAppGenerationSuccess</p>
<p>如果参数配置没有问题，通过友盟后台推送还是失败，那可能是代码中出现错误；</p>
<p>4：在双端友盟推送能够成功，并且在确定各端友盟对应应用已配置了白名单的情况下(注：需要确定友盟已添加白名单)，白名单配置如下图：</p>
<p><img src="/posts/187306977/%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A42.jpg" alt="img"> </p>
<p>在确定白名单已经配置的情况下，Android端和IOS端会同时出现问题，那么大概率可能是后台的问题，需要告知后台帮忙排查解决问题</p>
<p>5：推送失败信息如下：</p>
<p><img src="/posts/187306977/%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A43.png" alt="img"> </p>
<p>一般是推送证书有问题，重新上传下。</p>
<p>注：在项目未发布的时候就要针对推送进行测试，及时发现问题并解决，如果发现了推送问题，可参照以上的步骤进行排查</p>
<h2 id="友盟推送错误"><a href="#友盟推送错误" class="headerlink" title="友盟推送错误"></a>友盟推送错误</h2><h3 id="友盟注册报错-s-x3D-11-s1-x3D-accs-bindapp-error"><a href="#友盟注册报错-s-x3D-11-s1-x3D-accs-bindapp-error" class="headerlink" title="友盟注册报错 s&#x3D;-11,s1&#x3D;accs bindapp error"></a>友盟注册报错 s&#x3D;-11,s1&#x3D;accs bindapp error</h3><p>排查：</p>
<ol>
<li>检查参数、IP白名单、后台填的参数</li>
<li>代码中注册逻辑要加<code>mPushAgent.setResourcePackageName(packageName);</code></li>
<li>有可能是跟阿里百川一起使用，导致的冲突（有可能是so包冲突；有可能是百川失败）</li>
</ol>
<h3 id="友盟推送-java-lang-IllegalArgumentException-ResClass未初始化，请确保你已经添加了必要的资源。同时确保你在混淆文件中添加了xxx-xxx-xidamen-R"><a href="#友盟推送-java-lang-IllegalArgumentException-ResClass未初始化，请确保你已经添加了必要的资源。同时确保你在混淆文件中添加了xxx-xxx-xidamen-R" class="headerlink" title="友盟推送 java.lang.IllegalArgumentException: ResClass未初始化，请确保你已经添加了必要的资源。同时确保你在混淆文件中添加了xxx.xxx.xidamen.R$*"></a>友盟推送 java.lang.IllegalArgumentException: ResClass未初始化，请确保你已经添加了必要的资源。同时确保你在混淆文件中添加了xxx.xxx.xidamen.R$*</h3><p>问题描述：友盟注册成功，取到正确的别名和token了。用自定义样式推送的消息，报“java.lang.IllegalArgumentException: ResClass未初始化，请确保你已经添加了必要的资源。同时确保你在混淆文件中添加了xxx.xxx.xidamen.R$*”</p>
<p>解决：实际是缺少了.so包，报错中还有报缺少so包的错误。IMLib&#x2F;libs下缺少了so包</p>
<h3 id="ResClass未初始化-请确保你已经添加了必要的资源"><a href="#ResClass未初始化-请确保你已经添加了必要的资源" class="headerlink" title="ResClass未初始化,请确保你已经添加了必要的资源"></a>ResClass未初始化,请确保你已经添加了必要的资源</h3><p>ResClass未初始化,请确保你已经添加了必要的资源…</p>
<p>友盟推送的过程中报这个错误。</p>
<p>排查步骤：</p>
<p>1、友盟控制台查看了参数、app中配置的参数、后台配置的参数，一致。–》app端可以接收消息</p>
<p>2、友盟控制台是否添加了IP白名单</p>
<p>3、是否因为是多渠道而没有在友盟注册中添加packageName，这个packageName需要和AndroidManifest.xml中的包名一致</p>
<p>SBC2.0 最后排查到是第3点的问题</p>
<p>解决：</p>
<p>1、在PushCenter.java中添加参数</p>
<p><img src="http://ww1.sinaimg.cn/large/981009fdly1gjmj1ghuucj226i12ualt.jpg" alt="ResClass未初始化的解决1.png"></p>
<p>2、在调用这个注册的地方添加参数</p>
<p><img src="http://ww1.sinaimg.cn/large/981009fdly1gjmj1y8pgwj226w16ynav.jpg" alt="ResClass未初始化的解决2.png"></p>
<p>3、注意这个packageName要与AndroidManifest.xml中的包名一致</p>
<p><img src="http://ww1.sinaimg.cn/large/981009fdly1gjmj2gohrbj21tm0r013t.jpg" alt="ResClass未初始化的解决3.png"></p>
<p><img src="http://ww1.sinaimg.cn/large/981009fdly1gjmj2or30rj21zg0ua16w.jpg" alt="ResClass未初始化的解决4.png"></p>
<h3 id="后台推送消息，手机接收不到的问题"><a href="#后台推送消息，手机接收不到的问题" class="headerlink" title="后台推送消息，手机接收不到的问题"></a>后台推送消息，手机接收不到的问题</h3><p>排查过程：</p>
<ol>
<li><p>先对比ios和安卓看两端是否有同样问题</p>
<ol>
<li>如果有同样问题，检查参数配置（友盟控制台、手机端、后台）要一致、友盟控制台的IP白名单是否配置</li>
</ol>
</li>
<li><p>因为ios未上架AppStore无法推送，排除与ios对比的可能性，从参数、ip白名单等方面排查</p>
</li>
<li><p>检查参数（友盟控制台、后台、安卓端）一致，尝试从友盟控制台推送消息，安卓可接收到【得出参数无误的结论】</p>
</li>
<li><p>检查友盟控制台IP白名单，无误【得出不是IP白名单问题】</p>
</li>
<li><p>通过后台网页发送推送消息，后台服务抓取参数进行比对，发现友盟注册别名”alias_type”错误</p>
</li>
<li><p>别名错误的原因是groovy中设置的<code>“\\”</code>导致首字母消失【详解见 <a target="_blank" rel="noopener" href="https://shenbh.top/gradle%E7%9F%A5%E8%AF%86/Gradle%E7%AC%94%E8%AE%B0/">https://shenbh.top/gradle知识/Gradle笔记/</a>下的groovy的manifestPlaceholders属性值取值问题 这个笔记】</p>
</li>
</ol>
<h1 id="分享相关"><a href="#分享相关" class="headerlink" title="分享相关"></a>分享相关</h1><h2 id="关于微信无法分享问题"><a href="#关于微信无法分享问题" class="headerlink" title="关于微信无法分享问题"></a>关于微信无法分享问题</h2><p>前置条件：使用友盟第三方分享（包含了微信）<br>排查步骤：</p>
<ol>
<li>看日志<br>1.1 提示参数错误：检查渠道、参数（Android参数、网站登记参数）<br>1.2 提示包名错误：检查Android包名、网站登记包名</li>
</ol>
<h2 id="微信分享一闪即消失，调不起来微信"><a href="#微信分享一闪即消失，调不起来微信" class="headerlink" title="微信分享一闪即消失，调不起来微信"></a>微信分享一闪即消失，调不起来微信</h2><ul>
<li><p>检查是否使用的是签名包，非签名包不能调试微信分享功能（但若在多渠道中指定在直接运行时的是签名包也是ok的）</p>
</li>
<li><p>检查是否有自定义分享缩略图（thumbData），若有，检查自定义缩略图大小不能超过32kb</p>
</li>
<li><p>检查是否有自定义描述内容（description），若有，检查自定义描述内容长度不能超过1024</p>
</li>
<li><p>关于微信分享的其他限制可查看原码<code>WXMediaMessage.class</code>，截取一段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">checkArgs</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">this</span>.getType() != <span class="number">8</span> || <span class="built_in">this</span>.thumbData != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.thumbData.length != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">this</span>.thumbData != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.thumbData.length &gt; <span class="string">&#x27;耀&#x27;</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;MicroMsg.SDK.WXMediaMessage&quot;</span>, <span class="string">&quot;checkArgs fail, thumbData is invalid&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">this</span>.title != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.title.length() &gt; <span class="number">512</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;MicroMsg.SDK.WXMediaMessage&quot;</span>, <span class="string">&quot;checkArgs fail, title is invalid&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">this</span>.description != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.description.length() &gt; <span class="number">1024</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;MicroMsg.SDK.WXMediaMessage&quot;</span>, <span class="string">&quot;checkArgs fail, description is invalid&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">this</span>.mediaObject == <span class="literal">null</span>) &#123;</span><br><span class="line">            Log.e(<span class="string">&quot;MicroMsg.SDK.WXMediaMessage&quot;</span>, <span class="string">&quot;checkArgs fail, mediaObject is null&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.mediaObject.checkArgs();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;MicroMsg.SDK.WXMediaMessage&quot;</span>, <span class="string">&quot;checkArgs fail, thumbData should not be null when send emoji&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="分享SDK7-1-x必须配合友盟基础组件库-v9-2-x版本或更高版本-使用"><a href="#分享SDK7-1-x必须配合友盟基础组件库-v9-2-x版本或更高版本-使用" class="headerlink" title="分享SDK7.1.x必须配合友盟基础组件库(v9.2.x版本或更高版本)使用!"></a>分享SDK7.1.x必须配合友盟基础组件库(v9.2.x版本或更高版本)使用!</h2><p>问题：分享SDK7.1.x必须配合友盟基础组件库(v9.2.x版本或更高版本)使用!</p>
<p><img src="/posts/187306977/%E6%8F%90%E7%A4%BA%E5%8F%8B%E7%9B%9F%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E5%BA%93%E7%89%88%E6%9C%AC%E5%A4%AA%E4%BD%8E.png" alt="安卓/提示友盟基础组件库版本太低"></p>
<p>原因：原本已经在<code>build.gradle</code>的<code>buildTypes》release</code>中开启了混淆<code>minifyEnabled true</code>，但没有开启zip和无用资源优化，我这边开启了<code>zipAlignEnabled</code>和<code>shrinkResources</code>后就报上述的错误</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">shrinkResources</span> <span class="literal">true</span></span><br><span class="line">zipAlignEnabled <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>解决：</p>
<ol>
<li><p>升级了<code>gradle</code>版本</p>
<ul>
<li><code>gradle-wrapper.properties</code>中：<code>gradle-6.5-all.zip</code>—&gt;<code>gradle-6.7.1-all.zip</code></li>
<li>根目录<code>build.gradle</code>中：<code>classpath &#39;com.android.tools.build:gradle:4.1.1&#39;</code> —&gt; <code>classpath &#39;com.android.tools.build:gradle:4.2.2&#39;</code></li>
</ul>
</li>
<li><p>给这个<code>module</code>的<code>proguard-rules.pro</code>配置了免混淆规则</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line">-optimizationpasses <span class="number">5</span> <span class="comment"># 指定代码的压缩级别</span></span><br><span class="line">-dontusemixedcaseclassnames <span class="comment"># 是否使用大小写混合</span></span><br><span class="line">-dontpreverify <span class="comment"># 混淆时是否做预校验</span></span><br><span class="line">-verbose <span class="comment"># 混淆时是否记录日志</span></span><br><span class="line">-optimizations !code<span class="regexp">/simplification/arithmetic,!field/</span>*,!<span class="keyword">class</span><span class="regexp">/merging/</span>* <span class="comment"># 混淆时所采用的算法</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.app.Activity <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.app.Application <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.app.Service <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.content.BroadcastReceiver <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.content.ContentProvider <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.app.backup.BackupAgentHelper <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.preference.Preference <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.android.vending.licensing.ILicensingService <span class="comment"># 保持哪些类不被混淆</span></span><br><span class="line">-keepclasseswithmembernames <span class="keyword">class</span> * &#123; <span class="comment"># 保持 native 方法不被混淆</span></span><br><span class="line">   native &lt;methods&gt;;</span><br><span class="line">&#125;</span><br><span class="line">-keepclasseswithmembers <span class="keyword">class</span> * &#123; <span class="comment"># 保持自定义控件类不被混淆</span></span><br><span class="line">   public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class="line">&#125;</span><br><span class="line">-keepclasseswithmembers <span class="keyword">class</span> * &#123;<span class="comment"># 保持自定义控件类不被混淆</span></span><br><span class="line">   public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers <span class="keyword">class</span> * <span class="keyword">extends</span> android.app.Activity &#123; <span class="comment"># 保持自定义控件类不被混淆</span></span><br><span class="line">   public <span class="keyword">void</span> *(android.view.View);</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers enum * &#123; <span class="comment"># 保持枚举 enum 类不被混淆</span></span><br><span class="line">   public static **[] values();</span><br><span class="line">   public static ** valueOf(java.lang.<span class="built_in">String</span>);</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> * implements android.os.Parcelable &#123;<span class="comment">#保持Parcelable不被混淆</span></span><br><span class="line">   public static final android.os.Parcelable$Creator *;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Explicitly preserve all serialization members. The Serializable interface</span></span><br><span class="line"><span class="comment"># is only a marker interface, so it wouldn&#x27;t save them.</span></span><br><span class="line">-keep public <span class="keyword">class</span> * implements java.io.Serializable &#123;*;&#125;</span><br><span class="line">-keepclassmembers <span class="keyword">class</span> * implements java.io.Serializable &#123;</span><br><span class="line">   static final long serialVersionUID;</span><br><span class="line">   private static final java.io.ObjectStreamField[]   serialPersistentFields;</span><br><span class="line">   private <span class="keyword">void</span> writeObject(java.io.ObjectOutputStream);</span><br><span class="line">   private <span class="keyword">void</span> readObject(java.io.ObjectInputStream);</span><br><span class="line">   java.lang.<span class="built_in">Object</span> writeReplace();</span><br><span class="line">   java.lang.<span class="built_in">Object</span> readResolve();</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers <span class="keyword">class</span> * &#123;</span><br><span class="line">   public &lt;init&gt; (org.json.JSONObject);</span><br><span class="line">&#125;</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.rcw597.app.R$*&#123;</span><br><span class="line">   public static final int *;</span><br><span class="line">   public static final java.lang.<span class="built_in">String</span> *;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Gson混淆配置</span></span><br><span class="line"><span class="comment"># removes such information by default, so configure it to keep all of it.</span></span><br><span class="line">-keepattributes Signature</span><br><span class="line"><span class="comment"># Gson specific classes</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">sun</span>.misc.Unsafe &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.google.gson.stream.** &#123;*;&#125;</span><br><span class="line"><span class="comment"># Application classes that will be serialized/deserialized over Gson</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.google.gson.examples.android.model.** &#123;*;&#125;</span><br><span class="line">-dontwarn com.google.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.google.gson.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.google.protobuf.** &#123;*;&#125;</span><br><span class="line"><span class="comment">#这句非常重要，主要是滤掉 com.demo.demo.bean包下的所有.class文件不进行混淆编译,com.demo.demo是你的包名</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.rcw597.app.net.params.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.rcw597.app.im.bean.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.rcw597.app.im.bean.params.** &#123;*;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#IM云信混淆配置</span></span><br><span class="line">-dontwarn com.netease.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.netease.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.lykevin.neteaseim.** &#123;*;&#125;</span><br><span class="line"><span class="comment">#如果你使用全文检索插件，需要加入</span></span><br><span class="line">-dontwarn org.apache.lucene.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">org</span>.apache.lucene.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">net</span>.sqlcipher.** &#123;*;&#125;</span><br><span class="line">-dontwarn com.xiaomi.push.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.xiaomi.** &#123;*;&#125;</span><br><span class="line">-ignorewarnings</span><br><span class="line">-keepattributes *Annotation*</span><br><span class="line">-keepattributes Exceptions</span><br><span class="line">-keepattributes InnerClasses</span><br><span class="line">-keepattributes Signature</span><br><span class="line">-keepattributes SourceFile,LineNumberTable</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.hianalytics.android.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.huawei.updatesdk.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.huawei.hms.**&#123;*;&#125;</span><br><span class="line">-dontwarn com.vivo.push.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.vivo.push.**&#123;*; &#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.vivo.vms.**&#123;*; &#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.netease.nimlib.mixpush.vivo.VivoPush* &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.netease.nimlib.mixpush.vivo.VivoPushReceiver&#123;*;&#125;</span><br><span class="line">-dontwarn com.meizu.cloud.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.meizu.cloud.** &#123;*;&#125;</span><br><span class="line">-keep public <span class="keyword">class</span> * <span class="keyword">extends</span> android.app.Service</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.heytap.msp.** &#123; *;&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#极验</span></span><br><span class="line">-dontwarn com.geetest.sdk.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.geetest.sdk.**&#123;*;&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#友盟SDK混淆配置</span></span><br><span class="line">-dontshrink</span><br><span class="line">-dontoptimize</span><br><span class="line">-dontwarn com.google.android.maps.**</span><br><span class="line">-dontwarn android.webkit.WebView</span><br><span class="line">-dontwarn com.umeng.**</span><br><span class="line">-dontwarn com.tencent.weibo.sdk.**</span><br><span class="line">-dontwarn com.facebook.**</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">javax</span>.**</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">android</span>.webkit.**</span><br><span class="line">-dontwarn android.support.v4.**</span><br><span class="line">-keep enum com.facebook.**</span><br><span class="line">-keepattributes Exceptions,InnerClasses,Signature</span><br><span class="line">-keepattributes *Annotation*</span><br><span class="line">-keepattributes SourceFile,LineNumberTable</span><br><span class="line">-keep public interface com.facebook.**</span><br><span class="line">-keep public interface com.tencent.**</span><br><span class="line">-keep public interface com.umeng.socialize.**</span><br><span class="line">-keep public interface com.umeng.socialize.sensor.**</span><br><span class="line">-keep public interface com.umeng.scrshot.**</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.umeng.socialize.* &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.facebook.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.facebook.** &#123; *; &#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.scrshot.**</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.tencent.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.socialize.sensor.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.socialize.handler.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.socialize.handler.*</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.weixin.handler.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.weixin.handler.*</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.qq.handler.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.qq.handler.*</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">UMMoreHandler</span>&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.mm.sdk.modelmsg.WXMediaMessage &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.mm.sdk.modelmsg.** implements com.tencent.mm.sdk.modelmsg.WXMediaMessage$IMediaObject &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">im</span>.yixin.sdk.api.YXMessage &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">im</span>.yixin.sdk.api.** implements im.yixin.sdk.api.YXMessage$YXMessageData&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.mm.sdk.** &#123;</span><br><span class="line">   *;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.mm.opensdk.** &#123;</span><br><span class="line">   *;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.wxop.** &#123;</span><br><span class="line">   *;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.mm.sdk.** &#123;</span><br><span class="line">   *;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.twitter.** &#123; *; &#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.** &#123;*;&#125;</span><br><span class="line">-dontwarn com.tencent.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.kakao.** &#123;*;&#125;</span><br><span class="line">-dontwarn com.kakao.**</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.umeng.com.umeng.soexample.R$*&#123;</span><br><span class="line">    public static final int *;</span><br><span class="line">&#125;</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.linkedin.android.mobilesdk.R$*&#123;</span><br><span class="line">    public static final int *;</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers enum * &#123;</span><br><span class="line">    public static **[] values();</span><br><span class="line">    public static ** valueOf(java.lang.<span class="built_in">String</span>);</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.open.TDialog$*</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.open.TDialog$* &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.open.PKDialog</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.open.PKDialog &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.open.PKDialog$*</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.tencent.open.PKDialog$* &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.socialize.impl.ImageImpl &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.sina.** &#123;*;&#125;</span><br><span class="line">-dontwarn com.sina.**</span><br><span class="line">-keep <span class="keyword">class</span>  <span class="title class_">com</span>.alipay.share.sdk.** &#123;</span><br><span class="line">   *;</span><br><span class="line">&#125;</span><br><span class="line">-keepnames <span class="keyword">class</span> * implements android.os.Parcelable &#123;</span><br><span class="line">    public static final ** CREATOR;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.linkedin.** &#123; *; &#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.android.dingtalk.share.ddsharemodule.** &#123; *; &#125;</span><br><span class="line">-keepattributes Signature</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.umeng.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.uc.** &#123;*;&#125;</span><br><span class="line">-keepclassmembers <span class="keyword">class</span> * &#123;</span><br><span class="line">   public &lt;init&gt; (org.json.JSONObject);</span><br><span class="line">&#125;</span><br><span class="line">-keepclassmembers enum * &#123;</span><br><span class="line">    public static **[] values();</span><br><span class="line">    public static ** valueOf(java.lang.<span class="built_in">String</span>);</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.zui.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.miui.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.heytap.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">a</span>.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.vivo.** &#123;*;&#125;</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.xm597.app.R$*&#123;</span><br><span class="line">public static final int *;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"><span class="comment">#高德地图混淆配置</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.amap.api.maps.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.autonavi.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.amap.api.trace.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.amap.api.location.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.amap.api.fence.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.autonavi.aps.amapapi.model.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.amap.api.services.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.amap.api.navi.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.autonavi.**&#123;*;&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#百度地图混淆配置</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.baidu.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.baidu.vi.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">mapsdkvi</span>.com.** &#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">vi</span>.com.** &#123;*;&#125;</span><br><span class="line">-dontwarn com.baidu.**</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#EventBus混淆配置</span></span><br><span class="line">-keepattributes *Annotation*</span><br><span class="line">-keepclassmembers <span class="keyword">class</span> * &#123;</span><br><span class="line">    @org.greenrobot.eventbus.Subscribe &lt;methods&gt;;</span><br><span class="line">&#125;</span><br><span class="line">-keep enum org.greenrobot.eventbus.ThreadMode &#123; *; &#125;</span><br><span class="line"><span class="comment"># And if you use AsyncExecutor:</span></span><br><span class="line">-keepclassmembers <span class="keyword">class</span> * <span class="keyword">extends</span> org.greenrobot.eventbus.util.ThrowableFailureEvent &#123;</span><br><span class="line">    &lt;init&gt;(java.lang.Throwable);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Glide混淆配置</span></span><br><span class="line">-keep public <span class="keyword">class</span> * implements com.bumptech.glide.module.GlideModule</span><br><span class="line">-keep <span class="keyword">class</span> * <span class="keyword">extends</span> com.bumptech.glide.module.AppGlideModule &#123;</span><br><span class="line"> &lt;init&gt;(...);</span><br><span class="line">&#125;</span><br><span class="line">-keep public enum com.bumptech.glide.load.ImageHeaderParser$** &#123;</span><br><span class="line">  **[] $VALUES;</span><br><span class="line">  public *;</span><br><span class="line">&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.bumptech.glide.load.data.ParcelFileDescriptorRewinder$InternalRewinder &#123;</span><br><span class="line">  *** rewind();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Retrofit混淆配置</span></span><br><span class="line"><span class="comment"># Retrofit does reflection on generic parameters. InnerClasses is required to use Signature and</span></span><br><span class="line"><span class="comment"># EnclosingMethod is required to use InnerClasses.</span></span><br><span class="line">-keepattributes Signature, InnerClasses, EnclosingMethod</span><br><span class="line"><span class="comment"># Retrofit does reflection on method and parameter annotations.</span></span><br><span class="line">-keepattributes RuntimeVisibleAnnotations, RuntimeVisibleParameterAnnotations</span><br><span class="line"><span class="comment"># Retain service method parameters when optimizing.</span></span><br><span class="line">-keepclassmembers,allowshrinking,allowobfuscation interface * &#123;</span><br><span class="line">    @retrofit2.http.* &lt;methods&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Ignore annotation used for build tooling.</span></span><br><span class="line">-dontwarn org.codehaus.mojo.animal_sniffer.IgnoreJRERequirement</span><br><span class="line"><span class="comment"># Ignore JSR 305 annotations for embedding nullability information.</span></span><br><span class="line">-dontwarn javax.annotation.**</span><br><span class="line"><span class="comment"># Guarded by a NoClassDefFoundError try/catch and only used when on the classpath.</span></span><br><span class="line">-dontwarn kotlin.Unit</span><br><span class="line"><span class="comment"># Top-level functions that can only be used by Kotlin.</span></span><br><span class="line">-dontwarn retrofit2.KotlinExtensions</span><br><span class="line">-dontwarn retrofit2.KotlinExtensions$*</span><br><span class="line"><span class="comment"># With R8 full mode, it sees no subtypes of Retrofit interfaces since they are created with a Proxy</span></span><br><span class="line"><span class="comment"># and replaces all potential values with null. Explicitly keeping the interfaces prevents this.</span></span><br><span class="line">-<span class="keyword">if</span> interface * &#123; @retrofit2.http.* &lt;methods&gt;; &#125;</span><br><span class="line">-keep,allowobfuscation interface &lt;<span class="number">1</span>&gt;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#极光推送混淆配置</span></span><br><span class="line">-dontoptimize</span><br><span class="line">-dontpreverify</span><br><span class="line">-dontwarn cn.jpush.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">cn</span>.jpush.** &#123; *; &#125;</span><br><span class="line">-keep <span class="keyword">class</span> * <span class="keyword">extends</span> cn.jpush.android.helpers.JPushMessageReceiver &#123; *; &#125;</span><br><span class="line">-dontwarn cn.jiguang.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">cn</span>.jiguang.** &#123; *; &#125;</span><br><span class="line">-dontwarn cn.com.chinatelecom.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">cn</span>.com.chinatelecom.** &#123; *; &#125;</span><br><span class="line">-dontwarn com.ct.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.ct.** &#123; *; &#125;</span><br><span class="line">-dontwarn a.a.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">a</span>.a.** &#123; *; &#125;</span><br><span class="line">-dontwarn com.cmic.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.cmic.** &#123; *; &#125;</span><br><span class="line">-dontwarn com.unicom.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.unicom.** &#123; *; &#125;</span><br><span class="line">-dontwarn com.sdk.**</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.sdk.** &#123; *; &#125;</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.sina.** &#123;</span><br><span class="line">    *;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">#</span></span><br><span class="line"><span class="comment">#OAID</span></span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">XI</span>.CA.XI.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">XI</span>.K0.XI.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">XI</span>.XI.K0.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">XI</span>.vs.K0.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">XI</span>.xo.XI.XI.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.asus.msa.SupplementaryDID.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.asus.msa.sdid.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.bun.lib.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.bun.miitmdid.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.huawei.hms.ads.identifier.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">com</span>.samsung.android.deviceidservice.**&#123;*;&#125;</span><br><span class="line">-keep <span class="keyword">class</span> <span class="title class_">org</span>.json.**&#123;*;&#125;</span><br><span class="line">-keep public <span class="keyword">class</span> <span class="title class_">com</span>.netease.nis.sdkwrapper.Utils &#123;public &lt;methods&gt;;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="IM即时通讯"><a href="#IM即时通讯" class="headerlink" title="IM即时通讯"></a>IM即时通讯</h1><h2 id="关于百川IM在安卓8不能调起问题-阿里已经不维护了"><a href="#关于百川IM在安卓8不能调起问题-阿里已经不维护了" class="headerlink" title="关于百川IM在安卓8不能调起问题(阿里已经不维护了)"></a>关于百川IM在安卓8不能调起问题(阿里已经不维护了)</h2><p>现象:PMS顾客端IM聊天在安卓8不能调起，会报登录超时。安卓8以下的正常。导购端的都正常(包括在安卓8)<br>排查步骤：</p>
<ol>
<li>排查是否是tcmService进程没有开启（在AS的logcat的标题栏上看的）</li>
<li>排查gradle中的targetVersion的值，IM不支持太高的版本（解决：降低targetVersion）<br>原因:辣苹果顾客端targetVersion设置成27，而云旺不支持这么高的版本。<br>解决:降低targetVersion</li>
</ol>
<h2 id="百川在安卓8以上无法推送问题"><a href="#百川在安卓8以上无法推送问题" class="headerlink" title="百川在安卓8以上无法推送问题"></a>百川在安卓8以上无法推送问题</h2><p>现象：导购端退到后台，顾客端发送消息。在安卓6上导购端状态栏有新消息提示，在安卓8以上没有新消息提示</p>
<p>解决:【暂不解决，百川都不维护了，看看客户是否换成融云】</p>
<h1 id="地图-amp-定位"><a href="#地图-amp-定位" class="headerlink" title="地图&amp;定位"></a>地图&amp;定位</h1><h2 id="高德地图相关"><a href="#高德地图相关" class="headerlink" title="高德地图相关"></a>高德地图相关</h2><h3 id="key、定位相关"><a href="#key、定位相关" class="headerlink" title="key、定位相关"></a>key、定位相关</h3><ol>
<li>如果误删高德地图控制台申请的应用和key<br>可以进行添加新的key，同时要更改代码注册清单文件中对应的apikey的值</li>
<li>同一个应用可以申请多个key，不过注册清单文件中的apikey只能一个，所以限制了只能有一个生效<br>（当然如果是两个编辑器进行编译的话，那么可以同时用到两个）</li>
<li>高德地图控制台申请应用名，即使删除了也不能重新用这个名字</li>
<li>注意：在安卓6.0以上的sdk中，权限是要写在代码中，在注册清单文件中写的无效。（只能在手机的设置里信任此应用方可），否则会报“缺少定位权限”的异常</li>
<li>删除了高德地图控制台申请的key，应用中会报“KEY鉴权失败”的异常</li>
</ol>
<h3 id="aMap-x3D-mapView-getMap-一直报-NullPointException"><a href="#aMap-x3D-mapView-getMap-一直报-NullPointException" class="headerlink" title="aMap &#x3D; mapView.getMap();一直报 NullPointException"></a>aMap &#x3D; mapView.getMap();一直报 NullPointException</h3><p>解决：在<code>app.build</code>中添加</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sourceSets&#123;</span><br><span class="line">    main&#123;</span><br><span class="line">        jniLibs.srcDirs = [<span class="string">&#x27;libs&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    instrumentTest.setRoot(<span class="string">&#x27;tests&#x27;</span>)</span><br><span class="line">        debug.setRoot(<span class="string">&#x27;build-types/debug&#x27;</span>)</span><br><span class="line">        release.setRoot(<span class="string">&#x27;build-types/release&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码</p>
<p><code>app.build</code></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;com.android.application&#x27;</span></span><br><span class="line"></span><br><span class="line">task clean(<span class="attr">type:</span>Exec)&#123;</span><br><span class="line">    ext.lockhunter = <span class="string">&#x27;\&quot;C:\\LockHunter.exe\&quot;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> buildDir = file(<span class="keyword">new</span> File(<span class="string">&quot;build&quot;</span>))</span><br><span class="line">    commandLine <span class="string">&#x27;cmd&#x27;</span> , <span class="string">&quot;$lockhunter&quot;</span>, <span class="string">&#x27;/delete&#x27;</span>, <span class="string">&#x27;/silent&#x27;</span>,buildDir</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion <span class="number">23</span></span><br><span class="line">    buildToolsVersion <span class="string">&#x27;23.0.3&#x27;</span></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId <span class="string">&quot;com.xxx&quot;</span></span><br><span class="line">        minSdkVersion <span class="number">17</span></span><br><span class="line">        targetSdkVersion <span class="number">19</span></span><br><span class="line">        compileOptions &#123;</span><br><span class="line">            sourceCompatibility JavaVersion.VERSION_1_7</span><br><span class="line">            targetCompatibility JavaVersion.VERSION_1_7</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">&#x27;proguard-android.txt&#x27;</span>), <span class="string">&#x27;proguard-rules.txt&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sourceSets&#123;</span><br><span class="line">        main&#123;</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">&#x27;libs&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        instrumentTest.setRoot(<span class="string">&#x27;tests&#x27;</span>)</span><br><span class="line">        debug.setRoot(<span class="string">&#x27;build-types/debug&#x27;</span>)</span><br><span class="line">        release.setRoot(<span class="string">&#x27;build-types/release&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile fileTree(<span class="attr">includes:</span> [<span class="string">&#x27;*.jar&#x27;</span>], <span class="attr">dir:</span> <span class="string">&#x27;libs&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/fastjson-1.2.4.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/nineoldandroids-2.4.0.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/okhttp-3.4.1.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/okio-1.9.0.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/universal-image-loader-1.9.2.jar&#x27;</span>)</span><br><span class="line">    compile <span class="string">&#x27;com.android.support:appcompat-v7:23.4.0&#x27;</span></span><br><span class="line">    compile <span class="string">&#x27;com.flipboard:bottomsheet-core:1.5.1&#x27;</span></span><br><span class="line">    compile files(<span class="string">&#x27;libs/AMap_Location_V3.5.0_20170731.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/AMap_Search_V5.2.1_20170630.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/Android_Map3D_SDK_V5.2.1_20170630.jar&#x27;</span>)</span><br><span class="line">    compile files(<span class="string">&#x27;libs/Volley.jar&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AndroidManifest.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">package</span>=<span class="string">&quot;com.xxx&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:versionCode</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:versionName</span>=<span class="string">&quot;1.0&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-sdk</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:minSdkVersion</span>=<span class="string">&quot;17&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:targetSdkVersion</span>=<span class="string">&quot;19&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 地图包、搜索包需要的基础权限 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许程序打开网络套接字 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许程序设置内置sd卡的写权限 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许程序获取网络状态 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许程序访问WiFi网络信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许程序读写手机状态和身份 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许程序访问CellID或WiFi热点来获取粗略的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用于访问GPS定位--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--用于读取手机当前的状态--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CHANGE_CONFIGURATION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WAKE_LOCK&quot;</span> /&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--用于申请调用A-GPS模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_LOCATION_EXTRA_COMMANDS&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_SETTINGS&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.xxx.MyApplication&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:allowBackup</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_launcher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/AppTheme&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;com.amap.api.v2.apikey&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:value</span>=<span class="string">&quot;b5eae3aeaae6a5439226e657ac997d08&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--主要界面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;com.xxx.personal.locate.MarkerAnimationActivity&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:label</span>=<span class="string">&quot;@string/app_name&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 定位需要的服务 使用2.0的定位需要加上这个 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">&quot;com.amap.api.location.APSService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>MarkerAnimationActivity.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xxx.personal.locate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Point;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.Interpolator;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.LinearInterpolator;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.AMap;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.MapView;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.BitmapDescriptorFactory;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.CameraPosition;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.LatLng;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.Marker;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.MarkerOptions;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.animation.Animation;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.animation.ScaleAnimation;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.maps.model.animation.TranslateAnimation;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.services.core.LatLonPoint;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.services.geocoder.GeocodeResult;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.services.geocoder.GeocodeSearch;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.services.geocoder.RegeocodeAddress;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.services.geocoder.RegeocodeQuery;</span><br><span class="line"><span class="keyword">import</span> com.amap.api.services.geocoder.RegeocodeResult;</span><br><span class="line"><span class="keyword">import</span> com.xxx.MyBaseActivity;</span><br><span class="line"><span class="keyword">import</span> com.xxx.R;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AMapV2地图中简单介绍一些Marker的用法.</span></span><br><span class="line"><span class="comment"> * Marker动画功能介绍</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MarkerAnimationActivity</span> <span class="keyword">extends</span> <span class="title class_">MyBaseActivity</span> <span class="keyword">implements</span> <span class="title class_">View</span>.OnClickListener,AMap.OnCameraChangeListener,GeocodeSearch.OnGeocodeSearchListener &#123;</span><br><span class="line">	<span class="keyword">private</span> MarkerOptions markerOption;</span><br><span class="line">	<span class="keyword">private</span> AMap aMap;</span><br><span class="line">	<span class="keyword">private</span> MapView mapView;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">LatLng</span> <span class="variable">latlng</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LatLng</span>(<span class="number">39.761</span>, <span class="number">116.434</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">Marker</span> <span class="variable">screenMarker</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="type">Marker</span> <span class="variable">growMarker</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">	GeocodeSearch geocodeSearch;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.marker_animation_activity);</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * 设置离线地图存储目录，在下载离线地图或初始化地图设置; 使用过程中可自行设置, 若自行设置了离线地图存储的路径，</span></span><br><span class="line"><span class="comment">		 * 则需要在离线地图下载和使用地图页面都进行路径设置</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="comment">// Demo中为了其他界面可以使用下载的离线地图，使用默认位置存储，屏蔽了自定义设置</span></span><br><span class="line">		<span class="comment">// MapsInitializer.sdcardDir =OffLineMapUtils.getSdCacheDir(this);</span></span><br><span class="line">		mapView = (MapView) findViewById(R.id.map);</span><br><span class="line">		mapView.onCreate(savedInstanceState); <span class="comment">// 此方法必须重写</span></span><br><span class="line">		init();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 初始化AMap对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">Button</span> <span class="variable">clearMap</span> <span class="operator">=</span> (Button) findViewById(R.id.growMarker);</span><br><span class="line">		clearMap.setOnClickListener(<span class="built_in">this</span>);</span><br><span class="line">		<span class="type">Button</span> <span class="variable">resetMap</span> <span class="operator">=</span> (Button) findViewById(R.id.jumpMarker);</span><br><span class="line">		resetMap.setOnClickListener(<span class="built_in">this</span>);</span><br><span class="line">		<span class="keyword">if</span> (aMap == <span class="literal">null</span>) &#123;</span><br><span class="line">			aMap = mapView.getMap();</span><br><span class="line">		&#125;</span><br><span class="line">		aMap.setOnMapLoadedListener(<span class="keyword">new</span> <span class="title class_">AMap</span>.OnMapLoadedListener() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMapLoaded</span><span class="params">()</span> &#123;</span><br><span class="line">				addMarkersToMap();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置可视范围变化时的回调的接口方法</span></span><br><span class="line">		aMap.setOnCameraChangeListener(<span class="keyword">new</span> <span class="title class_">AMap</span>.OnCameraChangeListener() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCameraChange</span><span class="params">(CameraPosition position)</span> &#123;</span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCameraChangeFinish</span><span class="params">(CameraPosition postion)</span> &#123;</span><br><span class="line">				<span class="comment">//屏幕中心的Marker跳动</span></span><br><span class="line">                startJumpAnimation();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		aMap.setOnCameraChangeListener(<span class="built_in">this</span>);</span><br><span class="line">		geocodeSearch = <span class="keyword">new</span> <span class="title class_">GeocodeSearch</span>(<span class="built_in">this</span>);</span><br><span class="line">		geocodeSearch.setOnGeocodeSearchListener(<span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 方法必须重写</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onResume</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onResume();</span><br><span class="line">		mapView.onResume();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 方法必须重写</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onPause();</span><br><span class="line">		mapView.onPause();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 方法必须重写</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onSaveInstanceState</span><span class="params">(Bundle outState)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onSaveInstanceState(outState);</span><br><span class="line">		mapView.onSaveInstanceState(outState);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 方法必须重写</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>.onDestroy();</span><br><span class="line">		mapView.onDestroy();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在地图上添加marker</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addMarkersToMap</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">		addMarkerInScreenCenter();</span><br><span class="line"></span><br><span class="line">		addGrowMarker();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在屏幕中心添加一个Marker</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addMarkerInScreenCenter</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">LatLng</span> <span class="variable">latLng</span> <span class="operator">=</span> aMap.getCameraPosition().target;</span><br><span class="line">		<span class="type">Point</span> <span class="variable">screenPosition</span> <span class="operator">=</span> aMap.getProjection().toScreenLocation(latLng);</span><br><span class="line">		screenMarker = aMap.addMarker(<span class="keyword">new</span> <span class="title class_">MarkerOptions</span>()</span><br><span class="line">				.anchor(<span class="number">0.5f</span>,<span class="number">0.5f</span>)</span><br><span class="line">				.icon(BitmapDescriptorFactory.fromResource(R.drawable.purple_pin)));</span><br><span class="line">		<span class="comment">//设置Marker在屏幕上,不跟随地图移动</span></span><br><span class="line">	 	screenMarker.setPositionByPixels(screenPosition.x,screenPosition.y);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加一个从地上生长的Marker</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addGrowMarker</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(growMarker == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">MarkerOptions</span> <span class="variable">markerOptions</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MarkerOptions</span>().icon(BitmapDescriptorFactory</span><br><span class="line">					.defaultMarker(BitmapDescriptorFactory.HUE_AZURE))</span><br><span class="line">					.position(latlng);</span><br><span class="line">			growMarker = aMap.addMarker(markerOptions);</span><br><span class="line">		&#125; </span><br><span class="line">		</span><br><span class="line">		startGrowAnimation();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 地上生长的Marker</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startGrowAnimation</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">if</span>(growMarker != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">Animation</span> <span class="variable">animation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScaleAnimation</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">			animation.setInterpolator(<span class="keyword">new</span> <span class="title class_">LinearInterpolator</span>());</span><br><span class="line">			<span class="comment">//整个移动所需要的时间</span></span><br><span class="line">			animation.setDuration(<span class="number">1000</span>);</span><br><span class="line">			<span class="comment">//设置动画</span></span><br><span class="line">			growMarker.setAnimation(animation);</span><br><span class="line">			<span class="comment">//开始动画</span></span><br><span class="line">			growMarker.startAnimation();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 屏幕中心marker 跳动</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startJumpAnimation</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (screenMarker != <span class="literal">null</span> ) &#123;</span><br><span class="line">			<span class="comment">//根据屏幕距离计算需要移动的目标点</span></span><br><span class="line">			<span class="keyword">final</span> <span class="type">LatLng</span> <span class="variable">latLng</span> <span class="operator">=</span> screenMarker.getPosition();</span><br><span class="line">			<span class="type">Point</span> <span class="variable">point</span> <span class="operator">=</span>  aMap.getProjection().toScreenLocation(latLng);</span><br><span class="line">			point.y -= dip2px(<span class="built_in">this</span>,<span class="number">125</span>);</span><br><span class="line">			<span class="type">LatLng</span> <span class="variable">target</span> <span class="operator">=</span> aMap.getProjection()</span><br><span class="line">					.fromScreenLocation(point);</span><br><span class="line">			<span class="comment">//使用TranslateAnimation,填写一个需要移动的目标点</span></span><br><span class="line">			<span class="type">Animation</span> <span class="variable">animation</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TranslateAnimation</span>(target);</span><br><span class="line">			animation.setInterpolator(<span class="keyword">new</span> <span class="title class_">Interpolator</span>() &#123;</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="keyword">public</span> <span class="type">float</span> <span class="title function_">getInterpolation</span><span class="params">(<span class="type">float</span> input)</span> &#123;</span><br><span class="line">					<span class="comment">// 模拟重加速度的interpolator</span></span><br><span class="line">					<span class="keyword">if</span>(input &lt;= <span class="number">0.5</span>) &#123;</span><br><span class="line">						<span class="keyword">return</span> (<span class="type">float</span>) (<span class="number">0.5f</span> - <span class="number">2</span> * (<span class="number">0.5</span> - input) * (<span class="number">0.5</span> - input));</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="keyword">return</span> (<span class="type">float</span>) (<span class="number">0.5f</span> - Math.sqrt((input - <span class="number">0.5f</span>)*(<span class="number">1.5f</span> - input)));</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			<span class="comment">//整个移动所需要的时间</span></span><br><span class="line">			animation.setDuration(<span class="number">600</span>);</span><br><span class="line">			<span class="comment">//设置动画</span></span><br><span class="line">			screenMarker.setAnimation(animation);</span><br><span class="line">			<span class="comment">//开始动画</span></span><br><span class="line">			screenMarker.startAnimation();</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Log.e(<span class="string">&quot;amap&quot;</span>,<span class="string">&quot;screenMarker is null&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//dip和px转换</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">dip2px</span><span class="params">(Context context, <span class="type">float</span> dpValue)</span> &#123;</span><br><span class="line">		<span class="keyword">final</span> <span class="type">float</span> <span class="variable">scale</span> <span class="operator">=</span> context.getResources().getDisplayMetrics().density;</span><br><span class="line">		<span class="keyword">return</span> (<span class="type">int</span>) (dpValue * scale + <span class="number">0.5f</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">		<span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * 从地上生长的Marker</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">case</span> R.id.growMarker:</span><br><span class="line">			startGrowAnimation();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		 * marker 跳动动画</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">case</span> R.id.jumpMarker:</span><br><span class="line">			startJumpAnimation();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCameraChange</span><span class="params">(CameraPosition cameraPosition)</span> &#123;</span><br><span class="line">		<span class="type">LatLng</span> <span class="variable">target</span> <span class="operator">=</span> cameraPosition.target;</span><br><span class="line"><span class="comment">//		System.out.println(target.latitude+&quot;---&quot;+target.longitude);</span></span><br><span class="line">		getAddressByLatlng(target);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCameraChangeFinish</span><span class="params">(CameraPosition cameraPosition)</span> &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRegeocodeSearched</span><span class="params">(RegeocodeResult regeocodeResult, <span class="type">int</span> i)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (regeocodeResult != <span class="literal">null</span> &amp;&amp; regeocodeResult.getRegeocodeAddress() != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="type">RegeocodeAddress</span> <span class="variable">regeocodeAddress</span> <span class="operator">=</span> regeocodeResult.getRegeocodeAddress();</span><br><span class="line">				<span class="type">String</span> <span class="variable">formatAddress</span> <span class="operator">=</span> regeocodeAddress.getFormatAddress();</span><br><span class="line">				<span class="type">String</span> <span class="variable">simpleAddress</span> <span class="operator">=</span> formatAddress.substring(<span class="number">9</span>);</span><br><span class="line">				System.out.println(<span class="string">&quot;查询经纬度对应详细地址：\n&quot;</span> + simpleAddress);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//				NToast.shortToast(AMAPLocationActivity.this, &quot;没有搜索到结果&quot;);</span></span><br><span class="line">				System.out.println();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//			NToast.shortToast(AMAPLocationActivity.this, &quot;搜索失败,请检查网络&quot;);</span></span><br><span class="line">			System.out.println();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onGeocodeSearched</span><span class="params">(GeocodeResult geocodeResult, <span class="type">int</span> i)</span> &#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getAddressByLatlng</span><span class="params">(LatLng latLng)</span> &#123;</span><br><span class="line">		<span class="comment">//逆地理编码查询条件：逆地理编码查询的地理坐标点、查询范围、坐标类型。</span></span><br><span class="line">		<span class="type">LatLonPoint</span> <span class="variable">latLonPoint</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LatLonPoint</span>(latLng.latitude, latLng.longitude);</span><br><span class="line">		<span class="type">RegeocodeQuery</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegeocodeQuery</span>(latLonPoint, <span class="number">500f</span>, GeocodeSearch.AMAP);</span><br><span class="line">		<span class="comment">//异步查询</span></span><br><span class="line">		geocodeSearch.getFromLocationAsyn(query);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="百度定位移到项目中不可用"><a href="#百度定位移到项目中不可用" class="headerlink" title="百度定位移到项目中不可用"></a>百度定位移到项目中不可用</h2><ol>
<li>检查权限；检查是不是重新申请了key（一个包名对应一个key）；</li>
<li>用百度定位的时候要用<code>getApplicationContext()</code>，因为当前的context被销毁了虽然不报错，但是也不提供定位。</li>
</ol>
<h1 id="Bugly相关"><a href="#Bugly相关" class="headerlink" title="Bugly相关"></a>Bugly相关</h1><h2 id="Bugly-无法上报的问题"><a href="#Bugly-无法上报的问题" class="headerlink" title="Bugly 无法上报的问题"></a>Bugly 无法上报的问题</h2><ul>
<li>可能是加了自己的异常捕获导致的<br>解决：去掉自己的异常捕获</li>
</ul>
<h1 id="GreenDao的问题"><a href="#GreenDao的问题" class="headerlink" title="GreenDao的问题"></a>GreenDao的问题</h1><ul>
<li>复合主键</li>
</ul>
<p>在数据库表多对多的关系中，中间表使用的是复合主键，在GreenDao中复合主键的表达方式是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复合主键</span></span><br><span class="line"><span class="meta">@Entity(indexes = &#123; @Index(value = &quot;studentId, teacherId&quot;, unique = true)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TeacherStudent</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> studentId;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> teacherId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多对多关系：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">	<span class="meta">@ToMany</span></span><br><span class="line">	<span class="meta">@JoinEntity(entity = TeacherStudent.class, sourceProperty = &quot;studentId&quot;, targetProperty = &quot;teacherId&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Teacher&gt; teachers;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span>&#123;</span><br><span class="line">	<span class="meta">@Id</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">long</span> id;</span><br><span class="line">	<span class="meta">@ToMany</span></span><br><span class="line">	<span class="meta">@JoinEntity(entity = TeacherStudent.class, sourceProperty = &quot;teacherId&quot;, targetProperty = &quot;studentId&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; students;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询结果出现重复项：<br>当查询结果出现重复项的时候，使用函数.distinct()取消所有的重复项。</li>
<li>如果GreenDao报错时，首先是将自动生成的代码段删除然后重新编译</li>
</ul>
<h1 id="MVPArms失效问题"><a href="#MVPArms失效问题" class="headerlink" title="MVPArms失效问题"></a>MVPArms失效问题</h1><p>在AS4.1以上没有templates的issue</p>
<p><a target="_blank" rel="noopener" href="https://github.com/JessYanCoding/MVPArmsTemplate/issues/26">https://github.com/JessYanCoding/MVPArmsTemplate/issues/26</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bigademo.com/2021/01/20/AndroidStudio%204.1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1/index.html">https://www.bigademo.com/2021/01/20/AndroidStudio%204.1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1/index.html</a></p>
<p>查看 <a href="https://shenbh.github.io/posts/8f94baaa/">AndroidStudio-代码快捷键&amp;模板</a> 的AS4.1上写模板【新方式】</p>
<h1 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h1><h2 id="App-跳转微信小程序失败"><a href="#App-跳转微信小程序失败" class="headerlink" title="App 跳转微信小程序失败"></a>App 跳转微信小程序失败</h2><p> 安卓端调用微信小程序支付功能时候，一直失败，微信的app也调不起来。</p>
<p>对比了微信开放平台上的安卓应用的的appId 值，配置的包名、以及应用签名信息，确认都完全正确。微信的分享也正常，但是就是调不起来小程序，微信sdk给的错误信息如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">D/MicroMsg<span class="selector-class">.PaySdk</span><span class="selector-class">.WXFactory</span>: createWXAPI, appId = wx8c3653f8c376e8c4, checkSignature = false</span><br><span class="line"></span><br><span class="line"><span class="number">11645</span>-<span class="number">11645</span>/app<span class="selector-class">.laidianyi</span><span class="selector-class">.weilanshidai</span> D/MicroMsg<span class="selector-class">.SDK</span><span class="selector-class">.WXApiImplV10</span>: &lt;init&gt;, appId = wx8c3653f8c376e8c4, checkSignature = false</span><br><span class="line"></span><br><span class="line"><span class="number">11645</span>-<span class="number">11645</span>/app<span class="selector-class">.laidianyi</span><span class="selector-class">.weilanshidai</span> D/MicroMsg<span class="selector-class">.SDK</span><span class="selector-class">.WXMsgImplComm</span>: ignore wechat app signature validation</span><br><span class="line"></span><br><span class="line"><span class="number">11645</span>-<span class="number">11645</span>/app<span class="selector-class">.laidianyi</span><span class="selector-class">.weilanshidai</span> I/MicroMsg<span class="selector-class">.SDK</span><span class="selector-class">.WXApiImplV10</span>: sendReq, req type = <span class="number">19</span></span><br></pre></td></tr></table></figure>

<p>经过一系列尝试，原来是个人微信账号没有预览权限导致，换个有预览权限的微信账号，安卓app就能正常调起微信小程序了<br>备注：iOS 没有这个问题，只有安卓会出现这个问题</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt=" WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%AE%89%E5%8D%93%E9%97%AE%E9%A2%98/" rel="tag"># 安卓问题</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/45516a70/" rel="next" title="Manifest">
                <i class="fa fa-chevron-left"></i> Manifest
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/1330169938/" rel="prev" title="安卓问题-未归类">
                安卓问题-未归类 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@189.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/shenbh" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://gitee.com/shen_bh" target="_blank" title="Gitee">
                      
                        <i class="fa fa-fw fa-git"></i>Gitee</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95"><span class="nav-text">第三方登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8B%E7%9B%9F-%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95%E6%8E%88%E6%9D%83%E4%B8%8D%E8%B5%B0%E5%9B%9E%E8%B0%83"><span class="nav-text">友盟 微信登录授权不走回调</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%94%AF%E4%BB%98%E7%9B%B8%E5%85%B3"><span class="nav-text">支付相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%9B%B8%E5%85%B3"><span class="nav-text">微信支付相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E8%B0%83%E7%94%A8%E4%B8%8D%E8%B5%B7%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%88AsyncTask%E7%9A%84%E5%9D%91%EF%BC%89"><span class="nav-text">微信支付调用不起来的问题（AsyncTask的坑）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WXPayEntryActivity-%E4%B8%8D%E5%9B%9E%E8%B0%83%E9%97%AE%E9%A2%98"><span class="nav-text">WXPayEntryActivity 不回调问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%9B%9E%E8%B0%83java-lang-IllegalStateException-Already-attached"><span class="nav-text">微信支付回调java.lang.IllegalStateException: Already attached</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%EF%BC%9A%E5%BC%B9%E8%B5%B7%E6%94%AF%E4%BB%98%E9%A1%B5%E9%9D%A2%E4%BD%86%E6%98%AF%E5%8E%9F%E6%9D%A5%E7%9A%84%E9%A1%B5%E9%9D%A2%E8%B5%B0%E4%BA%86onPause%E6%B2%A1%E6%9C%89%E8%B5%B0onStop%E6%96%B9%E6%B3%95"><span class="nav-text">微信支付：弹起支付页面但是原来的页面走了onPause没有走onStop方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#App%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E2%80%9C%E6%94%AF%E4%BB%98%E9%AA%8C%E8%AF%81%E7%AD%BE%E5%90%8D%E5%A4%B1%E8%B4%A5%E2%80%9D"><span class="nav-text">App微信支付“支付验证签名失败”</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1WAP%E6%94%AF%E4%BB%98%E6%8F%90%E7%A4%BA%E2%80%9D%E5%95%86%E5%AE%B6%E5%8F%82%E6%95%B0%E6%A0%BC%E5%BC%8F%E6%9C%89%E8%AF%AF%EF%BC%8C%E8%AF%B7%E8%81%94%E7%B3%BB%E5%95%86%E5%AE%B6%E8%A7%A3%E5%86%B3%E2%80%9D"><span class="nav-text">微信WAP支付提示”商家参数格式有误，请联系商家解决”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%94%AF%E4%BB%98%EF%BC%8C%E6%97%A0%E6%B3%95%E8%BF%94%E5%9B%9E%E5%BA%94%E7%94%A8"><span class="nav-text">微信小程序支付，无法返回应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E6%94%AF%E4%BB%98%E5%AE%9D-sdk-%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">集成支付宝 sdk 遇到的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E5%A8%81%E5%AF%8C%E9%80%9A%E6%94%AF%E4%BB%98%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">集成威富通支付遇到的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98"><span class="nav-text">支付宝支付</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A8%E9%80%81%E7%9B%B8%E5%85%B3"><span class="nav-text">推送相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8B%E7%9B%9F%E6%97%A0%E6%B3%95%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98"><span class="nav-text">友盟无法推送问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="nav-text">排查步骤：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%88%E4%B8%80%E5%9F%8E%E5%AE%89%E5%8D%93%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4"><span class="nav-text">又一城安卓友盟推送问题排查步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4"><span class="nav-text">友盟推送问题排查步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81%E9%94%99%E8%AF%AF"><span class="nav-text">友盟推送错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8B%E7%9B%9F%E6%B3%A8%E5%86%8C%E6%8A%A5%E9%94%99-s-x3D-11-s1-x3D-accs-bindapp-error"><span class="nav-text">友盟注册报错 s&#x3D;-11,s1&#x3D;accs bindapp error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8B%E7%9B%9F%E6%8E%A8%E9%80%81-java-lang-IllegalArgumentException-ResClass%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8C%E8%AF%B7%E7%A1%AE%E4%BF%9D%E4%BD%A0%E5%B7%B2%E7%BB%8F%E6%B7%BB%E5%8A%A0%E4%BA%86%E5%BF%85%E8%A6%81%E7%9A%84%E8%B5%84%E6%BA%90%E3%80%82%E5%90%8C%E6%97%B6%E7%A1%AE%E4%BF%9D%E4%BD%A0%E5%9C%A8%E6%B7%B7%E6%B7%86%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%BA%86xxx-xxx-xidamen-R"><span class="nav-text">友盟推送 java.lang.IllegalArgumentException: ResClass未初始化，请确保你已经添加了必要的资源。同时确保你在混淆文件中添加了xxx.xxx.xidamen.R$*</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ResClass%E6%9C%AA%E5%88%9D%E5%A7%8B%E5%8C%96-%E8%AF%B7%E7%A1%AE%E4%BF%9D%E4%BD%A0%E5%B7%B2%E7%BB%8F%E6%B7%BB%E5%8A%A0%E4%BA%86%E5%BF%85%E8%A6%81%E7%9A%84%E8%B5%84%E6%BA%90"><span class="nav-text">ResClass未初始化,请确保你已经添加了必要的资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF%EF%BC%8C%E6%89%8B%E6%9C%BA%E6%8E%A5%E6%94%B6%E4%B8%8D%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">后台推送消息，手机接收不到的问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E4%BA%AB%E7%9B%B8%E5%85%B3"><span class="nav-text">分享相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E5%BE%AE%E4%BF%A1%E6%97%A0%E6%B3%95%E5%88%86%E4%BA%AB%E9%97%AE%E9%A2%98"><span class="nav-text">关于微信无法分享问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E4%BF%A1%E5%88%86%E4%BA%AB%E4%B8%80%E9%97%AA%E5%8D%B3%E6%B6%88%E5%A4%B1%EF%BC%8C%E8%B0%83%E4%B8%8D%E8%B5%B7%E6%9D%A5%E5%BE%AE%E4%BF%A1"><span class="nav-text">微信分享一闪即消失，调不起来微信</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E4%BA%ABSDK7-1-x%E5%BF%85%E9%A1%BB%E9%85%8D%E5%90%88%E5%8F%8B%E7%9B%9F%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6%E5%BA%93-v9-2-x%E7%89%88%E6%9C%AC%E6%88%96%E6%9B%B4%E9%AB%98%E7%89%88%E6%9C%AC-%E4%BD%BF%E7%94%A8"><span class="nav-text">分享SDK7.1.x必须配合友盟基础组件库(v9.2.x版本或更高版本)使用!</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IM%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF"><span class="nav-text">IM即时通讯</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E7%99%BE%E5%B7%9DIM%E5%9C%A8%E5%AE%89%E5%8D%938%E4%B8%8D%E8%83%BD%E8%B0%83%E8%B5%B7%E9%97%AE%E9%A2%98-%E9%98%BF%E9%87%8C%E5%B7%B2%E7%BB%8F%E4%B8%8D%E7%BB%B4%E6%8A%A4%E4%BA%86"><span class="nav-text">关于百川IM在安卓8不能调起问题(阿里已经不维护了)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BE%E5%B7%9D%E5%9C%A8%E5%AE%89%E5%8D%938%E4%BB%A5%E4%B8%8A%E6%97%A0%E6%B3%95%E6%8E%A8%E9%80%81%E9%97%AE%E9%A2%98"><span class="nav-text">百川在安卓8以上无法推送问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%B0%E5%9B%BE-amp-%E5%AE%9A%E4%BD%8D"><span class="nav-text">地图&amp;定位</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E7%9B%B8%E5%85%B3"><span class="nav-text">高德地图相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#key%E3%80%81%E5%AE%9A%E4%BD%8D%E7%9B%B8%E5%85%B3"><span class="nav-text">key、定位相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aMap-x3D-mapView-getMap-%E4%B8%80%E7%9B%B4%E6%8A%A5-NullPointException"><span class="nav-text">aMap &#x3D; mapView.getMap();一直报 NullPointException</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BE%E5%BA%A6%E5%AE%9A%E4%BD%8D%E7%A7%BB%E5%88%B0%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%B8%8D%E5%8F%AF%E7%94%A8"><span class="nav-text">百度定位移到项目中不可用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Bugly%E7%9B%B8%E5%85%B3"><span class="nav-text">Bugly相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Bugly-%E6%97%A0%E6%B3%95%E4%B8%8A%E6%8A%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">Bugly 无法上报的问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#GreenDao%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">GreenDao的问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MVPArms%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98"><span class="nav-text">MVPArms失效问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="nav-text">其他功能</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#App-%E8%B7%B3%E8%BD%AC%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%A4%B1%E8%B4%A5"><span class="nav-text">App 跳转微信小程序失败</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>