<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Activity 的 36 大难点，你会几个？ 智能总结：本文全面总结了 Android Activity 的相关知识，包括生命周期（如不同场景下的变化、横竖屏切换等）、启动模式（standard、singleTop、singleTask、singleInstance 及使用方式、应用场景）、数据传递（如 Intent 传递数据大小限制、内存不足时的保存方法等）、与其他概念的关系（如 Contex">
<meta property="og:type" content="article">
<meta property="og:title" content="Android的36大难点">
<meta property="og:url" content="http://shenbh.github.io/posts/a42e0030/index.html">
<meta property="og:site_name" content="积跬步">
<meta property="og:description" content="Activity 的 36 大难点，你会几个？ 智能总结：本文全面总结了 Android Activity 的相关知识，包括生命周期（如不同场景下的变化、横竖屏切换等）、启动模式（standard、singleTop、singleTask、singleInstance 及使用方式、应用场景）、数据传递（如 Intent 传递数据大小限制、内存不足时的保存方法等）、与其他概念的关系（如 Contex">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%B8%80%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E4%BA%86%E8%A7%A3Activity.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Dialog%E5%BC%B9%E5%87%BA%E6%97%B6.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2%E6%97%B6.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E4%B8%8BActivity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%8F%98%E5%8C%96.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%B7%B2%E5%90%AF%E5%8A%A8%E7%9A%84Activity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%8F%98%E5%8C%96.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E8%AE%BE%E7%BD%AEActivity%E6%88%90%E7%AA%97%E5%8F%A3%E6%A0%B7%E5%BC%8F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E9%80%80%E5%87%BA%E8%B0%83%E7%94%A8%E5%A4%9A%E4%B8%AAActivity%E7%9A%84Application.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E9%94%81%E5%AE%9A%E5%B1%8F%E4%B8%8E%E8%A7%A3%E9%94%81%E5%B1%8F%E5%B9%95%E6%97%B6Activity%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%BF%AE%E6%94%B9Activity%E8%BF%9B%E5%85%A5%E5%92%8C%E9%80%80%E5%87%BA%E5%8A%A8%E7%94%BB.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Activity%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%8A%B6%E6%80%81.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%85%B3%E9%97%AD.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA%E5%90%8E%E5%8F%88%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%BB%80%E4%B9%88%E6%98%AFonNewIntent.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Standard.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleTop.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleTask.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleInstance.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleTop%E6%A0%B7%E4%BE%8B.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Activity%E7%9A%84Flags.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%A0%87%E8%AE%B0%E4%BD%8D.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-onNewIntent.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Intent%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%9D%80%E6%8E%89%E5%90%8E%E5%8F%B0%E6%97%B6Activity%E5%93%AA%E4%B8%AA%E6%96%B9%E6%B3%95%E4%BF%9D%E5%AD%98%E4%B8%B4%E6%97%B6%E7%8A%B6%E6%80%81.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-onSaveInstanceState()%E8%A2%AB%E6%89%A7%E8%A1%8C%E7%9A%84%E5%9C%BA%E6%99%AF.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Activity%E8%B7%B3%E8%BD%AC%E6%97%B6%E4%BC%9A%E6%89%A7%E8%A1%8C%E7%9A%84%E6%96%B9%E6%B3%95.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E7%94%A8Intent%E5%8E%BB%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity%E4%B9%8B%E5%A4%96%E7%9A%84%E6%96%B9%E6%B3%95.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Scheme%E8%B7%B3%E8%BD%AC%E5%8D%8F%E8%AE%AE.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Scheme%E5%AE%9A%E4%B9%89.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2780c638c9tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab278295b2b0tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2782c145c5tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab278bb02fa6tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2799c85ff1tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab279e0daf15tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab279eee3314tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab27a5c1b536tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab27a9560902tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab27ba678cf4tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab27ba9dbb3btplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab27cee0b839tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab28553037aatplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab285541faaatplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2855867adbtplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2855c30501tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab285772443atplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2865765c07tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab287022cf69tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2878933ee5tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab2875e5a963tplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="og:image" content="http://shenbh.github.io/posts/a42e0030/16e1ab287980fd1atplv-t2oaga2asx-jj-mark3024000q75.png">
<meta property="article:published_time" content="2025-01-16T06:26:00.000Z">
<meta property="article:modified_time" content="2025-05-07T09:15:12.592Z">
<meta property="article:author" content="阿炳">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://shenbh.github.io/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/a42e0030/"/>





  <title>Android的36大难点 | 积跬步</title>
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">积跬步</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Just do IT Now.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/a42e0030/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="积跬步">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Android的36大难点</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2025-01-16T14:26:00+08:00">
                2025-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android%E6%89%A9%E5%B1%95/" itemprop="url" rel="index">
                    <span itemprop="name">Android扩展</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Activity-的-36-大难点，你会几个？"><a href="#Activity-的-36-大难点，你会几个？" class="headerlink" title="Activity 的 36 大难点，你会几个？"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903983656468488#heading-5">Activity 的 36 大难点，你会几个？</a></h1><blockquote>
<p>智能总结：<br>本文全面总结了 Android Activity 的相关知识，包括生命周期（如不同场景下的变化、横竖屏切换等）、启动模式（standard、singleTop、singleTask、singleInstance 及使用方式、应用场景）、数据传递（如 Intent 传递数据大小限制、内存不足时的保存方法等）、与其他概念的关系（如 Context 等）、进程（如进程优先级、ANR 等），还提到了 Activity 管理机制等内容。</p>
</blockquote>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><ul>
<li>学 <code>Android</code> 有一段时间了，一直都只顾着学新的东西，最近发现很多平常用的少的东西竟让都忘了，趁着这两天，打算把有关 <code>Activity</code> 的内容以问题的形式梳理出来，也供大家查缺补漏。  <blockquote>
<p>本文中，我将一改往日写博客的习惯，全文用 <code>XMind</code> 将所有知识点以思维导图的形式呈现，欢迎大家食用～～</p>
</blockquote>
<h1 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h1></li>
</ul>
<p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95.png" alt="文章目录"></p>
<h1 id="方便大家学习，我在-GitHub-上建立个-仓库"><a href="#方便大家学习，我在-GitHub-上建立个-仓库" class="headerlink" title="方便大家学习，我在 GitHub 上建立个 仓库"></a>方便大家学习，我在 GitHub 上建立个 仓库</h1><ul>
<li>仓库内容与博客同步更新。由于我在 <code>稀土掘金</code> <code>简书</code> <code>CSDN</code> <code>博客园</code> 等站点，都有新内容发布。所以大家可以直接关注该仓库，以免错过精彩内容！</li>
<li>仓库地址： <a target="_blank" rel="noopener" href="https://github.com/FishInWater-1999/android_interviews">精心归纳 <code>Android</code> 、<code>JVM</code> 、算法等</a><h1 id="神图"><a href="#神图" class="headerlink" title="神图"></a>神图</h1></li>
<li>在开始之前，先让我们看看 <code>Android</code> 的 <code>activity</code> 到底都有哪些东西？</li>
<li>借一张网上很火的图带你了解 <code>Activity</code><br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%B8%80%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E4%BA%86%E8%A7%A3Activity.png" alt="一张图带你了解 Activity"><h1 id="一、生命周期"><a href="#一、生命周期" class="headerlink" title="一、生命周期"></a>一、生命周期</h1></li>
<li>先贴一张闻名遐迩的图</li>
<li>我们生命周期先看看具体有哪些方法回调，在逐一攻破：<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="生命周期"><h2 id="1-1-Dialog-弹出时"><a href="#1-1-Dialog-弹出时" class="headerlink" title="1.1 Dialog 弹出时"></a>1.1 Dialog 弹出时</h2><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Dialog%E5%BC%B9%E5%87%BA%E6%97%B6.png" alt="dialog弹出时">  </li>
<li>如果是单纯是创建的 <code>dialog</code> ，<code>Activity</code> 并不会执行生命周期的方法</li>
<li>但是如果是跳转到一个不是全屏的 <code>Activity</code> 的话, 当然就是按照正常的生命周期来执行了</li>
<li>即 <code>onPasue()</code> -&gt; <code>onPause()</code> ( 不会执行原 <code>Activity</code> 的 <code>onStop()</code> , 否则上个页面就不显示了 )</li>
</ul>
<h2 id="1-2-横竖屏切换时"><a href="#1-2-横竖屏切换时" class="headerlink" title="1.2 横竖屏切换时"></a>1.2 横竖屏切换时</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2%E6%97%B6.png" alt="横竖屏切换时">  </p>
<ul>
<li>不设置 <code>Activity</code> 的 <code>android:configChanges</code> 时，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次</li>
<li>设置 <code>Activity</code> 的 <code>android:configChanges=&quot;orientation&quot;</code> 时，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次</li>
<li>设置 <code>Activity</code> 的 <code>android:configChanges=&quot;orientation|keyboardHidden&quot;</code> 时，切屏不会重新调用各个生命周期，只会执行 <code>onConfigurationChanged</code> 方法</li>
<li>注意：还有一点，非常重要，一个 <code>Android</code> 的变更细节！当 <code>API &gt;12</code> 时，需要加入 <code>screenSize</code> 属性，否则屏幕切换时即使你设置了 <code>orientation</code> 系统也会重建 <code>Activity</code> ！</li>
<li><a href="https://link.juejin.cn/?target=https://developer.android.com/guide/topics/resources/runtime-changes.html" title="https://developer.android.com/guide/topics/resources/runtime-changes.html">横竖屏切换生命周期的执行</a><h2 id="1-3-不同场景下-Activity-生命周期的变化过程"><a href="#1-3-不同场景下-Activity-生命周期的变化过程" class="headerlink" title="1.3 不同场景下 Activity 生命周期的变化过程"></a>1.3 不同场景下 Activity 生命周期的变化过程</h2><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E4%B8%8BActivity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%8F%98%E5%8C%96.png" alt="不同场景下Activity生命周期的变化过程">  </li>
<li>启动 <code>Activity</code> ： <code>onCreate()</code> —&gt; <code>onStart()</code> —&gt; <code>onResume()</code> ，<code>Activity</code> 进入运行状态。</li>
<li>锁屏时会执行 <code>onPause()</code> 和 <code>onStop()</code> , 而开屏时则应该执行 <code>onStart()</code> <code>onResume()</code><br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%B7%B2%E5%90%AF%E5%8A%A8%E7%9A%84Activity%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%8F%98%E5%8C%96.png" alt="已启动的 Activity 生命周期的变化">  </li>
<li><code>Activity</code> 退居后台： 当前 <code>Activity</code> 转到新的 <code>Activity</code> 界面或按 <code>Home</code> 键回到主屏： <code>onPause()</code> —&gt; <code>onStop()</code> ，进入停滞状态。</li>
<li><code>Activity</code> 返回前台： <code>onRestart()</code> —&gt; <code>onStart()</code> —&gt; <code>onResume()</code> ，再次回到运行状态。</li>
<li><code>Activity</code> 退居后台： 且系统内存不足， 系统会杀死这个后台状态的 <code>Activity</code> ，若再次回到这个 <code>Activity</code> ,则会走 <code>onCreate()</code> –&gt; <code>onStart()</code> —&gt; <code>onResume()</code><h2 id="1-4-将一个-Activity-设置成窗口的样式"><a href="#1-4-将一个-Activity-设置成窗口的样式" class="headerlink" title="1.4 将一个 Activity 设置成窗口的样式"></a>1.4 将一个 Activity 设置成窗口的样式</h2><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E8%AE%BE%E7%BD%AEActivity%E6%88%90%E7%AA%97%E5%8F%A3%E6%A0%B7%E5%BC%8F.png" alt="设置 Activity 成窗口样式"><br>只需要给我们的 <code>Activity</code> 配置如下属性即可。 <code>android:theme=&quot;@android:style/Theme.Dialog&quot;</code></li>
</ul>
<h2 id="1-5-退出已调用多个-Activity-的-Application"><a href="#1-5-退出已调用多个-Activity-的-Application" class="headerlink" title="1.5 退出已调用多个 Activity 的 Application"></a>1.5 退出已调用多个 Activity 的 Application</h2><ul>
<li><p>通常情况用户退出一个 <code>Activity</code> 只需按返回键,我们写代码想退出 <code>activity</code> 直接调用 <code>finish()</code> 方法就行。<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E9%80%80%E5%87%BA%E8%B0%83%E7%94%A8%E5%A4%9A%E4%B8%AAActivity%E7%9A%84Application.png" alt="退出调用多个 Activity 的 Application"></p>
</li>
<li><p>发送特定广播:</p>
</li>
</ul>
<ol>
<li>在需要结束应用时, 发送一个特定的广播,每个 <code>Activity</code> 收到广播后,关闭 即可。</li>
<li>给某个 <code>activity</code> 注册接受接受广播的意图 <code>registerReceiver(receiver, filter)</code></li>
<li>如果过接受到的是 关闭 <code>activity</code> 的广播 <code>activity finish()</code> 掉</li>
</ol>
<ul>
<li>递归退出</li>
</ul>
<ol>
<li>就调用 <code>finish()</code> 方法 把当前的 <code>Activity</code> 退出</li>
<li>在打开新的 <code>Activity</code> 时使用 <code>startActivityForResult</code> , 然后自己加标志, 在 <code>onActivityResult</code> 中处理, 递归关闭。</li>
</ol>
<ul>
<li>其实</li>
</ul>
<ol>
<li>也可以通过 <code>intent</code> 的 <code>flag</code> 来实现 <code>intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP)</code> 激活一个新的 <code>activity</code>。</li>
<li>此时如果该任务栈中已经有该 <code>Activity</code> , 那么系统会把这个 <code>Activity</code> 上面的所有 <code>Activity</code> 干掉。</li>
<li>其实相当于给 <code>Activity</code> 配置的启动模式为 <code>singleTask</code> 。</li>
</ol>
<ul>
<li>记录打开的 <code>Activity</code></li>
</ul>
<ol>
<li>每打开一个 <code>Activity</code> , 就记录下来。</li>
<li>在需要退出时 , 关闭每一个 <code>Activity</code></li>
</ol>
<h2 id="1-6-锁定屏与解锁屏幕，Activity-如何执行生命周期"><a href="#1-6-锁定屏与解锁屏幕，Activity-如何执行生命周期" class="headerlink" title="1.6 锁定屏与解锁屏幕，Activity 如何执行生命周期"></a>1.6 锁定屏与解锁屏幕，Activity 如何执行生命周期</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E9%94%81%E5%AE%9A%E5%B1%8F%E4%B8%8E%E8%A7%A3%E9%94%81%E5%B1%8F%E5%B9%95%E6%97%B6Activity%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="锁定屏与解锁屏幕，Activity如何执行生命周期">  </p>
<ul>
<li>锁屏时会执行 <code>onPause()</code> 和 <code>onStop()</code> , 而开屏时则应该执行 <code>onStart()</code> <code>onResume()</code></li>
</ul>
<h2 id="1-7-修改-Activity-进入和退出动画"><a href="#1-7-修改-Activity-进入和退出动画" class="headerlink" title="1.7 修改 Activity 进入和退出动画"></a>1.7 修改 Activity 进入和退出动画</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%BF%AE%E6%94%B9Activity%E8%BF%9B%E5%85%A5%E5%92%8C%E9%80%80%E5%87%BA%E5%8A%A8%E7%94%BB.png" alt="修改 Activity 进入和退出动画">  </p>
<ul>
<li>可以通过两种方式 ， 一是通过定义 <code>Activity</code> 的主题 ，二是通过覆写 <code>Activity</code> 的 <code>overridePendingTransition</code> 方法。</li>
<li>通过设置主题样式在 <code>styles.xml</code> 中编辑代码 , 添加 <code>themes.xml</code> 文件：在 <code>AndroidManifest.xml</code> 中给指定的 <code>Activity</code> 指定 <code>theme</code>。</li>
<li>覆写 <code>overridePendingTransition</code> 方法：<code>overridePendingTransition(R.anim.fade, R.anim.hold)</code>;</li>
</ul>
<h2 id="1-8-Activity-的四种状态"><a href="#1-8-Activity-的四种状态" class="headerlink" title="1.8 Activity 的四种状态"></a>1.8 Activity 的四种状态</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Activity%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%8A%B6%E6%80%81.png" alt="四种状态"></p>
<ul>
<li><code>runnig</code> ：用户可以点击，<code>activity</code> 处于栈顶状态。</li>
<li><code>paused</code> ：<code>activity</code> 失去焦点的时候，被一个非全屏的 <code>activity</code> 占据或者被一个透明的 <code>activity</code> 覆盖，这个状态的 <code>activity</code> 并没有销毁，它所有的状态信息和成员变量仍然存在，只是不能够被点击。(内存紧张的情况，这个 <code>activity</code> 有可能被回收)<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%85%B3%E9%97%AD.png" alt="关闭"></li>
<li><code>stopped</code> ：这个 <code>activity</code> 被另外一个 <code>activity</code> 完全覆盖，但是这个 <code>activity</code> 的所有状态信息和成员变量仍然存在(除了内存紧张)</li>
<li><code>killed</code> ：这个 <code>activity</code> 已经被销毁，其所有的状态信息和成员变量已经不存在了。<h2 id="1-9-如何处理异常退出"><a href="#1-9-如何处理异常退出" class="headerlink" title="1.9 如何处理异常退出"></a>1.9 如何处理异常退出</h2><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA.png" alt="如何处理异常退出">  </li>
<li><code>Activity</code> 异常退出的时候 –&gt; <code>onPause()</code> –&gt; <code>onSaveInstanceState()</code> –&gt; <code>onStop()</code> –&gt; <code>onDestory()</code></li>
<li>需要注意的是 <code>onSaveInstanceState()</code> 方法与 <code>onPause</code> 并没有严格的先后关系，有可能在 <code>onPause</code> 之前，也有可能在其后面调用，但会在 <code>onStop()</code> 方法之前调用</li>
<li>异常退出后又重新启动该 <code>Activity</code> –&gt; <code>onCreate()</code> –&gt; <code>onStart()</code> –&gt; <code>onRestoreInstanceState()</code> –&gt; <code>onResume()</code><br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA%E5%90%8E%E5%8F%88%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8.png" alt="异常退出后又重新启动"></li>
<li>搞懂这个生命周期的执行后就可以回答了，首先要知道面试官的意思：是要重新启动并恢复这个 <code>Activity</code> 还是说直接退出整个 <code>app</code></li>
<li>如果要恢复则要在 <code>onSaveInstanceState()</code> 中进行保存数据并在 <code>onRestoreInstanceState()</code> 中进行恢复</li>
<li>如果是要退出 <code>app</code> 的话就要捕获全局的异常信息，并退出 <code>app</code></li>
<li>当然个人建议是使用 <code>UncaughtExceotionHandler</code> 来捕获全局异常进行退出 <code>app</code> 的操作，这样会减少之前崩溃所造成的后遗症！</li>
</ul>
<h2 id="1-10-什么是-onNewIntent"><a href="#1-10-什么是-onNewIntent" class="headerlink" title="1.10 什么是 onNewIntent"></a>1.10 什么是 onNewIntent</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E4%BB%80%E4%B9%88%E6%98%AFonNewIntent.png" alt="onNewIntent">  </p>
<ul>
<li>如果 <code>IntentActivity</code> 处于任务栈的顶端，也就是说之前打开过的 <code>Activity</code> ，现在处于 <code>onPause</code> 、 <code>onStop</code> 状态的话，其他应用再发送 <code>Intent</code> 的话</li>
<li>执行顺序为：<code>onNewIntent</code>，<code>onRestart</code>，<code>onStart</code>，<code>onResume</code>。</li>
</ul>
<h1 id="二、启动模式"><a href="#二、启动模式" class="headerlink" title="二、启动模式"></a>二、启动模式</h1><h2 id="2-1-启动模式"><a href="#2-1-启动模式" class="headerlink" title="2.1 启动模式"></a>2.1 启动模式</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F.png" alt="启动模式"></p>
<ul>
<li><p><code>Activity</code> 一共有四种 <code>launchMode</code> ：<code>standard</code> 、<code>singleTop</code> 、<code>singleTask</code> 、<code>singleInstance</code> 。<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Standard.png" alt="Standard"></p>
</li>
<li><p><code>Standard</code> 模式（默认模式）</p>
</li>
</ul>
<ol>
<li>说明： 每次启动一个 <code>Activity</code> 都会又一次创建一个新的实例入栈，无论这个实例是否存在。</li>
<li>生命周期：每次被创建的实例 <code>Activity</code> 的生命周期符合典型情况，它的 <code>onCreate</code> 、<code>onStart</code> 、<code>onResume</code> 都会被调用。 </li>
<li>举例：此时 <code>Activity</code> 栈中以此有 <code>A</code> 、<code>B</code> 、<code>C</code> 三个 <code>Activity</code> ，此时C处于栈顶，启动模式为 <code>Standard</code> 模式。若在 <code>C Activity</code> 中加入点击事件，须要跳转到还有一个同类型的 <code>C Activity</code> 。结果是还有一个 <code>C Activity</code> 进入栈中，成为栈顶。<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleTop.png" alt="SingleTop"></li>
</ol>
<ul>
<li><code>SingleTop</code> 模式（栈顶复用模式）</li>
</ul>
<ol>
<li>说明：分两种处理情况：须要创建的 <code>Activity</code> 已经处于栈顶时，此时会直接复用栈顶的 <code>Activity</code> 。不会再创建新的 <code>Activity</code> ；若须要创建的 <code>Activity</code> 不处于栈顶，此时会又一次创建一个新的 <code>Activity</code> 入栈，同 <code>Standard</code> 模式一样。</li>
<li>生命周期：若情况一中栈顶的 <code>Activity</code> 被直接复用时，它的 <code>onCreate</code> 、<code>onStart</code> 不会被系统调用，由于它并没有发生改变。可是一个新的方法 <code>onNewIntent</code> 会被回调（ <code>Activity</code> 被正常创建时不会回调此方法）。</li>
<li>举例：此时 <code>Activity</code> 栈中以此有 <code>A</code> 、<code>B</code> 、<code>C</code> 三个 <code>Activity</code> ，此时 <code>C</code> 处于栈顶，启动模式为 <code>SingleTop</code> 模式。情况一：在 <code>C Activity</code> 中加入点击事件，须要跳转到还有一个同类型的 <code>C Activity</code> 。结果是直接复用栈顶的 <code>C Activity</code>。情况二：在 <code>C Activity</code> 中加入点击事件，须要跳转到还有一个 <code>A Activity</code>。结果是创建一个新的 <code>Activity</code> 入栈。成为栈顶。<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleTask.png" alt="SingleTask"></li>
</ol>
<ul>
<li><code>SingleTask</code> 模式（栈内复用模式）</li>
</ul>
<ol>
<li>说明：若须要创建的 <code>Activity</code> 已经处于栈中时，此时不会创建新的 <code>Activity</code> ，而是将存在栈中的 <code>Activity</code> 上面的其他 <code>Activity</code> 所有销毁，使它成为栈顶。</li>
<li>如果是在别的应用程序中启动它，则会新建一个 <code>task</code> ，并在该task中启动这个 <code>Activity</code> ，<code>singleTask</code> 允许别的 <code>Activity</code> 与其在一个 <code>task</code> 中共存，也就是说，如果我在这个 <code>singleTask</code> 的实例中再打开新的 <code>Activity</code> ，这个新的 <code>Activity</code> 还是会在 <code>singleTask</code> 的实例的 <code>task</code> 中。</li>
<li>生命周期：同 <code>SingleTop</code> 模式中的情况一同样。仅仅会又一次回调 <code>Activity</code> 中的 <code>onNewIntent</code> 方法</li>
<li>举例：此时 <code>Activity</code> 栈中以此有 <code>A</code> 、<code>B</code> 、<code>C</code> 三个 <code>Activity</code> 。此时 <code>C</code> 处于栈顶，启动模式为 <code>SingleTask</code> 模式。情况一：在 <code>C Activity</code> 中加入点击事件，须要跳转到还有一个同类型的 <code>C Activity</code> 。结果是直接用栈顶的 <code>C Activity</code> 。情况二：在 <code>C Activity</code> 中加入点击事件，须要跳转到还有一个 <code>A Activity</code> 。结果是将 <code>A Activity</code> 上面的 <code>B</code> 、<code>C</code> 所有销毁，使 <code>A Activity</code> 成为栈顶。<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleInstance.png" alt="ingleInstance"></li>
</ol>
<ul>
<li><code>SingleInstance</code> 模式（单实例模式）</li>
</ul>
<ol>
<li>说明： <code>SingleInstance</code> 比较特殊，是全局单例模式，是一种加强的 <code>SingleTask</code> 模式。它除了具有它所有特性外，还加强了一点：只有一个实例，并且这个实例独立运行在一个 <code>task</code> 中，这个 <code>task</code> 只有这个实例，不允许有别的 <code>Activity</code> 存在。</li>
<li>这个经常使用于系统中的应用，比如 <code>Launch</code> 、锁屏键的应用等等，整个系统中仅仅有一个！所以在我们的应用中一般不会用到。了解就可以。</li>
<li>举例：比方 <code>A Activity</code> 是该模式，启动 <code>A</code> 后。系统会为它创建一个单独的任务栈，由于栈内复用的特性。兴许的请求均不会创建新的 <code>Activity</code> ，除非这个独特的任务栈被系统销毁。</li>
</ol>
<h2 id="2-2-启动模式的使用方式"><a href="#2-2-启动模式的使用方式" class="headerlink" title="2.2 启动模式的使用方式"></a>2.2 启动模式的使用方式</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F.png" alt="启动模式的使用方式"></p>
<ul>
<li>在 <code>Manifest.xml</code> 中指定 <code>Activity</code> 启动模式</li>
</ul>
<ol>
<li>一种静态的指定方法</li>
<li>在 <code>Manifest.xml</code> 文件里声明 <code>Activity</code> 的同一时候指定它的启动模式</li>
<li>这样在代码中跳转时会依照指定的模式来创建 <code>Activity</code> 。</li>
</ol>
<ul>
<li>启动 <code>Activity</code> 时。在 <code>Intent</code> 中指定启动模式去创建 <code>Activity</code></li>
</ul>
<ol>
<li>一种动态的启动模式</li>
<li>在 <code>new</code> 一个 <code>Intent</code> 后</li>
<li>通过 <code>Intent</code> 的 <code>addFlags</code> 方法去动态指定一个启动模式。</li>
</ol>
<ul>
<li>注意：以上两种方式都能够为 <code>Activity</code> 指定启动模式，可是二者还是有差别的。</li>
</ul>
<ol>
<li>优先级：动态指定方式即另外一种比第一种优先级要高，若两者同一时候存在，以另外一种方式为准。</li>
<li>限定范围：第一种方式无法为 <code>Activity</code> 直接指定 <code>FLAG_ACTIVITY_CLEAR_TOP</code> 标识，另外一种方式无法为 <code>Activity</code> 指定 <code>singleInstance</code> 模式。</li>
</ol>
<h2 id="2-3-启动模式的实际应用场景"><a href="#2-3-启动模式的实际应用场景" class="headerlink" title="2.3 启动模式的实际应用场景"></a>2.3 启动模式的实际应用场景</h2><blockquote>
<p>这四种模式中的 <code>Standard</code> 模式是最普通的一种，没有什么特别注意。而 <code>SingleInstance</code> 模式是整个系统的单例模式，在我们的应用中一般不会应用到。所以，这里就具体解说 <code>SingleTop</code> 和 <code>SingleTask</code> 模式的运用场景：</p>
</blockquote>
<p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.png" alt="启动模式的实际应用场景"></p>
<ul>
<li><code>SingleTask</code> 模式的运用场景</li>
</ul>
<ol>
<li>最常见的应用场景就是保持我们应用开启后仅仅有一个 <code>Activity</code> 的实例。</li>
<li>最典型的样例就是应用中展示的主页（ <code>Home</code> 页）。</li>
<li>假设用户在主页跳转到其他页面，运行多次操作后想返回到主页，假设不使用 <code>SingleTask</code> 模式，在点击返回的过程中会多次看到主页，这明显就是设计不合理了。</li>
</ol>
<ul>
<li><code>SingleTop</code> 模式的运用场景</li>
</ul>
<ol>
<li>假设你在当前的 <code>Activity</code> 中又要启动同类型的 <code>Activity</code></li>
<li>此时建议将此类型 <code>Activity</code> 的启动模式指定为 <code>SingleTop</code> ，能够降低Activity的创建，节省内存！</li>
</ol>
<ul>
<li>注意：复用 <code>Activity</code> 时的生命周期回调</li>
</ul>
<ol>
<li>这里还须要考虑一个 <code>Activity</code> 跳转时携带页面參数的问题。</li>
<li>由于当一个 <code>Activity</code> 设置了 <code>SingleTop</code> 或者 <code>SingleTask</code> 模式后，跳转此 <code>Activity</code> 出现复用原有 <code>Activity</code> 的情况时，此 <code>Activity</code> 的 <code>onCreate</code> 方法将不会再次运行。<code>onCreate</code> 方法仅仅会在第一次创建 <code>Activity</code> 时被运行。</li>
<li>而一般 <code>onCreate</code> 方法中会进行该页面的数据初始化、<code>UI</code> 初始化，假设页面的展示数据无关页面跳转传递的參数，则不必操心此问题</li>
<li>若页面展示的数据就是通过 <code>getInten()</code> 方法来获取，那么问题就会出现：<code>getInten()</code> 获取的一直都是老数据，根本无法接收跳转时传送的新数据！</li>
</ol>
<ul>
<li><p>以下，通过一个样例来具体解释：<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-SingleTop%E6%A0%B7%E4%BE%8B.png" alt="Android的36大难点-SingleTop样例"></p>
</li>
<li><p>以上代码中的 <code>CourseDetailActivity</code> 在配置文件里设置了启动模式是 <code>SingleTop</code> 模式，依据上面启动模式的介绍可得知，当 <code>CourseDetailActivity</code> 处于栈顶时。</p>
</li>
<li><p>再次跳转页面到 <code>CourseDetailActivity</code> 时会直接复用原有的 <code>Activity</code> ，并且此页面须要展示的数据是从 <code>getIntent()</code> 方法得来，可是 <code>initData()</code> 方法不会再次被调用，此时页面就无法显示新的数据。</p>
</li>
<li><p>当然这样的情况系统早就为我们想过了，这时我们须要另外一个回调 <code>onNewIntent（Intent intent）</code>方法。此方法会传入最新的 <code>intent</code> ，这样我们就能够解决上述问题。这里建议的方法是又一次去 <code>setIntent</code> 。然后又一次去初始化数据和 <code>UI</code> 。代码例如以下所看到的：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服用Activity的生命周期回调</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onNewIntent</span><span class="params">(Intent intent)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>.onNewIntent(intent);</span><br><span class="line">    setIntent(intent);</span><br><span class="line">    initData();</span><br><span class="line">    initView();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这样，在一个页面中能够反复跳转并显示不同的内容。</li>
</ul>
<h2 id="2-4-快速启动一个-Activity"><a href="#2-4-快速启动一个-Activity" class="headerlink" title="2.4 快速启动一个 Activity"></a>2.4 快速启动一个 Activity</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity.png" alt="快速启动一个 Activity"></p>
<ul>
<li>这个问题其实也是比较简单的，就是不要在 <code>Activity</code> 的 <code>onCreate</code> 方法中执行过多繁重的操作，并且在 <code>onPasue</code> 方法中同样不能做过多的耗时操作。</li>
</ul>
<h2 id="2-5-启动流程"><a href="#2-5-启动流程" class="headerlink" title="2.5 启动流程"></a>2.5 启动流程</h2><ul>
<li>注意！这里并不是要回答 <code>Activity</code> 的生命周期！</li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903474606374925" title="https://juejin.cn/post/6844903474606374925">3 分钟看懂 <code>Activity</code> 启动流程</a></li>
</ul>
<h2 id="2-6-Activity-的-Flags"><a href="#2-6-Activity-的-Flags" class="headerlink" title="2.6 Activity 的 Flags"></a>2.6 Activity 的 Flags</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Activity%E7%9A%84Flags.png" alt="Activity 的 Flags"></p>
<ul>
<li><p>标记位既能够设定Activity的启动模式，如同上面介绍的，在动态指定启动模式，比方 <code>FLAG_ACTIVITY_NEW_TASK</code> 和 <code>FLAG_ACTIVITY_SINGLE_TOP</code> 等。它还能够影响 <code>Activity</code> 的运行状态 ，比方 <code>FLAG_ACTIVITY_CLEAN_TOP</code> 和 <code>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</code> 等。</p>
</li>
<li><p>以下介绍几个基本的标记位，切勿死记，理解几个就可以，须要时再查官方文档。<br><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%9A%84%E6%A0%87%E8%AE%B0%E4%BD%8D.png" alt="几个基本的标记位"></p>
</li>
<li><p><code>FLAG_ACTIVITY_NEW_TASK</code></p>
</li>
</ul>
<ol>
<li>作用是为 <code>Activity</code> 指定 <code>“SingleTask”</code> 启动模式。跟在 <code>AndroidMainfest.xml</code> 指定效果同样</li>
</ol>
<ul>
<li><code>FLAG_ACTIVITY_SINGLE_TOP</code></li>
</ul>
<ol>
<li>作用是为 <code>Activity</code> 指定 <code>“SingleTop”</code> 启动模式，跟在 <code>AndroidMainfest.xml</code> 指定效果同样。</li>
</ol>
<ul>
<li><code>FLAG_ACTIVITY_CLEAN_TOP</code></li>
</ul>
<ol>
<li>具有此标记位的 <code>Activity</code> ，启动时会将与该 <code>Activity</code> 在同一任务栈的其他 <code>Activity</code> 出栈。</li>
<li>一般与 <code>SingleTask</code> 启动模式一起出现。</li>
<li>它会完毕 <code>SingleTask</code> 的作用。</li>
<li>但事实上 <code>SingleTask</code> 启动模式默认具有此标记位的作用</li>
</ol>
<ul>
<li><code>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</code></li>
</ul>
<ol>
<li>具有此标记位的 <code>Activity</code> 不会出如今历史 <code>Activity</code> 的列表中</li>
<li>使用场景：当某些情况下我们不希望用户通过历史列表回到 <code>Activity</code> 时，此标记位便体现了它的效果。</li>
<li>它等同于在 <code>xml</code> 中指定 <code>Activity</code> 的属性.</li>
</ol>
<h2 id="2-7-onNewInstent-方法什么时候执行"><a href="#2-7-onNewInstent-方法什么时候执行" class="headerlink" title="2.7 onNewInstent()方法什么时候执行"></a>2.7 onNewInstent()方法什么时候执行</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-onNewIntent.png" alt="onNewInstent()方法什么时候执行"><br>这个是启动模式中的了，当此 <code>Activity</code> 的实例已经存在，并且此时的启动模式为 <code>SingleTask</code> 和 <code>SingleInstance</code> ，另外当这个实例位于栈顶且启动模式为 <code>SingleTop</code> 时也会触发 <code>onNewInstent()</code> 。</p>
<h1 id="三、数据"><a href="#三、数据" class="headerlink" title="三、数据"></a>三、数据</h1><h2 id="3-1-Activity-间通过-Intent-传递数据大小限制"><a href="#3-1-Activity-间通过-Intent-传递数据大小限制" class="headerlink" title="3.1 Activity 间通过 Intent 传递数据大小限制"></a>3.1 Activity 间通过 Intent 传递数据大小限制</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Intent%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE.png" alt="Activity 间通过 Intent 传递数据大小限制"></p>
<ul>
<li><code>Intent</code> 在传递数据时是有大小限制的，这里官方并未详细说明，不过通过实验的方法可以测出数据应该被限制在 <code>1MB</code> 之内（ <code>1024KB</code> ）</li>
<li>我们采用传递 <code>Bitmap</code> 的方法，发现当图片大小超过 <code>1024</code>（准确地说是 <code>1020</code> 左右）的时候，程序就会出现闪退、停止运行等异常(不同的手机反应不同)</li>
<li>因此可以判断 <code>Intent</code> 的传输容量在 <code>1MB</code> 之内。</li>
</ul>
<h2 id="3-2-内存不足时系统会杀掉后台的Activity，若需要进行一些临时状态的保存，在哪个方法进行"><a href="#3-2-内存不足时系统会杀掉后台的Activity，若需要进行一些临时状态的保存，在哪个方法进行" class="headerlink" title="3.2 内存不足时系统会杀掉后台的Activity，若需要进行一些临时状态的保存，在哪个方法进行"></a>3.2 内存不足时系统会杀掉后台的Activity，若需要进行一些临时状态的保存，在哪个方法进行</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E6%9D%80%E6%8E%89%E5%90%8E%E5%8F%B0%E6%97%B6Activity%E5%93%AA%E4%B8%AA%E6%96%B9%E6%B3%95%E4%BF%9D%E5%AD%98%E4%B8%B4%E6%97%B6%E7%8A%B6%E6%80%81.png" alt="onSaveInstanceState()"></p>
<ul>
<li><code>Activity</code> 的 <code>onSaveInstanceState()</code> 和 <code>onRestoreInstanceState()</code> 并不是生命周期方法，它们不同于 <code>onCreate()</code> 、<code>onPause()</code> 等生命周期方法，它们并不一定会被触发。</li>
<li><code>onSaveInstanceState()</code> 方法，当应用遇到意外情况（如：内存不足、用户直接按 <code>Home</code> 键）由系统销毁一个 <code>Activity</code> ，<code>onSaveInstanceState()</code> 会被调用。</li>
<li>但是当用户主动去销毁一个 <code>Activity</code> 时，例如在应用中按返回键，<code>onSaveInstanceState()</code> 就不会被调用。</li>
<li>除非该 <code>activity</code> 不是被用户主动销毁的，通常 <code>onSaveInstanceState()</code> 只适合用于保存一些临时性的状态，而 <code>onPause()</code> 适合用于数据的持久化保存。</li>
</ul>
<h2 id="3-3-onSaveInstanceState-被执行的场景"><a href="#3-3-onSaveInstanceState-被执行的场景" class="headerlink" title="3.3 onSaveInstanceState() 被执行的场景"></a>3.3 onSaveInstanceState() 被执行的场景</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-onSaveInstanceState()%E8%A2%AB%E6%89%A7%E8%A1%8C%E7%9A%84%E5%9C%BA%E6%99%AF.png" alt="onSaveInstanceState() 被执行的场景"></p>
<ul>
<li>系统不知道你按下 <code>HOME</code> 后要运行多少其他的程序，自然也不知道 <code>activity A</code> 是否会被销毁</li>
<li>因此系统都会调用 <code>onSaveInstanceState()</code> ，让用户有机会保存某些非永久性的数据。以下几种情况的分析都遵循该原则：</li>
</ul>
<ol>
<li>当用户按下 <code>HOME</code> 键时</li>
<li>长按 <code>HOME</code> 键，选择运行其他的程序时</li>
<li>锁屏时</li>
<li>从 <code>activity A</code> 中启动一个新的 <code>activity</code> 时</li>
<li>屏幕方向切换时</li>
</ol>
<h2 id="3-4-两个-Activity-之间跳转时必然会执行的方法"><a href="#3-4-两个-Activity-之间跳转时必然会执行的方法" class="headerlink" title="3.4 两个 Activity 之间跳转时必然会执行的方法"></a>3.4 两个 Activity 之间跳转时必然会执行的方法</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Activity%E8%B7%B3%E8%BD%AC%E6%97%B6%E4%BC%9A%E6%89%A7%E8%A1%8C%E7%9A%84%E6%96%B9%E6%B3%95.png" alt="两个 Activity 之间跳转时必然会执行的方法"></p>
<p>一般情况下比如说有两个 <code>activity</code> , 分别叫 <code>A</code> , <code>B</code> ,当在 <code>A</code> 里面激活 <code>B</code> 组件的时候, <code>A</code> 会调用 <code>onPause()</code> 方法,然后 <code>B</code> 调用 <code>onCreate()</code> , <code>onStart()</code> , <code>onResume()</code> 。<br>这个时候 <code>B</code> 覆盖了窗体, <code>A</code> 会调用 <code>onStop()</code> 方法. 如果 <code>B</code> 是个透明的,或者 是对话框的样式, 就不会调用 <code>A</code> 的 <code>onStop()</code> 方法。</p>
<h2 id="3-5-用-Intent-去启动一个Activity-之外的方法"><a href="#3-5-用-Intent-去启动一个Activity-之外的方法" class="headerlink" title="3.5 用 Intent 去启动一个Activity 之外的方法"></a>3.5 用 Intent 去启动一个Activity 之外的方法</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E7%94%A8Intent%E5%8E%BB%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity%E4%B9%8B%E5%A4%96%E7%9A%84%E6%96%B9%E6%B3%95.png" alt="用 Intent 去启动一个Activity 之外的方法"></p>
<ul>
<li>使用 <code>adb shell am</code> 命令</li>
</ul>
<ol>
<li><code>am</code> 启动一个 <code>activity</code></li>
<li><code>adb shell am start com.example.fuchenxuan/.MainActivity</code></li>
<li><code>am</code> 发送一个广播，使用 <code>action</code></li>
<li><code>adb shell am broadcast -a magcomm.action.TOUCH_LETTER</code></li>
</ol>
<h2 id="3-6-scheme-跳转协议"><a href="#3-6-scheme-跳转协议" class="headerlink" title="3.6 scheme 跳转协议"></a>3.6 scheme 跳转协议</h2><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Scheme%E8%B7%B3%E8%BD%AC%E5%8D%8F%E8%AE%AE.png" alt="scheme跳转协议"></p>
<h4 id="3-6-1-定义"><a href="#3-6-1-定义" class="headerlink" title="3.6.1 定义"></a>3.6.1 定义</h4><p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-Scheme%E5%AE%9A%E4%B9%89.png" alt="定义"></p>
<ul>
<li>服务器可以定制化跳转 <code>app</code> 页面</li>
<li><code>app</code> 可以通过 <code>Scheme</code> 跳转到另一个 <code>app</code> 页面</li>
<li>可以通过 <code>h5</code> 页面跳转 <code>app</code> 原生页面</li>
</ul>
<h4 id="3-6-2-协议格式："><a href="#3-6-2-协议格式：" class="headerlink" title="3.6.2 协议格式："></a>3.6.2 协议格式：</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Uri</span>.parse(<span class="string">&quot;qh://test:8080/goods?goodsId=8897&amp;name=fuck&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/posts/a42e0030/Android%E7%9A%8436%E5%A4%A7%E9%9A%BE%E7%82%B9-%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F.png" alt="协议格式"></p>
<ul>
<li><code>qh</code> 代表 <code>Scheme</code> 协议名称</li>
<li><code>test</code> 代表 <code>Scheme</code> 作用的地址域</li>
<li><code>8080</code> 代表改路径的端口号</li>
<li><code>/goods</code> 代表的是指定页面(路径)</li>
<li><code>goodsId</code> 和 <code>name</code> 代表传递的两个参数</li>
</ul>
<h4 id="3-6-3-Scheme使用"><a href="#3-6-3-Scheme使用" class="headerlink" title="3.6.3 Scheme使用"></a>3.6.3 Scheme使用</h4><ul>
<li>定义一个 <code>Scheme</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.ScemeActivity&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--给页面添加指定的过滤器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--该页面的路径配置--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">data</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:host</span>=<span class="string">&quot;test&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:path</span>=<span class="string">&quot;/goods&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:port</span>=<span class="string">&quot;8080&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:scheme</span>=<span class="string">&quot;qh&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--下面这几行也必须得设置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.VIEW&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>获取 <code>Scheme</code> 跳转的参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"><span class="type">Uri</span> <span class="variable">uri</span> <span class="operator">=</span> getIntent().getData();</span><br><span class="line"><span class="keyword">if</span>(uri != <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//完整的url信息</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> uri.toString();</span><br><span class="line">    sb.append(s + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//scheme部分</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">scheme</span> <span class="operator">=</span> uri.getScheme();</span><br><span class="line">    sb.append(<span class="string">&quot;scheme=&quot;</span> + scheme +<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//host部分</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> uri.getHost();</span><br><span class="line">    sb.append(<span class="string">&quot;host=&quot;</span> + host +<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//访问路径</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> uri.getPath();</span><br><span class="line">    sb.append(<span class="string">&quot;path=&quot;</span> + path + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//port部分</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> uri.getPort();</span><br><span class="line">    sb.append(<span class="string">&quot;port=&quot;</span> + port + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//Query部分</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> uri.getQuery();</span><br><span class="line">    sb.append(<span class="string">&quot;query=&quot;</span> + query + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//获取指定参数值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">goodsId</span>  <span class="operator">=</span> uri.getQueryParameter(<span class="string">&quot;goodsId&quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;goodsId=&quot;</span> + goodsId + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="comment">//列举所有参数名</span></span><br><span class="line">    Set&lt;String&gt; queryParameterNames  = uri.getQueryParameterNames();</span><br><span class="line">    textView.setText(sb.toString()j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>调用方式</li>
</ul>
<ol>
<li>原生调用</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW, Uri.parse(<span class="string">&quot;qh://test:8080/goods?goodsId=8897&amp;name=fuck&quot;</span>));</span><br><span class="line">startActivity(intent1);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>html调用</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;qh://test:8080/goods?goodsId=8897&amp;name=fuck&quot;</span>&gt;</span>打开商品详情<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>判断某个Scheme是否有效</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(Intent.ACTION_VIEW, Uri.parse(<span class="string">&quot;qh://test:8080/goods?goodsId=8897&amp;name=fuck&quot;</span>));</span><br><span class="line">List&lt;ResolveInfo&gt; activities = getPackageManager().queryIntentActivities(intent, <span class="number">0</span>);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">isValid</span> <span class="operator">=</span> !activities.isEmpty();</span><br><span class="line"><span class="keyword">if</span>(isValid)&#123;</span><br><span class="line">    startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>关于scheme跳转协议，可以查看下面的博客，站在巨人的肩膀上，才能看得更远 <a href="https://link.juejin.cn/?target=https://link.jianshu.com/?t=http://blog.csdn.net/qq_23547831/article/details/51685310" title="https://link.jianshu.com/?t=http://blog.csdn.net/qq_23547831/article/details/51685310">Android产品研发（十一）–&gt;应用内跳转Scheme协议</a></li>
</ul>
<h1 id="四、Context"><a href="#四、Context" class="headerlink" title="四、Context"></a>四、Context</h1><h2 id="4-1-Context-Activity-Appliction-的区别"><a href="#4-1-Context-Activity-Appliction-的区别" class="headerlink" title="4.1 Context , Activity , Appliction 的区别"></a>4.1 Context , Activity , Appliction 的区别</h2><p><img src="/posts/a42e0030/16e1ab2780c638c9tplv-t2oaga2asx-jj-mark3024000q75.png" alt="Context, Activity, Appliction 的区别"></p>
<ul>
<li>相同:<code>Activity</code> 和 <code>Application</code> 都是 <code>Context</code> 的子类。</li>
<li><code>Context</code> 从字面上理解就是上下文的意思, 在实际应用中它也确实是起到了管理 上下文环境中各个参数和变量的总用, 方便我们可以简单的访问到各种资源。</li>
<li>不同:维护的生命周期不同。<code>Context</code> 维护的是当前的 <code>Activity</code> 的生命周期, <code>Application</code> 维护的是整个项目的生命周期。</li>
<li>使用 <code>context</code> 的时候, 小心内存泄露, 防止内存泄露</li>
</ul>
<h2 id="4-2-Context-是什么"><a href="#4-2-Context-是什么" class="headerlink" title="4.2 Context 是什么"></a>4.2 Context 是什么</h2><p><img src="/posts/a42e0030/16e1ab278295b2b0tplv-t2oaga2asx-jj-mark3024000q75.png" alt="Context 是什么"></p>
<ul>
<li><p>它描述的是一个应用程序环境的信息,即上下文。</p>
</li>
<li><p>该类是一个抽象( <code>abstract class</code> )类, <code>Android</code> 提供了该抽象类的具体实 现类( <code>ContextIml</code> )。</p>
</li>
<li><p>通过它我们可以获取应用程序的资源和类, 也包括一些应用级别操作, 例如:启动一个 <code>Activity</code> ,发送广播,接受 <code>Intent</code> ,信息,等。</p>
</li>
</ul>
<h4 id="4-2-1-附加一张-Context-继承关系图"><a href="#4-2-1-附加一张-Context-继承关系图" class="headerlink" title="4.2.1 附加一张 Context 继承关系图"></a>4.2.1 附加一张 Context 继承关系图</h4><p><img src="/posts/a42e0030/16e1ab2782c145c5tplv-t2oaga2asx-jj-mark3024000q75.png" alt="Context继承关系图"></p>
<h2 id="4-3-获取当前屏幕-Activity-的对象"><a href="#4-3-获取当前屏幕-Activity-的对象" class="headerlink" title="4.3 获取当前屏幕 Activity 的对象"></a>4.3 获取当前屏幕 Activity 的对象</h2><p><img src="/posts/a42e0030/16e1ab278bb02fa6tplv-t2oaga2asx-jj-mark3024000q75.png" alt="获取当前屏幕Activity的对象"></p>
<ul>
<li>使用 ActivityLifecycleCallbacks</li>
<li><a href="https://link.juejin.cn/?target=https://link.jianshu.com/?t=http://blog.csdn.net/vfush/article/details/51483436" title="https://link.jianshu.com/?t=http://blog.csdn.net/vfush/article/details/51483436">Android 如何获取当前Activity实例对象？</a></li>
</ul>
<h2 id="4-4-Activity-的管理机制"><a href="#4-4-Activity-的管理机制" class="headerlink" title="4.4 Activity 的管理机制"></a>4.4 Activity 的管理机制</h2><p><img src="/posts/a42e0030/16e1ab2799c85ff1tplv-t2oaga2asx-jj-mark3024000q75.png" alt="Activity的管理机制"></p>
<ul>
<li><a href="https://link.juejin.cn/?target=https://www.jianshu.com/p/33729a7a66da" title="https://www.jianshu.com/p/33729a7a66da">Activity的管理机制</a></li>
<li>面试官问这个问题，想看看大家对Activity了解是否深入：</li>
</ul>
<ol>
<li>什么是 ActivityRecord</li>
<li>什么是 TaskRecord</li>
<li>什么是 ActivityManagerService</li>
</ol>
<h2 id="4-5-什么是-Activity"><a href="#4-5-什么是-Activity" class="headerlink" title="4.5 什么是 Activity"></a>4.5 什么是 Activity</h2><p><img src="/posts/a42e0030/16e1ab279e0daf15tplv-t2oaga2asx-jj-mark3024000q75.png" alt="什么是 Activity"></p>
<ul>
<li>四大组件之一，通常一个用户交互界面对应一个 <code>activity</code> 。</li>
<li><code>activity</code> 是 <code>Context</code> 的子类，同时实现了 <code>window.callback</code> 和 <code>keyevent.callback</code> ，可以处理与窗体用户交互的事件。</li>
<li>开发中常用的有 <code>FragmentActivity</code> 、<code>ListActivity</code> 、<code>TabActivity</code>（ <code>Android 4.0</code> 被 <code>Fragment</code> 取代）</li>
</ul>
<h1 id="五、进程"><a href="#五、进程" class="headerlink" title="五、进程"></a>五、进程</h1><h2 id="5-1-Android-进程优先级"><a href="#5-1-Android-进程优先级" class="headerlink" title="5.1 Android 进程优先级"></a>5.1 Android 进程优先级</h2><ul>
<li>前台 &#x2F; 可见 &#x2F; 服务 &#x2F; 后台 &#x2F; 空<br><img src="/posts/a42e0030/16e1ab279eee3314tplv-t2oaga2asx-jj-mark3024000q75.png" alt="前台 / 可见 / 服务 / 后台 / 空"></li>
</ul>
<h4 id="5-1-1-前台进程：Foreground-process"><a href="#5-1-1-前台进程：Foreground-process" class="headerlink" title="5.1.1 前台进程：Foreground process"></a>5.1.1 前台进程：Foreground process</h4><p><img src="/posts/a42e0030/16e1ab27a5c1b536tplv-t2oaga2asx-jj-mark3024000q75.png" alt="前台进程：Foreground process"></p>
<ul>
<li>用户正在交互的 <code>Activity</code>（ <code>onResume()</code> ）</li>
<li>当某个 <code>Service</code> 绑定正在交互的 <code>Activity</code></li>
<li>被主动调用为前台 <code>Service</code>（ <code>startForeground()</code> ）</li>
<li>组件正在执行生命周期的回调（ <code>onCreate()</code> 、<code>onStart()</code> 、<code>onDestory()</code> ）</li>
<li><code>BroadcastReceiver</code> 正在执行 <code>onReceive()</code></li>
</ul>
<h4 id="5-1-2-可见进程：Visible-process"><a href="#5-1-2-可见进程：Visible-process" class="headerlink" title="5.1.2 可见进程：Visible process"></a>5.1.2 可见进程：Visible process</h4><p><img src="/posts/a42e0030/16e1ab27a9560902tplv-t2oaga2asx-jj-mark3024000q75.png" alt="可见进程：Visible process"></p>
<ul>
<li>我们的 <code>Activity</code> 处在 <code>onPause()</code>（没有进入 <code>onStop()</code> ）</li>
<li>绑定到前台 <code>Activity</code> 的 <code>Service</code></li>
</ul>
<h4 id="5-1-3-服务进程：Service-process"><a href="#5-1-3-服务进程：Service-process" class="headerlink" title="5.1.3 服务进程：Service process"></a>5.1.3 服务进程：Service process</h4><p><img src="/posts/a42e0030/16e1ab27ba678cf4tplv-t2oaga2asx-jj-mark3024000q75.png" alt="服务进程"></p>
<ul>
<li>简单的 <code>startService()</code> 启动。</li>
</ul>
<h4 id="5-1-4-后台进程：Background-process"><a href="#5-1-4-后台进程：Background-process" class="headerlink" title="5.1.4 后台进程：Background process"></a>5.1.4 后台进程：Background process</h4><p><img src="/posts/a42e0030/16e1ab27ba9dbb3btplv-t2oaga2asx-jj-mark3024000q75.png" alt="后台进程：Background process"></p>
<ul>
<li>对用户没有直接影响的进程 — <code>Activity</code> 处于 <code>onStop()</code> 的时候。</li>
<li><code>android:process=&quot;:xxx&quot;</code></li>
</ul>
<h4 id="5-1-5-空进程：Empty-process"><a href="#5-1-5-空进程：Empty-process" class="headerlink" title="5.1.5 空进程：Empty process"></a>5.1.5 空进程：Empty process</h4><p><img src="/posts/a42e0030/16e1ab27cee0b839tplv-t2oaga2asx-jj-mark3024000q75.png" alt="空进程：Empty process"></p>
<ul>
<li>不含有任何的活动的组件。（ <code>Android</code> 设计的，处于缓存的目的，为了第二次启动更快，采取的一个权衡）</li>
</ul>
<h2 id="5-2-可见进程"><a href="#5-2-可见进程" class="headerlink" title="5.2 可见进程"></a>5.2 可见进程</h2><p><img src="/posts/a42e0030/16e1ab28553037aatplv-t2oaga2asx-jj-mark3024000q75.png" alt="可见进程"></p>
<blockquote>
<p>可见进程指部分程序界面能够被用户看见，却不在前台与用户交互的进程。例如，我们在一个界面上弹出一个对话框（该对话框是一个新的 <code>Activity</code> ），那么在对话框后面的原界面是可见的，但是并没有与用户进行交互，那么原界面就是可见进程。</p>
</blockquote>
<ul>
<li>一个进程满足下面任何一个条件都被认为是可视的：</li>
</ul>
<ol>
<li>寄宿着一个不是前台的活动，但是它对用户仍可见（它的 <code>onPause()</code> 方法已经被调用）。举例来说，这可能发生在，如果一个前台活动在一个对话框（其他进程的）运行之后仍然是可视的，比如输入法的弹出时。</li>
<li>寄宿着一个服务，该服务绑定到一个可视的活动。</li>
</ol>
<ul>
<li>一个可视进程被认为是及其重要的且不会被杀死，除非为了保持前台进程运行。</li>
</ul>
<h2 id="5-3-服务进程"><a href="#5-3-服务进程" class="headerlink" title="5.3 服务进程"></a>5.3 服务进程</h2><p><img src="/posts/a42e0030/16e1ab285541faaatplv-t2oaga2asx-jj-mark3024000q75.png" alt="服务进程"></p>
<ul>
<li><p>服务进程是通过 <code>startService()</code> 方法启动的进程，但不属于前台进程和可见进程。例如，在后台播放音乐或者在后台下载就是服务进程。</p>
</li>
<li><p>系统保持它们运行，除非没有足够内存来保证所有的前台进程和可视进程。</p>
</li>
</ul>
<h2 id="5-4-后台进程"><a href="#5-4-后台进程" class="headerlink" title="5.4 后台进程"></a>5.4 后台进程</h2><p><img src="/posts/a42e0030/16e1ab2855867adbtplv-t2oaga2asx-jj-mark3024000q75.png" alt="后台进程"></p>
<ul>
<li><p>后台进程是一个保持着一个当前对用户不可视的活动（已经调用 <code>Activity</code> 对象的 <code>onStop()</code> 方法）（如果还有除了 <code>UI</code> 线程外其他线程在运行话，不受影响）。</p>
<blockquote>
<p>例如我正在使用 <code>qq</code> 和别人聊天，这个时候 <code>qq</code> 是前台进程，但是当我点击 <code>Home</code> 键让 <code>qq</code> 界面消失的时候，这个时候它就转换成了后台进程。</p>
</blockquote>
</li>
<li><p>这些进程没有直接影响用户体验，并且可以在任何时候被杀以收回内存用于一个前台、可视、服务进程。</p>
</li>
<li><p>一般地有很多后台进程运行着，因此它们保持在一个 <code>LRU</code>（ <code>least recently used</code> ，即最近最少使用，如果您学过操作系统的话会觉得它很熟悉，跟内存的页面置换算法 <code>LRU</code> 一样）列表以确保最近使用最多的活动的进程最后被杀。</p>
</li>
</ul>
<h2 id="5-5-空进程"><a href="#5-5-空进程" class="headerlink" title="5.5 空进程"></a>5.5 空进程</h2><p><img src="/posts/a42e0030/16e1ab2855c30501tplv-t2oaga2asx-jj-mark3024000q75.png" alt="空进程"></p>
<ul>
<li>空进程是一个没有保持活跃的应用程序组件的进程，不包含任何活跃组件。</li>
<li>保持这个进程可用的唯一原因是作为一个 <code>cache</code> 以提高下次启动组件的速度。系统进程杀死这些进程，以在进程 <code>cache</code> 和潜在的内核 <code>cache</code> 之间平衡整个系统资源。</li>
<li><code>android</code> 进程的回收顺序从先到后分别是：空进程，后台进程，服务进程，可见进程，前台进程。</li>
</ul>
<h2 id="5-6-什么是-ANR，如何避免"><a href="#5-6-什么是-ANR，如何避免" class="headerlink" title="5.6 什么是 ANR，如何避免"></a>5.6 什么是 ANR，如何避免</h2><p><img src="/posts/a42e0030/16e1ab285772443atplv-t2oaga2asx-jj-mark3024000q75.png" alt="什么是 ANR，如何避免"></p>
<h4 id="5-6-1-什么是ANR"><a href="#5-6-1-什么是ANR" class="headerlink" title="5.6.1 什么是ANR"></a>5.6.1 什么是ANR</h4><p><img src="/posts/a42e0030/16e1ab2865765c07tplv-t2oaga2asx-jj-mark3024000q75.png" alt="什么是ANR"></p>
<ul>
<li><code>ANR</code> ，全称为 <code>Application Not Responding</code> 。</li>
<li>在 <code>Android</code> 中，如果你的应用程序有一段时间没有响应，系统会向用户显示一个对话框，这个对话框称作应用程序无响应对话框。</li>
</ul>
<h4 id="5-6-2-用户行为"><a href="#5-6-2-用户行为" class="headerlink" title="5.6.2 用户行为"></a>5.6.2 用户行为</h4><p><img src="/posts/a42e0030/16e1ab287022cf69tplv-t2oaga2asx-jj-mark3024000q75.png" alt="用户行为"></p>
<ul>
<li>用户可以选择让程序继续运行，也可以让程序停止运行。</li>
<li>他们在使用你的应用程序时，并不希望每次都要处理这个对话框。</li>
<li>因此，在程序里对响应性能的设计很重要，这样，系统不会显示 <code>ANR</code> 给用户。</li>
</ul>
<h4 id="5-6-3-Android不同组件ANR超时时间不同"><a href="#5-6-3-Android不同组件ANR超时时间不同" class="headerlink" title="5.6.3 Android不同组件ANR超时时间不同"></a>5.6.3 Android不同组件ANR超时时间不同</h4><p><img src="/posts/a42e0030/16e1ab2878933ee5tplv-t2oaga2asx-jj-mark3024000q75.png" alt="Android不同组件ANR超时时间不同"></p>
<ul>
<li>不同的组件发生 <code>ANR</code> 的时间不一样，主线程（ <code>Activity</code> 、<code>Service</code> ）是 <code>5</code> 秒，<code>BroadCastReceiver</code> 是 <code>10</code> 秒。</li>
</ul>
<h4 id="5-6-4-解决方案"><a href="#5-6-4-解决方案" class="headerlink" title="5.6.4 解决方案"></a>5.6.4 解决方案</h4><p><img src="/posts/a42e0030/16e1ab2875e5a963tplv-t2oaga2asx-jj-mark3024000q75.png" alt="解决方案"></p>
<ol>
<li>将所有耗时操作，比如访问网络，<code>Socket</code> 通信，查询大量 <code>SQL</code> 语句，复杂逻辑计算等都放在子线程中去，然后通过 <code>handler.sendMessage</code> 、<code>runonUITread</code> 、<code>AsyncTask</code> 等方式更新 <code>UI</code> ，以确保用户界面操作的流畅度。</li>
<li>如果耗时操作需要让用户等待，那么可以在界面上显示进度条。</li>
</ol>
<h2 id="5-7-android的任务栈-Task"><a href="#5-7-android的任务栈-Task" class="headerlink" title="5.7 android的任务栈 Task"></a>5.7 android的任务栈 Task</h2><p><img src="/posts/a42e0030/16e1ab287980fd1atplv-t2oaga2asx-jj-mark3024000q75.png" alt="android的任务栈 Task"></p>
<ul>
<li>一个 <code>Task</code> 包含的就是 <code>activity</code> 集合，<code>android</code> 系统可以通过任务栈有序的管理 <code>activity</code></li>
<li>一个app当中可能不止一个任务栈，在某些情况下，一个 <code>activity</code> 也可以独享一个任务栈（ <code>singleInstance</code> 模式启动的 <code>activity</code> ）</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>本文基本涵盖了 <code>Android Activity</code> 的所有知识点。对于 <code>App</code> 启动、<code>AMS</code> 希望大家能根据文中链接或者 <code>Google</code> 搜索的形式继续展开学习。</li>
<li>**<code>重点</code>**：关于 <code>Android</code> 的四大组件，到现在为止我才总结完 Activity ，马上我将继续针对，<code>Service</code> ，<code>BroadcastRecevier</code> 等，以及事件分发、滑动冲突、新能优化等重要模块，进行全面总结</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/39ac0fe3/" rel="next" title="AMS">
                <i class="fa fa-chevron-left"></i> AMS
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/ecfbccf/" rel="prev" title="Harmony-Utils">
                Harmony-Utils <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">292</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Activity-%E7%9A%84-36-%E5%A4%A7%E9%9A%BE%E7%82%B9%EF%BC%8C%E4%BD%A0%E4%BC%9A%E5%87%A0%E4%B8%AA%EF%BC%9F"><span class="nav-text">Activity 的 36 大难点，你会几个？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95"><span class="nav-text">文章目录</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%96%B9%E4%BE%BF%E5%A4%A7%E5%AE%B6%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%88%91%E5%9C%A8-GitHub-%E4%B8%8A%E5%BB%BA%E7%AB%8B%E4%B8%AA-%E4%BB%93%E5%BA%93"><span class="nav-text">方便大家学习，我在 GitHub 上建立个 仓库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A5%9E%E5%9B%BE"><span class="nav-text">神图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">一、生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-Dialog-%E5%BC%B9%E5%87%BA%E6%97%B6"><span class="nav-text">1.1 Dialog 弹出时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2%E6%97%B6"><span class="nav-text">1.2 横竖屏切换时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E4%B8%8B-Activity-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%8F%98%E5%8C%96%E8%BF%87%E7%A8%8B"><span class="nav-text">1.3 不同场景下 Activity 生命周期的变化过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-%E5%B0%86%E4%B8%80%E4%B8%AA-Activity-%E8%AE%BE%E7%BD%AE%E6%88%90%E7%AA%97%E5%8F%A3%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="nav-text">1.4 将一个 Activity 设置成窗口的样式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-%E9%80%80%E5%87%BA%E5%B7%B2%E8%B0%83%E7%94%A8%E5%A4%9A%E4%B8%AA-Activity-%E7%9A%84-Application"><span class="nav-text">1.5 退出已调用多个 Activity 的 Application</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-6-%E9%94%81%E5%AE%9A%E5%B1%8F%E4%B8%8E%E8%A7%A3%E9%94%81%E5%B1%8F%E5%B9%95%EF%BC%8CActivity-%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">1.6 锁定屏与解锁屏幕，Activity 如何执行生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-7-%E4%BF%AE%E6%94%B9-Activity-%E8%BF%9B%E5%85%A5%E5%92%8C%E9%80%80%E5%87%BA%E5%8A%A8%E7%94%BB"><span class="nav-text">1.7 修改 Activity 进入和退出动画</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-8-Activity-%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%8A%B6%E6%80%81"><span class="nav-text">1.8 Activity 的四种状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-9-%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA"><span class="nav-text">1.9 如何处理异常退出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-10-%E4%BB%80%E4%B9%88%E6%98%AF-onNewIntent"><span class="nav-text">1.10 什么是 onNewIntent</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="nav-text">二、启动模式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F"><span class="nav-text">2.1 启动模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">2.2 启动模式的使用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">2.3 启动模式的实际应用场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E5%BF%AB%E9%80%9F%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AA-Activity"><span class="nav-text">2.4 快速启动一个 Activity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="nav-text">2.5 启动流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-Activity-%E7%9A%84-Flags"><span class="nav-text">2.6 Activity 的 Flags</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-7-onNewInstent-%E6%96%B9%E6%B3%95%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%89%A7%E8%A1%8C"><span class="nav-text">2.7 onNewInstent()方法什么时候执行</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE"><span class="nav-text">三、数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Activity-%E9%97%B4%E9%80%9A%E8%BF%87-Intent-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%E5%A4%A7%E5%B0%8F%E9%99%90%E5%88%B6"><span class="nav-text">3.1 Activity 间通过 Intent 传递数据大小限制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E6%97%B6%E7%B3%BB%E7%BB%9F%E4%BC%9A%E6%9D%80%E6%8E%89%E5%90%8E%E5%8F%B0%E7%9A%84Activity%EF%BC%8C%E8%8B%A5%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%BA%9B%E4%B8%B4%E6%97%B6%E7%8A%B6%E6%80%81%E7%9A%84%E4%BF%9D%E5%AD%98%EF%BC%8C%E5%9C%A8%E5%93%AA%E4%B8%AA%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C"><span class="nav-text">3.2 内存不足时系统会杀掉后台的Activity，若需要进行一些临时状态的保存，在哪个方法进行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-onSaveInstanceState-%E8%A2%AB%E6%89%A7%E8%A1%8C%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="nav-text">3.3 onSaveInstanceState() 被执行的场景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-%E4%B8%A4%E4%B8%AA-Activity-%E4%B9%8B%E9%97%B4%E8%B7%B3%E8%BD%AC%E6%97%B6%E5%BF%85%E7%84%B6%E4%BC%9A%E6%89%A7%E8%A1%8C%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-text">3.4 两个 Activity 之间跳转时必然会执行的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-%E7%94%A8-Intent-%E5%8E%BB%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%AAActivity-%E4%B9%8B%E5%A4%96%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-text">3.5 用 Intent 去启动一个Activity 之外的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-scheme-%E8%B7%B3%E8%BD%AC%E5%8D%8F%E8%AE%AE"><span class="nav-text">3.6 scheme 跳转协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-1-%E5%AE%9A%E4%B9%89"><span class="nav-text">3.6.1 定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-2-%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F%EF%BC%9A"><span class="nav-text">3.6.2 协议格式：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-3-Scheme%E4%BD%BF%E7%94%A8"><span class="nav-text">3.6.3 Scheme使用</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Context"><span class="nav-text">四、Context</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-Context-Activity-Appliction-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">4.1 Context , Activity , Appliction 的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-Context-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">4.2 Context 是什么</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-%E9%99%84%E5%8A%A0%E4%B8%80%E5%BC%A0-Context-%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="nav-text">4.2.1 附加一张 Context 继承关系图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95-Activity-%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="nav-text">4.3 获取当前屏幕 Activity 的对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-Activity-%E7%9A%84%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6"><span class="nav-text">4.4 Activity 的管理机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-%E4%BB%80%E4%B9%88%E6%98%AF-Activity"><span class="nav-text">4.5 什么是 Activity</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%BF%9B%E7%A8%8B"><span class="nav-text">五、进程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Android-%E8%BF%9B%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-text">5.1 Android 进程优先级</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-%E5%89%8D%E5%8F%B0%E8%BF%9B%E7%A8%8B%EF%BC%9AForeground-process"><span class="nav-text">5.1.1 前台进程：Foreground process</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-%E5%8F%AF%E8%A7%81%E8%BF%9B%E7%A8%8B%EF%BC%9AVisible-process"><span class="nav-text">5.1.2 可见进程：Visible process</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-%E6%9C%8D%E5%8A%A1%E8%BF%9B%E7%A8%8B%EF%BC%9AService-process"><span class="nav-text">5.1.3 服务进程：Service process</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4-%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B%EF%BC%9ABackground-process"><span class="nav-text">5.1.4 后台进程：Background process</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-5-%E7%A9%BA%E8%BF%9B%E7%A8%8B%EF%BC%9AEmpty-process"><span class="nav-text">5.1.5 空进程：Empty process</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-%E5%8F%AF%E8%A7%81%E8%BF%9B%E7%A8%8B"><span class="nav-text">5.2 可见进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-%E6%9C%8D%E5%8A%A1%E8%BF%9B%E7%A8%8B"><span class="nav-text">5.3 服务进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-%E5%90%8E%E5%8F%B0%E8%BF%9B%E7%A8%8B"><span class="nav-text">5.4 后台进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-%E7%A9%BA%E8%BF%9B%E7%A8%8B"><span class="nav-text">5.5 空进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-%E4%BB%80%E4%B9%88%E6%98%AF-ANR%EF%BC%8C%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D"><span class="nav-text">5.6 什么是 ANR，如何避免</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-1-%E4%BB%80%E4%B9%88%E6%98%AFANR"><span class="nav-text">5.6.1 什么是ANR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-2-%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA"><span class="nav-text">5.6.2 用户行为</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-3-Android%E4%B8%8D%E5%90%8C%E7%BB%84%E4%BB%B6ANR%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E4%B8%8D%E5%90%8C"><span class="nav-text">5.6.3 Android不同组件ANR超时时间不同</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-4-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">5.6.4 解决方案</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-android%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%A0%88-Task"><span class="nav-text">5.7 android的任务栈 Task</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>