<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="private," />










<meta name="description" content="基础入门ArkTS工程目录结构（Stage模型） AppScope &gt; app.json5：应用的全局配置信息，详见app.json5配置文件。【不能放ets文件。模块的ets中引用它编译通不过无法预览但可以运行。可在资源文件中引用AppScope中的资源】 entry：HarmonyOS工程模块，编译构建生成一个HAP包。 src &gt; main &gt; ets：用于存放ArkTS源">
<meta property="og:type" content="article">
<meta property="og:title" content="HarmonyOS NEXT入门">
<meta property="og:url" content="http://shenbh.github.io/posts/fd0f9041/index.html">
<meta property="og:site_name" content="积跬步">
<meta property="og:description" content="基础入门ArkTS工程目录结构（Stage模型） AppScope &gt; app.json5：应用的全局配置信息，详见app.json5配置文件。【不能放ets文件。模块的ets中引用它编译通不过无法预览但可以运行。可在资源文件中引用AppScope中的资源】 entry：HarmonyOS工程模块，编译构建生成一个HAP包。 src &gt; main &gt; ets：用于存放ArkTS源">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/HAR%E5%92%8CHSP%E5%9C%A8APP%E5%8C%85%E4%B8%AD%E7%9A%84%E5%BD%A2%E6%80%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/%E5%BC%80%E5%8F%91%E6%80%81%E4%B8%8E%E7%BC%96%E8%AF%91%E6%80%81%E7%9A%84%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84%E8%A7%86%E5%9B%BE.png">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/%E7%BC%96%E8%AF%91%E5%8F%91%E5%B8%83%E4%B8%8E%E4%B8%8A%E6%9E%B6%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E5%9B%BE.png">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%BB%93%E6%9E%84%EF%BC%88FA%E6%A8%A1%E5%9E%8B%EF%BC%89.png">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="http://shenbh.github.io/posts/fd0f9041/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%B5%81%E7%A8%8B%201.png">
<meta property="article:published_time" content="2024-07-10T03:41:00.000Z">
<meta property="article:modified_time" content="2024-12-30T09:54:59.848Z">
<meta property="article:author" content="阿炳">
<meta property="article:tag" content="private">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://shenbh.github.io/posts/fd0f9041/HAR%E5%92%8CHSP%E5%9C%A8APP%E5%8C%85%E4%B8%AD%E7%9A%84%E5%BD%A2%E6%80%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/fd0f9041/"/>





  <title>HarmonyOS NEXT入门 | 积跬步</title><meta name="robots" content="noindex">
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">积跬步</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Just do IT Now.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/fd0f9041/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="积跬步">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">HarmonyOS NEXT入门</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-07-10T11:41:00+08:00">
                2024-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HarmonyOS/" itemprop="url" rel="index">
                    <span itemprop="name">HarmonyOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="基础入门"><a href="#基础入门" class="headerlink" title="基础入门"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-dev-guide-V5">基础入门</a></h1><h2 id="ArkTS工程目录结构（Stage模型）"><a href="#ArkTS工程目录结构（Stage模型）" class="headerlink" title="ArkTS工程目录结构（Stage模型）"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/start-with-ets-stage-V5">ArkTS工程目录结构（Stage模型）</a></h2><ul>
<li><strong>AppScope &gt; app.json5</strong>：应用的全局配置信息，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-configuration-file-V5">app.json5配置文件</a>。【不能放ets文件。模块的ets中引用它编译通不过无法预览但可以运行。可在资源文件中引用AppScope中的资源】</li>
<li><strong>entry</strong>：HarmonyOS工程模块，编译构建生成一个HAP包。<ul>
<li><strong>src &gt; main &gt; ets</strong>：用于存放ArkTS源码。</li>
<li><strong>src &gt; main &gt; ets &gt; entryability</strong>：应用&#x2F;服务的入口。</li>
<li><strong>src &gt; main &gt; ets &gt; entrybackupability</strong>：应用提供扩展的备份恢复能力。</li>
<li><strong>src &gt; main &gt; ets &gt; pages</strong>：应用&#x2F;服务包含的页面。</li>
<li><strong>src &gt; main &gt; resources</strong>：用于存放应用&#x2F;服务所用到的资源文件，如图形、多媒体、字符串、布局文件等。关于资源文件，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5">资源分类与访问</a>。</li>
<li><strong>src &gt; main &gt; module.json5</strong>：模块配置文件。主要包含HAP包的配置信息、应用&#x2F;服务在具体设备上的配置信息以及应用&#x2F;服务的全局配置信息。具体的配置文件说明，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5">module.json5配置文件</a>。</li>
<li><strong><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-hvigor-build-profile-V5">build-profile.json5</a><strong>：当前的模块信息 、编译信息配置项，包括buildOption、targets配置等。【不同字段模块级的<code>buildOption</code>配置会</strong>继承</strong>工程级配置】</li>
<li><strong>hvigorfile.ts</strong>：模块级编译构建任务脚本。</li>
<li><strong>obfuscation-rules.txt</strong>：混淆规则文件。混淆开启后，在使用Release模式进行编译时，会对代码进行编译、混淆及压缩处理，保护代码资产。详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-build-obfuscation-0000001731754312-V5">开启代码混淆</a>。</li>
<li><strong>oh-package.json5</strong>：用来描述包名、版本、入口文件（类型声明文件）和依赖项等信息。</li>
</ul>
</li>
<li><strong>oh_modules</strong>：用于存放三方库依赖信息。</li>
<li><strong>build-profile.json5</strong>：工程级配置信息，包括签名signingConfigs、产品配置products等。其中products中可配置当前运行环境，默认为HarmonyOS。</li>
<li><strong>hvigorfile.ts</strong>：工程级编译构建任务脚本。</li>
<li><strong>oh-package.json5</strong>：主要用来描述全局配置，如：依赖覆盖（overrides）、依赖关系重写（overrideDependencyMap）和参数化配置（parameterFile）等。</li>
</ul>
<h2 id="开发基础知识"><a href="#开发基础知识" class="headerlink" title="开发基础知识"></a>开发基础知识</h2><h3 id="应用程序包基础知识"><a href="#应用程序包基础知识" class="headerlink" title="应用程序包基础知识"></a>应用程序包基础知识</h3><h4 id="应用程序包概述-Module类型"><a href="#应用程序包概述-Module类型" class="headerlink" title="应用程序包概述-Module类型"></a>应用程序包概述-Module类型</h4><ul>
<li><strong>Alibity类型的Module</strong>： 用于实现应用的功能和特性。每一个Ability类型的Module编译后，会生成一个以<code>.hap</code>为后缀的文件，称其为&#x3D;&#x3D;HAP&#x3D;&#x3D;（Harmony Ability Package）包。HAP包可独立安装和运行，是应用安装的基本单位，一个应用中可以包含一个或多个HAP包，具体包含如下两种类型。<ul>
<li>entry类型的Module：应用的主模块，包含应用的入口界面、入口图标和主功能特性，编译后生成entry类型的HAP。每一个应用分发到同一类型的设备上的应用程序包，只能包含&#x3D;&#x3D;唯一&#x3D;&#x3D;一个entry类型的HAP。</li>
</ul>
<ul>
<li>feature类型的Module：应用的动态特性模块，编译后生成feature类型的HAP。一个应用中可以包含一个或多个feature类型的HAP，也可以不包含。</li>
</ul>
</li>
<li><strong>Library类型的Module</strong>：用于实现代码和资源的共享。同一个Library类型的Module可以被其他的Module多次引用，合理地使用该类型的Module，能够降低开发和维护成本。Library类型的Module分为Static和Shared两种类型，编译后会生成共享包。  <ul>
<li>Static Library：静态共享库。编译后会生成一个以<code>.har</code>为后缀的文件，即静态共享包&#x3D;&#x3D;HAR&#x3D;&#x3D;（Harmony Archive）。</li>
<li>Shared Library：动态共享库。编译后会生成一个以<code>.hsp</code>为后缀的文件，即动态共享包&#x3D;&#x3D;HSP&#x3D;&#x3D;（Harmony Shared Package）。<blockquote>
<p>实际上，Shared Library编译后除了会生成一个<code>.hsp</code>文件，还会生成一个<code>.har</code>文件。这个<code>.har</code>文件中包含了HSP对外导出的接口，应用中的其他模块需要通过<code>.har</code>文件来引用HSP的功能。为了表述方便，我们通常认为Shared Library编译后生成HSP。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">共享包类型</th>
<th align="left">编译和运行方式</th>
<th align="left">发布和引用方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">HAR</td>
<td align="left">HAR中的代码和资源跟随使用方编译，如果有多个使用方，它们的编译产物中会存在<strong>多份</strong>相同拷贝。</td>
<td align="left">HAR除了支持应用内引用，还可以独立打包发布，供其他应用引用。</td>
</tr>
<tr>
<td align="left">HSP</td>
<td align="left">HSP中的代码和资源可以独立编译，运行时在一个进程中代码也只会存在<strong>一份</strong>。</td>
<td align="left">HSP一般随应用进行打包，当前支持应用内和集成态HSP。应用内HSP只支持应用内引用，集成态HSP支持发布到ohpm私仓和跨应用引用。</td>
</tr>
</tbody></table>
<p><img src="/posts/fd0f9041/HAR%E5%92%8CHSP%E5%9C%A8APP%E5%8C%85%E4%B8%AD%E7%9A%84%E5%BD%A2%E6%80%81%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="HAR和HSP在APP包中的形态示意图"></p>
<h4 id="应用程序包结构-Stage模型应用程序包结构"><a href="#应用程序包结构-Stage模型应用程序包结构" class="headerlink" title="应用程序包结构-Stage模型应用程序包结构"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-package-structure-stage-V5">应用程序包结构-Stage模型应用程序包结构</a></h4><h5 id="开发态包结构"><a href="#开发态包结构" class="headerlink" title="开发态包结构"></a>开发态包结构</h5><p>在DevEco Studio上<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/start-with-ets-stage-V5#%E5%88%9B%E5%BB%BAarkts%E5%B7%A5%E7%A8%8B">创建一个项目工程</a>，并尝试创建多个不同类型的Module。根据实际工程中的目录对照本章节进行学习，可以有助于理解开发态的应用程序结构。</p>
<p><strong>图1</strong> 项目工程结构示意图（以实际为准）<br><img src="/posts/fd0f9041/%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="项目工程结构示意图">  </p>
<p>工程结构主要包含的文件类型及用途如下：  </p>
<blockquote>
<p>[!说明]   </p>
<ul>
<li>AppScope目录由DevEco Studio&#x3D;&#x3D;自动生成&#x3D;&#x3D;，不可更改。</li>
<li>Module目录名称可以由DevEco Studio自动生成（比如entry、library等），也可以自定义。为了便于说明，下表中统一采用Module_name表示。</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="left">文件类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">配置文件</td>
<td align="left">包括应用级配置信息、以及Module级配置信息：  <br>- <strong>AppScope &gt; app.json5</strong>：<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-configuration-file-V5">app.json5配置文件</a>，用于声明应用的全局配置信息，比如应用Bundle名称、应用名称、应用图标、应用版本号等。  <br>- <strong>Module_name &gt; src &gt; main &gt; module.json5</strong>：<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5">module.json5配置文件</a>，用于声明Module基本信息、支持的设备类型、所含的组件信息、运行所需申请的权限等。</td>
</tr>
<tr>
<td align="left">ArkTS源码文件</td>
<td align="left"><strong>Module_name &gt; src &gt; main &gt; ets</strong>：用于存放Module的ArkTS源码文件（<code>.ets</code>文件）。</td>
</tr>
<tr>
<td align="left">资源文件</td>
<td align="left">包括应用级资源文件、以及Module级资源文件，支持图形、多媒体、字符串、布局文件等，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5">资源分类与访问</a>。  <br>- <strong>AppScope &gt; resources</strong> ：用于存放应用需要用到的资源文件。  <br>- <strong>Module_name &gt; src &gt; main &gt; resources</strong> ：用于存放该Module需要用到的资源文件。</td>
</tr>
<tr>
<td align="left">其他配置文件</td>
<td align="left">用于编译构建，包括构建配置文件、编译构建任务脚本、混淆规则文件、依赖的共享包信息等。  <br>- <strong>build-profile.json5</strong>：工程级或Module级的构建配置文件，包括应用签名、产品配置等。  <br>- <strong>hvigorfile.ts</strong>：应用级或Module级的编译构建任务脚本，开发者可以自定义编译构建工具版本、控制构建行为的配置参数。  <br>- <strong>obfuscation-rules.txt</strong>：混淆规则文件。混淆开启后，在使用Release模式进行编译时，会对代码进行编译、混淆及压缩处理，保护代码资产。  <br>- <strong>oh-package.json5</strong>：用于存放依赖库的信息，包括所依赖的三方库和共享包。</td>
</tr>
</tbody></table>
<h5 id="编译态包结构"><a href="#编译态包结构" class="headerlink" title="编译态包结构"></a>编译态包结构</h5><p>不同类型的Module编译后会生成对应的HAP、HAR、HSP等文件，开发态视图与编译态视图的对照关系如下：<br><strong>图2</strong> 开发态与编译态的工程结构视图<br><img src="/posts/fd0f9041/%E5%BC%80%E5%8F%91%E6%80%81%E4%B8%8E%E7%BC%96%E8%AF%91%E6%80%81%E7%9A%84%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84%E8%A7%86%E5%9B%BE.png" alt="开发态与编译态的工程结构视图"></p>
<p>从开发态到编译态，Module中的文件会发生如下变更：  </p>
<ul>
<li><strong>ets目录</strong>：ArkTS源码编译生成.abc文件。</li>
<li><strong>resources目录</strong>：AppScope目录下的资源文件会合入到Module下面资源目录中，如果两个目录下的存在重名文件，编译打包后只会保留AppScope目录下的资源文件。</li>
<li><strong>module配置文件</strong>：AppScope目录下的app.json5文件字段会合入到Module下面的module.json5文件之中，编译后生成HAP或HSP最终的module.json文件。</li>
</ul>
<blockquote>
<p>[!说明]<br>在编译HAP和HSP时，会把他们&#x3D;&#x3D;所依赖的HAR直接编译到HAP和HSP中&#x3D;&#x3D;。</p>
</blockquote>
<h5 id="发布态包结构"><a href="#发布态包结构" class="headerlink" title="发布态包结构"></a>发布态包结构</h5><p>每个应用中至少包含一个<code>.hap</code>文件，可能包含若干个<code>.hsp</code>文件、也可能不含，一个应用中的所有<code>.hap</code>与<code>.hsp</code>文件合在一起称为<strong>Bundle</strong>，其对应的bundleName是应用的唯一标识（详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-configuration-file-V5">app.json5配置文件</a>中的bundleName标签）。<br>当应用发布上架到应用市场时，需要将Bundle打包为一个<code>.app</code>后缀的文件用于上架，这个<code>.app</code>文件称为<strong>App Pack</strong>（Application Package），与此同时，DevEco Studio工具自动会生成一个<strong>pack.info</strong>文件。<strong>pack.info</strong>文件描述了App Pack中每个HAP和HSP的属性，包含APP中的bundleName和versionCode信息、以及Module中的name、type和abilities等信息。</p>
<blockquote>
<p>[!说明]   </p>
<ul>
<li>App Pack是发布上架到应用市场的基本单元，但是&#x3D;&#x3D;不能在设备上直接安装和运行&#x3D;&#x3D;。</li>
<li>在应用签名、云端分发、端侧安装时，都是&#x3D;&#x3D;以HAP&#x2F;HSP为单位&#x3D;&#x3D;进行签名、分发和安装的。</li>
</ul>
</blockquote>
<p><strong>图3</strong> 编译发布与上架部署流程图<br><img src="/posts/fd0f9041/%E7%BC%96%E8%AF%91%E5%8F%91%E5%B8%83%E4%B8%8E%E4%B8%8A%E6%9E%B6%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="编译发布与上架部署流程图"></p>
<h5 id="选择合适的包类型"><a href="#选择合适的包类型" class="headerlink" title="选择合适的包类型"></a>选择合适的包类型</h5><p>HAP、HAR、HSP三者的功能和使用场景总结对比如下：</p>
<table>
<thead>
<tr>
<th align="left">Module类型</th>
<th align="left">包类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Ability</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/hap-package-V5">HAP</a></td>
<td align="left">应用的功能模块，可以独立安装和运行，必须包含一个entry类型的HAP，可选包含一个或多个feature类型的HAP。</td>
</tr>
<tr>
<td align="left">Static Library</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/har-package-V5">HAR</a></td>
<td align="left">静态共享包，&#x3D;&#x3D;编译态复用&#x3D;&#x3D;。<br>- 支持应用内共享，也可以发布后供其他应用使用。<br>- 作为二方库，发布到<a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/">OHPM</a>私仓，供公司内部其他应用使用。<br>- 作为三方库，发布到<a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/">OHPM</a>中心仓，供其他应用使用。<br>- 多包（HAP&#x2F;HSP）引用相同的HAR时，会造成多包间代码和资源的重复拷贝，从而导致应用包膨大。</td>
</tr>
<tr>
<td align="left">Shared Library</td>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/in-app-hsp-V5">HSP</a></td>
<td align="left">动态共享包，&#x3D;&#x3D;运行时复用&#x3D;&#x3D;。  <br>- 当前仅支持&#x3D;&#x3D;应用内共享&#x3D;&#x3D;。  <br>- 当多包（HAP&#x2F;HSP）同时引用同一个共享包时，采用HSP替代HAR，可以避免HAR造成的多包间代码和资源的重复拷贝，从而减小应用包大小。</td>
</tr>
</tbody></table>
<p>HAP、HSP、HAR支持的规格对比如下，其中“√”表示是，“×”表示否。<br>开发者可以根据实际场景所需的能力，选择相应类型的包进行开发。在后续的章节中还会针对如何使用<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/hap-package-V5">HAP</a>、<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/har-package-V5">HAR</a>、<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/in-app-hsp-V5">HSP</a>分别展开详细介绍。</p>
<table>
<thead>
<tr>
<th align="left">规格</th>
<th align="left">HAP</th>
<th align="left">HAR</th>
<th align="left">HSP</th>
</tr>
</thead>
<tbody><tr>
<td align="left">支持在配置文件中声明<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/uiability-overview-V5">UIAbility</a>组件【系统调度应用的最小单元】与<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/extensionability-overview-V5">ExtensionAbility</a>组件</td>
<td align="left">√</td>
<td align="left">×</td>
<td align="left">×</td>
</tr>
<tr>
<td align="left">支持在配置文件中声明<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5#pages%E6%A0%87%E7%AD%BE">pages</a>页面</td>
<td align="left">√</td>
<td align="left">×</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">支持包含资源文件与.so文件</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">支持依赖其他HAR文件</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">支持依赖其他HSP文件</td>
<td align="left">√</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">支持在设备上独立安装运行</td>
<td align="left">√</td>
<td align="left">×</td>
<td align="left">×</td>
</tr>
</tbody></table>
<blockquote>
<p>[!说明]  </p>
<ul>
<li>HAR虽然不支持在配置文件中声明pages页面，但是可以包含pages页面，并通过<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-routing-V5#%E5%91%BD%E5%90%8D%E8%B7%AF%E7%94%B1">命名路由</a>的方式进行跳转。</li>
<li>由于HSP&#x3D;&#x3D;仅&#x3D;&#x3D;支持应用内共享，如果HAR依赖了HSP，则该HAR文件仅支持应用内共享，不支持发布到二方仓或三方仓供其他应用使用，否则会导致编译失败。</li>
<li>HAR和HSP均&#x3D;&#x3D;不支持循环依赖&#x3D;&#x3D;，也&#x3D;&#x3D;不支持依赖传递&#x3D;&#x3D;。</li>
</ul>
</blockquote>
<h4 id="应用程序包结构-FA模型应用程序包结构"><a href="#应用程序包结构-FA模型应用程序包结构" class="headerlink" title="应用程序包结构-FA模型应用程序包结构"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-package-structure-fa-V5">应用程序包结构-FA模型应用程序包结构</a></h4><p>基于<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-configuration-file-overview-fa-V5">FA模型</a>开发的应用，其应用程序包结构如下图<strong>应用程序包结构（FA模型）</strong> 所示。开发者需要熟悉应用程序包结构相关的基本概念。</p>
<p>FA模型与Stage模型不同之处在于<strong>HAP内部文件存放位置不同</strong>，FA模型将所有的<strong>资源文件、库文件和代码文件</strong>都放在assets文件夹中，在文件夹内部进一步区分。</p>
<ul>
<li><code>config.json</code>是应用配置文件，IDE会自动生成一部分模块代码，开发者按需修改其中的配置。详细字段请参见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-structure-V5">应用配置文件</a>。</li>
<li><code>assets</code>是HAP所有的资源文件、库文件和代码文件的集合，内部可以分为<code>entry</code>和<code>js</code>文件夹。<code>entry</code>文件夹中存放的是<code>resources</code>目录和<code>resources.index</code>文件。</li>
<li><code>resources</code>目录用于存放应用的资源文件（字符串、图片等），便于开发者使用和维护，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5">资源文件的使用</a>。</li>
<li><code>resources.index</code>是资源索引表，由IDE调用SDK工具生成。</li>
<li><code>js</code>文件夹中存放的是<strong>编译后</strong>的代码文件。</li>
<li><code>pack.info</code>是Bundle中用于描述每个HAP属性的文件，例如app中的bundleName和versionCode信息、module中的name、type和abilities等信息，由IDE工具构建Bundle包时自动生成。</li>
</ul>
<p><strong>图1</strong> 应用程序包结构（FA模型）<br><img src="/posts/fd0f9041/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%BB%93%E6%9E%84%EF%BC%88FA%E6%A8%A1%E5%9E%8B%EF%BC%89.png" alt="应用程序包结构（FA模型）"></p>
<h4 id="应用程序包开发与使用-HAP"><a href="#应用程序包开发与使用-HAP" class="headerlink" title="应用程序包开发与使用-HAP"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/hap-package-V5">应用程序包开发与使用-HAP</a></h4><p>HAP（Harmony Ability Package）是应用安装和运行的基本单元。HAP包是由代码、资源、第三方库、配置文件等打包生成的模块包，其主要分为两种类型：entry和feature。</p>
<ul>
<li>entry：应用的主模块，作为应用的入口，提供了应用的基础功能。</li>
<li>feature：应用的动态特性模块，作为应用能力的扩展，可以根据用户的需求和设备类型进行选择性安装。<br>应用程序包可以只包含一个基础的entry包，也可以包含一个基础的entry包和多个功能性的feature包。<h5 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h5></li>
<li>单HAP场景：如果只包含UIAbility组件，无需使用ExtensionAbility组件，优先采用单HAP（即一个entry包）来实现应用开发。虽然一个HAP中可以包含一个或多个UIAbility组件，为了避免不必要的资源加载，<strong>推荐采用</strong>“一个UIAbility+多个页面”的方式。</li>
<li>多HAP场景：如果应用的功能比较复杂，需要使用<strong>ExtensionAbility组件</strong>，可以采用多HAP（即一个entry包+多个feature包）来实现应用开发，每个HAP中包含一个UIAbility组件或者一个ExtensionAbility组件。在这种场景下，可能会存在多个HAP引用相同的库文件，导致重复打包的问题。<h5 id="约束限制"><a href="#约束限制" class="headerlink" title="约束限制"></a>约束限制</h5></li>
<li><strong>不支持导出</strong>接口和ArkUI组件，给其他模块使用。</li>
<li>多HAP场景下，App Pack包中同一设备类型的所有HAP中必须有且只有一个Entry类型的HAP，Feature类型的HAP可以有一个或者多个，也可以没有。</li>
<li>多HAP场景下，同一应用中的所有HAP的配置文件中的<strong>bundleName、versionCode、versionName、minCompatibleVersionCode、debug、minAPIVersion、targetAPIVersion、apiReleaseType相同</strong>，同一设备类型的所有HAP对应的<strong>moduleName标签必须唯一</strong>。HAP打包生成App Pack包时，会对上述参数配置进行校验。</li>
<li>多HAP场景下，同一应用的所有HAP、HSP的<strong>签名证书要保持一致</strong>。上架应用市场是以App Pack形式上架，应用市场分发时会将所有HAP从App Pack中拆分出来，同时对其中的所有HAP进行重签名，这样保证了所有HAP签名证书的一致性。在调试阶段，开发者通过命令行或DevEco Studio将HAP安装到设备上时，要保证所有HAP签名证书一致，否则会出现安装失败的问题。<h5 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h5>下面简要介绍如何通过DevEco Studio新建一个HAP模块。</li>
</ul>
<ol>
<li>创建工程，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/start-with-ets-stage-V5">构建第一个ArkTS应用</a>。</li>
<li>在工程目录上单击右键，选择<strong>New &gt; Module</strong>。</li>
<li>在弹出的对话框中选择<strong>Empty Ability</strong>模板，单击<strong>Next</strong>。</li>
<li>在Module配置界面，配置<strong>Module name</strong>，选择<strong>Module Type</strong>和<strong>Device Type</strong>，然后单击<strong>Next</strong>。</li>
<li>在Ability配置界面，配置<strong>Ability name</strong>，然后单击<strong>Finish</strong>完成创建。<h5 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h5></li>
</ol>
<ul>
<li>HAP中支持添加UIAbility组件或ExtensionAbility组件，添加pages页面。具体操作可参考<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-add-new-ability-0000001053183674-V5">应用&#x2F;服务开发</a>。</li>
<li>HAP中支持引用HAR或HSP共享包，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/har-package-V5#%E4%BD%BF%E7%94%A8">HAR的使用</a>、<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/in-app-hsp-V5#%E4%BD%BF%E7%94%A8">HSP的使用</a>。<h5 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h5>通过DevEco Studio编译打包，生成单个或者多个HAP，即可基于HAP进行调试。如需根据不同的部署环境、目标人群、运行环境等，将同一个HAP定制编译为不同版本，请参见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-customized-multi-targets-and-products-guides-0000001731595144-V5">定制编译指导</a>。<br>开发者可以采用DevEco Studio或者hdc工具进行调试：  </li>
<li><strong>方法一：</strong> 使用DevEco Studio进行调试，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-run-debug-configurations-0000001760344518-V5">应用程序包调试方法</a>。</li>
<li><strong>方法二：</strong> 使用hdc工具(可通过HarmonyOS SDK获取，在SDK的toolchains目录下)进行调试。<br>  在调试前，需要先安装或更新HAP，此处有两种方式：  <ul>
<li><p>直接使用hdc安装、更新HAP。<br>  HAP的路径为开发平台上的文件路径，以Windows开发平台为例，命令参考如下：<br>  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       <span class="regexp">//</span> 安装、更新，多HAP可以指定多个文件路径</span><br><span class="line">hdc install entry.hap feature.hap</span><br><span class="line"><span class="regexp">//</span> 执行结果</span><br><span class="line">install bundle successfully.</span><br><span class="line"><span class="regexp">//</span> 卸载</span><br><span class="line">hdc uninstall com.example.myapplication</span><br><span class="line"><span class="regexp">//</span> 执行结果</span><br><span class="line">uninstall bundle successfully.</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>先执行hdc shell，再使用bm工具安装、更新HAP。<br>  HAP的文件路径为真机上的文件路径，命令参考如下：<br>  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">       <span class="regexp">//</span> 先执行hdc shell才能使用bm工具</span><br><span class="line">hdc shell</span><br><span class="line"><span class="regexp">//</span> 安装、更新，多HAP可以指定多个文件路径</span><br><span class="line">bm install -p <span class="regexp">/data/</span>app<span class="regexp">/entry.hap /</span>data<span class="regexp">/app/</span>feature.hap</span><br><span class="line"><span class="regexp">//</span> 执行结果</span><br><span class="line">install bundle successfully.</span><br><span class="line"><span class="regexp">//</span> 卸载</span><br><span class="line">bm uninstall -n com.example.myapplication</span><br><span class="line"><span class="regexp">//</span> 执行结果</span><br><span class="line">uninstall bundle successfully.</span><br></pre></td></tr></table></figure><br>  完成HAP安装或更新后，即可参考相关调试命令进行 <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/aa-tool-V5">调试</a>。</p>
</li>
</ul>
</li>
</ul>
<h4 id="应用程序包开发与使用-HAR"><a href="#应用程序包开发与使用-HAR" class="headerlink" title="应用程序包开发与使用-HAR"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/har-package-V5">应用程序包开发与使用-HAR</a></h4><p>HAR（Harmony Archive）是静态共享包，可以包含代码、C++库、资源和配置文件。通过HAR可以实现多个模块或多个工程<strong>共享ArkUI组件、资源</strong>等相关代码。</p>
<h5 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h5><ul>
<li>作为二方库，发布到<a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/">OHPM</a>私仓，供公司内部其他应用使用。</li>
<li>作为三方库，发布到<a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/">OHPM</a>中心仓，供其他应用使用。<h5 id="约束限制-1"><a href="#约束限制-1" class="headerlink" title="约束限制"></a>约束限制</h5></li>
<li>HAR不支持在设备上单独安装&#x2F;运行，只能作为应用模块的依赖项被引用。 ^1bb0e7</li>
<li>HAR不支持在配置文件中声明<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/uiability-overview-V5">UIAbility</a>组件与<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/extensionability-overview-V5">ExtensionAbility</a>组件。</li>
<li>HAR不支持在配置文件中声明<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5#pages%E6%A0%87%E7%AD%BE">pages</a>页面，但是可以包含pages页面，并通过<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-routing-V5#%E5%91%BD%E5%90%8D%E8%B7%AF%E7%94%B1">命名路由</a>的方式进行跳转。</li>
<li>HAR<strong>不支持引用AppScope目录中的资源</strong>。在编译构建时，AppScope中的内容不会打包到HAR中，因此会导致HAR资源引用失败。</li>
<li>HAR可以依赖其他HAR，但不支持循环依赖，也不支持依赖传递。<h5 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h5>通过DevEco Studio创建一个HAR模块，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-har-0000001547134226-V5#section643521083015">创建库模块</a>。<h5 id="开发-1"><a href="#开发-1" class="headerlink" title="开发"></a>开发</h5>介绍如何导出HAR的ArkUI组件、接口、资源，供其他应用或当前应用的其他模块引用。<br><code>Index.ets</code>文件是HAR导出声明文件的入口，HAR需要导出的接口，统一在<code>Index.ets</code>文件中导出。<code>Index.ets</code>文件是DevEco Studio默认自动生成的，用户也可以自定义，在模块的<code>oh-package.json5</code>文件中的main字段配置入口声明文件，配置如下所示：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;Index.ets&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="导出ArkUI组件"><a href="#导出ArkUI组件" class="headerlink" title="导出ArkUI组件"></a>导出ArkUI组件</h6>ArkUI组件的导出方式与ts的导出方式一致，通过&#x3D;&#x3D;export&#x3D;&#x3D;导出ArkUI组件，示例如下：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/components/mainpage/MainPage.ets</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">MainPage</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;HAR MainPage&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">32</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;32px&#x27;</span> &#125;)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">56</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">Center</span>, <span class="attr">alignItems</span>: <span class="title class_">ItemAlign</span>.<span class="property">Center</span>, <span class="attr">alignContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.pic_empty&#x27;</span>)).<span class="title function_">width</span>(<span class="string">&#x27;33%&#x27;</span>)</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.empty&#x27;</span>))</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">14</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.text_color&#x27;</span>))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
HAR对外暴露的接口，在<code>Index.ets</code>导出文件中声明如下所示：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/Index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">MainPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/components/mainpage/MainPage&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="导出ts类和方法"><a href="#导出ts类和方法" class="headerlink" title="导出ts类和方法"></a>导出ts类和方法</h6>通过export导出ts类和方法，支持导出多个ts类和方法，示例如下所示：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ts/test.ets</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Log</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">info</span>(<span class="params">msg: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">func</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;har func&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">func2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;har func2&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
HAR对外暴露的接口，在<code>Index.ets</code>导出文件中声明如下所示：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/Index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Log</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ts/test&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; func &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ts/test&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; func2 &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ts/test&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="导出native方法"><a href="#导出native方法" class="headerlink" title="导出native方法"></a>导出native方法</h6>在HAR中也可以包含C++编写的so。对于so中的native方法，HAR通过以下方式导出，以导出libnative.so的加法接口add为例：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/utils/nativeTest.ts</span></span><br><span class="line"><span class="keyword">import</span> native <span class="keyword">from</span> <span class="string">&#x27;liblibrary.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">nativeAdd</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">number</span> = native.<span class="title function_">add</span>(a, b);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
HAR对外暴露的接口，在<code>Index.ets</code>导出文件中声明如下所示：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/Index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; nativeAdd &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/utils/nativeTest&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h6>在编译构建HAP时，DevEco Studio会从HAP模块及依赖的模块中收集资源文件，如果不同模块下的&#x3D;&#x3D;资源文件&#x3D;&#x3D;出现重名&#x3D;&#x3D;冲突&#x3D;&#x3D;时，DevEco Studio会按照以下优先级进行&#x3D;&#x3D;覆盖&#x3D;&#x3D;（优先级由高到低）：</li>
<li>AppScope（仅API9的<code>Stage</code>模型支持）。</li>
<li>HAP包自身模块。</li>
<li>依赖的HAR模块，如果依赖的多个HAR之间有资源冲突，会按照工程oh-package.json5中dependencies下的依赖顺序进行覆盖，依赖顺序在前的优先级较高。例如下方示例中dayjs和lottie中包含同名文件时，会优先使用dayjs中的资源。</li>
</ul>
<blockquote>
<p>[!说明]<br>如果在<code>AppScope/HAP模块/HAR模块</code>的国际化目录中配置了资源，在相同的国际化限定词下，合并的优先级也遵循上述规则。同时，国际化<strong>限定词</strong>中配置的<strong>优先级高</strong>于在base中的配置。如：在AppScope的base中配置了资源字段，在HAR模块的en_US中配置了同样的资源字段，则在en_US的使用场景中，会更优先使用HAR模块中配置的资源字段。</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// oh-package.json5</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;dayjs&quot;</span>: <span class="string">&quot;^1.10.4&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lottie&quot;</span>: <span class="string">&quot;^2.0.0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>介绍如何配置HAR依赖，并引用HAR的ArkUI组件、接口、资源。<br>引用HAR前，需要先配置对HAR的依赖，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-har-import-0000001547293682-V5">引用HAR文件和资源</a>。  </p>
<h6 id="引用HAR的ArkUI组件"><a href="#引用HAR的ArkUI组件" class="headerlink" title="引用HAR的ArkUI组件"></a>引用HAR的ArkUI组件</h6><p>HAR的依赖配置成功后，可以引用HAR的ArkUI组件。ArkUI组件的导入方式与ts的导入方式一致，通过<code>import</code>引入HAR导出的ArkUI组件，示例如下所示：  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry/src/main/ets/pages/IndexSec.ets</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MainPage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">IndexSec</span> &#123;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="comment">// 引用HAR的ArkUI组件</span></span><br><span class="line">      <span class="title class_">MainPage</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="引用HAR的ts类和方法"><a href="#引用HAR的ts类和方法" class="headerlink" title="引用HAR的ts类和方法"></a>引用HAR的ts类和方法</h6><p>通过import引用HAR导出的ts类和方法，示例如下所示：  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry/src/main/ets/pages/Index.ets</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Log</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; func &#125; <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">        .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">32</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="number">700</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.text_color&#x27;</span>))</span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;32px&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//引用HAR的ts类和方法</span></span><br><span class="line">      <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.button&#x27;</span>))</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">48</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;4%&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">type</span>(<span class="title class_">ButtonType</span>.<span class="property">Capsule</span>)</span><br><span class="line">        .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>($r(<span class="string">&#x27;sys.float.ohos_id_corner_radius_button&#x27;</span>))</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.button_background&#x27;</span>))</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">fontSize</span>($r(<span class="string">&#x27;sys.float.ohos_id_text_size_button1&#x27;</span>))</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 引用HAR的类和方法</span></span><br><span class="line">          <span class="title class_">Log</span>.<span class="title function_">info</span>(<span class="string">&#x27;har msg&#x27;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&#x27;func return: &#x27;</span> + <span class="title function_">func</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="引用HAR的native方法"><a href="#引用HAR的native方法" class="headerlink" title="引用HAR的native方法"></a>引用HAR的native方法</h6><p>通过import引用HAR导出的native方法，示例如下所示：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry/src/main/ets/pages/Index.ets</span></span><br><span class="line"><span class="keyword">import</span> &#123; nativeAdd &#125; <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">        .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">32</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="number">700</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.text_color&#x27;</span>))</span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;32px&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//引用HAR的native方法</span></span><br><span class="line">      <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.native_add&#x27;</span>))</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;nativeAdd&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">48</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;4%&#x27;</span>, <span class="attr">bottom</span>: <span class="string">&#x27;6%&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">type</span>(<span class="title class_">ButtonType</span>.<span class="property">Capsule</span>)</span><br><span class="line">        .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>($r(<span class="string">&#x27;sys.float.ohos_id_corner_radius_button&#x27;</span>))</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.button_background&#x27;</span>))</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">fontSize</span>($r(<span class="string">&#x27;sys.float.ohos_id_text_size_button1&#x27;</span>))</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&#x27;result: &#x27;</span> + <span class="title function_">nativeAdd</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="引用HAR的资源"><a href="#引用HAR的资源" class="headerlink" title="引用HAR的资源"></a>引用HAR的资源</h6><p>通过&#x3D;&#x3D;$r&#x3D;&#x3D;引用HAR中的资源，例如在HAR模块的<code>src/main/resources</code>里添加字符串资源（在string.json中定义，name：hello_har）和图片资源（icon_har.png），然后在Entry模块中引用该字符串和图片资源的示例如下所示：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry/src/main/ets/pages/Index.ets</span></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 引用HAR的字符串资源</span></span><br><span class="line">      <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.hello_har&#x27;</span>))</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;stringHar&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.text_color&#x27;</span>))</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;40%&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">List</span>() &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="comment">// 引用HAR的图片资源</span></span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.icon_har&#x27;</span>))</span><br><span class="line">            .<span class="title function_">id</span>(<span class="string">&#x27;iconHar&#x27;</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;48px&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;5%&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;312px&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignListItem</span>(<span class="title class_">ListItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h5><p>HAR可以作为二方库和三方库提供给其他应用使用，如果需要对代码资产进行保护时，建议开启混淆能力。<br>混淆能力开启后，DevEco Studio在构建HAR时，会对代码进行编译、混淆及压缩处理，保护代码资产。  </p>
<blockquote>
<p>[!说明]<br>仅Stage模型的ArkTS工程支持混淆。<br>HAR开启混淆后资源ID为-1，<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-resource-manager-V5">ResourceManager</a>等通过ID获取资源的API不再生效。  </p>
</blockquote>
<p>对于API 10及以上版本，HAR模块默认开启混淆能力，可以在HAR模块的build-profile.json5文件中的ruleOptions字段下的enable进行设置，配置如下所示：  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;apiType&quot;</span>: <span class="string">&quot;stageMode&quot;</span>,</span><br><span class="line">  <span class="string">&quot;buildOption&quot;</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;buildOptionSet&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;release&quot;</span>,</span><br><span class="line">      <span class="string">&quot;arkOptions&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;obfuscation&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;ruleOptions&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;files&quot;</span>: [</span><br><span class="line">              <span class="string">&quot;./obfuscation-rules.txt&quot;</span></span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;consumerFiles&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;./consumer-rules.txt&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;targets&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;default&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="编译生成TS文件"><a href="#编译生成TS文件" class="headerlink" title="编译生成TS文件"></a>编译生成TS文件</h6><blockquote>
<p>[!说明]<br>在har中使用Sendable class时，开启该配置。</p>
</blockquote>
<p>har模块中arkts文件编译后，默认产物为js文件，想要将产物修改为ts文件，可以在har模块src&#x2F;main目录下的module.json5文件中的”metadata”字段下的”UseTsHar”进行设置，配置如下所示：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;module&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;TsClosedHar&quot;</span>,</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;har&quot;</span>,</span><br><span class="line">    <span class="string">&quot;deviceTypes&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;default&quot;</span>,</span><br><span class="line">      <span class="string">&quot;tablet&quot;</span>,</span><br><span class="line">      <span class="string">&quot;2in1&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;metadata&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;UseTsHar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h5><p>详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-har-publish-0000001597973129-V5">发布HAR</a>。</p>
<h4 id="应用程序包开发与使用-HSP"><a href="#应用程序包开发与使用-HSP" class="headerlink" title="应用程序包开发与使用-HSP"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/in-app-hsp-V5">应用程序包开发与使用-HSP</a></h4><p>HSP（Harmony Shared Package）是动态共享包，可以包含代码、C++库、资源和配置文件，通过HSP可以实现代码和资源的共享。HSP不支持独立发布，而是跟随其宿主应用的APP包一起发布，与宿主应用同进程，具有相同的包名和生命周期。</p>
<blockquote>
<p>[!说明]<br>应用内HSP：在编译过程中与应用包名（bundleName）强耦合，只能给某个特定的应用使用。<br>集成态HSP：构建、发布过程中，不与特定的应用包名耦合；使用时，工具链支持自动将集成态HSP的包名替换成宿主应用包名。</p>
</blockquote>
<h5 id="使用场景-2"><a href="#使用场景-2" class="headerlink" title="使用场景"></a>使用场景</h5><ul>
<li><p>多个HAP&#x2F;HSP共用的代码和资源放在同一个HSP中，可以提高代码、资源的可重用性和可维护性，同时编译打包时也只保留一份HSP代码和资源，能够有效控制应用包大小。</p>
</li>
<li><p>HSP在运行时<strong>按需加载</strong>，有助于提升应用性能。</p>
</li>
<li><p>同一个组织内部的多个应用之间，可以使用集成态HSP实现代码和资源的共享。</p>
<h5 id="约束限制-2"><a href="#约束限制-2" class="headerlink" title="约束限制"></a>约束限制</h5></li>
<li><p>HSP不支持在设备上单独安装&#x2F;运行，需要与依赖该HSP的HAP一起安装&#x2F;运行。HSP的版本号必须与HAP<strong>版本号一致</strong>。</p>
</li>
<li><p>HSP不支持在配置文件中声明<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/uiability-overview-V5">UIAbility</a>组件与<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/extensionability-overview-V5">ExtensionAbility</a>组件。</p>
</li>
<li><p>HSP可以依赖其他HAR或HSP，但不支持循环依赖，也不支持依赖传递。</p>
</li>
<li><p>集成态HSP只支持&#x3D;&#x3D;<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-package-structure-stage-V5">Stage模型</a>&#x3D;&#x3D;。</p>
</li>
<li><p>集成态HSP需要<strong>API12及以上版本</strong>，使用标准化的OHMUrl格式。</p>
<h5 id="创建-2"><a href="#创建-2" class="headerlink" title="创建"></a>创建</h5><p>通过DevEco Studio创建一个HSP模块，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-hsp-0000001521396322-V5#section7717162312546">创建HSP模块</a>，我们以创建一个名为library的HSP模块为例。基本的工程目录结构如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MyApplication</span><br><span class="line">├── library</span><br><span class="line">│   ├── <span class="attribute">src</span></span><br><span class="line">│   │   └── <span class="selector-tag">main</span></span><br><span class="line">│   │       ├── ets</span><br><span class="line">│   │       │   └── pages</span><br><span class="line">│   │       │       └── index<span class="selector-class">.ets</span></span><br><span class="line">│   │       ├── resources</span><br><span class="line">│   │       └── module<span class="selector-class">.json5</span></span><br><span class="line">│   ├── oh-package<span class="selector-class">.json5</span></span><br><span class="line">│   ├── index<span class="selector-class">.ets</span></span><br><span class="line">│   └── build-profile<span class="selector-class">.json5</span> <span class="comment">//模块级</span></span><br><span class="line">└── build-profile<span class="selector-class">.json5</span>     <span class="comment">//工程级</span></span><br></pre></td></tr></table></figure>
<h5 id="开发-2"><a href="#开发-2" class="headerlink" title="开发"></a>开发</h5><p>介绍如何导出HSP的ArkUI组件、接口、资源，供应用内的其他HAP&#x2F;HSP引用。</p>
<h6 id="导出ArkUI组件-1"><a href="#导出ArkUI组件-1" class="headerlink" title="导出ArkUI组件"></a>导出ArkUI组件</h6><p>ArkUI组件可以通过export导出，例如：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/components/MyTitleBar.ets</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">MyTitleBar</span> &#123;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.library_title&#x27;</span>))</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;library&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">32</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.text_color&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对外暴露的接口，需要在入口文件index.ets中声明：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">MyTitleBar</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/components/MyTitleBar&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="导出ts类和方法-1"><a href="#导出ts类和方法-1" class="headerlink" title="导出ts类和方法"></a>导出ts类和方法</h6><p>通过export导出ts类和方法，例如：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/utils/test.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Log</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">info</span>(<span class="attr">msg</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">minus</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对外暴露的接口，需要在入口文件index.ets中声明：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Log</span>, add, minus &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/utils/test&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="导出native方法-1"><a href="#导出native方法-1" class="headerlink" title="导出native方法"></a>导出native方法</h6><p>在HSP中也可以包含C++编写的so。对于so中的native方法，HSP通过<strong>间接的方式</strong>导出，以导出liblibrary.so的乘法接口multi为例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/utils/nativeTest.ts</span></span><br><span class="line"><span class="keyword">import</span> native <span class="keyword">from</span> <span class="string">&#x27;liblibrary.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">nativeMulti</span>(<span class="params">a: <span class="built_in">number</span>, b: <span class="built_in">number</span></span>): <span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">number</span> = native.<span class="title function_">multi</span>(a, b);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对外暴露的接口，需要在入口文件index.ets中声明：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; nativeMulti &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/utils/nativeTest&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="通过-r访问HSP中的资源"><a href="#通过-r访问HSP中的资源" class="headerlink" title="通过$r访问HSP中的资源"></a>通过<code>$r</code>访问HSP中的资源</h6><p>在组件中，经常需要使用字符串、图片等资源。HSP中的组件需要使用资源时，一般将其所用资源放在HSP包内，而非放在HSP的使用方处，以符合高内聚低耦合的原则。<br>在工程中，常通过<code>$r/$rawfile</code>的形式引用应用资源。可以用<code>$r/$rawfile</code>访问本模块resources目录下的资源，如访问resources目录下定义的图片<code>src/main/resources/base/media/example.png</code>时，可以用<code>$r(&quot;app.media.example&quot;)</code>。有关<code>$r/$rawfile</code>的详细使用方式，请参阅文档<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5">资源分类与访问</a>中“资源访问-应用资源”小节。<br><strong>不推荐</strong>使用<strong>相对路径</strong>的方式，容易引用错误路径。例如：<br>当要引用上述同一图片资源时，在HSP模块中使用<code>Image(&quot;../../resources/base/media/example.png&quot;)</code>，实际上该Image组件访问的是HSP调用方（如entry）下的资源<code>entry/src/main/resources/base/media/example.png</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/pages/Index.ets</span></span><br><span class="line"><span class="comment">// 正确用例</span></span><br><span class="line"><span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.example&#x27;</span>))</span><br><span class="line">  .<span class="title function_">id</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">  .<span class="title function_">borderRadius</span>(<span class="string">&#x27;48px&#x27;</span>)</span><br><span class="line"><span class="comment">// 错误用例</span></span><br><span class="line"><span class="title class_">Image</span>(<span class="string">&quot;../../resources/base/media/example.png&quot;</span>)</span><br><span class="line">  .<span class="title function_">id</span>(<span class="string">&#x27;example&#x27;</span>)</span><br><span class="line">  .<span class="title function_">borderRadius</span>(<span class="string">&#x27;48px&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h6 id="导出HSP中的资源"><a href="#导出HSP中的资源" class="headerlink" title="导出HSP中的资源"></a>导出HSP中的资源</h6><p>跨包访问HSP内资源时，推荐实现一个<strong>资源管理类</strong>，以封装对外导出的资源。采用这种方式，具有如下优点：</p>
</li>
<li><p>HSP开发者可以控制自己需要导出的资源，不需要对外暴露的资源可以不用导出。</p>
</li>
<li><p>使用方无须感知HSP内部的资源名称。当HSP内部的资源名称发生变化时，也不需要使用方跟着修改。<br>其具体实现如下：<br>将需要对外提供的资源封装为一个资源管理类：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/src/main/ets/ResManager.ets</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ResManager</span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getPic</span>(): <span class="title class_">Resource</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $r(<span class="string">&#x27;app.media.pic&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDesc</span>(): <span class="title class_">Resource</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $r(<span class="string">&#x27;app.string.shared_desc&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对外暴露的接口，需要在入口文件index.ets中声明：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">ResManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/ResManager&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p>介绍如何引用HSP中的接口，以及如何通过页面路由实现HSP的pages页面跳转与返回。</p>
<h6 id="引用HSP中的接口"><a href="#引用HSP中的接口" class="headerlink" title="引用HSP中的接口"></a>引用HSP中的接口</h6><p>要使用HSP中的接口，首先需要在使用方的oh-package.json5中配置对它的依赖，详见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-har-import-0000001547293682-V5">引用动态共享包</a>。<br>依赖配置成功后，就可以像使用HAR一样调用HSP的对外接口了。例如，上面的library已经导出了下面这些接口：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// library/index.ets</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Log</span>, add, minus &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/utils/test&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">MyTitleBar</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/components/MyTitleBar&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">ResManager</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/ResManager&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; nativeMulti &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/main/ets/utils/nativeTest&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在使用方的代码中，可以这样使用：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry/src/main/ets/pages/index.ets</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Log</span>, add, <span class="title class_">MyTitleBar</span>, <span class="title class_">ResManager</span>, nativeMulti &#125; <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ohos.base&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Logger</span> <span class="keyword">from</span> <span class="string">&#x27;../logger/Logger&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TAG</span> = <span class="string">&#x27;Index&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>() &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">MyTitleBar</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">&#x27;35px&#x27;</span>, <span class="attr">top</span>: <span class="string">&#x27;32px&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">            .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;685px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="comment">// ResManager返回的Resource对象，可以传给组件直接使用，也可以从中取出资源来使用</span></span><br><span class="line">          <span class="title class_">Image</span>(<span class="title class_">ResManager</span>.<span class="title function_">getPic</span>())</span><br><span class="line">            .<span class="title function_">id</span>(<span class="string">&#x27;image&#x27;</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;48px&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;685px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span>, <span class="attr">top</span>: <span class="number">4</span>, <span class="attr">bottom</span>: <span class="number">4</span> &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.add&#x27;</span>))</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;685px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;84px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span>, <span class="attr">top</span>: <span class="number">4</span>, <span class="attr">bottom</span>: <span class="number">4</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Log</span>.<span class="title function_">info</span>(<span class="string">&#x27;add button click!&#x27;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&#x27;result: &#x27;</span> + <span class="title function_">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.get_string_value&#x27;</span>))</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;getStringValue&#x27;</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;685px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;84px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span>, <span class="attr">top</span>: <span class="number">4</span>, <span class="attr">bottom</span>: <span class="number">4</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 先通过当前上下文获取hsp模块的上下文，再获取hsp模块的resourceManager，然后再调用resourceManager的接口获取资源</span></span><br><span class="line">          <span class="title function_">getContext</span>()</span><br><span class="line">            .<span class="title function_">createModuleContext</span>(<span class="string">&#x27;library&#x27;</span>)</span><br><span class="line">            .<span class="property">resourceManager</span></span><br><span class="line">            .<span class="title function_">getStringValue</span>(<span class="title class_">ResManager</span>.<span class="title function_">getDesc</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">`getStringValue is <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&#x27;getStringValue is &#x27;</span> + value;</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function">(<span class="params">err: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">`getStringValue promise error is <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.native_multi&#x27;</span>))</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;nativeMulti&#x27;</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;685px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;84px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span>, <span class="attr">top</span>: <span class="number">4</span>, <span class="attr">bottom</span>: <span class="number">4</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Log</span>.<span class="title function_">info</span>(<span class="string">&#x27;nativeMulti button click!&#x27;</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">message</span> = <span class="string">&#x27;result: &#x27;</span> + <span class="title function_">nativeMulti</span>(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignListItem</span>(<span class="title class_">ListItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="页面路由跳转"><a href="#页面路由跳转" class="headerlink" title="页面路由跳转"></a>页面路由跳转</h6><p>若开发者想在entry模块中，添加一个按钮跳转至library模块中的menu页面（路径为：<code>library/src/main/ets/pages/menu.ets</code>），那么可以在使用方的代码（entry模块下的<code>Index.ets</code>，路径为：<code>entry/src/main/ets/pages/Index.ets</code>）里这样使用：  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Log</span>, add, <span class="title class_">MyTitleBar</span>, <span class="title class_">ResManager</span>, nativeMulti &#125; <span class="keyword">from</span> <span class="string">&#x27;library&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ohos.base&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Logger</span> <span class="keyword">from</span> <span class="string">&#x27;../logger/Logger&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">TAG</span> = <span class="string">&#x27;Index&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>() &#123;</span><br><span class="line">        <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>($r(<span class="string">&#x27;app.string.click_to_menu&#x27;</span>))</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">500</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;clickToMenu&#x27;</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;685px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;84px&#x27;</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span>, <span class="attr">bottom</span>: <span class="number">10</span> &#125;)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span>, <span class="attr">top</span>: <span class="number">4</span>, <span class="attr">bottom</span>: <span class="number">4</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          router.<span class="title function_">pushUrl</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;@bundle:com.samples.hspsample/library/ets/pages/Menu&#x27;</span></span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;push page success&#x27;</span>);</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">info</span>(<span class="variable constant_">TAG</span>, <span class="string">&#x27;push page success&#x27;</span>);</span><br><span class="line">          &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Logger</span>.<span class="title function_">error</span>(<span class="variable constant_">TAG</span>, <span class="string">`pushUrl failed, code is <span class="subst">$&#123;err.code&#125;</span>, message is <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignListItem</span>(<span class="title class_">ListItemAlign</span>.<span class="property">Center</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>router.pushUrl</code>方法的入参中url的内容为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;@bundle:com.samples.hspsample/library/ets/pages/Menu&#x27;</span></span><br></pre></td></tr></table></figure>
<p>url内容的模板为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;@bundle:包名（bundleName）/模块名（moduleName）/路径/页面所在的文件名(不加.ets后缀)&#x27;</span></span><br></pre></td></tr></table></figure>
<h6 id="页面路由返回"><a href="#页面路由返回" class="headerlink" title="页面路由返回"></a>页面路由返回</h6><p>如果当前处于HSP中的页面，需要返回之前的页面时，可以使用<code>router.back</code>方法，但是返回的页面必须是当前页面跳转路径上的页面。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;@ohos.router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index3</span> &#123; <span class="comment">// 路径为：`library/src/main/ets/pages/Back.ets</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;HSP back page&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">          .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">32</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;app.color.text_color&#x27;</span>))</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;32px&#x27;</span> &#125;)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.back_to_HAP&#x27;</span>))</span><br><span class="line">          .<span class="title function_">id</span>(<span class="string">&#x27;backToHAP&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">48</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">550</span> &#125;)</span><br><span class="line">          .<span class="title function_">type</span>(<span class="title class_">ButtonType</span>.<span class="property">Capsule</span>)</span><br><span class="line">          .<span class="title function_">borderRadius</span>($r(<span class="string">&#x27;sys.float.ohos_id_corner_radius_button&#x27;</span>))</span><br><span class="line">          .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.button_background&#x27;</span>))</span><br><span class="line">          .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">          .<span class="title function_">fontSize</span>($r(<span class="string">&#x27;sys.float.ohos_id_text_size_button1&#x27;</span>))</span><br><span class="line">            <span class="comment">// 绑定点击事件</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            router.<span class="title function_">back</span>(&#123; <span class="comment">//  返回HAP的页面</span></span><br><span class="line">              <span class="attr">url</span>: <span class="string">&#x27;pages/Index&#x27;</span> <span class="comment">// 路径为：`entry/src/main/ets/pages/Index.ets`</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Button</span>($r(<span class="string">&#x27;app.string.back_to_HSP&#x27;</span>))</span><br><span class="line">          .<span class="title function_">id</span>(<span class="string">&#x27;backToHSP&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontFamily</span>(<span class="string">&#x27;HarmonyHeiTi&#x27;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">48</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;624px&#x27;</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">&#x27;4%&#x27;</span> , <span class="attr">bottom</span>: <span class="string">&#x27;6%&#x27;</span> &#125;)</span><br><span class="line">          .<span class="title function_">type</span>(<span class="title class_">ButtonType</span>.<span class="property">Capsule</span>)</span><br><span class="line">          .<span class="title function_">borderRadius</span>($r(<span class="string">&#x27;sys.float.ohos_id_corner_radius_button&#x27;</span>))</span><br><span class="line">          .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.button_background&#x27;</span>))</span><br><span class="line">          .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_foreground_contrary&#x27;</span>))</span><br><span class="line">          .<span class="title function_">fontSize</span>($r(<span class="string">&#x27;sys.float.ohos_id_text_size_button1&#x27;</span>))</span><br><span class="line">            <span class="comment">// 绑定点击事件</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            router.<span class="title function_">back</span>(&#123; <span class="comment">//  返回HSP的页面</span></span><br><span class="line">              <span class="attr">url</span>: <span class="string">&#x27;@bundle:com.samples.hspsample/library/ets/pages/Menu&#x27;</span> <span class="comment">//路径为：`library/src/main/ets/pages/Menu.ets</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">backgroundColor</span>($r(<span class="string">&#x27;app.color.page_background&#x27;</span>))</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>页面返回<code>router.back</code>方法的入参中url说明：</p>
</li>
<li><p>如果从HSP页面返回HAP页面，url的内容为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;pages/Index&#x27;</span></span><br></pre></td></tr></table></figure>
<p>url内容的模板为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;页面所在的文件名(不加.ets后缀)&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>如果从HSP1的页面跳到HSP2的页面后，需要返回到HSP1的页面，url的内容为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;@bundle:com.samples.hspsample/library/ets/pages/Menu&#x27;</span></span><br></pre></td></tr></table></figure>
<p>url内容的模板为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;@bundle:包名（bundleName）/模块名（moduleName）/路径/页面所在的文件名(不加.ets后缀)&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="集成态HSP"><a href="#集成态HSP" class="headerlink" title="集成态HSP"></a>集成态HSP</h5><h6 id="配置HSP模块为集成态HSP"><a href="#配置HSP模块为集成态HSP" class="headerlink" title="配置HSP模块为集成态HSP"></a>配置HSP模块为集成态HSP</h6><p>修改模块级构建配置文件<code>build-profile.json5</code>，设置配置项<code>integratedHsp</code>为<code>true</code>，指定构建的HSP模块为集成态HSP。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;apiType&quot;</span>: <span class="string">&quot;stageMode&quot;</span>,</span><br><span class="line">  <span class="string">&quot;buildOption&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;arkOptions&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;integratedHsp&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="配置工程使用标准化的OHMUrl格式"><a href="#配置工程使用标准化的OHMUrl格式" class="headerlink" title="配置工程使用标准化的OHMUrl格式"></a>配置工程使用标准化的OHMUrl格式</h6><p>集成态HSP需要使用标准化的OHMUrl格式，修改工程级构建配置文件<code>build-profile.json5</code>，设置配置项<code>useNormalizedOHMUrl</code>为<code>true</code>，指定工程使用标准化的OHMUrl格式。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;app&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;products&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">      <span class="string">&quot;signingConfig&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">      <span class="string">&quot;compatibleSdkVersion&quot;</span>: <span class="string">&quot;5.0.0(12)&quot;</span>,</span><br><span class="line">      <span class="string">&quot;runtimeOS&quot;</span>: <span class="string">&quot;HarmonyOS&quot;</span>,</span><br><span class="line">      <span class="string">&quot;buildOption&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;strictMode&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;useNormalizedOHMUrl&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="应用程序包开发与使用-动态import"><a href="#应用程序包开发与使用-动态import" class="headerlink" title="应用程序包开发与使用-动态import"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-dynamic-import-V5">应用程序包开发与使用-动态import</a></h4><p>动态import支持条件延迟加载，支持部分反射功能，可以提升页面的加载速度；动态import支持加载HSP模块&#x2F;HAR模块&#x2F;OHPM包&#x2F;Native库等，并且HAR模块间只有变量动态import时还可以进行模块解耦。</p>
<h5 id="技术适用场景介绍"><a href="#技术适用场景介绍" class="headerlink" title="技术适用场景介绍"></a>技术适用场景介绍</h5><p>应用开发的有些场景中，如果希望根据条件导入模块或者按需导入模块，可以使用动态导入代替<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/introduction-to-arkts-V5#%E9%9D%99%E6%80%81%E5%AF%BC%E5%85%A5">静态导入</a>。下面是可能会需要动态导入的场景：</p>
<ul>
<li>当静态导入的模块很明显的降低了代码的加载速度且被使用的可能性很低，或者并不需要马上使用它。</li>
<li>当静态导入的模块很明显的占用了大量的系统内存且被使用的可能性很低。</li>
<li>当被导入的模块，在加载时并不存在，需要<strong>异步</strong>获取。</li>
<li>当被导入的模块说明符，需要动态构建。（静态导入只能使用静态说明符）</li>
<li>当被导入的模块有副作用（这里的副作用，可以理解为模块中会直接运行的代码），这些副作用只有在触发了某些条件才被需要时。</li>
</ul>
<h5 id="业务扩展场景介绍"><a href="#业务扩展场景介绍" class="headerlink" title="业务扩展场景介绍"></a>业务扩展场景介绍</h5><p>动态import在业务上除了能实现条件<strong>延迟加载</strong>，还可以实现<strong>部分反射</strong>功能。实例如下，HAP动态import HAR包harlibrary，并调用静态成员函数staticAdd()、成员函数instanceAdd()，以及全局方法addHarlibrary()。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// harlibrary&#x27;s src/main/ets/utils/Calc.ets</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Calc</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">staticAdd</span>(<span class="attr">a</span>:<span class="built_in">number</span>, <span class="attr">b</span>:<span class="built_in">number</span>):<span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> c = a + b;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DynamicImport I am harlibrary in staticAdd, %d + %d = %d&#x27;</span>, a, b, c);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">instanceAdd</span>(<span class="attr">a</span>:<span class="built_in">number</span>, <span class="attr">b</span>:<span class="built_in">number</span>):<span class="built_in">number</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> c = a + b;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DynamicImport I am harlibrary in instanceAdd, %d + %d = %d&#x27;</span>, a, b, c);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">addHarlibrary</span>(<span class="params">a:<span class="built_in">number</span>, b:<span class="built_in">number</span></span>):<span class="built_in">number</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> c = a + b;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DynamicImport I am harlibrary in addHarlibrary, %d + %d = %d&#x27;</span>, a, b, c);</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="应用程序包安装卸载与更新"><a href="#应用程序包安装卸载与更新" class="headerlink" title="应用程序包安装卸载与更新"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-package-install-uninstall-V5">应用程序包安装卸载与更新</a></h4><p>本章节简要介绍应用程序包的安装卸载流程、以及应用程序包的两种更新方式。</p>
<h5 id="应用程序包的安装卸载"><a href="#应用程序包的安装卸载" class="headerlink" title="应用程序包的安装卸载"></a>应用程序包的安装卸载</h5><p>开发者可以通过调试命令进行应用的安装和卸载，可参考<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-package-structure-stage-V5#%E5%8F%91%E5%B8%83%E6%80%81%E5%8C%85%E7%BB%93%E6%9E%84">编译发布与上架部署流程图</a>。<br><strong>图1</strong> 应用程序包安装和卸载流程（开发者）<br><img src="/posts/fd0f9041/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%B5%81%E7%A8%8B.png" alt="应用程序包安装和卸载流程"><br>开发者将应用上架应用市场后，终端设备用户可以在终端设备上使用应用市场进行应用的安装和卸载。</p>
<p><strong>图2</strong> 应用程序包安装和卸载流程（终端设备用户）<br><img src="/posts/fd0f9041/%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%B5%81%E7%A8%8B%201.png" alt="应用程序包安装和卸载流程"></p>
<h5 id="应用程序包的更新"><a href="#应用程序包的更新" class="headerlink" title="应用程序包的更新"></a>应用程序包的更新</h5><p>应用程序包可以通过以下两种方式进行更新：  </p>
<ul>
<li>应用市场内更新：新版本应用通过应用市场上架后，应用市场通知终端用户该应用有新版本，终端用户可以根据通知到应用市场（客户端）进行应用升级。</li>
<li>应用内检测升级：终端用户启动应用时，应用市场检测到该应用有新版本会通知终端用户，可以到应用市场进行应用的下载更新。</li>
</ul>
<h3 id="应用配置文件（Stage模型）"><a href="#应用配置文件（Stage模型）" class="headerlink" title="应用配置文件（Stage模型）"></a>应用配置文件（Stage模型）</h3><h4 id="应用配置文件概述（Stage模型）"><a href="#应用配置文件概述（Stage模型）" class="headerlink" title="应用配置文件概述（Stage模型）"></a>应用配置文件概述（Stage模型）</h4><p>每个应用项目的代码目录下必须包含应用配置文件，这些配置文件会向编译工具、操作系统和应用市场提供应用的基本信息。<br>在基于Stage模型开发的应用项目代码下，都存在<strong>一个app.json5</strong>配置文件、以及<strong>一个或多个</strong><code>module.json5</code>配置文件。  </p>
<p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-configuration-file-V5">app.json5配置文件</a>主要包含以下内容：</p>
<ul>
<li>应用的全局配置信息，包含应用的Bundle名称、开发厂商、版本号等基本信息。</li>
<li>特定设备类型的配置信息。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-configuration-file-V5">module.json5配置文件</a>主要包含以下内容：</p>
<ul>
<li>Module的基本配置信息，包含Module名称、类型、描述、支持的设备类型等基本信息。</li>
<li><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/stage-model-development-overview-V5">应用组件</a>信息，包含UIAbility组件和ExtensionAbility组件的描述信息。</li>
<li>应用运行过程中所需的权限信息。</li>
</ul>
<h4 id="app-json5配置文件"><a href="#app-json5配置文件" class="headerlink" title="app.json5配置文件"></a>app.json5配置文件</h4><h5 id="配置文件示例"><a href="#配置文件示例" class="headerlink" title="配置文件示例"></a>配置文件示例</h5><p>先通过一个示例，整体认识一下app.json5配置文件。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;app&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bundleName&quot;</span>: <span class="string">&quot;com.application.myapplication&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vendor&quot;</span>: <span class="string">&quot;example&quot;</span>,</span><br><span class="line">    <span class="string">&quot;versionCode&quot;</span>: <span class="number">1000000</span>,</span><br><span class="line">    <span class="string">&quot;versionName&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;$media:app_icon&quot;</span>,</span><br><span class="line">    <span class="string">&quot;label&quot;</span>: <span class="string">&quot;$string:app_name&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;$string:description_application&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minAPIVersion&quot;</span>: <span class="number">9</span>,</span><br><span class="line">    <span class="string">&quot;targetAPIVersion&quot;</span>: <span class="number">9</span>,</span><br><span class="line">    <span class="string">&quot;apiReleaseType&quot;</span>: <span class="string">&quot;Release&quot;</span>,</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;car&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;minAPIVersion&quot;</span>: <span class="number">8</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;targetBundleName&quot;</span>: <span class="string">&quot;com.application.test&quot;</span>,</span><br><span class="line">    <span class="string">&quot;targetPriority&quot;</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="string">&quot;appEnvironments&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:<span class="string">&quot;name1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value1&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;maxChildProcess&quot;</span>: <span class="number">5</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="配置文件标签"><a href="#配置文件标签" class="headerlink" title="配置文件标签"></a>配置文件标签</h5><p>app.json5配置文件包含以下标签。</p>
<p><strong>表1</strong> app.json5配置文件标签说明</p>
<table>
<thead>
<tr>
<th align="left">属性名称</th>
<th align="left">含义</th>
<th align="left">数据类型</th>
<th align="left">是否可缺省</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bundleName</td>
<td align="left">标识应用的Bundle名称，用于标识应用的唯一性。命名规则如下 ：<br>- 由字母、数字、下划线和符号“.”组成，且必须以<strong>字母开头</strong>。<br>- 字符串<strong>最小长度为7字节</strong>，最大长度128字节。<br>- 推荐采用反域名形式命名（如“com.example.demo”，建议第一级为域名后缀com，第二级为厂商&#x2F;个人名，第三级为应用名，也可以多级）。<br>对于随系统源码编译的应用，建议命名为“com.ohos.demo”形式，其中的ohos标识系统应用。</td>
<td align="left">字符串</td>
<td align="left">该标签&#x3D;&#x3D;不可缺省&#x3D;&#x3D;。</td>
</tr>
<tr>
<td align="left">bundleType</td>
<td align="left">标识应用的Bundle类型，用于区分应用或者元服务。支持的取值如下：<br>- app：当前Bundle为应用。<br>- atomicService：当前Bundle为元服务。<br>- shared：当前Bundle为共享库应用，预留字段。<br>- appService：当前Bundle为系统级共享库应用，仅供系统应用使用。</td>
<td align="left">字符串</td>
<td align="left">该标签可缺省，缺省值为app。</td>
</tr>
<tr>
<td align="left">debug</td>
<td align="left">标识应用是否可调试。<br>- true：可以进行断点调试。<br>- false：不可以进行断点调试。</td>
<td align="left">布尔值</td>
<td align="left">由IDE编译构建时生成。该标签可缺省，缺省值为false。</td>
</tr>
<tr>
<td align="left">icon</td>
<td align="left">标识<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-component-configuration-stage-V5">应用的图标</a>，取值为图标资源文件的索引。</td>
<td align="left">字符串</td>
<td align="left">该标签&#x3D;&#x3D;不可缺省&#x3D;&#x3D;。</td>
</tr>
<tr>
<td align="left">label</td>
<td align="left">标识<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-component-configuration-stage-V5">应用的名称</a>，取值为字符串资源的索引，字符串长度不超过63字节。</td>
<td align="left">字符串</td>
<td align="left">该标签&#x3D;&#x3D;不可缺省&#x3D;&#x3D;。</td>
</tr>
<tr>
<td align="left">description</td>
<td align="left">标识应用的描述信息。取值为长度不超过255字节的字符串，内容为描述信息的字符串资源索引。</td>
<td align="left">字符串</td>
<td align="left">该标签可缺省，缺省值为空。</td>
</tr>
<tr>
<td align="left">vendor</td>
<td align="left">标识对应用开发厂商的描述，取值为长度不超过255字节的字符串。</td>
<td align="left">字符串</td>
<td align="left">该标签可缺省，缺省值为空。</td>
</tr>
<tr>
<td align="left">versionCode</td>
<td align="left">标识应用的版本号，取值为小于2^31次方的<strong>正整数</strong>。此数字仅用于确定某个版本是否比另一个版本更新，数值越大表示版本越高。<br>开发者可以将该值设置为任何正整数，但是必须确保应用的新版本都使用比旧版本更大的值。</td>
<td align="left">数值</td>
<td align="left">该标签&#x3D;&#x3D;不可缺省&#x3D;&#x3D;。</td>
</tr>
<tr>
<td align="left">versionName</td>
<td align="left">标识向用户<strong>展示</strong>的应用版本号。<br>取值为长度不超过127字节的字符串，仅由<strong>数字和点</strong>构成，推荐采用“A.B.C.D”四段式的形式。四段式推荐的含义如下所示。<br>第一段：主版本号&#x2F;Major，范围0<del>99，重大修改的版本，如实现新的大功能或重大变化。<br>第二段：次版本号&#x2F;Minor，范围0</del>99，表示实现较突出的特点，如新功能添加或大问题修复。<br>第三段：特性版本号&#x2F;Feature，范围0<del>99，标识规划的新版本特性。<br>第四段：修订版本号&#x2F;Patch，范围0</del>999，表示维护版本，如修复bug。</td>
<td align="left">字符串</td>
<td align="left">该标签&#x3D;&#x3D;不可缺省&#x3D;&#x3D;。</td>
</tr>
<tr>
<td align="left">minCompatibleVersionCode</td>
<td align="left">标识应用能够兼容的最低历史版本号，用于应用跨设备兼容性判断。取值范围为0~2147483647。</td>
<td align="left">数值</td>
<td align="left">该标签可缺省，缺省值等于versionCode标签值。</td>
</tr>
<tr>
<td align="left">minAPIVersion</td>
<td align="left">标识应用运行需要的SDK的API最小版本。取值范围为0~2147483647。</td>
<td align="left">数值</td>
<td align="left">应用编译构建时由build-profile.json5中的compatibleSdkVersion自动生成。</td>
</tr>
<tr>
<td align="left">targetAPIVersion</td>
<td align="left">标识应用运行需要的API目标版本。取值范围为0~2147483647。</td>
<td align="left">数值</td>
<td align="left">应用编译构建时由build-profile.json5中的compileSdkVersion自动生成。</td>
</tr>
<tr>
<td align="left">apiReleaseType</td>
<td align="left">标识应用运行需要的API目标版本的类型，采用字符串类型表示。取值为“CanaryN”、“BetaN”或者“Release”，其中，N代表大于零的整数。<br>- Canary：受限发布的版本。<br>- Beta：公开发布的Beta版本。<br>- Release：公开发布的正式版本。</td>
<td align="left">字符串</td>
<td align="left">应用编译构建时根据当前使用的SDK的Stage自动生成。即便手动配置了取值，编译构建时也会被覆盖。</td>
</tr>
<tr>
<td align="left">accessible</td>
<td align="left">标识应用是否能访问应用的安装目录，仅针对Stage模型的系统应用和预置应用生效。</td>
<td align="left">布尔值</td>
<td align="left">该标签可缺省，缺省值为false。</td>
</tr>
<tr>
<td align="left">multiProjects</td>
<td align="left">标识当前工程是否支持多个工程的联合开发。<br>- true：当前工程支持多个工程的联合开发。多工程开发可参考<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-hvigor-multi-projects-0000001819424365-V5">多工程构建</a>。<br>- false：当前工程不支持多个工程的联合开发。</td>
<td align="left">布尔值</td>
<td align="left">该标签可缺省，缺省值为false。</td>
</tr>
<tr>
<td align="left">asanEnabled</td>
<td align="left">标识应用程序是否开启asan检测，用于辅助定位buffer越界造成的crash问题。<br>- true：当前工程开启asan检测。<br>- false：当前工程不开启asan检测。</td>
<td align="left">布尔值</td>
<td align="left">该标签可缺省，缺省值为false。</td>
</tr>
<tr>
<td align="left">tablet</td>
<td align="left">标识对tablet设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion。<br>如果使用该属性对tablet设备做了特殊配置，则应用在tablet设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td>
<td align="left">对象</td>
<td align="left">该标签可缺省，缺省时tablet设备使用app.json5公共区域配置的属性值。</td>
</tr>
<tr>
<td align="left">tv</td>
<td align="left">标识对tv设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion。<br>如果使用该属性对tv设备做了特殊配置，则应用在tv设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td>
<td align="left">对象</td>
<td align="left">该标签可缺省，缺省时tv设备使用app.json5公共区域配置的属性值。</td>
</tr>
<tr>
<td align="left">wearable</td>
<td align="left">标识对wearable设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion。<br>如果使用该属性对wearable设备做了特殊配置，则应用在wearable设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td>
<td align="left">对象</td>
<td align="left">该标签可缺省，缺省时wearable设备使用app.json5公共区域配置的属性值。</td>
</tr>
<tr>
<td align="left">car</td>
<td align="left">标识对car设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion。<br>如果使用该属性对car设备做了特殊配置，则应用在car设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td>
<td align="left">对象</td>
<td align="left">该标签可缺省，缺省时car设备使用app.json5公共区域配置的属性值。</td>
</tr>
<tr>
<td align="left">default</td>
<td align="left">标识对default设备做的特殊配置，可以配置的属性字段有上文提到的：minAPIVersion。<br>如果使用该属性对default设备做了特殊配置，则应用在default设备中会采用此处配置的属性值，并忽略在app.json5公共区域配置的属性值。</td>
<td align="left">对象</td>
<td align="left">该标签可缺省，缺省时default设备使用app.json5公共区域配置的属性值。</td>
</tr>
<tr>
<td align="left">targetBundleName</td>
<td align="left">标识当前包所指定的目标应用, 标签值的取值规则和范围与bundleName标签一致。配置该字段的应用为具有overlay特征的应用。</td>
<td align="left">字符串</td>
<td align="left">该标签可缺省，缺省值为空。</td>
</tr>
<tr>
<td align="left">targetPriority</td>
<td align="left">标识当前应用的优先级，取值范围为1~100。配置targetBundleName字段之后，才支持配置该字段。</td>
<td align="left">数值</td>
<td align="left">该标签可缺省, 缺省值为1。</td>
</tr>
<tr>
<td align="left">generateBuildHash</td>
<td align="left">标识当前应用的所有HAP和HSP是否由打包工具生成哈希值。<br>该字段配置为true时，该应用下的所有HAP和HSP都会由打包工具生成对应的哈希值。系统OTA升级时，若应用的versionCode保持不变，可根据哈希值判断应用是否需要升级。<br><strong>说明：</strong><br>该字段仅对<strong>预置应用生效</strong>。</td>
<td align="left">布尔值</td>
<td align="left">该标签可缺省, 缺省值为false。</td>
</tr>
<tr>
<td align="left">GWPAsanEnabled</td>
<td align="left">标识应用程序是否开启GWP-asan堆内存检测工具，用于对内存越界、内存释放后使用等内存破坏问题进行分析。<br>- true：当前工程开启GWP-asan检测。<br>- false：当前工程不开启GWP-asan检测。</td>
<td align="left">布尔值</td>
<td align="left">该标签可缺省, 缺省值为false。</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-configuration-file-V5#appenvironments%E6%A0%87%E7%AD%BE">appEnvironments</a></td>
<td align="left">标识当前模块配置的应用环境变量。</td>
<td align="left">对象数组</td>
<td align="left">该标签可缺省，缺省值为空。</td>
</tr>
<tr>
<td align="left">maxChildProcess</td>
<td align="left">标识当前应用自身可创建的子进程的最大个数，取值范围为0到512，0表示不限制，当应用有多个模块时，以entry模块的配置为准。</td>
<td align="left">数值</td>
<td align="left">该标签可缺省，缺省时使用系统配置的默认值。</td>
</tr>
</tbody></table>
<h5 id="appEnvironments标签"><a href="#appEnvironments标签" class="headerlink" title="appEnvironments标签"></a>appEnvironments标签</h5><p>此标签标识应用配置的环境变量。</p>
<p><strong>表1</strong> appEnvironments标签说明</p>
<table>
<thead>
<tr>
<th align="left">属性名称</th>
<th align="left">含义</th>
<th align="left">数据类型</th>
<th align="left">是否可缺省</th>
</tr>
</thead>
<tbody><tr>
<td align="left">name</td>
<td align="left">标识环境变量的变量名称。取值为长度不超过4096字节的字符串。</td>
<td align="left">字符串</td>
<td align="left">该标签可缺省，缺省值为空。</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">标识环境变量的值。取值为长度不超过4096字节的字符串。</td>
<td align="left">字符串</td>
<td align="left">该标签可缺省，缺省值为空。</td>
</tr>
</tbody></table>
<p>appEnvironments标签示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;app&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;appEnvironments&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>:<span class="string">&quot;name1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value1&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="module-json5配置文件"><a href="#module-json5配置文件" class="headerlink" title="module.json5配置文件"></a><a href="%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6module.json5.md">module.json5配置文件</a></h4><h3 id="应用配置文件（FA模型）"><a href="#应用配置文件（FA模型）" class="headerlink" title="应用配置文件（FA模型）"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/_u914d_u7f6e_u6587_u4ef6_uff08fa_u6a21_u578b_uff09-V5">应用配置文件（FA模型）</a></h3><h4 id="应用配置文件概述（FA模型）"><a href="#应用配置文件概述（FA模型）" class="headerlink" title="应用配置文件概述（FA模型）"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/application-configuration-file-overview-fa-V5">应用配置文件概述（FA模型）</a></h4><h4 id="app对象内部结构"><a href="#app对象内部结构" class="headerlink" title="app对象内部结构"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/app-structure-V5">app对象内部结构</a></h4><h4 id="deviceConfig内部结构"><a href="#deviceConfig内部结构" class="headerlink" title="deviceConfig内部结构"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/deviceconfig-structure-V5">deviceConfig内部结构</a></h4><h4 id="module对象内部结构"><a href="#module对象内部结构" class="headerlink" title="module对象内部结构"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/module-structure-V5">module对象内部结构</a></h4><h2 id="资源分类与访问"><a href="#资源分类与访问" class="headerlink" title="资源分类与访问"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/resource-categories-and-access-V5">资源分类与访问</a></h2><h2 id="学习ArkTS语言"><a href="#学习ArkTS语言" class="headerlink" title="学习ArkTS语言"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/1_4_u5b66_u4e60arkts_u8bed_u8a00-V5">学习ArkTS语言</a></h2><h3 id="初识ArkTS语言"><a href="#初识ArkTS语言" class="headerlink" title="初识ArkTS语言"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-get-started-V5">初识ArkTS语言</a></h3><p>ArkTS是HarmonyOS优选的主力应用开发语言。ArkTS围绕应用开发在<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/">TypeScript</a>（简称TS）生态基础上做了进一步扩展，保持了TS的基本风格，同时通过规范定义强化<strong>开发期静态检查和分析</strong>，提升程序执行稳定性和性能。<br>从API version 10开始，ArkTS进一步通过规范强化静态检查和分析，对比标准TS的差异可以参考<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/typescript-to-arkts-migration-guide-V5">从TypeScript到ArkTS的适配规则</a>：</p>
<ul>
<li>强制使用<strong>静态类型</strong>：静态类型是ArkTS最重要的特性之一。如果使用静态类型，那么程序中变量的类型就是确定的。同时，由于所有类型在程序实际运行前都是已知的，编译器可以验证代码的正确性，从而减少运行时的类型检查，有助于性能提升。</li>
<li>&#x3D;&#x3D;禁止在运行时改变对象布局&#x3D;&#x3D;：为实现最大性能，ArkTS要求在程序执行期间不能更改对象布局。</li>
<li>限制运算符语义：为获得更好的性能并鼓励开发者编写更清晰的代码，ArkTS限制了一些运算符的语义。比如，<strong>一元加法运算符只能作用于数字</strong>，不能用于其他类型的变量。</li>
<li>不支持Structural typing：对Structural typing的支持需要在语言、编译器和运行时进行大量的考虑和仔细的实现，当前ArkTS不支持该特性。根据实际场景的需求和反馈，我们后续会重新考虑。</li>
</ul>
<p>当前，在UI开发框架中，ArkTS主要扩展了如下能力：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-basic-syntax-overview-V5">基本语法</a>：ArkTS定义了声明式UI描述、自定义组件和动态扩展UI元素的能力，再配合ArkUI开发框架中的系统组件及其相关的事件方法、属性方法等共同构成了UI开发的主体。</li>
<li><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-state-management-overview-V5">状态管理</a>：ArkTS提供了多维度的状态管理机制。在UI开发框架中，与UI相关联的数据可以在组件内使用，也可以在不同组件层级间传递，比如父子组件之间、爷孙组件之间，还可以在应用全局范围内传递或跨设备传递。另外，从数据的传递形式来看，可分为只读的单向传递和可变更的双向传递。开发者可以灵活地利用这些能力来实现数据和UI的联动。</li>
<li><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-rendering-control-overview-V5">渲染控制</a>：ArkTS提供了渲染控制的能力。条件渲染可根据应用的不同状态，渲染对应状态下的UI内容。循环渲染可从数据源中迭代获取数据，并在每次迭代过程中创建相应的组件。数据懒加载从数据源中按需迭代数据，并在每次迭代过程中创建相应的组件。</li>
</ul>
<p>ArkTS兼容<code>TS/JavaScript</code>(简称JS)生态，开发者可以使用TS&#x2F;JS进行开发或复用已有代码。HarmonyOS系统对TS&#x2F;JS支持的详细情况参见<a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-migration-background-V5#%E5%85%BC%E5%AE%B9tsjs%E7%9A%84%E7%BA%A6%E6%9D%9F">兼容TS&#x2F;JS的约束</a>。<br>未来，ArkTS会结合应用开发&#x2F;运行的需求持续演进，逐步提供并行和并发能力增强、系统类型增强、分布式开发范式等更多特性。  </p>
<h4 id="ArkTS语言介绍"><a href="#ArkTS语言介绍" class="headerlink" title="ArkTS语言介绍"></a><a href="ArkTS%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D.md">ArkTS语言介绍</a></h4><p>通过<strong>取消动态类型特性</strong>，ArkTS代码能更有效地被运行前编译和优化，从而实现更快的应用启动和更低的功耗。  </p>
<h4 id="方舟字节码基本原理"><a href="#方舟字节码基本原理" class="headerlink" title="方舟字节码基本原理"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-bytecode-fundamentals-V5">方舟字节码基本原理</a></h4><p>方舟字节码中，除寄存器和累加器之外，还存在<strong>全局变量</strong>、<strong>模块（<a target="_blank" rel="noopener" href="https://262.ecma-international.org/12.0/#sec-ecmascript-language-scripts-and-modules">module</a>）命名空间和模块变量</strong>、<strong>词法环境和词法变量</strong>、<strong>补丁变量</strong>4种值存储方式。指令可以使用这4种储值位置中的值作为入参。  </p>
<h4 id="方舟字节码文件格式"><a href="#方舟字节码文件格式" class="headerlink" title="方舟字节码文件格式"></a><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-bytecode-file-format-V5">方舟字节码文件格式</a></h4><h2 id="ArkWeb"><a href="#ArkWeb" class="headerlink" title="ArkWeb"></a>ArkWeb</h2><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/training/course/slightMooc/C101717497640610394">https://developer.huawei.com/consumer/cn/training/course/slightMooc/C101717497640610394</a></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xxx.ets</span></span><br><span class="line"><span class="keyword">import</span> &#123; webview &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkWeb&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">WebComponent</span> &#123;</span><br><span class="line">  <span class="attr">controller</span>: webview.<span class="property">WebviewController</span> = <span class="keyword">new</span> webview.<span class="title class_">WebviewController</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;loadUrl&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 点击按钮时，通过loadUrl，跳转到www.example1.com【就是加载了新的url页面】</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">controller</span>.<span class="title function_">loadUrl</span>(<span class="string">&#x27;www.example1.com&#x27;</span>);</span><br><span class="line">            <span class="comment">// 点击按钮时，通过loadData，加载HTML格式的文本数据</span></span><br><span class="line">            <span class="comment">//this.controller.loadData(&quot;&lt;html&gt;&lt;body bgcolor=\&quot;white\&quot;&gt;Source:&lt;pre&gt;source&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;&quot;,&quot;text/html&quot;,&quot;UTF-8&quot;);</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">e</span>: <span class="title class_">BusinessError</span> = error <span class="keyword">as</span> <span class="title class_">BusinessError</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`ErrorCode: <span class="subst">$&#123;e.code&#125;</span>,  Message: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="comment">// 组件创建时，加载www.example.com</span></span><br><span class="line">      <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: <span class="string">&#x27;www.example.com&#x27;</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span>&#125;)</span><br><span class="line">      <span class="comment">//Web(&#123;</span></span><br><span class="line">		<span class="comment">//		src:this.articleDetail.webUrl, //修改Web组件的src属性</span></span><br><span class="line">		<span class="comment">//		//src:$rawfile(&#x27;sourse_learning/index.html&#x27;), //加载本地Web资源</span></span><br><span class="line">		<span class="comment">//		controller:this.webviewController</span></span><br><span class="line">	  <span class="comment">//&#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他对WebView的配置  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Web</span>(&#123;<span class="attr">src</span>: <span class="variable language_">this</span>.<span class="property">VrImage</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span>&#125;)</span><br><span class="line">	.<span class="title function_">blockNetwork</span>(<span class="variable language_">this</span>.<span class="property">block</span>)<span class="comment">//拦截网络请求，在请求被发起之前进行处理，允许开发者自定义请求的执行逻辑。【1. **避免请求**: 可以使用这个功能来完全阻止某些特定的网络请求，比如为了解决特定的安全问题或者在开发和测试阶段禁用某些外部 API 调用。2. **修改请求**: 允许开发者修改即将发出的网络请求，例如为请求添加自定义头部信息或修改请求参数。3. **条件控制**: 可以根据某些条件（例如用户的网络状态、设备类型等）决定是否允许特定的请求执行。】</span></span><br><span class="line">	.<span class="title function_">javaScriptAccess</span>(<span class="literal">true</span>)  </span><br><span class="line">	.<span class="title function_">darkMode</span>(<span class="title class_">WebDarkMode</span>.<span class="property">Auto</span>)<span class="comment">//深色模式设置  WebDarkMode.Auto表示开启深色模式，并且深色模式跟随系统  </span></span><br><span class="line">	.<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)<span class="comment">//白色  </span></span><br><span class="line">	.<span class="title function_">zoomAccess</span>(<span class="literal">true</span>)<span class="comment">//设置可以支持缩放  </span></span><br><span class="line">	.<span class="title function_">databaseAccess</span>(<span class="literal">true</span>)<span class="comment">//设置是否开启数据库存储A  </span></span><br><span class="line">	.<span class="title function_">geolocationAccess</span>(<span class="literal">true</span>)<span class="comment">//启用地理位置  </span></span><br><span class="line">	<span class="comment">// .textZoomRatio(100)//设置页面的文本缩放百分比，默认为100%。  </span></span><br><span class="line">	.<span class="title function_">cacheMode</span>(<span class="title class_">CacheMode</span>.<span class="property">Default</span>)<span class="comment">//默认  </span></span><br><span class="line">	.<span class="title function_">fileAccess</span>(<span class="literal">true</span>)<span class="comment">//设置是否开启应用中文件系统的访问，默认启用。  </span></span><br><span class="line">	.<span class="title function_">mixedMode</span>(<span class="title class_">MixedMode</span>.<span class="property">All</span>)<span class="comment">//设置是否允许加载超文本传输协议（HTTP）和超文本传输安全协议（HTTPS）混合内容，默认不允许加载HTTP和HTTPS混合内容。  </span></span><br><span class="line">	.<span class="title function_">domStorageAccess</span>(<span class="literal">true</span>)  </span><br><span class="line">	.<span class="title function_">allowWindowOpenMethod</span>(<span class="literal">true</span>)<span class="comment">//网页是否可以通过JavaScript自动打开窗口。</span></span><br></pre></td></tr></table></figure>



<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-app-architecture-overview-V5">架构</a></p>
<ul>
<li><input checked disabled type="checkbox"> <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-layered-architecture-design-V5">分层架构设计</a>：将应用划分为产品定制层、基础特性层和共功能力层，可以降低层间的依赖性，提高可维护性。进一步明确每层的职责和层间的交互机制，为开发者呈现一个清晰且结构化的开发框架。</li>
<li><input disabled type="checkbox"> <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-modular-design-V5">模块化设计</a>：将应用分解为多个功能模块，每个模块负责执行特定的功能。提高代码的可理解性和可复用性，使应用的扩展和维护变得更为简便，也降低了系统各部分之间的耦合度。</li>
<li><input disabled type="checkbox"> <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-application-navigation-design-V5">应用导航设计</a>：将应用划分为多功能模块 后，通过Navigation导航设计，完成业务模块之间的解耦，实现不同业务模块之间的页面跳转交互。</li>
<li><input disabled type="checkbox"> 其他文章：</li>
</ul>
<ol>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7352891079295303715?from=search-suggest">探索鸿蒙：HAP&#x2F;HAR&#x2F;HSP，你用对了吗在软件开发的各个领域，都少不了共享库的存在， Java 中的 JAR ，An - 掘金</a>  </li>
<li><a target="_blank" rel="noopener" href="https://gitee.com/harmonyos_samples/hmosworld">HMOSWorld: 基于分层架构和模块化设计的最佳实践，结合HarmonyOS”一次开发，多端部署”的能力，实现一款承载HarmonyOS最新技术特性，向HarmonyOS开发者赋能的示例应用。</a></li>
</ol>
<!-- flag of hidden posts -->
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/private/" rel="tag"># private</a>
          
        </div>
      

      
      
      

      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">95</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8"><span class="nav-text">基础入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ArkTS%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%EF%BC%88Stage%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="nav-text">ArkTS工程目录结构（Stage模型）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text">开发基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text">应用程序包基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E6%A6%82%E8%BF%B0-Module%E7%B1%BB%E5%9E%8B"><span class="nav-text">应用程序包概述-Module类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%BB%93%E6%9E%84-Stage%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%BB%93%E6%9E%84"><span class="nav-text">应用程序包结构-Stage模型应用程序包结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%80%81%E5%8C%85%E7%BB%93%E6%9E%84"><span class="nav-text">开发态包结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E6%80%81%E5%8C%85%E7%BB%93%E6%9E%84"><span class="nav-text">编译态包结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E6%80%81%E5%8C%85%E7%BB%93%E6%9E%84"><span class="nav-text">发布态包结构</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%8C%85%E7%B1%BB%E5%9E%8B"><span class="nav-text">选择合适的包类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%BB%93%E6%9E%84-FA%E6%A8%A1%E5%9E%8B%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%BB%93%E6%9E%84"><span class="nav-text">应用程序包结构-FA模型应用程序包结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8-HAP"><span class="nav-text">应用程序包开发与使用-HAP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">使用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%A6%E6%9D%9F%E9%99%90%E5%88%B6"><span class="nav-text">约束限制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA"><span class="nav-text">创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%80%E5%8F%91"><span class="nav-text">开发</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B0%83%E8%AF%95"><span class="nav-text">调试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8-HAR"><span class="nav-text">应用程序包开发与使用-HAR</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="nav-text">使用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%A6%E6%9D%9F%E9%99%90%E5%88%B6-1"><span class="nav-text">约束限制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-1"><span class="nav-text">创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%80%E5%8F%91-1"><span class="nav-text">开发</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAArkUI%E7%BB%84%E4%BB%B6"><span class="nav-text">导出ArkUI组件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAts%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95"><span class="nav-text">导出ts类和方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAnative%E6%96%B9%E6%B3%95"><span class="nav-text">导出native方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B5%84%E6%BA%90"><span class="nav-text">资源</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BC%95%E7%94%A8HAR%E7%9A%84ArkUI%E7%BB%84%E4%BB%B6"><span class="nav-text">引用HAR的ArkUI组件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BC%95%E7%94%A8HAR%E7%9A%84ts%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95"><span class="nav-text">引用HAR的ts类和方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BC%95%E7%94%A8HAR%E7%9A%84native%E6%96%B9%E6%B3%95"><span class="nav-text">引用HAR的native方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BC%95%E7%94%A8HAR%E7%9A%84%E8%B5%84%E6%BA%90"><span class="nav-text">引用HAR的资源</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-text">编译</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E7%94%9F%E6%88%90TS%E6%96%87%E4%BB%B6"><span class="nav-text">编译生成TS文件</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%91%E5%B8%83"><span class="nav-text">发布</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8-HSP"><span class="nav-text">应用程序包开发与使用-HSP</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="nav-text">使用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%A6%E6%9D%9F%E9%99%90%E5%88%B6-2"><span class="nav-text">约束限制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-2"><span class="nav-text">创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%80%E5%8F%91-2"><span class="nav-text">开发</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAArkUI%E7%BB%84%E4%BB%B6-1"><span class="nav-text">导出ArkUI组件</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAts%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95-1"><span class="nav-text">导出ts类和方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAnative%E6%96%B9%E6%B3%95-1"><span class="nav-text">导出native方法</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-r%E8%AE%BF%E9%97%AEHSP%E4%B8%AD%E7%9A%84%E8%B5%84%E6%BA%90"><span class="nav-text">通过$r访问HSP中的资源</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAHSP%E4%B8%AD%E7%9A%84%E8%B5%84%E6%BA%90"><span class="nav-text">导出HSP中的资源</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%BC%95%E7%94%A8HSP%E4%B8%AD%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="nav-text">引用HSP中的接口</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC"><span class="nav-text">页面路由跳转</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1%E8%BF%94%E5%9B%9E"><span class="nav-text">页面路由返回</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E6%80%81HSP"><span class="nav-text">集成态HSP</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEHSP%E6%A8%A1%E5%9D%97%E4%B8%BA%E9%9B%86%E6%88%90%E6%80%81HSP"><span class="nav-text">配置HSP模块为集成态HSP</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%B7%A5%E7%A8%8B%E4%BD%BF%E7%94%A8%E6%A0%87%E5%87%86%E5%8C%96%E7%9A%84OHMUrl%E6%A0%BC%E5%BC%8F"><span class="nav-text">配置工程使用标准化的OHMUrl格式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8-%E5%8A%A8%E6%80%81import"><span class="nav-text">应用程序包开发与使用-动态import</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="nav-text">技术适用场景介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E6%89%A9%E5%B1%95%E5%9C%BA%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="nav-text">业务扩展场景介绍</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E5%AE%89%E8%A3%85%E5%8D%B8%E8%BD%BD%E4%B8%8E%E6%9B%B4%E6%96%B0"><span class="nav-text">应用程序包安装卸载与更新</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%9A%84%E5%AE%89%E8%A3%85%E5%8D%B8%E8%BD%BD"><span class="nav-text">应用程序包的安装卸载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8C%85%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="nav-text">应用程序包的更新</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88Stage%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="nav-text">应用配置文件（Stage模型）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A6%82%E8%BF%B0%EF%BC%88Stage%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="nav-text">应用配置文件概述（Stage模型）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-json5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">app.json5配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="nav-text">配置文件示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%87%E7%AD%BE"><span class="nav-text">配置文件标签</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#appEnvironments%E6%A0%87%E7%AD%BE"><span class="nav-text">appEnvironments标签</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#module-json5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">module.json5配置文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88FA%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="nav-text">应用配置文件（FA模型）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A6%82%E8%BF%B0%EF%BC%88FA%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="nav-text">应用配置文件概述（FA模型）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="nav-text">app对象内部结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#deviceConfig%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="nav-text">deviceConfig内部结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#module%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84"><span class="nav-text">module对象内部结构</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%88%86%E7%B1%BB%E4%B8%8E%E8%AE%BF%E9%97%AE"><span class="nav-text">资源分类与访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0ArkTS%E8%AF%AD%E8%A8%80"><span class="nav-text">学习ArkTS语言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E8%AF%86ArkTS%E8%AF%AD%E8%A8%80"><span class="nav-text">初识ArkTS语言</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ArkTS%E8%AF%AD%E8%A8%80%E4%BB%8B%E7%BB%8D"><span class="nav-text">ArkTS语言介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E8%88%9F%E5%AD%97%E8%8A%82%E7%A0%81%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="nav-text">方舟字节码基本原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E8%88%9F%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="nav-text">方舟字节码文件格式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ArkWeb"><span class="nav-text">ArkWeb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84"><span class="nav-text">架构</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>