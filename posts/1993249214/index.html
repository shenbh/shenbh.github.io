<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="安卓第三方," />










<meta name="description" content="dagger2相关dagger2笔记：是个依赖注入框架。Dagger2是第一个用生成的代码实现完整堆栈的。指导原则是生成代码，模仿用户可能已经手写的代码，以确保依赖注入尽可能简单、可跟踪和高性能。">
<meta property="og:type" content="article">
<meta property="og:title" content="第三方-Dagger2">
<meta property="og:url" content="http://shenbh.github.io/posts/1993249214/index.html">
<meta property="og:site_name" content="AB">
<meta property="og:description" content="dagger2相关dagger2笔记：是个依赖注入框架。Dagger2是第一个用生成的代码实现完整堆栈的。指导原则是生成代码，模仿用户可能已经手写的代码，以确保依赖注入尽可能简单、可跟踪和高性能。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-12-25T01:45:54.000Z">
<meta property="article:modified_time" content="2022-12-27T02:19:01.541Z">
<meta property="article:author" content="阿炳">
<meta property="article:tag" content="安卓第三方">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/1993249214/"/>





  <title>第三方-Dagger2 | AB</title>
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AB</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Just do IT Now.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/1993249214/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AB">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">第三方-Dagger2</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-25T09:45:54+08:00">
                2019-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="dagger2相关"><a href="#dagger2相关" class="headerlink" title="dagger2相关"></a>dagger2相关</h1><h2 id="dagger2笔记："><a href="#dagger2笔记：" class="headerlink" title="dagger2笔记："></a>dagger2笔记：</h2><p>是个依赖注入框架。Dagger2是第一个用生成的代码实现完整堆栈的。指导原则是生成代码，模仿用户可能已经手写的代码，以确保依赖注入尽可能简单、可跟踪和高性能。</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/82ba5a292572">例子（MVP）：</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title class_">MainContract</span>.View &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    MainPresenter mainPresenter;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        DaggerMainComponent.builder()</span><br><span class="line">                .mainModule(<span class="keyword">new</span> <span class="title class_">MainModule</span>(<span class="built_in">this</span>))</span><br><span class="line">                .build()</span><br><span class="line">                .inject(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//调用Presenter方法加载数据</span></span><br><span class="line">        mainPresenter.loadData();</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainPresenter</span> &#123;</span><br><span class="line">    <span class="comment">//MainContract是个接口，View是他的内部接口，这里看做View接口即可</span></span><br><span class="line">    <span class="keyword">private</span> MainContract.View mView;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    MainPresenter(MainContract.View view) &#123;</span><br><span class="line">        mView = view;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//调用model层方法，加载数据</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="comment">//回调方法成功时</span></span><br><span class="line">        mView.updateUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Module</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainModule</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> MainContract.View mView;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">MainModule</span><span class="params">(MainContract.View view)</span> &#123;</span><br><span class="line">            mView = view;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Provides</span></span><br><span class="line">        MainView <span class="title function_">provideMainView</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Component(modules = MainModule.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainComponent</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity activity)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>说明：<br><code>@Module</code> 内<code>@privides</code> 提供 –&gt;提供给没有构造函数的类的依赖，这些类无法用<code>@Inject</code>标注（比如第三方库、系统类、以及<code>MVP</code>中<code>Contract</code>接口）<br>桥梁：<code>@Component</code> 接口（或抽象）类上，说明<code>modules</code>有哪些<br>用<code>@Inject</code>声明的类成员属性不能用<code>private</code>修饰（<code>MainActivity</code>中<code>MainPresenter</code>类对象用<code>@Inject</code>修饰）<br>某个类被<code>@Inject</code>标记时会自动到它的构造方法中，如果这个构造方法也被<code>@Inject</code>标记的话，就会自动初始化这个类，从而完成依赖注入。（当然他们之间需要个<code>@Component</code>当桥梁产生联系）<br>一个<code>Component</code>类可以包含多个<code>Module</code>类，用来提供依赖</p>
</blockquote>
<h3 id="注入过程："><a href="#注入过程：" class="headerlink" title="注入过程："></a>注入过程：</h3><p>首先<code>MainActivity</code>需要依赖<code>MainPresenter</code>，因此，我们在里面用<code>@Injec</code>t对<code>MainPresenter</code>进行标注，表明这是要注入的类。然后，我们对<code>MainPresenter</code>的构造函数也添加注解<code>@Inject</code>，此时构造函数里有一个参数<code>MainContract.View</code>，因为<code>MainPresenter</code>需要依赖<code>MainContract.View</code>，所以我们定义了一个类，叫做<code>MainModule</code>，提供一个方法<code>provideMainView</code>，用来提供这个依赖，这个<code>MainView</code>是通过<code>MainModule</code>的构造函数注入进来的，接着我们需要定义<code>Component</code>接口类，并将<code>Module</code>包含进来，即</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(modules = MainModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainComponent</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity activity)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时里面声明了一个<code>inject</code>方法，方法参数为<code>ManActivity</code>，用来获取<code>MainActivity</code>实例，以初始化在里面声明的<code>MainPresenter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DaggerMainComponent.builder()</span><br><span class="line">         .mainModule(<span class="keyword">new</span> <span class="title class_">MainModule</span>(<span class="built_in">this</span>))</span><br><span class="line">         .build()</span><br><span class="line">         .inject(<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@Inject</code> 带有此注解的属性或构造方法将<strong>参与到依赖注入中</strong>，<code>Dagger2</code>会实例化有此注解的类</li>
<li><code>@Module</code> 带有此注解的类，用来<strong>提供依赖</strong>，里面定义一些用<code>@Provides</code>注解的以<code>provide</code>开头的方法，这些方法就是所提供的依赖，<code>Dagger2</code>会在该类中寻找实例化某个类所需要的依赖。</li>
<li><code>@Component</code>用来将<code>@Inject</code>和<code>@Module</code>联系起来的<strong>桥梁</strong>，从<code>@Module</code>中获取依赖并将依赖注入给<code>@Inject</code></li>
</ul>
<h2 id="Dagger2注入原理"><a href="#Dagger2注入原理" class="headerlink" title="Dagger2注入原理"></a>Dagger2注入原理</h2><p>通过<code>apt</code>插件在<strong>编译阶段</strong>生成相应的注入代码</p>
<p><code>MainPresenter</code>实例化过程，<code>MainPresenter</code>会有一个工厂类，在这个类的<code>get()</code>中进行<code>MainPresenter</code>创建，而<code>MainPresenter</code>所需要的<code>View</code>依赖，是由<code>MainModule</code>里定义的以<code>provide</code>开头方法所对应的工厂类提供的。</p>
<h2 id="Dagger2基础知识及在Java中使用（1）"><a href="#Dagger2基础知识及在Java中使用（1）" class="headerlink" title="Dagger2基础知识及在Java中使用（1）"></a><a target="_blank" rel="noopener" href="https://juejin.im/post/5d6f3e47f265da03aa258c72">Dagger2基础知识及在Java中使用（1）</a></h2><blockquote>
<p>比喻：<br><code>@Component</code>：相当于个注射器（是接口）；<br><code>@Module</code>相当于注射液，就是数据源（是类或抽象类）；<br>要把注射液放入指定哪个注射器如：<code>@Component(modules=...)</code>；<br><code>@Inject</code>相当于标注被注射体。</p>
</blockquote>
<h3 id="首先添加依赖"><a href="#首先添加依赖" class="headerlink" title="首先添加依赖"></a>首先添加依赖</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger:2.24&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&quot;com.google.dagger:dagger-compiler:2.24&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-Inject-amp-Component可以简单实现依赖注入（不带-Module）"><a href="#1-Inject-amp-Component可以简单实现依赖注入（不带-Module）" class="headerlink" title="1. @Inject &amp; @Component可以简单实现依赖注入（不带@Module）"></a>1. <code>@Inject</code> &amp; <code>@Component</code>可以简单实现依赖注入（不带@Module）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//无参构造函数的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义我们的Component</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AstudyActivityComponent</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">injectTo</span><span class="params">(AstudyActivity astudyActivity)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，点下<strong>AS》build》Make Project</strong>，让apt帮我们生成代码。一般生成代码为Dagger+你定义Component类名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在我们的Activity中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AstudyActivity</span> <span class="keyword">extends</span> <span class="title class_">BaseActivity</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Person person;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//这里是我封装的onCreate,省略部分代码，只为理解，之后都请忽略！</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processLogic</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//第一种</span></span><br><span class="line">        DaggerAstudyActivityComponent.create().injectTo(<span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//第二种（使用module传值时一定是用这个）</span></span><br><span class="line">        <span class="comment">//DaggerAstudyActivityComponent.builder().build().injectTo(this);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-带-Module的使用"><a href="#2-带-Module的使用" class="headerlink" title="2. 带@Module的使用"></a>2. 带@Module的使用</h3><h3 id="无参构造函数的情况"><a href="#无参构造函数的情况" class="headerlink" title="无参构造函数的情况"></a>无参构造函数的情况</h3><p>假设Human类是第三方类库，里面没有<code>@Inject</code>，那么我们使用<code>@Module</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//假设这个类是第三方类库中的，里面没有@Inject</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Human</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Human</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义我们的数据源Module</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BstudyActivityModule</span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    Human <span class="title function_">humanProvides</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Human</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义我们的Component。带上了参数</span></span><br><span class="line"><span class="meta">@Component(modules = BstudyActivityModule.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BstudyActivityModuleComponent</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">injectTo</span><span class="params">(BstudyActivity bstudyActivity)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<ol>
<li>改不了的第三方库等类对象要注入到指定位置则需要用到 <code>@Module</code>+<code>@Component</code>+<code>@Inject</code>。而且**<code>@Module</code>标记的对象的优先级比<code>@Inject</code>标记的高**</li>
<li>通过<code>Module</code>传参</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CstudyModule</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> money;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CstudyModule</span><span class="params">(<span class="type">int</span> money)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    Soul <span class="title function_">providesSoul</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Soul</span> <span class="variable">soul</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Soul</span>();</span><br><span class="line">        soul.setMoney(<span class="built_in">this</span>.money);</span><br><span class="line">        <span class="keyword">return</span> soul;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    Woman <span class="title function_">providesWoman</span><span class="params">(Soul soul)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Woman</span>(soul);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>providesWoman</code>用<code>@Provides</code>标注，它会先去找<code>Soul</code>的初始化，先通过<code>@Provides</code>找<code>Soul</code>，找到了<code>providesSoul</code>。假如此时没有<code>providesSoul</code>，则会去<code>Soul</code>类中找有没有被<code>@Inject</code>标记的构造方法，如果还没有，那么报错。</p>
</blockquote>
<p><strong>注意：</strong></p>
<ul>
<li>在<code>Module</code>的构造函数<strong>带有参数且参数被使用</strong>的情况下，所生产的<code>Component</code>类就没有<code>create()</code>方法了</li>
<li>在这里的<code>module</code>如果没有<code>providesSoul()</code>方法的话，还有一种情况只要在<code>Soul</code>的构造方法有<code>@Inject</code>也是可以的。</li>
</ul>
<ol start="4">
<li><p>自己在<code>Component</code>中写<code>@Component.Builder</code>，并在其标记的接口内加<code>@BindInstance</code>，可以避免在<code>DaggerXXXComponent.builder().xxx</code>调用的时候再创建对象，直接传参即可</p>
</li>
<li><p><code>Componet</code>依赖<code>Component</code>，使用<code>dependence</code></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FragmentComponent依赖于ActivityComponent</span><br><span class="line">FragmentComponent中 injectTo 在Activity中实例化并提供对外的activityComponent对象</span><br><span class="line">在Fragment中通过<span class="module-access"><span class="module"><span class="identifier">DaggerFragmentComponent</span>.</span></span>builder<span class="literal">()</span>.activity<span class="constructor">Component(ActivityComponent对象)</span>.build<span class="literal">()</span>.inject<span class="constructor">To(<span class="params">this</span>)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>@SubComponent</code>跟使用<code>dependence</code>效果一样</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ActivityComponent中获取FragmentComponent对象</span><br><span class="line">FragmentComponent标记@Subcomponent，并加injectTo</span><br><span class="line">在Activity中实例化并提供对外的activityComponent对象</span><br><span class="line">在Fragment中通过<span class="module-access"><span class="module"><span class="identifier">ActivityComponent</span>.</span></span>fragment<span class="constructor">Component()</span>.inject<span class="constructor">To(<span class="params">this</span>)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>@SubComponent</code>和<code>@Subcomponent.Builder</code>，效果与5、6一样</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ActivityComponent中获取FragmentComponent.Builder对象</span><br><span class="line">FragmentComponent标记<span class="meta">@Subcomponent</span>，加injectTo，并加<span class="meta">@Subcomponent</span>.Builder里面只有个build()方法</span><br><span class="line">在Activity中实例化并提供对外的activityComponent对象</span><br><span class="line">在Fragment中通过ActivityComponent.sonbuilder().build().injectTo(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Dagger2基础知识及在Java中使用（2）"><a href="#Dagger2基础知识及在Java中使用（2）" class="headerlink" title="Dagger2基础知识及在Java中使用（2）"></a><a target="_blank" rel="noopener" href="https://juejin.im/post/5d6f81b8e51d4561f17a5136">Dagger2基础知识及在Java中使用（2）</a></h2><h2 id="Dagger2在Android中的使用"><a href="#Dagger2在Android中的使用" class="headerlink" title="Dagger2在Android中的使用"></a><a target="_blank" rel="noopener" href="https://juejin.im/post/5d705bd4f265da03b46c0e01">Dagger2在Android中的使用</a></h2><p>例子：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger-android:2.24&#x27;</span></span><br><span class="line"><span class="comment">// if you use the support libraries(就是你需要v4.Fragment就需要加上support包)</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger-android-support:2.24&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-compiler:2.24&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-android-processor:2.24&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Children</span> &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Children</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SurperMan</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SurperManModule</span> &#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    SurperMan <span class="title function_">surperManProvides</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SurperMan</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>dagger.android包提供了一个@ContributesAndroidInjector标注是为了省去我们每次去Activity里初始化Component</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="comment">//抽象类，名字自定义，</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">NeedInjectModules</span> &#123;</span><br><span class="line">    <span class="comment">//这个方法的意思标识要注入到ForAndroidActivity页面。如果需要在MainActivity页面的话。继续加这个方法，返回值为MainActivity即可</span></span><br><span class="line">    <span class="meta">@ContributesAndroidInjector</span></span><br><span class="line">    <span class="keyword">abstract</span> ForAndroidActivity <span class="title function_">inject</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这里AndroidSupportInjectionModule是系统的，必须加上</span></span><br><span class="line"><span class="comment">//NeedInjectModules是我们要注册到Activity的</span></span><br><span class="line"><span class="comment">//SurperManModule，surperMan的</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;</span></span><br><span class="line"><span class="meta">        AndroidSupportInjectionModule.class,</span></span><br><span class="line"><span class="meta">        NeedInjectModules.class,</span></span><br><span class="line"><span class="meta">        SurperManModule</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//继承AndroidInjector&lt;T&gt;，泛型就是我们的application</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AppComponent</span> <span class="keyword">extends</span> <span class="title class_">AndroidInjector</span>&lt;MyApplication&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//还记得@Component.Builder的用法吗，可以看之前的。</span></span><br><span class="line">    <span class="meta">@Component</span>.Builder</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="meta">@BindsInstance</span></span><br><span class="line">        Builder <span class="title function_">application</span><span class="params">(Application application)</span>;</span><br><span class="line">        AppComponent <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> <span class="keyword">extends</span> <span class="title class_">DaggerApplication</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AndroidInjector&lt;? <span class="keyword">extends</span> <span class="title class_">DaggerApplication</span>&gt; applicationInjector() &#123;</span><br><span class="line">        <span class="comment">//将我们的AppComponent.Builder返回出去</span></span><br><span class="line">        <span class="keyword">return</span> DaggerAppComponent.builder().application(MyApplication.<span class="built_in">this</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Activity里使用或者在Fragment里使用，只需继承我们的DaggerActivity&amp;DaggerFragment。直接看我们的Activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForAndroidActivity</span> <span class="keyword">extends</span> <span class="title class_">DaggerAppCompatActivity</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Children children;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    SuperMan superMan;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_astudy);</span><br><span class="line">        LogUtils.i(<span class="string">&quot;已经生成实例&quot;</span>,children.hashCode()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">        LogUtils.i(<span class="string">&quot;已经生成实例&quot;</span>,surperMan.hashCode()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dagger2华丽使用在MVP框架中"><a href="#Dagger2华丽使用在MVP框架中" class="headerlink" title="Dagger2华丽使用在MVP框架中"></a><a target="_blank" rel="noopener" href="https://juejin.im/post/5d70b71cf265da03d15572a6">Dagger2华丽使用在MVP框架中</a></h2><p>RxJava + Retrofit + MVP + Dagger2</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入dagger.android库</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger-android:2.24&#x27;</span></span><br><span class="line"><span class="comment">// if you use the support libraries</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger-android-support:2.24&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-compiler:2.24&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-android-processor:2.24&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">NeedInjectModules</span> &#123;</span><br><span class="line">    <span class="meta">@ContributesAndroidInjector</span></span><br><span class="line">    <span class="keyword">abstract</span> POSTFragment <span class="title function_">injectPOSTFragment</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(modules = &#123;</span></span><br><span class="line"><span class="meta">        AndroidSupportInjectionModule.class,</span></span><br><span class="line"><span class="meta">        NeedInjectModules.class,</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AppComponent</span> <span class="keyword">extends</span> <span class="title class_">AndroidInjector</span>&lt;MyApplication&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Component</span>.Builder</span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="meta">@BindsInstance</span></span><br><span class="line">        Builder <span class="title function_">application</span><span class="params">(Application application)</span>;</span><br><span class="line">        AppComponent <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化Presenter：</p>
<p>无参可以直接用@Inject，若有参数则要用Module</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PostPresenter</span> <span class="keyword">extends</span> <span class="title class_">BasePresenter</span>&lt;PostContract.View&gt; <span class="keyword">implements</span> <span class="title class_">PostContract</span>.Prensenter &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PostPresenter</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    ...<span class="comment">//省略部分代码，便于理解</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Application中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> <span class="keyword">extends</span> <span class="title class_">DaggerApplication</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AndroidInjector&lt;? <span class="keyword">extends</span> <span class="title class_">DaggerApplication</span>&gt; applicationInjector() &#123;</span><br><span class="line">        <span class="keyword">return</span> DaggerAppComponent.builder().application(<span class="built_in">this</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为我们的Activity要继承DaggerActivity、DaggerFragment，所以我们新建BaseDaggerActivity和BaseDaggerFragment，里面有DaggerActivity和RxActivity的一些内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseDaggerActivity</span>&lt;T <span class="keyword">extends</span> <span class="title class_">BasePresenter</span>&gt; <span class="keyword">extends</span> <span class="title class_">RxFragmentActivity</span> <span class="keyword">implements</span> <span class="title class_">BaseView</span>, HasAndroidInjector &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> T mPresenter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//public abstract T cretaePresenter();</span></span><br><span class="line">    </span><br><span class="line">    ...<span class="comment">//省略部分代码，便于理解</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="各注解用法"><a href="#各注解用法" class="headerlink" title="各注解用法"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/user11223344abc/article/details/83450237">各注解用法</a></h2><h3 id="Dagger2各属性了解"><a href="#Dagger2各属性了解" class="headerlink" title="Dagger2各属性了解"></a>Dagger2各属性了解</h3><ul>
<li>必要属性</li>
</ul>
<p><code>@inject</code> &#x2F;&#x2F;注入 , <code>@Component</code> , <code>@Module</code> , <code>@Provider</code></p>
<p>要用Dagger2这几个属性是绕不开的</p>
<ul>
<li>高级属性</li>
</ul>
<p><code>@Named</code> , <code>@Qualifier</code> , <code>@Scope</code> , <code>@Singleton</code></p>
<p>可分两组，<code>@Named</code>底层实现是<code>@Qualifier</code>，<code>@Singleton</code>底层实现是<code>@Scope</code></p>
<h3 id="Dagger2各属性使用及分析"><a href="#Dagger2各属性使用及分析" class="headerlink" title="Dagger2各属性使用及分析"></a>Dagger2各属性使用及分析</h3><h4 id="Inject"><a href="#Inject" class="headerlink" title="@Inject"></a><code>@Inject</code></h4><p><strong>注解构造函数：</strong></p>
<p>通过标记构造函数，告诉Dagger2可以创建该类的实例（Dagger2通过Inject标记可以在需要这个类实例的时候来找到这个构造函数并把相关实例new出来）从而提供依赖关系。</p>
<p>若注解了构造函数，没有注解依赖变量，将不创建实例。</p>
<blockquote>
<p>用@Inject注解应该用来创建类实例的构造函数</p>
</blockquote>
<p><strong>注解依赖变量：</strong></p>
<p>通过标记依赖变量，Dagger2提供依赖关系，注入变量。</p>
<p>若注解了依赖变量，而没注解构造函数，将获得一个null对象。</p>
<blockquote>
<p>用@Inject注解构造函数，再用@Inject注解类实例</p>
</blockquote>
<h4 id="Module"><a href="#Module" class="headerlink" title="@Module"></a><code>@Module</code></h4><p>通过注解类，为Dagger提供依赖关系</p>
<h4 id="Provides"><a href="#Provides" class="headerlink" title="@Provides"></a><code>@Provides</code></h4><blockquote>
<p>是一种工厂模式</p>
</blockquote>
<p><code>@Provides</code>依然是为了提供依赖关系，是对<code>@Inject</code>的补充，弥补了<code>@Inject</code>对于第三方框架和接口类的盲区。</p>
<p><code>@Provides</code>方法本身可能也拥有自身的依赖关系。</p>
<p><code>@Provides</code>方法本身是不能独立存在的，它必须依附于一个Module</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LstudyActivity</span> <span class="keyword">extends</span> <span class="title class_">BaseActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Provider&lt;Pig&gt; pig_spec;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Lazy&lt;Sheep&gt; sheep_spec;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick(R.id.btn)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">specOnClick</span><span class="params">()</span> &#123;</span><br><span class="line">        LogUtils.i(<span class="string">&quot;看看hashCode值&quot;</span>, <span class="string">&quot;Provider pig_spec不通过get的hashCode ==&gt; &quot;</span> + pig_spec.hashCode());</span><br><span class="line">        LogUtils.i(<span class="string">&quot;看看hashCode值&quot;</span>, <span class="string">&quot;Provider pig_spec的hashCode ==&gt; &quot;</span> + pig_spec.get().hashCode());</span><br><span class="line">        LogUtils.i(<span class="string">&quot;看看hashCode值&quot;</span>, <span class="string">&quot;Lazy sheep_spec的hashCode ==&gt; &quot;</span> + sheep_spec.get().hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不调用get()方法的Provider的HashCode值。一直不变</p>
<p>调用get()方法的Provider的HashCode值。一直在改变</p>
<p>调用get()方法的Lazy的HashCode值。一直不变</p>
</blockquote>
<p>provider是一种工厂模式，每次调用get()，都会生成不同的实例。不调用不会生成实例（返回的是容器的HashCode）。</p>
<h4 id="Component"><a href="#Component" class="headerlink" title="@Component"></a><code>@Component</code></h4><p>通过注解接口类，作为提供依赖和所需依赖之间的桥梁（链接<code>Module</code>和<code>Container</code>），在编译时生成相关实例，将相关依赖注入完成使命。</p>
<p><strong>依赖规则</strong></p>
<p>若<code>@Inject</code>和<code>@Module</code>都提供了依赖对象</p>
<ol>
<li>查找Module中是否存在创建该类的方法</li>
<li>若存在，初始化参数，完成实例创建</li>
<li>若不存在，用<code>@Inject</code>创建实例</li>
</ol>
<h4 id="Singleton"><a href="#Singleton" class="headerlink" title="@Singleton"></a><code>@Singleton</code></h4><blockquote>
<p>是@Scope的一种。是作用域单例。Component在哪build就跟那个类的生命周期绑定，即只在那个绑定的实例类里起作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span>  <span class="comment">//注明是Scope</span></span><br><span class="line"><span class="meta">@Documented</span>   <span class="comment">//标记文档提示</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span>  <span class="comment">//运行时候级别</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Singleton &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>1、Component在Activity里build，那么这个单例只限于在这个Activity里。意思退出这个Activity，再进这个Activity时，这个单例会被重新new<br>2、如果Component在Application里build，那么这个单例就是全局的。注意这里涉及到了我们之前的Component依赖Component。</p>
</blockquote>
<p>使用Dagger2要有<strong>局部单例</strong>和<strong>全局单例</strong>的意识。（变量地址是否相同）</p>
<p>两者的基本定义是一样的，要看Component的作用域，若Component的作用域是全局的，那么对应<code>@Singleton</code>或者<code>@Scope</code>的对应module就全局的，反之亦然。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UrlConstant</span>&#123;</span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="keyword">public</span> UrlConstant <span class="title function_">instance</span><span class="params">()</span>[</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UrlConstant</span>();</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>局部单例：</strong>Component传入具体的某个子类Activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(modules=&#123;UrlConstant.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainComponent</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(MainActivity mainActivity)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>全局单例：</strong>步骤：</p>
<ol>
<li>Component传入基类的Activity</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(modules=&#123;UrlConstant.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GlobalComponent</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(BaseActivity baseActivity)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在Application中实例化它</li>
</ol>
<p>利用率Application的唯一特性，也可以另起一个全局唯一的类承载，但没必要</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> <span class="keyword">extends</span> <span class="title class_">Application</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GlobalComponent mGlobalComponent;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取全局单例Global</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> GlobalComponent <span class="title function_">getGlobalComponent</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mGlobalComponent == <span class="literal">null</span>)&#123;</span><br><span class="line">            mGlobalComponent = DaggerGlobalComponent.builder().build();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mGlobalComponent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Client中调用</li>
</ol>
<p>在基类中进程初始化，然后加标记进行控制，对子类暴露，这样子类想要的时候可以直接拿，更重要的是可以避免Component中inject(XXXActivity)新增类的问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseActivity</span> <span class="keyword">extends</span> <span class="title class_">NetObserverActivity</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    UrlConstant mUrlConstant;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(<span class="meta">@Nullable</span> Bundle savedInstanceState)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">if</span>(!notInitGlobalComponent())&#123;</span><br><span class="line">            ((MyApplication) getApplication()).getGlobalComponent().inject(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">notInitGlobalComponent</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UrlConstant <span class="title function_">getUrlConstant</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mUrlConstant;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Scope"><a href="#Scope" class="headerlink" title="@Scope"></a><code>@Scope</code></h4><ol>
<li>Scope是Singleton的底层实现，一般在工程实施中，它作为提高可读性的手段之一让程序员可以一眼就看出哪些是全局哪些是局部的生命周期</li>
<li>来标识范围的注解，并控制如何重复使用类的实例。仅用@inject注解，未用@Scope注解，在每次依赖注入的时候都会创建新的实例。使用@Scope注解会缓存第一次创建的实例，然后重复注入缓存的实例，不会创建新的实例。</li>
<li>如果有类注入实例的类被@Scope注解，那么其Component必须被相同的Scope注解。</li>
<li>如果依赖实例的注入来源是@Provides方法时，@Provides方法必须被@Scope注解；</li>
<li>如果依赖实例的注入来源是@Inject注解的构造函数时，实例类必须被@Scope注解。@Scope实际上是对注入器的控制。</li>
</ol>
<p>另外在看其它博客文章的时候，你会经常看到 @ActivityScope 可以声明一个Activity生命周期的对象 ，@ApplicationScope 可以声明一个Application生命周期的对象 ， 难道这些Scope这么神？ 定义一个名字就可以控制对象的生命周期了？ 其实这和 @Singleton一样的，都是代码是否通过同一个 component 对象来控制的。比如 @ActivityScope 定义的对象 ，其在Activity创建了component对象 ，那这个component对象肯定在这个Activity的生命周期内啊，依赖创建出来的对象也肯定是这个Activity啊。还有@ApplicationScope 中的component 对象是在 Application中的，那依赖创建出来的对象的生命周期也肯定是和 @Singleton的一样的，单例的生命周期不就是整个 Application 吗。</p>
<h4 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a><code>@Qualifier</code></h4><p>限定符，它可以标记不同的构造方法让外部调用者获取期望的构造对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义一个限定符</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"> <span class="meta">@Qualifier</span><span class="comment">//限定符 </span></span><br><span class="line"> <span class="meta">@Documented</span> </span><br><span class="line"> <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span> </span><br><span class="line"> <span class="keyword">public</span> <span class="meta">@interface</span> Type &#123; </span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;<span class="comment">//默认值为&quot;&quot; </span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果把Type改成Named那么就跟@Named一样了</p>
</blockquote>
<p>首先自定义一个注解<code>@interface</code>，刨开2个元注解不看 @Documented @Retention，顶部定义一个 <code>@Qualifier</code>限定符标识，然后这一句String value() default “”的意思是，Type注解可以传参，默认为一个空字符串。<br><strong>定义好了这个注解就相当于定义好了一个可接收参数的标签</strong>，接下来我们要将这个标签传入不同的参数然后分别贴到不同的构造函数之上（记住其中的关系，**@Provide + @Type(“”)区分不同构造函数<strong>，</strong>Type又被@Qualifier修饰**），这样，就相当于让每个构造函数有了辨识的途径，若要使用不同的构造函数，则只需去揭开不同的标签即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义Module</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Module</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SalaModule</span> &#123; </span><br><span class="line">    <span class="comment">//......... </span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Type(&quot;normal&quot;)</span><span class="comment">//使用限定符来区别使用哪个构造函数返回对象 </span></span><br><span class="line">    <span class="meta">@Provides</span> <span class="keyword">public</span> Apple <span class="title function_">provideNormalApple</span><span class="params">()</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Apple</span>(); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Type(&quot;color&quot;)</span></span><br><span class="line">    <span class="comment">//使用限定符来区别使用哪个构造函数返回对象 </span></span><br><span class="line">    <span class="meta">@Provides</span> <span class="keyword">public</span> Apple <span class="title function_">provideColorApple</span><span class="params">(String color)</span> &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Apple</span>(color); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们的Apple构造函数里使用了String,所以这里要管理这个String(★否则报错) </span></span><br><span class="line">    <span class="comment">//int等基本数据类型是不需要这样做的 </span></span><br><span class="line">    <span class="meta">@Provides</span> <span class="keyword">public</span> String <span class="title function_">provideString</span><span class="params">()</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Module传入不同参数分别标记不同的构造方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编写Component</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;SaladModule.class&#125;)</span></span><br><span class="line"><span class="comment">//指明要在那些Module里寻找依赖 </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SaladComponent</span> &#123; </span><br><span class="line">    <span class="comment">//......... </span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Type(&quot;normal&quot;)</span></span><br><span class="line">    <span class="comment">//关键靠这个限定符来区分调用哪个构造函数 </span></span><br><span class="line">    Apple <span class="title function_">provideNormalApple</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//这个方法名并不重要，只要是provide开头就行，但是建议和module里一致 </span></span><br><span class="line">    <span class="meta">@Type(&quot;color&quot;)</span> </span><br><span class="line">    Apple <span class="title function_">provideColorApple</span><span class="params">()</span>; </span><br><span class="line">    String <span class="title function_">provideString</span><span class="params">()</span>; </span><br><span class="line">    <span class="comment">//注意：下面的这个方法，表示要将以上的三个依赖注入到某个类中 </span></span><br><span class="line">    <span class="comment">// 这里我们把上面的三个依赖注入到Salad中 </span></span><br><span class="line">    <span class="comment">// 因为我们要做沙拉 </span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inject</span><span class="params">(Salad salad)</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Component通过刚才自定义的@Type注解标注对外暴露的接口，当这个接口方法被调用时，它会去Moudle内找对应的相同的@Type参数列表一致的构造与provider方法。</p>
<h4 id="Named"><a href="#Named" class="headerlink" title="@Named"></a><code>@Named</code></h4><p>Named底层实现是@Qualifier，是@Qualifier的一种</p>
<p>源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Named &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="简介-原文链接"><a href="#简介-原文链接" class="headerlink" title="简介 原文链接"></a>简介 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/tangpj/p/9874133.html">原文链接</a></h2><p>Dagger2是个依赖注入框架</p>
<p>依赖注入：是种实现控制反转用于解决依赖性设计模式。一个依赖关系指的是可被利用的一种对象（即服务提供端）。依赖注入是将所依赖的传递给将使用的从属对象（即客户端）。该服务是将会变成客户端的状态的一部分。传递服务给客户端，而非允许客户端来建立或寻找服务，是本设计模式的基本要求。–》简单说就是将实例对象传入到另一个对象中去（给一个对象传入一个实例变量）。</p>
<h2 id="依赖注入的实现"><a href="#依赖注入的实现" class="headerlink" title="依赖注入的实现"></a>依赖注入的实现</h2><ul>
<li>构造函数注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">    Menu menu;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Man</span><span class="params">(Menu menu)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.menu = menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>setter方法注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">    Menu menu;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setMenu</span><span class="params">(Menu menu)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.menu = menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>接口注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuInject</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">injectMenu</span><span class="params">(Menu menu)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chef</span> <span class="keyword">implements</span> <span class="title class_">MenuInject</span>&#123;</span><br><span class="line">    Menu menu;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">injectMenu</span><span class="params">(Menu menu)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.menu = menu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>依赖注入框架</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@Inject</span> <span class="keyword">class</span> <span class="title class_">Menu</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chef</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Menu menu;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Dagger2-实现依赖注入"><a href="#Dagger2-实现依赖注入" class="headerlink" title="Dagger2 实现依赖注入"></a>Dagger2 实现依赖注入</h2><p>Dagger2（2.17之后的版本）最简单的使用方式就是下面这种：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span> A a;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假如，A还需要依赖其他的类，且这个类是第三方库中提供的。又或者A实现了C接口，我们就需要用依赖倒置原则来加强我们的代码的可维护性等等。</p>
<p><strong>例子：做个餐饮系统，把点好的菜单发给厨师，让厨师负责做菜。</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入一些Dagger For Android的依赖库</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger-android:2.17&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger-android-support:2.17&#x27;</span> <span class="comment">// if you use the support libraries</span></span><br><span class="line">implementation <span class="string">&#x27;com.google.dagger:dagger:2.17&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-compiler:2.17&#x27;</span></span><br><span class="line">annotationProcessor <span class="string">&#x27;com.google.dagger:dagger-android-processor:2.17&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>Cooking接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cooking</span>&#123;</span><br><span class="line">    String <span class="title function_">cook</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Chef</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chef</span> <span class="keyword">implements</span> <span class="title class_">Cooking</span>&#123;</span><br><span class="line"></span><br><span class="line">    Menu menu;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Chef</span><span class="params">(Menu menu)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.menu = menu;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">cook</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//key菜名， value是否烹饪</span></span><br><span class="line">        Map&lt;String,Boolean&gt; menuList = menu.getMenus();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String,Boolean&gt; entry : menuList.entrySet())&#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getValue())&#123;</span><br><span class="line">                sb.append(entry.getKey()).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Menu</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String,Boolean&gt; menus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Menu</span><span class="params">( Map&lt;String,Boolean&gt; menus)</span>&#123;</span><br><span class="line">         <span class="built_in">this</span>.menus = menus;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Map&lt;String,Boolean&gt; <span class="title function_">getMenus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> menus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们写一个Activity，作用是在onCreate方法中使用Chef对象实现cooking操作。我们先来看看不使用Dagger2和使用Dagger2的代码区别。</p>
<p><strong>MainActivity</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Map&lt;String, Boolean&gt; menus = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        menus.put(<span class="string">&quot;酸菜鱼&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        menus.put(<span class="string">&quot;土豆丝&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        menus.put(<span class="string">&quot;铁板牛肉&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="type">Menu</span> <span class="variable">menu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Menu</span>(menus);</span><br><span class="line">        <span class="type">Chef</span> <span class="variable">chef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Chef</span>(menu);</span><br><span class="line">        System.out.println(chef.cook());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>DaggerMainActivity</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaggerMainActivity</span> <span class="keyword">extends</span> <span class="title class_">DaggerActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Chef chef;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Log.d(TAG,chef.cook());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在DaggerMainActivity上实现依赖注入还需要哪些代码。</p>
<p><strong>CookModules</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CookModules</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Boolean&gt; <span class="title function_">providerMenus</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String, Boolean&gt; menus = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">        menus.put(<span class="string">&quot;酸菜鱼&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        menus.put(<span class="string">&quot;土豆丝&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        menus.put(<span class="string">&quot;铁板牛肉&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> menus;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ActivityModules</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ActivityModules</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ContributesAndroidInjector</span></span><br><span class="line">    <span class="keyword">abstract</span> MainActivity <span class="title function_">contributeMainActivity</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>CookAppComponent</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;</span></span><br><span class="line"><span class="meta">        AndroidSupportInjectionModule.class,</span></span><br><span class="line"><span class="meta">        ActivityModules.class,</span></span><br><span class="line"><span class="meta">        CookModules.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CookAppComponent</span> <span class="keyword">extends</span> <span class="title class_">AndroidInjector</span>&lt;MyApplication&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Component</span>.Builder</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Builder</span> <span class="keyword">extends</span> <span class="title class_">AndroidInjector</span>.Builder&lt;MyApplication&gt;&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MyApplication</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> <span class="keyword">extends</span> <span class="title class_">DaggerApplication</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AndroidInjector&lt;? <span class="keyword">extends</span> <span class="title class_">DaggerApplication</span>&gt; applicationInjector() &#123;</span><br><span class="line">        <span class="keyword">return</span> DaggerCookAppComponent.builder().create(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Dagger2-For-Android-使用要点分析"><a href="#Dagger2-For-Android-使用要点分析" class="headerlink" title="Dagger2 For Android 使用要点分析"></a>Dagger2 For Android 使用要点分析</h2><ol>
<li><strong>CookModules</strong><br>CookModule很简单，它的目的就是通过@Providers注解提供Menu对象需要的数据。因为Menu是需要依赖一个Map对象的，所以我们通过CookModules给它构造一个Map对象，并自动把它注入到Menu实例里面。</li>
<li><strong>ActivityModules</strong><br>ActivityModules的主要作用就是通过@ContributesAndroidInjector来标记哪个类需要使用依赖注入功能，这里标记的是ManActivity，所以MainActivity能通过@Inject注解来注入Chef对象。</li>
<li><strong>CookAppComponent</strong><br>CookAppComponent相当于一个注射器，我们前面定义的Modules就是被注射的类，使用@Inject注入对象的地方就是接收者类。</li>
<li><strong>MyApplication</strong><br>MyAppliction的特点是继承了DaggerAppliction类，并且在applicationInjector方法中构建了一个DaggerCookAppComponent注射器。</li>
</ol>
<p>这就是Dagger 2在Android中的使用方案了，在这里我们可以看到，接收这类（MainActivity）中的代码非常简单，实现依赖注入只使用了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line">Chef chef;</span><br></pre></td></tr></table></figure>

<p>在接收类里面完全没有多余的代码，如果我们要拓展可以SecondsActivity的话，在SecondsActivity我们要用到Menu类。</p>
<p>那么我们只需要在ActivityModules中增加：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ContributesAndroidInjector</span></span><br><span class="line"><span class="keyword">abstract</span> SecondsActivity <span class="title function_">contributeSecondsActivity</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>然后在SecondsActivity注入Menu：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Inject</span></span><br><span class="line">Menu menu;</span><br></pre></td></tr></table></figure>

<p>可以看到，对于整个工程来说，实现使用Dagger2 For Android实现依赖注入要写的模版代码其实非常少，非常简洁。只需要进行一次配置就可以，不需要频繁写一堆模版代码。总的来说，Dagger2造成模版代码增加这个问题已经解决了。</p>
<h2 id="Dagger2的优势"><a href="#Dagger2的优势" class="headerlink" title="Dagger2的优势"></a>Dagger2的优势</h2><p>在这里我们总结下使用Dagger2带来的优点。</p>
<ol>
<li>减少代码量，提高工作效率<br>例如上面的例子中，我们构建一个Chef对象的话，不使用Dagger2的情况下，需要在初始化Chef对象之前进行一堆前置对象（Menu、Map）的初始化，并且需要手工注入到对应的实例中。你想像下，如果我们再加一个Restaurant( 餐馆 )对象，并且需要把Chef注入到Restaurant中的话，那么初始化Restaurant对象时，需要的前置步骤就更繁琐了。<br>可能有人会觉得，这也没什么啊，我不介意手工初始化。但是如果你的系统中有N处需要初始化Restaurant对象的地方呢？使用Dagger2 的话，只需要用注解注入就可以了。</li>
<li>自动处理依赖关系<br>使用Dagger2的时候，我们不需要指定对象的依赖关系，Dagger2会自动帮我们处理依赖关系（例如Chef需要依赖Menu，Menu需要依赖Map，Dagger自动处理了这个依赖关系）。</li>
<li>采用静态编译，不影响运行效率<br>因为Dagger2是在编译期处理依赖注入的，所以不会影响运行效率在一定的程度上还能提高系统的运行效率（例如采用Dagger2实现单例，不用加锁效率更高）。</li>
<li>提高多人编程效率<br>在多人协作的时候，一个人用Dagger2边写完代码后，其它所有组员都能通过@Inject注解直接注入常用的对象。加快编程效率，并且能大大增加代码的复用性。</li>
</ol>
<ul>
<li><strong>@ContributesAndroidInjector</strong><br>你可以把它看成Dagger2是否要自动把需要的用到的Modules注入到DishesFragment中。这个注解是Dagger2 For Android简化代码的关键</li>
<li><strong>@Module</strong><br>被这个注解标记的类可以看作为依赖对象的提供者，可以通过这个被标记的类结合其它注解来实现依赖关系的关联。</li>
<li><strong>@Provides</strong><br>主要作用就是用来提供一些第三方类库的对象或提供一些构建非常复杂的对象在Dagger2中类似工厂类的一个角色。</li>
<li><strong>@Binds</strong><br>主要作用就是确定接口与具体的具体实现类。</li>
</ul>
<h2 id="Dagger2-For-Android是如何注入依赖的？"><a href="#Dagger2-For-Android是如何注入依赖的？" class="headerlink" title="Dagger2 For Android是如何注入依赖的？"></a>Dagger2 For Android是如何注入依赖的？</h2><p>我们在用Dagger2的时候是通过一些模版代码来实现依赖注入的（ DaggerXXXComponent.builder().inject(xxx) 这种模版代码），但是在Demo中的DishesFragment根本没看到类似的代码啊，那么这些对象是什么时候注入到DishesFragment重的呢？</p>
<p>答案就是**@ContributesAndroidInjector**注解</p>
<p>我们先来看看Dagger2是通过什么方式来实现自动把依赖注入到DishesActivity中的。</p>
<p><strong>ActivityModules</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ActivityModules</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ContributesAndroidInjector(modules = DishesModules.class)</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> DishesActivity <span class="title function_">contributesDishActivity</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ContributesAndroidInjector(modules = AddEditModules.class)</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> AddEditDishActivity <span class="title function_">contributesAddEditDishActivity</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没错，就是@ContributesAndroidInjector这个注解，modules就代表这个DishesActivity需要依赖哪个Modules。</p>
<h2 id="Dagger2-For-Android使用要点"><a href="#Dagger2-For-Android使用要点" class="headerlink" title="Dagger2 For Android使用要点"></a>Dagger2 For Android使用要点</h2><p>我们现在来总结下，简化版的Dagger实现依赖注入的几个必要条件：</p>
<ol>
<li>第三方库通过Modules的@provides注解来提供依赖</li>
<li>提供一个全局唯一的Component，并且Modules中需要添加AndroidSupportInjectionModule类，它的作用时关联需求与依赖之间的关系</li>
<li>Application需要继承DaggerApplication类，并且在applicationInjector构建并返回全剧唯一的Component实例</li>
<li>其它需要使用依赖注入的组建都需要继承<strong>Dagger组件名字</strong>类，并且需要在相应的Modules中通过@ContributesAndroidInjector注解标记需要注入依赖的组建。</li>
</ol>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt=" WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%AE%89%E5%8D%93%E7%AC%AC%E4%B8%89%E6%96%B9/" rel="tag"># 安卓第三方</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/3257296232/" rel="next" title="第三方相关">
                <i class="fa fa-chevron-left"></i> 第三方相关
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/3447597586/" rel="prev" title="第三方-ARouter">
                第三方-ARouter <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">84</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@189.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/shenbh" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://gitee.com/shen_bh" target="_blank" title="Gitee">
                      
                        <i class="fa fa-fw fa-git"></i>Gitee</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#dagger2%E7%9B%B8%E5%85%B3"><span class="nav-text">dagger2相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dagger2%E7%AC%94%E8%AE%B0%EF%BC%9A"><span class="nav-text">dagger2笔记：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="nav-text">注入过程：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="nav-text">Dagger2注入原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%9C%A8Java%E4%B8%AD%E4%BD%BF%E7%94%A8%EF%BC%881%EF%BC%89"><span class="nav-text">Dagger2基础知识及在Java中使用（1）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A6%96%E5%85%88%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="nav-text">首先添加依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Inject-amp-Component%E5%8F%AF%E4%BB%A5%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%8D%E5%B8%A6-Module%EF%BC%89"><span class="nav-text">1. @Inject &amp; @Component可以简单实现依赖注入（不带@Module）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%B8%A6-Module%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">2. 带@Module的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%8F%82%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-text">无参构造函数的情况</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%8F%8A%E5%9C%A8Java%E4%B8%AD%E4%BD%BF%E7%94%A8%EF%BC%882%EF%BC%89"><span class="nav-text">Dagger2基础知识及在Java中使用（2）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2%E5%9C%A8Android%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">Dagger2在Android中的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2%E5%8D%8E%E4%B8%BD%E4%BD%BF%E7%94%A8%E5%9C%A8MVP%E6%A1%86%E6%9E%B6%E4%B8%AD"><span class="nav-text">Dagger2华丽使用在MVP框架中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E6%B3%A8%E8%A7%A3%E7%94%A8%E6%B3%95"><span class="nav-text">各注解用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dagger2%E5%90%84%E5%B1%9E%E6%80%A7%E4%BA%86%E8%A7%A3"><span class="nav-text">Dagger2各属性了解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dagger2%E5%90%84%E5%B1%9E%E6%80%A7%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%88%86%E6%9E%90"><span class="nav-text">Dagger2各属性使用及分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Inject"><span class="nav-text">@Inject</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Module"><span class="nav-text">@Module</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Provides"><span class="nav-text">@Provides</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Component"><span class="nav-text">@Component</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Singleton"><span class="nav-text">@Singleton</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scope"><span class="nav-text">@Scope</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Qualifier"><span class="nav-text">@Qualifier</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Named"><span class="nav-text">@Named</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-%E5%8E%9F%E6%96%87%E9%93%BE%E6%8E%A5"><span class="nav-text">简介 原文链接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">依赖注入的实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2-%E5%AE%9E%E7%8E%B0%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-text">Dagger2 实现依赖注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2-For-Android-%E4%BD%BF%E7%94%A8%E8%A6%81%E7%82%B9%E5%88%86%E6%9E%90"><span class="nav-text">Dagger2 For Android 使用要点分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="nav-text">Dagger2的优势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2-For-Android%E6%98%AF%E5%A6%82%E4%BD%95%E6%B3%A8%E5%85%A5%E4%BE%9D%E8%B5%96%E7%9A%84%EF%BC%9F"><span class="nav-text">Dagger2 For Android是如何注入依赖的？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dagger2-For-Android%E4%BD%BF%E7%94%A8%E8%A6%81%E7%82%B9"><span class="nav-text">Dagger2 For Android使用要点</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>