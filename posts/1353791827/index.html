<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="安卓UI," />










<meta name="description" content="RecyclerView 优化 数据处理和视图加载分离：数据的处理逻辑尽可能放在异步处理，onBindViewHolder 方法中只处理数据填充到视图中。 数据优化：分页拉取远端数据，对拉取下来的远端数据进行缓存，提升二次加载速度；对于新增或者删除数据通过 DiffUtil 来进行局部刷新数据，而不是一味地全局刷新数据。  示例">
<meta property="og:type" content="article">
<meta property="og:title" content="UI-RecyclerView">
<meta property="og:url" content="http://shenbh.github.io/posts/1353791827/index.html">
<meta property="og:site_name" content="积跬步">
<meta property="og:description" content="RecyclerView 优化 数据处理和视图加载分离：数据的处理逻辑尽可能放在异步处理，onBindViewHolder 方法中只处理数据填充到视图中。 数据优化：分页拉取远端数据，对拉取下来的远端数据进行缓存，提升二次加载速度；对于新增或者删除数据通过 DiffUtil 来进行局部刷新数据，而不是一味地全局刷新数据。  示例">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/RecyclerView%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/RecyclerView%E7%9A%84ViewHolder.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/RecyclerView%E7%9A%84ViewHolder2.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%86%8D%E9%81%8D%E5%8E%86mAttachedScrap%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94position%E7%9A%84ViewHolder%E5%AF%B9%E8%B1%A1.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%B0%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8%E9%A1%B9%E5%88%86%E6%88%90%E4%BA%863%E5%9D%97%E5%8C%BA%E5%9F%9F.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap1.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap2.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap3.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap4.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/mRecyclerPool1.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/mRecyclerPool2.png">
<meta property="og:image" content="http://shenbh.github.io/posts/1353791827/mRecyclerPool3.png">
<meta property="article:published_time" content="2020-03-16T02:18:58.000Z">
<meta property="article:modified_time" content="2025-06-25T06:06:20.925Z">
<meta property="article:author" content="阿炳">
<meta property="article:tag" content="安卓UI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://shenbh.github.io/posts/1353791827/RecyclerView%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/1353791827/"/>





  <title>UI-RecyclerView | 积跬步</title>
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">积跬步</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Just do IT Now.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/1353791827/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="积跬步">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">UI-RecyclerView</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-03-16T10:18:58+08:00">
                2020-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="RecyclerView-优化"><a href="#RecyclerView-优化" class="headerlink" title="RecyclerView 优化"></a><code>RecyclerView</code> 优化</h1><ul>
<li>数据处理和视图加载分离：数据的处理逻辑尽可能放在异步处理，onBindViewHolder 方法中只处理数据填充到视图中。</li>
<li>数据优化：分页拉取远端数据，对拉取下来的远端数据进行缓存，提升二次加载速度；对于新增或者删除数据通过 <code>DiffUtil</code> 来进行局部刷新数据，而不是一味地全局刷新数据。</li>
</ul>
<p>示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdapterDiffCallback</span> <span class="keyword">extends</span> <span class="title class_">DiffUtil</span>.Callback &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; mOldList;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; mNewList;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AdapterDiffCallback</span><span class="params">(List&lt;String&gt; oldList, List&lt;String&gt; newList)</span> &#123;</span><br><span class="line">        mOldList = oldList;</span><br><span class="line">        mNewList = newList;</span><br><span class="line">        DiffUtil.DiffResult</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOldListSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mOldList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNewListSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mNewList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areItemsTheSame</span><span class="params">(<span class="type">int</span> oldItemPosition, <span class="type">int</span> newItemPosition)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mOldList.get(oldItemPosition).getClass().equals(mNewList.get(newItemPosition).getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areContentsTheSame</span><span class="params">(<span class="type">int</span> oldItemPosition, <span class="type">int</span> newItemPosition)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mOldList.get(oldItemPosition).equals(mNewList.get(newItemPosition));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DiffUtil.<span class="type">DiffResult</span> <span class="variable">diffResult</span> <span class="operator">=</span> DiffUtil.calculateDiff(<span class="keyword">new</span> <span class="title class_">AdapterDiffCallback</span>(oldList, newList));</span><br><span class="line">diffResult.dispatchUpdatesTo(mAdapter);</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/recyclerview/widget/DiffUtil.Callback">DiffUtil.Callback</a></li>
<li>布局优化：减少布局层级，简化 <code>ItemView</code></li>
<li>升级 <code>RecycleView</code> 版本到 25.1.0 及以上使用 <a target="_blank" rel="noopener" href="https://blog.csdn.net/C_biubiubiu/article/details/128747524">Prefetch</a> 功能</li>
<li>通过重写 <code>RecyclerView.onViewRecycled(holder)</code> 来回收资源</li>
<li>如果 <code>Item</code> 高度是固定的话，可以使用 <a target="_blank" rel="noopener" href="https://blog.csdn.net/zzx410527/article/details/93177979"><code>RecyclerView.setHasFixedSize(true);</code></a> 来避免 <code>requestLayout</code> 浪费资源【不是瀑布流的情况下可以加这句】</li>
<li>对 <code>ItemView</code> 设置监听器，不要对每个 <code>Item</code> 都调用 <code>addXxListener</code>，应该大家公用一个 <code>XxListener</code>，根据 <code>ID</code> 来进行不同的操作，优化了对象的频繁创建带来的资源消耗</li>
<li>如果多个 <code>RecycledView</code> 的 <code>Adapter</code> 是一样的，比如嵌套的 <code>RecyclerView</code> 中存在一样的 <code>Adapter</code>，可以通过设置 <code>RecyclerView.setRecycledViewPool(pool)</code>，来共用一个 <code>RecycledViewPool</code>。</li>
</ul>
<h1 id="二级列表"><a href="#二级列表" class="headerlink" title="二级列表"></a>二级列表</h1><p>在布局文件中添加 <code>ExpandableAdapter</code>，或在 <code>Activity</code>中 <code>extends ExpandableAdapter</code><br>在 <code>Activity</code>的 <code>oncreate</code>中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将默认的左边的箭头去掉</span></span><br><span class="line">expandLview.setGroupIndicator(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<ol>
<li>创建一个类继承 <code>BaseExpandableListAdapter</code></li>
<li>先重写 <code>getGroupCount</code>、<code>getGroupView</code> 再写 <code>getChildView</code>、<code>getChildrenCount</code></li>
<li>在 <code>activity</code>中创建适配器对象，并且设置适配器</li>
</ol>
<p>思路：<br>继承 <code>activity</code>  </p>
<ol>
<li>创建两 <code>xml</code>布局<br>布局1：有 <code>ExpandableListView</code>控件<br>布局2：子列表的样式</li>
<li>在 <code>activity</code>的 <code>oncreate</code>方法中实例化 <code>ExpandableListView</code>控件</li>
<li>自定义可扩展适配器，创建一个类继承 <code>BaseExpandableListAdapter</code>并添加为实现的方法</li>
<li>必须重写的方法：先重写 <code>getGroupCount</code>、<code>getGroupView</code>再写 <code>getChildView</code>、<code>getChildrenCount</code></li>
<li>在 <code>onCreate</code>方法中实例化可扩展适配器对象</li>
<li>调用 <code>setadapter</code>设置适配器</li>
</ol>
<p>注释：如果我们在自定义适配器时，注意是否需要加载元素样式布局（如果需要加载，这个时候必须获取布局过滤器对象）–&gt;通常情况处理方式为：添加一个构造方法，里面的参数只收有 <code>context c</code>在获取 <code>view</code>，必须通过布局过滤器对象调用 <code>inflate</code>方法，加载样式布局 返回 <code>view</code>对象，记得赋值</p>
<p>如果继承 <code>listactivity</code>。。。</p>
<h1 id="可扩展适配器实现步骤"><a href="#可扩展适配器实现步骤" class="headerlink" title="可扩展适配器实现步骤"></a>可扩展适配器实现步骤</h1><ol>
<li>继承<code>activity</code></li>
<li>创建两<code>xml</code>布局<br>布局1：有<code>ExpandableListView</code>控件<br>布局2：子列表元素的样式</li>
<li>在<code>activity</code>的<code>oncreate</code>方法中实例化<code>ExpandableListView</code>控件</li>
<li>自定义可扩展适配器，继承<code>BaseExpandableListAdapter</code>并添加未实现的方法</li>
<li>必须重写<code>getGroupView</code>、<code>getGroupCount</code>、<code>getChildView</code>、<code>getChildrenCount</code></li>
<li>在<code>oncreate</code>方法中实例化自定义可扩展适配器对象</li>
<li>调用<code>setadapter</code>设置适配器</li>
</ol>
<blockquote>
<p>注释：如果我们在自定义适配器时，注意是否需要加载元素样式布局（如果需要加载，这个时候必须获取布局过滤器对象）—&gt;通常情况处理方式为：添加一个构造方法，里面的参数至少有Context c    在获取view,必须通过布局过滤器对象调用inflate方法，加载样式布局 返回View对象，记得赋值</p>
</blockquote>
<h1 id="RecyclerView"><a href="#RecyclerView" class="headerlink" title="RecyclerView"></a><a target="_blank" rel="noopener" href="https://juejin.cn/post/7044797219878223909"><code>RecyclerView</code></a></h1><h2 id="RecyclerView整体架构设计"><a href="#RecyclerView整体架构设计" class="headerlink" title="RecyclerView整体架构设计"></a><code>RecyclerView</code>整体架构设计</h2><p><img src="/posts/1353791827/RecyclerView%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.png" alt="Android/RecyclerView1"></p>
<p><code>RecyclerView</code>类注释中对自己的解释：它是一种可以在有限区域内展示大量数据的<code>View</code>。</p>
<ul>
<li><code>RecyclerView</code>本质是<code>ViewGroup</code></li>
<li><code>Adapter</code>、<code>LayoutManager</code>、<code>Recycler</code>这三个对<code>RecyclerView</code>是必不可少的<ul>
<li><code>Recycler</code>的工作被封装在<code>RecyclerView</code>内部完成，对使用者来说是透明的。</li>
<li>谷歌提供了集中<code>LayoutManager</code>，实现单列列表、瀑布流列表等效果</li>
</ul>
</li>
</ul>
<h2 id="RecyclerView的重要成员"><a href="#RecyclerView的重要成员" class="headerlink" title="RecyclerView的重要成员"></a><code>RecyclerView</code>的重要成员</h2><h3 id="ViewHolder"><a href="#ViewHolder" class="headerlink" title="ViewHolder"></a><code>ViewHolder</code></h3><p><code>RecyclerView</code>的基本单位：<code>ViewHolder</code>。</p>
<p>如果用<code>Item</code>表示数据集中的一个数据对象，<code>ItemView</code>表示用来展示该<code>Item</code>的<code>View</code>对象。<code>ViewHolder</code>负责在<code>RecyclerView</code>中承载一个<code>ItemView</code>，除了维护<code>View</code>对象本身外，还维护着<code>Item</code>位置（<code>position</code>，此处的位置是指<code>Item</code>在<strong>数据集</strong>中的次序）、<code>item</code>类型、<code>item Id</code>等。大部分时候，<code>RecyclerView</code>内部或其辅助类不会直接操作<code>View</code>，而是操作<code>ViewHolder</code>。</p>
<p>在阅读<code>RecyclerView</code>源码时发现，一些操作需要用View做参数，也有一些操作需要用<code>ViewHolder</code>做参数，实际上在<code>RecyclerView</code>中，可以通过任意一样拿到另一样，不必太过纠结<code>RecyclerView</code>的各个内部类的变量中究竟维护的是哪种类型。</p>
<p><img src="/posts/1353791827/RecyclerView%E7%9A%84ViewHolder.png" alt="Android/RecyclerView2"></p>
<p>但一般认为，</p>
<ul>
<li>Adapter负责根据数据Item创建对应的ViewHolder；</li>
<li>Recycler负责管理ViewHolder，根据实际情况创建新的ViewHolder或复用已有的ViewHolder；</li>
<li>LayoutManager可以通过Recycler直接获取到View，负责讲其添加到RecyclerView的布局中，并通过Recycler回收已经不被展示的View。</li>
</ul>
<p><img src="/posts/1353791827/RecyclerView%E7%9A%84ViewHolder2.png" alt="Android/RecyclerView3"></p>
<h1 id="画了10张图，带你搞定RecyclerView的缓存复用机制"><a href="#画了10张图，带你搞定RecyclerView的缓存复用机制" class="headerlink" title="画了10张图，带你搞定RecyclerView的缓存复用机制"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/7RrdVWNhHGJl5YyR8iQBSg">画了10张图，带你搞定RecyclerView的缓存复用机制</a></h1><p>RecyclerView：<strong>回收其列表项视图以供重用</strong>。具体：<strong>当一个列表项被移出屏幕后，RecyclerView并不会销毁其视图，而是会缓存起来，以提供给新进入屏幕的列表项重用</strong>，这种重用可以：  </p>
<ul>
<li>避免重复创建不必要的视图。</li>
<li>避免重复执行昂贵的<code>findViewById</code>。<h2 id="RecyclerView是如何构建动态列表的？"><a href="#RecyclerView是如何构建动态列表的？" class="headerlink" title="RecyclerView是如何构建动态列表的？"></a>RecyclerView是如何构建动态列表的？</h2>与RecyclerView构建动态列表相关联的几个重要类中，Adapter与ViewHolder负责配合使用，共同定义RecyclerView列表项数据的展示方式，其中：</li>
</ul>
<ul>
<li>ViewHolder是一个「包含列表项视图(itemView)的封装容器」，同时也是「RecyclerView缓存复用的主要对象」。</li>
<li>Adapter则提供了「数据&lt;-&gt;视图」 的“绑定”关系，其包含以下几个关键方法：<ul>
<li><strong>onCreateViewHolder</strong>：负责创建并初始化ViewHolder及其关联的视图，但<strong>不会填充</strong>视图内容。 </li>
<li><strong>onBindViewHolder</strong>：负责提取适当的数据，<strong>填充</strong>ViewHolder的视图内容。<br>  然而，这2个方法并非每一个进入屏幕的列表项都会回调，相反，由于视图创建及findViewById执行等动作都主要集中在这2个方法，每次都要回调的话反而效率不佳。因此，我们应该通过对ViewHolder对象积极地缓存复用，来尽量减少对这2个方法的回调频次。</li>
</ul>
</li>
</ul>
<ol>
<li>最优情况是——取得的缓存对象正好是原先的ViewHolder对象，这种情况下既不需要重新创建该对象，也不需要重新绑定数据，即拿即用。</li>
<li>次优情况是——取得的缓存对象虽然不是原先的ViewHolder对象，但由于二者的列表项类型(itemType)相同，其关联的视图可以复用，因此只需要重新绑定数据即可。</li>
<li>最后实在没办法了，才需要执行这2个方法的回调，即创建新的ViewHolder对象并绑定数据。<br>实际上，这也是RecyclerView从缓存中查找最佳匹配ViewHolder对象时所遵循的优先级顺序。而真正负责执行这项查找工作的，则是RecyclerView类中一个被称为「回收者」的内部类——Recycler。<h2 id="Recycler是如何查找ViewHolder对象的？"><a href="#Recycler是如何查找ViewHolder对象的？" class="headerlink" title="Recycler是如何查找ViewHolder对象的？"></a>Recycler是如何查找ViewHolder对象的？</h2><figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * ...  </span></span><br><span class="line"><span class="comment"> * When &#123;<span class="doctag">@link</span> Recycler#getViewForPosition(int)&#125; is called, Recycler checks attached scrap and  </span></span><br><span class="line"><span class="comment"> * first level cache to find a matching View. If it cannot find a suitable View, Recycler will  </span></span><br><span class="line"><span class="comment"> * call the &#123;<span class="doctag">@link</span> #getViewForPositionAndType(Recycler, int, int)&#125; before checking  </span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> RecycledViewPool&#125;.  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * 当调用getViewForPosition(int)方法时，Recycler会检查attached scrap和一级缓存(指的是mCachedViews)以找到匹配的View。   </span></span><br><span class="line"><span class="comment"> * 如果找不到合适的View，Recycler会先调用ViewCacheExtension的getViewForPositionAndType(RecyclerView.Recycler, int, int)方法，再检查RecycledViewPool对象。  </span></span><br><span class="line"><span class="comment"> * ...  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ViewCacheExtension</span> &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Recycler</span> &#123;  </span><br><span class="line">    ...  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * Attempts to get the ViewHolder for the given position, either from the Recycler scrap,  </span></span><br><span class="line"><span class="comment">     * cache, the RecycledViewPool, or creating it directly.  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * 尝试通过从Recycler scrap缓存、RecycledViewPool查找或直接创建的形式来获取指定位置的ViewHolder。  </span></span><br><span class="line"><span class="comment">     * ...  </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="meta">@Nullable</span>  </span><br><span class="line">    ViewHolder <span class="title function_">tryGetViewHolderForPositionByDeadline</span><span class="params">(<span class="type">int</span> position,  </span></span><br><span class="line"><span class="params">            <span class="type">boolean</span> dryRun, <span class="type">long</span> deadlineNs)</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (mState.isPreLayout()) &#123;  </span><br><span class="line">            <span class="comment">// 0 尝试从mChangedScrap中获取ViewHolder对象  </span></span><br><span class="line">            holder = getChangedScrapViewForPosition(position);  </span><br><span class="line">            ...  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (holder == <span class="literal">null</span>) &#123;  </span><br><span class="line">            <span class="comment">// 1.1 尝试根据position从mAttachedScrap或mCachedViews中获取ViewHolder对象  </span></span><br><span class="line">            holder = getScrapOrHiddenOrCachedHolderForPosition(position, dryRun);  </span><br><span class="line">            ...  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span> (holder == <span class="literal">null</span>) &#123;  </span><br><span class="line">            ...  </span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">type</span> <span class="operator">=</span> mAdapter.getItemViewType(offsetPosition);  </span><br><span class="line">            <span class="keyword">if</span> (mAdapter.hasStableIds()) &#123;  </span><br><span class="line">                <span class="comment">// 1.2 尝试根据id从mAttachedScrap或mCachedViews中获取ViewHolder对象  </span></span><br><span class="line">                holder = getScrapOrCachedViewForId(mAdapter.getItemId(offsetPosition),  </span><br><span class="line">                        type, dryRun);  </span><br><span class="line">                ...  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span> (holder == <span class="literal">null</span> &amp;&amp; mViewCacheExtension != <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// 2 尝试从mViewCacheExtension中获取ViewHolder对象  </span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> mViewCacheExtension  </span><br><span class="line">                        .getViewForPositionAndType(<span class="built_in">this</span>, position, type);  </span><br><span class="line">                <span class="keyword">if</span> (view != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    holder = getChildViewHolder(view);  </span><br><span class="line">                    ...  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span> (holder == <span class="literal">null</span>) &#123; <span class="comment">// fallback to pool  </span></span><br><span class="line">                <span class="comment">// 3 尝试从mRecycledViewPool中获取ViewHolder对象  </span></span><br><span class="line">                holder = getRecycledViewPool().getRecycledView(type);  </span><br><span class="line">                ...  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span> (holder == <span class="literal">null</span>) &#123;  </span><br><span class="line">                <span class="comment">// 4.1 回调createViewHolder方法创建ViewHolder对象及其关联的视图  </span></span><br><span class="line">                holder = mAdapter.createViewHolder(RecyclerView.<span class="built_in">this</span>, type);  </span><br><span class="line">                ...  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (mState.isPreLayout() &amp;&amp; holder.isBound()) &#123;  </span><br><span class="line">            ...  </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!holder.isBound() || holder.needsUpdate() || holder.isInvalid()) &#123;  </span><br><span class="line">            ...  </span><br><span class="line">            <span class="comment">// 4.1 回调bindViewHolder方法提取数据填充ViewHolder的视图内容  </span></span><br><span class="line">            bound = tryBindViewHolderByDeadline(holder, offsetPosition, position, deadlineNs);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        ...  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> holder;  </span><br><span class="line">    &#125;  </span><br><span class="line">    ...  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结合RecyclerView类中的源码及注释可知，Recycler会依次从<code>mChangedScrap/mAttachedScrap</code>、<code>mCachedViews</code>、<code>mViewCacheExtension</code>、<code>mRecyclerPool</code>中尝试获取指定位置或ID的ViewHolder对象以供重用，如果全都获取不到则直接重新创建。这其中涉及的几层缓存结构分别是：</p>
<h3 id="mChangedScrap-x2F-mAttachedScrap"><a href="#mChangedScrap-x2F-mAttachedScrap" class="headerlink" title="mChangedScrap&#x2F;mAttachedScrap"></a>mChangedScrap&#x2F;mAttachedScrap</h3><p><code>mChangedScrap/mAttachedScrap</code>主要用于「<strong>临时存放仍在当前屏幕可见、但被标记为「移除」或「重用」的列表项</strong>」，其均以ArrayList的形式持有着每个列表项的ViewHolder对象，大小无明确限制，但一般来讲，其最大数就是屏幕内总的可见列表项数。</p>
<figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ArrayList&lt;ViewHolder&gt; mAttachedScrap = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">ArrayList&lt;ViewHolder&gt; mChangedScrap = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<p>但问题来了，既然是当前屏幕可见的列表项，为什么还需要缓存呢？又是什么时候列表项会被标记为「移除」或「重用」的呢？<br>这2个缓存结构实际上更多是为了避免出现像「局部刷新」这一类的操作，导致所有的列表项都需要重绘的情形。<br>区别在于，<code>mChangedScrap</code>主要的使用场景是：  </p>
<ol>
<li>开启了列表项动画(itemAnimator)，并且列表项动画的<code>canReuseUpdatedViewHolder(ViewHolder viewHolder)</code>方法返回false的前提下；    </li>
<li>调用了<code>notifyItemChanged</code>、<code>notifyItemRangeChanged</code>这一类方法，通知列表项数据发生变化；<figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">canReuseUpdatedViewHolder</span><span class="params">(ViewHolder viewHolder)</span> &#123;  </span><br><span class="line">    <span class="type">return</span> <span class="variable">mItemAnimator</span> <span class="operator">=</span>= <span class="literal">null</span> || mItemAnimator.canReuseUpdatedViewHolder(viewHolder,  </span><br><span class="line">            viewHolder.getUnmodifiedPayloads());  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canReuseUpdatedViewHolder</span><span class="params">(<span class="meta">@NonNull</span> ViewHolder viewHolder,  </span></span><br><span class="line"><span class="params">        <span class="meta">@NonNull</span> List&lt;Object&gt; payloads)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> canReuseUpdatedViewHolder(viewHolder);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canReuseUpdatedViewHolder</span><span class="params">(<span class="meta">@NonNull</span> ViewHolder viewHolder)</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<code>canReuseUpdatedViewHolder</code>方法的返回值表示的不同含义如下：</li>
</ol>
<ul>
<li>true，表示可以重用原先的ViewHolder对象。    </li>
<li>false，表示应该创建该ViewHolder的副本，以便itemAnimator利用两者来实现动画效果（例如交叉淡入淡出效果）。<br>简单讲就是，<strong>mChangedScrap主要是为列表项数据发生变化时的动画效果服务的</strong>。<br>而<strong>mAttachedScrap应对的则是剩下的绝大部分场景</strong>，比如：  </li>
<li>像<code>notifyItemMoved</code>、<code>notifyItemRemoved</code>这种列表项发生移动，但列表项数据本身没有发生变化的场景。    </li>
<li>关闭了列表项动画，或者列表项动画的<code>canReuseUpdatedViewHolder</code>方法返回true，即允许重用原先的ViewHolder对象的场景。<br>下面以一个简单的<code>notifyItemRemoved(int position)</code>操作为例来演示:<br><code>notifyItemRemoved(int position)</code>方法用于通知观察者，先前位于position的列表项已被移除， 其往后的列表项position都将往前移动1位。<br>为了简化问题、方便演示，我们的范例将会居于以下限制：  </li>
<li>列表项总个数没有铺满整个屏幕——意味着不会触发<code>mCachedViews</code>、<code>mRecyclerPool</code>等结构的缓存操作。    </li>
<li>去除列表项动画——意味着调用<code>notifyItemRemoved</code>后RecyclerView只会重新布局子视图一次。  <figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recyclerView.itemAnimator = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
理想情况下，调用<code>notifyItemRemoved(int position)</code>方法后，应只有位于position的列表项会被移除，其他的列表项，无论是位于position之前或之后，都最多只会调整position值，而不应发生视图的重新创建或数据的重新绑定，即不应该回调<code>onCreateViewHolder</code>与<code>onBindViewHolder</code>这2个方法。<br>为此，我们就需要将当前屏幕内的可见列表项暂时从当前屏幕剥离，临时缓存到<code>mAttachedScrap</code>这个结构中去。<br><img src="/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap.png" alt="当前屏幕内的可见列表项暂时从当前屏幕剥离临时缓存到mAttachedScrap"><br>等到RecyclerView重新开始布局显示其子视图后，再遍历<code>mAttachedScrap</code>找到对应position的ViewHolder对象进行复用。<br><img src="/posts/1353791827/%E5%86%8D%E9%81%8D%E5%8E%86mAttachedScrap%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94position%E7%9A%84ViewHolder%E5%AF%B9%E8%B1%A1.png" alt="再遍历mAttachedScrap找到对应position的ViewHolder对象">  <h3 id="mCachedViews"><a href="#mCachedViews" class="headerlink" title="mCachedViews"></a>mCachedViews</h3><code>mCachedViews</code>主要用于「存放已被移出屏幕、但有可能很快重新进入屏幕的列表项」。其同样是以ArrayList的形式持有着每个列表项的ViewHolder对象，默认大小限制为2。</li>
</ul>
<figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ArrayList&lt;ViewHolder&gt; mCachedViews = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ViewHolder&gt;();  </span><br><span class="line"><span class="type">int</span> <span class="variable">mViewCacheMax</span> <span class="operator">=</span> DEFAULT_CACHE_SIZE;  </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CACHE_SIZE</span> <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>比如像朋友圈这种按更新时间的先后顺序展示的Feed流，我们经常会在快速滑动中确定是否有自己感兴趣的内容，当意识到刚才滑走的内容可能比较有趣时，我们往往就会将上一条内容重新滑回来查看。<br>这种场景下我们追求的自然是上一条内容展示的实时性与完整性，而不应让用户产生“才滑走那么一会儿又要重新加载”的抱怨，也即同样不应发生视图的重新创建或数据的重新绑定。<br>我们用几张流程示意图来演示这种情况：<br>同样为了简化问题、方便描述，我们的范例将会居于以下限制：  </p>
<ul>
<li>关闭预拉取——意味着之后向上滑动时，都不会再预拉取「待进入屏幕区域」的一个列表项放入<code>mCachedView</code>了。  <figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recyclerView.layoutManager?.isItemPrefetchEnabled = <span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
<li>只存在一种类型的列表项，即所有列表项的itemType相同，默认都为0。<br>我们将图中的列表项分成了3块区域，分别是被滑出屏幕之外的区域、屏幕内的可见区域、随着滑动手势待进入屏幕的区域。<br><img src="/posts/1353791827/%E5%B0%86%E5%9B%BE%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8%E9%A1%B9%E5%88%86%E6%88%90%E4%BA%863%E5%9D%97%E5%8C%BA%E5%9F%9F.png" alt="将图中的列表项分成了3块区域"></li>
</ul>
<ol>
<li>当position&#x3D;0的列表项随着向上滑动的手势被移出屏幕后，由于<code>mCachedViews</code>初始容量为0，因此可直接放入；<img src="/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap1.png" alt="当前屏幕内的可见列表项暂时从当前屏幕剥离临时缓存到mAttachedScrap1"></li>
<li>当position&#x3D;1的列表项同样被移出屏幕后，由于未达到<code>mCachedViews</code>的默认容量大小限制，因此也可继续放入；<img src="/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap2.png" alt="当前屏幕内的可见列表项暂时从当前屏幕剥离临时缓存到mAttachedScrap2"></li>
<li>此时改为向下滑动，position&#x3D;1的列表项重新进入屏幕，Recycler就会依次从<code>mAttachedScrap</code>、<code>mCachedViews</code>查找可重用于此位置的ViewHolder对象；</li>
<li><code>mAttachedScrap</code>不是应对这种情况的，自然找不到。而<code>mCachedViews</code>会遍历自身持有的ViewHolder对象，对比ViewHolder对象的position值与待复用位置的position值是否一致，是的话就会将ViewHolder对象从<code>mCachedViews</code>中移除并返回；</li>
<li>此处拿到的ViewHolder对象即可直接复用，即符合前面所述的「最优情况」。<img src="/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap3.png" alt="当前屏幕内的可见列表项暂时从当前屏幕剥离临时缓存到mAttachedScrap3"></li>
<li>另外，随着position&#x3D;1的列表项重新进入屏幕，position&#x3D;7的列表项也会被移出屏幕，该位置的列表项同样会进入<code>mCachedViews</code>，即RecyclerView是双向缓存的。<img src="/posts/1353791827/%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%86%85%E7%9A%84%E5%8F%AF%E8%A7%81%E5%88%97%E8%A1%A8%E9%A1%B9%E6%9A%82%E6%97%B6%E4%BB%8E%E5%BD%93%E5%89%8D%E5%B1%8F%E5%B9%95%E5%89%A5%E7%A6%BB%E4%B8%B4%E6%97%B6%E7%BC%93%E5%AD%98%E5%88%B0mAttachedScrap4.png" alt="当前屏幕内的可见列表项暂时从当前屏幕剥离临时缓存到mAttachedScrap4"><h3 id="mViewCacheExtension"><a href="#mViewCacheExtension" class="headerlink" title="mViewCacheExtension"></a>mViewCacheExtension</h3><code>mViewCacheExtension</code>主要用于提供额外的、可由开发人员自由控制的缓存层级，属于非常规使用的情况，因此这里暂不展开讲。<h3 id="mRecyclerPool"><a href="#mRecyclerPool" class="headerlink" title="mRecyclerPool"></a>mRecyclerPool</h3><code>mRecyclerPool</code>主要用于「<strong>按不同的itemType分别存放超出mCachedViews限制的、被移出屏幕的列表项</strong>」，其会先以SparseArray区分不同的itemType，然后每种itemType对应的值又以ArrayList的形式持有着每个列表项的ViewHolder对象，每种itemType的ArrayList大小限制<strong>默认为5</strong>。<figure class="highlight java"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RecycledViewPool</span> &#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_MAX_SCRAP</span> <span class="operator">=</span> <span class="number">5</span>;  </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ScrapData</span> &#123;  </span><br><span class="line">        <span class="keyword">final</span> ArrayList&lt;ViewHolder&gt; mScrapHeap = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="type">int</span> <span class="variable">mMaxScrap</span> <span class="operator">=</span> DEFAULT_MAX_SCRAP;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">mCreateRunningAverageNs</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">        <span class="type">long</span> <span class="variable">mBindRunningAverageNs</span> <span class="operator">=</span> <span class="number">0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    SparseArray&lt;ScrapData&gt; mScrap = <span class="keyword">new</span> <span class="title class_">SparseArray</span>&lt;&gt;();  </span><br><span class="line">    ...  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
由于<code>mCachedViews</code>默认的大小限制仅为2，因此，当滑出屏幕的列表项超过2个后，就会按照<strong>先进先出</strong>的顺序，依次将ViewHolder对象从<code>mCachedViews</code>移出，并按itemType放入RecycledViewPool中的不同ArrayList。<br>这种缓存结构主要考虑的是随着被滑出屏幕列表项的增多，以及被滑出距离的越来越远，重新进入屏幕内的可能性也随之降低。于是Recycler就在时间与空间上做了一个权衡，允许相同itemType的ViewHolder被提取复用，只需要重新绑定数据即可。<br>这样一来，既可以避免无限增长的ViewHolder对象缓存挤占了原本就紧张的内存空间，又可以减少回调相比较之下执行代价更加昂贵的<code>onCreateViewHolder</code>方法。<br>同样我们用几张流程示意图来演示这种情况，这些示意图将在前面的<code>mCachedViews</code>示意图基础上继续操作：  </li>
<li>假设目前存在于<code>mCachedViews</code>中的仍是position&#x3D;0及position&#x3D;1这两个列表项。    </li>
<li>当我们继续向上滑动时，position&#x3D;2的列表项会尝试进入<code>mCachedViews</code>，由于超出了<code>mCachedViews</code>的容量限制，position&#x3D;0的列表项会从<code>mCachedViews</code>中被移出，并放入RecycledViewPool中itemType为0的ArrayList，即图中的情况①。<img src="/posts/1353791827/mRecyclerPool1.png" alt="mRecyclerPool1"></li>
<li>同时，底部的一个新的列表项也将随着滑动手势进入到屏幕内，但由于此时<code>mAttachedScrap</code>、<code>mCachedViews</code>、<code>mRecyclerPool</code>均没有合适的ViewHolder对象可以提供给其复用，因此该列表项只能执行<code>onCreateViewHolder</code>与<code>onBindViewHolder</code>这2个方法的回调，即图中的情况②。</li>
<li>等到position&#x3D;2的列表项被完全移出了屏幕后，也就顺利进入了<code>mCachedViews</code>中。<img src="/posts/1353791827/mRecyclerPool2.png" alt="mRecyclerPool2"></li>
<li>我们继续保持向上滑动的手势，此时，由于下一个待进入屏幕的列表项与position&#x3D;0的列表项的itemType相同，因此我们可以在走到从<code>mRecyclerPool</code>查找合适的ViewHolder对象这一步时，根据itemType找到对应的ArrayList，再取出其中的1个ViewHolder对象进行复用，即图中的情况①。</li>
<li>由于itemType类型一致，其关联的视图可以复用，因此只需要重新绑定数据即可，即符合前面所述的「次优情况」。<img src="/posts/1353791827/mRecyclerPool3.png" alt="mRecyclerPool3"></li>
<li>②③ 情况与前面的一致，此处不再赘余。  <h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table>
<thead>
<tr>
<th></th>
<th>RecyclerView缓存复用机制</th>
</tr>
</thead>
<tbody><tr>
<td>对象</td>
<td>ViewHolder（包含列表项视图(itemView)的封装容器）</td>
</tr>
<tr>
<td>目的</td>
<td>减少对<code>onCreateViewHolder</code>、<code>onBindViewHolder</code>这2个方法的回调</td>
</tr>
<tr>
<td>好处</td>
<td>1. 避免重复创建不必要的视图<br>2. 避免重复执行昂贵的<code>findViewById</code></td>
</tr>
<tr>
<td>效果</td>
<td>改善性能 、提升应用响应能力、降低功耗</td>
</tr>
<tr>
<td>核心类</td>
<td><code>Recycler</code>、<code>RecyclerViewPool</code></td>
</tr>
<tr>
<td>缓存结构</td>
<td><code>mChangedScrap</code>&#x2F;<code>mAttachedScrap</code>、<code>mCachedViews</code>、<code>mViewCacheExtension</code>、<code>mRecyclerPool</code></td>
</tr>
</tbody></table>
</li>
</ol>
<table>
<thead>
<tr>
<th>缓存结构</th>
<th>容器类型</th>
<th>容量限制</th>
<th>缓存用途</th>
<th>优先级顺序<br>(数值越小，<br>优先级越高)</th>
</tr>
</thead>
<tbody><tr>
<td><code>mChangedScrap</code>&#x2F;<code>mAttachedScrap</code></td>
<td><code>ArrayList</code></td>
<td>无，一般为屏幕内总的可见列表项数</td>
<td>临时存放仍在当前屏幕可见、但被标记为「移除」或「重用」的列表项</td>
<td>0</td>
</tr>
<tr>
<td><code>mCachedViews</code></td>
<td><code>ArrayList</code></td>
<td>默认为2</td>
<td>存放已被移出屏幕、但有可能很快重新进入屏幕的列表项</td>
<td>1</td>
</tr>
<tr>
<td><code>mViewCacheExtension</code></td>
<td>开发者自己定义</td>
<td>无</td>
<td>提供额外的可由开发人员自由控制的缓存层级</td>
<td>2</td>
</tr>
<tr>
<td><code>mRecyclerPool</code></td>
<td><code>SparseArray&lt;ArrayList&gt;</code></td>
<td>每种<code>ItemType</code>默认为5</td>
<td>按不同<code>itemType</code>分别存放超出<code>mCachedViews</code>限制的、被移出屏幕的列表项</td>
<td>3</td>
</tr>
</tbody></table>
<h1 id="代码：baseadapter-recyclerview"><a href="#代码：baseadapter-recyclerview" class="headerlink" title="代码：baseadapter-recyclerview"></a><a target="_blank" rel="noopener" href="https://github.com/hongyangAndroid/baseAdapter/tree/master/baseadapter-recyclerview">代码：baseadapter-recyclerview</a></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">├── Common</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main</span><br><span class="line">│           └── java</span><br><span class="line">│               └── utils</span><br><span class="line">│                   └── adapter.rvadapter</span><br><span class="line">│                       ── CommonRvAdapter.java</span><br><span class="line">│                       ── MultiItemTypeAdapter.java</span><br><span class="line">│                       └── base</span><br><span class="line">│                           ── ItemViewDelegate.java</span><br><span class="line">│                           ── ItemViewDelegateManager.java</span><br><span class="line">│                           ── ViewHolder.java</span><br><span class="line">│                       └── utils</span><br><span class="line">│                           ── WrapperUtils.java</span><br><span class="line">│                       └── wrapper</span><br><span class="line">│                           ── EmptyWrapper.java</span><br><span class="line">│                           ── HeaderAndFooterWrapper.java</span><br><span class="line">│                           ── LoadMoreWrapper.java</span><br></pre></td></tr></table></figure>

<h2 id="具体工具类代码"><a href="#具体工具类代码" class="headerlink" title="具体工具类代码"></a>具体工具类代码</h2><h3 id="CommonRvAdapter-java"><a href="#CommonRvAdapter-java" class="headerlink" title="CommonRvAdapter.java"></a>CommonRvAdapter.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ItemViewDelegate;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ViewHolder;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CommonRvAdapter</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">MultiItemTypeAdapter</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">protected</span> Context mContext;   </span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> mLayoutId;   </span><br><span class="line">    <span class="keyword">protected</span> List&lt;T&gt; mDatas;  </span><br><span class="line">    <span class="keyword">protected</span> LayoutInflater mInflater;   </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CommonRvAdapter</span><span class="params">(<span class="keyword">final</span> Context context, <span class="keyword">final</span> <span class="type">int</span> layoutId)</span> &#123;        </span><br><span class="line">        <span class="built_in">super</span>(context);                                                        </span><br><span class="line">        mContext = context;     </span><br><span class="line">        mInflater = LayoutInflater.from(context); </span><br><span class="line">        mLayoutId = layoutId;     </span><br><span class="line">        addItemViewDelegate(<span class="keyword">new</span> <span class="title class_">ItemViewDelegate</span>&lt;T&gt;() &#123;   </span><br><span class="line">            <span class="meta">@Override</span>      </span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewLayoutId</span><span class="params">()</span> &#123;    </span><br><span class="line">                <span class="keyword">return</span> layoutId;    </span><br><span class="line">            &#125;        </span><br><span class="line">            <span class="meta">@Override</span>  </span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isForViewType</span><span class="params">(T item, <span class="type">int</span> position)</span> &#123;    </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;  </span><br><span class="line">            &#125;       </span><br><span class="line">            <span class="meta">@Override</span>   </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">convert</span><span class="params">(ViewHolder holder, T t, <span class="type">int</span> position)</span> &#123;     </span><br><span class="line">                CommonRvAdapter.<span class="built_in">this</span>.convert(holder, t, position);  </span><br><span class="line">            &#125;      </span><br><span class="line">        &#125;); </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDatas</span><span class="params">(List&lt;T&gt; datas)</span> &#123;    </span><br><span class="line">        <span class="keyword">if</span> (datas == <span class="literal">null</span>) &#123;  </span><br><span class="line">            datas = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        &#125;       </span><br><span class="line">        mDatas = datas;    </span><br><span class="line">        <span class="built_in">super</span>.setDatas(mDatas); </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">convert</span><span class="params">(ViewHolder holder, T t, <span class="type">int</span> position)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="MultiItemTypeAdapter-java"><a href="#MultiItemTypeAdapter-java" class="headerlink" title="MultiItemTypeAdapter.java"></a>MultiItemTypeAdapter.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ItemViewDelegate;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ItemViewDelegateManager;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ViewHolder;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiItemTypeAdapter</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.Adapter&lt;ViewHolder&gt; &#123; </span><br><span class="line">    <span class="keyword">protected</span> Context mContext;    </span><br><span class="line">    <span class="keyword">protected</span> List&lt;T&gt; mDatas;    </span><br><span class="line">    <span class="keyword">protected</span> ItemViewDelegateManager mItemViewDelegateManager;    </span><br><span class="line">    <span class="keyword">protected</span> OnItemClickListener mOnItemClickListener;    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiItemTypeAdapter</span><span class="params">(Context context)</span> &#123;       </span><br><span class="line">        mContext = context;       </span><br><span class="line">        mItemViewDelegateManager = <span class="keyword">new</span> <span class="title class_">ItemViewDelegateManager</span>(); </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDatas</span><span class="params">(List&lt;T&gt; datas)</span> &#123;      </span><br><span class="line">        <span class="keyword">if</span> (datas == <span class="literal">null</span>) &#123;     </span><br><span class="line">            datas = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();      </span><br><span class="line">        &#125;       </span><br><span class="line">        mDatas = datas;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(<span class="type">int</span> position)</span> &#123;   </span><br><span class="line">        <span class="keyword">if</span> (!useItemViewDelegateManager()) &#123;   </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">super</span>.getItemViewType(position);  </span><br><span class="line">        &#125;        </span><br><span class="line">        <span class="keyword">return</span> mItemViewDelegateManager.getItemViewType(mDatas.get(position), position);</span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>   </span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="type">int</span> viewType)</span> &#123; </span><br><span class="line">        <span class="type">ItemViewDelegate</span> <span class="variable">itemViewDelegate</span> <span class="operator">=</span> mItemViewDelegateManager.getItemViewDelegate(viewType);   </span><br><span class="line">        <span class="type">int</span> <span class="variable">layoutId</span> <span class="operator">=</span> itemViewDelegate.getItemViewLayoutId();     </span><br><span class="line">        <span class="type">ViewHolder</span> <span class="variable">holder</span> <span class="operator">=</span> ViewHolder.createViewHolder(mContext, parent, layoutId);  </span><br><span class="line">        onViewHolderCreated(holder, holder.getConvertView());       </span><br><span class="line">        setListener(parent, holder, viewType);     </span><br><span class="line">        <span class="keyword">return</span> holder; </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewHolderCreated</span><span class="params">(ViewHolder holder, View itemView)</span> &#123;    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">convert</span><span class="params">(ViewHolder holder, T t)</span> &#123;     </span><br><span class="line">        mItemViewDelegateManager.convert(holder, t, holder.getAdapterPosition());  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">(<span class="type">int</span> viewType)</span> &#123;      </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;   </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setListener</span><span class="params">(<span class="keyword">final</span> ViewGroup parent, <span class="keyword">final</span> ViewHolder viewHolder, <span class="type">int</span> viewType)</span> &#123;   </span><br><span class="line">        <span class="keyword">if</span> (!isEnabled(viewType)) &#123;  </span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125;     </span><br><span class="line">        viewHolder.getConvertView().setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>      </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123; </span><br><span class="line">                <span class="keyword">if</span> (mOnItemClickListener != <span class="literal">null</span>) &#123;  </span><br><span class="line">                    <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> viewHolder.getAdapterPosition();       </span><br><span class="line">                    mOnItemClickListener.onItemClick(v, viewHolder, position);   </span><br><span class="line">                &#125;       </span><br><span class="line">            &#125;     </span><br><span class="line">        &#125;);       </span><br><span class="line">        viewHolder.getConvertView().setOnLongClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnLongClickListener() &#123;  </span><br><span class="line">            <span class="meta">@Override</span>          </span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onLongClick</span><span class="params">(View v)</span> &#123;      </span><br><span class="line">                <span class="keyword">if</span> (mOnItemClickListener != <span class="literal">null</span>) &#123;   </span><br><span class="line">                    <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> viewHolder.getAdapterPosition();      </span><br><span class="line">                    <span class="keyword">return</span> mOnItemClickListener.onItemLongClick(v, viewHolder, position);  </span><br><span class="line">                &#125;           </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;        </span><br><span class="line">            &#125;     </span><br><span class="line">        &#125;);  </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="type">int</span> position)</span> &#123; </span><br><span class="line">        convert(holder, mDatas.get(position));  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;    </span><br><span class="line">        <span class="type">int</span> <span class="variable">itemCount</span> <span class="operator">=</span> mDatas.size();    </span><br><span class="line">        <span class="keyword">return</span> itemCount;   </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getDatas</span><span class="params">()</span> &#123;    </span><br><span class="line">        <span class="keyword">return</span> mDatas;  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MultiItemTypeAdapter <span class="title function_">addItemViewDelegate</span><span class="params">(ItemViewDelegate&lt;T&gt; itemViewDelegate)</span> &#123;   </span><br><span class="line">        mItemViewDelegateManager.addDelegate(itemViewDelegate);     </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>; </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MultiItemTypeAdapter <span class="title function_">addItemViewDelegate</span><span class="params">(<span class="type">int</span> viewType, ItemViewDelegate&lt;T&gt; itemViewDelegate)</span> &#123;      </span><br><span class="line">        mItemViewDelegateManager.addDelegate(viewType, itemViewDelegate);       </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">useItemViewDelegateManager</span><span class="params">()</span> &#123;     </span><br><span class="line">        <span class="keyword">return</span> mItemViewDelegateManager.getItemViewDelegateCount() &gt; <span class="number">0</span>;  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OnItemClickListener</span> &#123;   </span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">onItemClick</span><span class="params">(View view, RecyclerView.ViewHolder holder, <span class="type">int</span> position)</span>;  </span><br><span class="line">        <span class="type">boolean</span> <span class="title function_">onItemLongClick</span><span class="params">(View view, RecyclerView.ViewHolder holder, <span class="type">int</span> position)</span>; </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOnItemClickListener</span><span class="params">(OnItemClickListener onItemClickListener)</span> &#123;    </span><br><span class="line">        <span class="built_in">this</span>.mOnItemClickListener = onItemClickListener;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ItemViewDelegate-java"><a href="#ItemViewDelegate-java" class="headerlink" title="ItemViewDelegate.java"></a>ItemViewDelegate.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.base;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemViewDelegate</span>&lt;T&gt; &#123; </span><br><span class="line">    <span class="type">int</span> <span class="title function_">getItemViewLayoutId</span><span class="params">()</span>;  </span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isForViewType</span><span class="params">(T item, <span class="type">int</span> position)</span>; </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">convert</span><span class="params">(ViewHolder holder, T t, <span class="type">int</span> position)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ItemViewDelegateManager-java"><a href="#ItemViewDelegateManager-java" class="headerlink" title="ItemViewDelegateManager.java"></a>ItemViewDelegateManager.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.base;</span><br><span class="line"><span class="keyword">import</span> androidx.collection.SparseArrayCompat;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ItemViewDelegateManager</span>&lt;T&gt; &#123;   </span><br><span class="line">    SparseArrayCompat&lt;ItemViewDelegate&lt;T&gt;&gt; delegates = <span class="keyword">new</span> <span class="title class_">SparseArrayCompat</span>();   </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewDelegateCount</span><span class="params">()</span> &#123;   </span><br><span class="line">        <span class="keyword">return</span> delegates.size();  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemViewDelegateManager&lt;T&gt; <span class="title function_">addDelegate</span><span class="params">(ItemViewDelegate&lt;T&gt; delegate)</span> &#123;    </span><br><span class="line">        <span class="type">int</span> <span class="variable">viewType</span> <span class="operator">=</span> delegates.size();   </span><br><span class="line">        <span class="keyword">if</span> (delegate != <span class="literal">null</span>) &#123;          </span><br><span class="line">            delegates.put(viewType, delegate);      </span><br><span class="line">            viewType++;     </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;  </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemViewDelegateManager&lt;T&gt; <span class="title function_">addDelegate</span><span class="params">(<span class="type">int</span> viewType, ItemViewDelegate&lt;T&gt; delegate)</span> &#123;    </span><br><span class="line">        <span class="keyword">if</span> (delegates.get(viewType) != <span class="literal">null</span>) &#123;     </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;An ItemViewDelegate is already registered for the viewType = &quot;</span> + viewType + <span class="string">&quot;. Already registered ItemViewDelegate is &quot;</span> + delegates.get(viewType));</span><br><span class="line">        &#125;        </span><br><span class="line">        delegates.put(viewType, delegate);  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>; </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemViewDelegateManager&lt;T&gt; <span class="title function_">removeDelegate</span><span class="params">(ItemViewDelegate&lt;T&gt; delegate)</span> &#123; </span><br><span class="line">        <span class="keyword">if</span> (delegate == <span class="literal">null</span>) &#123;       </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;ItemViewDelegate is null&quot;</span>);  </span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="type">int</span> <span class="variable">indexToRemove</span> <span class="operator">=</span> delegates.indexOfValue(delegate);   </span><br><span class="line">        <span class="keyword">if</span> (indexToRemove &gt;= <span class="number">0</span>) &#123;    </span><br><span class="line">            delegates.removeAt(indexToRemove);    </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemViewDelegateManager&lt;T&gt; <span class="title function_">removeDelegate</span><span class="params">(<span class="type">int</span> itemType)</span> &#123;   </span><br><span class="line">        <span class="type">int</span> <span class="variable">indexToRemove</span> <span class="operator">=</span> delegates.indexOfKey(itemType);   </span><br><span class="line">        <span class="keyword">if</span> (indexToRemove &gt;= <span class="number">0</span>) &#123;      </span><br><span class="line">            delegates.removeAt(indexToRemove);     </span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;  </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(T item, <span class="type">int</span> position)</span> &#123;   </span><br><span class="line">        <span class="type">int</span> <span class="variable">delegatesCount</span> <span class="operator">=</span> delegates.size();    </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> delegatesCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;  </span><br><span class="line">            ItemViewDelegate&lt;T&gt; delegate = delegates.valueAt(i);   </span><br><span class="line">            <span class="keyword">if</span> (delegate.isForViewType(item, position)) &#123;      </span><br><span class="line">                <span class="keyword">return</span> delegates.keyAt(i);      </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;   </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No ItemViewDelegate added that matches position=&quot;</span> + position + <span class="string">&quot; in data source&quot;</span>); </span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">convert</span><span class="params">(ViewHolder holder, T item, <span class="type">int</span> position)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">delegatesCount</span> <span class="operator">=</span> delegates.size();    </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; delegatesCount; i++) &#123;     </span><br><span class="line">            ItemViewDelegate&lt;T&gt; delegate = delegates.valueAt(i);    </span><br><span class="line">            <span class="keyword">if</span> (delegate.isForViewType(item, position)) &#123; </span><br><span class="line">                delegate.convert(holder, item, position); </span><br><span class="line">                <span class="keyword">return</span>;       </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;      </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No ItemViewDelegateManager added that matches position=&quot;</span> + position + <span class="string">&quot; in data source&quot;</span>);</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemViewDelegate <span class="title function_">getItemViewDelegate</span><span class="params">(<span class="type">int</span> viewType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> delegates.get(viewType); </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewLayoutId</span><span class="params">(<span class="type">int</span> viewType)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> getItemViewDelegate(viewType).getItemViewLayoutId();</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(ItemViewDelegate itemViewDelegate)</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> delegates.indexOfValue(itemViewDelegate);   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ViewHolder-java"><a href="#ViewHolder-java" class="headerlink" title="ViewHolder.java"></a>ViewHolder.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Typeface;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.text.util.Linkify;</span><br><span class="line"><span class="keyword">import</span> android.util.SparseArray;</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.AlphaAnimation;</span><br><span class="line"><span class="keyword">import</span> android.widget.Checkable;</span><br><span class="line"><span class="keyword">import</span> android.widget.ImageView;</span><br><span class="line"><span class="keyword">import</span> android.widget.ProgressBar;</span><br><span class="line"><span class="keyword">import</span> android.widget.RatingBar;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewHolder</span> <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.ViewHolder &#123;</span><br><span class="line">    <span class="keyword">private</span> SparseArray&lt;View&gt; mViews;</span><br><span class="line">    <span class="keyword">private</span> View mConvertView;</span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ViewHolder</span><span class="params">(Context context, View itemView)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(itemView);</span><br><span class="line">        mContext = context;</span><br><span class="line">        mConvertView = itemView;</span><br><span class="line">        mViews = <span class="keyword">new</span> <span class="title class_">SparseArray</span>&lt;View&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ViewHolder <span class="title function_">createViewHolder</span><span class="params">(Context context, View itemView)</span> &#123;</span><br><span class="line">        <span class="type">ViewHolder</span> <span class="variable">holder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViewHolder</span>(context, itemView);</span><br><span class="line">        <span class="keyword">return</span> holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ViewHolder <span class="title function_">createViewHolder</span><span class="params">(Context context, ViewGroup parent, <span class="type">int</span> layoutId)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">itemView</span> <span class="operator">=</span> LayoutInflater.from(context).inflate(layoutId, parent, <span class="literal">false</span>);</span><br><span class="line">        <span class="type">ViewHolder</span> <span class="variable">holder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ViewHolder</span>(context, itemView);</span><br><span class="line">        <span class="keyword">return</span> holder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过viewId获取控件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">View</span>&gt; T <span class="title function_">getView</span><span class="params">(<span class="type">int</span> viewId)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> mViews.get(viewId);</span><br><span class="line">        <span class="keyword">if</span> (view == <span class="literal">null</span>) &#123;</span><br><span class="line">            view = mConvertView.findViewById(viewId);</span><br><span class="line">            mViews.put(viewId, view);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (T) view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> View <span class="title function_">getConvertView</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mConvertView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/****以下为辅助方法*****/</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置TextView的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> viewId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setText</span><span class="params">(<span class="type">int</span> viewId, String text)</span> &#123;</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">tv</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        tv.setText(text);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setImageResource</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> resId)</span> &#123;</span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setImageResource(resId);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setImageBitmap</span><span class="params">(<span class="type">int</span> viewId, Bitmap bitmap)</span> &#123;</span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setImageBitmap(bitmap);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setImageDrawable</span><span class="params">(<span class="type">int</span> viewId, Drawable drawable)</span> &#123;</span><br><span class="line">        <span class="type">ImageView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setImageDrawable(drawable);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setBackgroundColor</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setBackgroundColor(color);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setBackgroundRes</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> backgroundRes)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setBackgroundResource(backgroundRes);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setTextColor</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> textColor)</span> &#123;</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setTextColor(textColor);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setTextColorRes</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> textColorRes)</span> &#123;</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setTextColor(mContext.getResources().getColor(textColorRes));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(&quot;NewApi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setAlpha</span><span class="params">(<span class="type">int</span> viewId, <span class="type">float</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) &#123;</span><br><span class="line">            getView(viewId).setAlpha(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Pre-honeycomb hack to set Alpha value  </span></span><br><span class="line">            <span class="type">AlphaAnimation</span> <span class="variable">alpha</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlphaAnimation</span>(value, value);</span><br><span class="line">            alpha.setDuration(<span class="number">0</span>);</span><br><span class="line">            alpha.setFillAfter(<span class="literal">true</span>);</span><br><span class="line">            getView(viewId).startAnimation(alpha);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setVisible</span><span class="params">(<span class="type">int</span> viewId, <span class="type">boolean</span> visible)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setVisibility(visible ? View.VISIBLE : View.GONE);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">linkify</span><span class="params">(<span class="type">int</span> viewId)</span> &#123;</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        Linkify.addLinks(view, Linkify.ALL);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setTypeface</span><span class="params">(Typeface typeface, <span class="type">int</span>... viewIds)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> viewId : viewIds) &#123;</span><br><span class="line">            <span class="type">TextView</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">            view.setTypeface(typeface);</span><br><span class="line">            view.setPaintFlags(view.getPaintFlags() | Paint.SUBPIXEL_TEXT_FLAG);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setProgress</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> progress)</span> &#123;</span><br><span class="line">        <span class="type">ProgressBar</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setProgress(progress);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setProgress</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> progress, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        <span class="type">ProgressBar</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setMax(max);</span><br><span class="line">        view.setProgress(progress);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setMax</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        <span class="type">ProgressBar</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setMax(max);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setRating</span><span class="params">(<span class="type">int</span> viewId, <span class="type">float</span> rating)</span> &#123;</span><br><span class="line">        <span class="type">RatingBar</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setRating(rating);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setRating</span><span class="params">(<span class="type">int</span> viewId, <span class="type">float</span> rating, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">        <span class="type">RatingBar</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setMax(max);</span><br><span class="line">        view.setRating(rating);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setTag</span><span class="params">(<span class="type">int</span> viewId, Object tag)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setTag(tag);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setTag</span><span class="params">(<span class="type">int</span> viewId, <span class="type">int</span> key, Object tag)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setTag(key, tag);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setChecked</span><span class="params">(<span class="type">int</span> viewId, <span class="type">boolean</span> checked)</span> &#123;</span><br><span class="line">        <span class="type">Checkable</span> <span class="variable">view</span> <span class="operator">=</span> (Checkable) getView(viewId);</span><br><span class="line">        view.setChecked(checked);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关于事件的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setOnClickListener</span><span class="params">(<span class="type">int</span> viewId, View.OnClickListener listener)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setOnClickListener(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setOnTouchListener</span><span class="params">(<span class="type">int</span> viewId, View.OnTouchListener listener)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setOnTouchListener(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ViewHolder <span class="title function_">setOnLongClickListener</span><span class="params">(<span class="type">int</span> viewId, View.OnLongClickListener listener)</span> &#123;</span><br><span class="line">        <span class="type">View</span> <span class="variable">view</span> <span class="operator">=</span> getView(viewId);</span><br><span class="line">        view.setOnLongClickListener(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WrapperUtils-java"><a href="#WrapperUtils-java" class="headerlink" title="WrapperUtils.java"></a>WrapperUtils.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.GridLayoutManager;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.StaggeredGridLayoutManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WrapperUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SpanSizeCallback</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="title function_">getSpanSize</span><span class="params">(GridLayoutManager layoutManager, GridLayoutManager.SpanSizeLookup oldLookup, <span class="type">int</span> position)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">onAttachedToRecyclerView</span><span class="params">(RecyclerView.Adapter innerAdapter, RecyclerView recyclerView, <span class="keyword">final</span> SpanSizeCallback callback)</span> &#123;</span><br><span class="line">        innerAdapter.onAttachedToRecyclerView(recyclerView);</span><br><span class="line">        RecyclerView.<span class="type">LayoutManager</span> <span class="variable">layoutManager</span> <span class="operator">=</span> recyclerView.getLayoutManager();</span><br><span class="line">        <span class="keyword">if</span> (layoutManager <span class="keyword">instanceof</span> GridLayoutManager) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">GridLayoutManager</span> <span class="variable">gridLayoutManager</span> <span class="operator">=</span> (GridLayoutManager) layoutManager;</span><br><span class="line">            <span class="keyword">final</span> GridLayoutManager.<span class="type">SpanSizeLookup</span> <span class="variable">spanSizeLookup</span> <span class="operator">=</span> gridLayoutManager.getSpanSizeLookup();</span><br><span class="line">            gridLayoutManager.setSpanSizeLookup(<span class="keyword">new</span> <span class="title class_">GridLayoutManager</span>.SpanSizeLookup() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSpanSize</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> callback.getSpanSize(gridLayoutManager, spanSizeLookup, position);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            gridLayoutManager.setSpanCount(gridLayoutManager.getSpanCount());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setFullSpan</span><span class="params">(RecyclerView.ViewHolder holder)</span> &#123;</span><br><span class="line">        ViewGroup.<span class="type">LayoutParams</span> <span class="variable">lp</span> <span class="operator">=</span> holder.itemView.getLayoutParams();</span><br><span class="line">        <span class="keyword">if</span> (lp != <span class="literal">null</span> &amp;&amp; lp <span class="keyword">instanceof</span> StaggeredGridLayoutManager.LayoutParams) &#123;</span><br><span class="line">            StaggeredGridLayoutManager.<span class="type">LayoutParams</span> <span class="variable">p</span> <span class="operator">=</span> (StaggeredGridLayoutManager.LayoutParams) lp;</span><br><span class="line">            p.setFullSpan(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="EmptyWraper-java"><a href="#EmptyWraper-java" class="headerlink" title="EmptyWraper.java"></a>EmptyWraper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.wrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.GridLayoutManager;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ViewHolder;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.utils.WrapperUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmptyWrapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.Adapter&lt;RecyclerView.ViewHolder&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ITEM_TYPE_EMPTY</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> RecyclerView.Adapter mInnerAdapter;</span><br><span class="line">    <span class="keyword">private</span> View mEmptyView;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> mEmptyLayoutId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EmptyWrapper</span><span class="params">(RecyclerView.Adapter adapter)</span> &#123;</span><br><span class="line">        mInnerAdapter = adapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (mEmptyView != <span class="literal">null</span> || mEmptyLayoutId != <span class="number">0</span>) &amp;&amp; mInnerAdapter.getItemCount() == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RecyclerView.ViewHolder <span class="title function_">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="type">int</span> viewType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            ViewHolder holder;</span><br><span class="line">            <span class="keyword">if</span> (mEmptyView != <span class="literal">null</span>) &#123;</span><br><span class="line">                holder = ViewHolder.createViewHolder(parent.getContext(), mEmptyView);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                holder = ViewHolder.createViewHolder(parent.getContext(), parent, mEmptyLayoutId);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> holder;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.onCreateViewHolder(parent, viewType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttachedToRecyclerView</span><span class="params">(RecyclerView recyclerView)</span> &#123;</span><br><span class="line">        WrapperUtils.onAttachedToRecyclerView(mInnerAdapter, recyclerView, <span class="keyword">new</span> <span class="title class_">WrapperUtils</span>.SpanSizeCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSpanSize</span><span class="params">(GridLayoutManager gridLayoutManager, GridLayoutManager.SpanSizeLookup oldLookup, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> gridLayoutManager.getSpanCount();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (oldLookup != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> oldLookup.getSpanSize(position);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewAttachedToWindow</span><span class="params">(RecyclerView.ViewHolder holder)</span> &#123;</span><br><span class="line">        mInnerAdapter.onViewAttachedToWindow(holder);</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            WrapperUtils.setFullSpan(holder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> ITEM_TYPE_EMPTY;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.getItemViewType(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mInnerAdapter.onBindViewHolder(holder, position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.getItemCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmptyView</span><span class="params">(View emptyView)</span> &#123;</span><br><span class="line">        mEmptyView = emptyView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmptyView</span><span class="params">(<span class="type">int</span> layoutId)</span> &#123;</span><br><span class="line">        mEmptyLayoutId = layoutId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HeaderAndFooterWrapper-java"><a href="#HeaderAndFooterWrapper-java" class="headerlink" title="HeaderAndFooterWrapper.java"></a>HeaderAndFooterWrapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.wrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.collection.SparseArrayCompat;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.GridLayoutManager;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ViewHolder;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.utils.WrapperUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeaderAndFooterWrapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.Adapter&lt;RecyclerView.ViewHolder&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BASE_ITEM_TYPE_HEADER</span> <span class="operator">=</span> <span class="number">100000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BASE_ITEM_TYPE_FOOTER</span> <span class="operator">=</span> <span class="number">200000</span>;</span><br><span class="line">    <span class="keyword">private</span> SparseArrayCompat&lt;View&gt; mHeaderViews = <span class="keyword">new</span> <span class="title class_">SparseArrayCompat</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> SparseArrayCompat&lt;View&gt; mFootViews = <span class="keyword">new</span> <span class="title class_">SparseArrayCompat</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> RecyclerView.Adapter mInnerAdapter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HeaderAndFooterWrapper</span><span class="params">(RecyclerView.Adapter adapter)</span> &#123;</span><br><span class="line">        mInnerAdapter = adapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RecyclerView.ViewHolder <span class="title function_">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="type">int</span> viewType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mHeaderViews.get(viewType) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ViewHolder</span> <span class="variable">holder</span> <span class="operator">=</span> ViewHolder.createViewHolder(parent.getContext(), mHeaderViews.get(viewType));</span><br><span class="line">            <span class="keyword">return</span> holder;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mFootViews.get(viewType) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ViewHolder</span> <span class="variable">holder</span> <span class="operator">=</span> ViewHolder.createViewHolder(parent.getContext(), mFootViews.get(viewType));</span><br><span class="line">            <span class="keyword">return</span> holder;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.onCreateViewHolder(parent, viewType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHeaderViewPos(position)) &#123;</span><br><span class="line">            <span class="keyword">return</span> mHeaderViews.keyAt(position);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isFooterViewPos(position)) &#123;</span><br><span class="line">            <span class="keyword">return</span> mFootViews.keyAt(position - getHeadersCount() - getRealItemCount());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.getItemViewType(position - getHeadersCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getRealItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.getItemCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isHeaderViewPos(position)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (isFooterViewPos(position)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mInnerAdapter.onBindViewHolder(holder, position - getHeadersCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getHeadersCount() + getFootersCount() + getRealItemCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttachedToRecyclerView</span><span class="params">(RecyclerView recyclerView)</span> &#123;</span><br><span class="line">        WrapperUtils.onAttachedToRecyclerView(mInnerAdapter, recyclerView, <span class="keyword">new</span> <span class="title class_">WrapperUtils</span>.SpanSizeCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSpanSize</span><span class="params">(GridLayoutManager layoutManager, GridLayoutManager.SpanSizeLookup oldLookup, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">viewType</span> <span class="operator">=</span> getItemViewType(position);</span><br><span class="line">                <span class="keyword">if</span> (mHeaderViews.get(viewType) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> layoutManager.getSpanCount();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mFootViews.get(viewType) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> layoutManager.getSpanCount();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (oldLookup != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> oldLookup.getSpanSize(position);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewAttachedToWindow</span><span class="params">(RecyclerView.ViewHolder holder)</span> &#123;</span><br><span class="line">        mInnerAdapter.onViewAttachedToWindow(holder);</span><br><span class="line">        <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> holder.getLayoutPosition();</span><br><span class="line">        <span class="keyword">if</span> (isHeaderViewPos(position) || isFooterViewPos(position)) &#123;</span><br><span class="line">            WrapperUtils.setFullSpan(holder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isHeaderViewPos</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> position &lt; getHeadersCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isFooterViewPos</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> position &gt;= getHeadersCount() + getRealItemCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addHeaderView</span><span class="params">(View view)</span> &#123;</span><br><span class="line">        mHeaderViews.put(mHeaderViews.size() + BASE_ITEM_TYPE_HEADER, view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFootView</span><span class="params">(View view)</span> &#123;</span><br><span class="line">        mFootViews.put(mFootViews.size() + BASE_ITEM_TYPE_FOOTER, view);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeadersCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mHeaderViews.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFootersCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mFootViews.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LoadMoreWrapper-java"><a href="#LoadMoreWrapper-java" class="headerlink" title="LoadMoreWrapper.java"></a>LoadMoreWrapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xm597.common.utils.adapter.rvadapter.wrapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.GridLayoutManager;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.RecyclerView;</span><br><span class="line"><span class="keyword">import</span> androidx.recyclerview.widget.StaggeredGridLayoutManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.base.ViewHolder;</span><br><span class="line"><span class="keyword">import</span> com.xm597.common.utils.adapter.rvadapter.utils.WrapperUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadMoreWrapper</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>.Adapter&lt;RecyclerView.ViewHolder&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ITEM_TYPE_LOAD_MORE</span> <span class="operator">=</span> Integer.MAX_VALUE - <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span> RecyclerView.Adapter mInnerAdapter;</span><br><span class="line">    <span class="keyword">private</span> View mLoadMoreView;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> mLoadMoreLayoutId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoadMoreWrapper</span><span class="params">(RecyclerView.Adapter adapter)</span> &#123;</span><br><span class="line">        mInnerAdapter = adapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">hasLoadMore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mLoadMoreView != <span class="literal">null</span> || mLoadMoreLayoutId != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isShowLoadMore</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hasLoadMore() &amp;&amp; (position &gt;= mInnerAdapter.getItemCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemViewType</span><span class="params">(<span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isShowLoadMore(position)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ITEM_TYPE_LOAD_MORE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.getItemViewType(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RecyclerView.ViewHolder <span class="title function_">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="type">int</span> viewType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (viewType == ITEM_TYPE_LOAD_MORE) &#123;</span><br><span class="line">            ViewHolder holder;</span><br><span class="line">            <span class="keyword">if</span> (mLoadMoreView != <span class="literal">null</span>) &#123;</span><br><span class="line">                holder = ViewHolder.createViewHolder(parent.getContext(), mLoadMoreView);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                holder = ViewHolder.createViewHolder(parent.getContext(), parent, mLoadMoreLayoutId);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//对外抛出ViewHolder </span></span><br><span class="line">            <span class="keyword">if</span> (mGetViewHolderListener != <span class="literal">null</span>) &#123;</span><br><span class="line">                mGetViewHolderListener.getViewHolder(holder);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> holder;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.onCreateViewHolder(parent, viewType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(RecyclerView.ViewHolder holder, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isShowLoadMore(position)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mOnLoadMoreListener != <span class="literal">null</span>) &#123;</span><br><span class="line">                mOnLoadMoreListener.onLoadMoreRequested();</span><br><span class="line">                holder.itemView.setOnClickListener(v -&gt; mOnLoadMoreListener.onLoadMoreViewClick());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mInnerAdapter.onBindViewHolder(holder, position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttachedToRecyclerView</span><span class="params">(RecyclerView recyclerView)</span> &#123;</span><br><span class="line">        WrapperUtils.onAttachedToRecyclerView(mInnerAdapter, recyclerView, <span class="keyword">new</span> <span class="title class_">WrapperUtils</span>.SpanSizeCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSpanSize</span><span class="params">(GridLayoutManager layoutManager, GridLayoutManager.SpanSizeLookup oldLookup, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (isShowLoadMore(position)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> layoutManager.getSpanCount();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (oldLookup != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> oldLookup.getSpanSize(position);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onViewAttachedToWindow</span><span class="params">(RecyclerView.ViewHolder holder)</span> &#123;</span><br><span class="line">        mInnerAdapter.onViewAttachedToWindow(holder);</span><br><span class="line">        <span class="keyword">if</span> (isShowLoadMore(holder.getLayoutPosition())) &#123;</span><br><span class="line">            setFullSpan(holder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setFullSpan</span><span class="params">(RecyclerView.ViewHolder holder)</span> &#123;</span><br><span class="line">        ViewGroup.<span class="type">LayoutParams</span> <span class="variable">lp</span> <span class="operator">=</span> holder.itemView.getLayoutParams();</span><br><span class="line">        <span class="keyword">if</span> (lp != <span class="literal">null</span> &amp;&amp; lp <span class="keyword">instanceof</span> StaggeredGridLayoutManager.LayoutParams) &#123;</span><br><span class="line">            StaggeredGridLayoutManager.<span class="type">LayoutParams</span> <span class="variable">p</span> <span class="operator">=</span> (StaggeredGridLayoutManager.LayoutParams) lp;</span><br><span class="line">            p.setFullSpan(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getItemCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mInnerAdapter.getItemCount() + (hasLoadMore() ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OnLoadMoreListener</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">onLoadMoreRequested</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这个是根据使用场景自己添加的，是控件的点击事件        </span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">onLoadMoreViewClick</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OnLoadMoreListener mOnLoadMoreListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LoadMoreWrapper <span class="title function_">setOnLoadMoreListener</span><span class="params">(OnLoadMoreListener loadMoreListener)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (loadMoreListener != <span class="literal">null</span>) &#123;</span><br><span class="line">            mOnLoadMoreListener = loadMoreListener;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">getViewHolderListener</span> &#123;</span><br><span class="line">        <span class="comment">//对外抛出ViewHolder      </span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">getViewHolder</span><span class="params">(ViewHolder holder)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> getViewHolderListener mGetViewHolderListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setmGetViewHolderListener</span><span class="params">(getViewHolderListener mGetViewHolderListener)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mGetViewHolderListener = mGetViewHolderListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LoadMoreWrapper <span class="title function_">setLoadMoreView</span><span class="params">(View loadMoreView)</span> &#123;</span><br><span class="line">        mLoadMoreView = loadMoreView;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LoadMoreWrapper <span class="title function_">setLoadMoreView</span><span class="params">(<span class="type">int</span> layoutId)</span> &#123;</span><br><span class="line">        mLoadMoreLayoutId = layoutId;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="使用：给RecyclerView添加footer"><a href="#使用：给RecyclerView添加footer" class="headerlink" title="使用：给RecyclerView添加footer"></a>使用：给RecyclerView添加footer</h2><blockquote>
<p>背景：SmartRefreshLayout下有RecyclerView，SmartRefreshLayout已经有header、footer若对其进行动态替换footer也是可行的方案。</p>
<p>此处方案是给RecyclerView添加footer</p>
<p>特点：首次就会显示出来，在加载更多的时候也会存在，所以要酌情看需求使用</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//define member variablesprivate </span></span><br><span class="line">LoadMoreWrapper&lt;PositionSearchAdapter&gt; mLoadMoreWrapper;</span><br><span class="line"><span class="keyword">private</span> View noMoreView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initRecyclerView</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...    </span></span><br><span class="line">    mHomePositionAdapter = <span class="keyword">new</span> <span class="title class_">PositionSearchAdapter</span>(getContext());</span><br><span class="line">    mLoadMoreWrapper = <span class="keyword">new</span> <span class="title class_">LoadMoreWrapper</span>&lt;&gt;(mHomePositionAdapter);</span><br><span class="line">    mLoadMoreWrapper.setLoadMoreView(R.layout.view_home_position_no_more);</span><br><span class="line">    mLoadMoreWrapper.setOnLoadMoreListener(<span class="keyword">new</span> <span class="title class_">LoadMoreWrapper</span>.OnLoadMoreListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoadMoreRequested</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoadMoreViewClick</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fastClickAvoider != <span class="literal">null</span> &amp;&amp; !fastClickAvoider.isFastClick()) &#123;</span><br><span class="line">                <span class="comment">//do click           </span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    mLoadMoreWrapper.setmGetViewHolderListener(holder -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (holder != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//获取到ViewHolder            </span></span><br><span class="line">            noMoreView = holder.getView(R.id.linearLayout);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    mBinding.rvHomePosition.setAdapter(mLoadMoreWrapper);</span><br><span class="line">    mHomePositionAdapter.setItemClickListener((binding, holder, position) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (fastClickAvoider != <span class="literal">null</span> &amp;&amp; !fastClickAvoider.isFastClick()) &#123;</span><br><span class="line">            <span class="comment">//...      </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//...    </span></span><br><span class="line">    <span class="comment">// fresh view    </span></span><br><span class="line">    mLoadMoreWrapper.notifyDataSetChanged();</span><br><span class="line">    <span class="comment">//对NoMoreWrapper的ViewHolder做些UI操作    </span></span><br><span class="line">    <span class="keyword">if</span> (noMoreView != <span class="literal">null</span>) &#123;</span><br><span class="line">        noMoreView.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>其中布局文件：<code>view_home_position_no_more.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/linearLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;horizontal&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingTop</span>=<span class="string">&quot;@dimen/viewSize10&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingBottom</span>=<span class="string">&quot;@dimen/viewSize20&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;1dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@drawable/shape_login_gradient_line_left&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">&quot;@dimen/viewSize32&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">&quot;@dimen/viewSize32&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;前往搜索查看更多&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">&quot;#00b2ee&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;@dimen/textSize13&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;1dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@drawable/shape_login_gradient_line_right&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>shape_login_gradient_line_left.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">gradient</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:endColor</span>=<span class="string">&quot;#601D1D1D&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startColor</span>=<span class="string">&quot;@android:color/transparent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;1dp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>shape_login_gradient_line_right.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">gradient</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:endColor</span>=<span class="string">&quot;@android:color/transparent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startColor</span>=<span class="string">&quot;#601D1D1D&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:height</span>=<span class="string">&quot;1dp&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="rv改成自动换行"><a href="#rv改成自动换行" class="headerlink" title="rv改成自动换行"></a>rv改成自动换行</h2><p>添加依赖库</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;com.google.android:flexbox:2.0.1&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在代码中使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FlexboxLayoutManager</span> <span class="variable">layoutManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FlexboxLayoutManager</span>(<span class="built_in">this</span>);  </span><br><span class="line">layoutManager.setFlexDirection(FlexDirection.ROW);  </span><br><span class="line">mBinding.rvDistanceChangeAddress.setLayoutManager(layoutManager);  </span><br><span class="line">mBinding.rvDistanceChangeAddress.addItemDecoration(<span class="keyword">new</span> <span class="title class_">RecyclerView</span>.ItemDecoration() &#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getItemOffsets</span><span class="params">(<span class="meta">@NonNull</span> Rect outRect, <span class="meta">@NonNull</span> View view, <span class="meta">@NonNull</span> RecyclerView parent, <span class="meta">@NonNull</span> RecyclerView.State state)</span> &#123;  </span><br><span class="line">        <span class="type">int</span> <span class="variable">spacing</span> <span class="operator">=</span> <span class="number">10</span>;<span class="comment">//间距大小，单位是像素  </span></span><br><span class="line">        outRect.set(<span class="number">0</span>, spacing, spacing, <span class="number">0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><ul>
<li>要对列表的某控件加点击事件，须得在<code>onBindViewHolder</code>中获取对象并添加监听</li>
<li><code>notifyItemChanged(position)</code>不触发<code>onViewHolderBind</code>方法，原来是rv外层有个<code>LoadMoreWrapper</code>容器。解决：在 <code>setItemClickListener</code> 中添加 <code>mLoadMoreWrapper.notifyItemChanged(position);</code>才会触发</li>
</ul>
<h1 id="RecyclerView问题"><a href="#RecyclerView问题" class="headerlink" title="RecyclerView问题"></a>RecyclerView问题</h1><h2 id="recyclerView没有数据问题"><a href="#recyclerView没有数据问题" class="headerlink" title="recyclerView没有数据问题"></a>recyclerView没有数据问题</h2><p>RecyclerView.setLayoutManager 不设置这个 就是不行的 就是没有数据的</p>
<h2 id="RecyclerView-getChildAt-position-空指针"><a href="#RecyclerView-getChildAt-position-空指针" class="headerlink" title="RecyclerView.getChildAt(position)空指针"></a><code>RecyclerView.getChildAt(position)</code>空指针</h2><p>问题：程序中，屏幕可以获取到 6 个子 view，当 getChildAt(position)的position 为 6 或 7 的时候，会有空指针异常</p>
<p>原因：<code>getChildAt()</code>只能获取到屏幕上显示的部分</p>
<p>解决：<code>View childView = recyclerView.getLayoutManager().findViewByPosition(position);</code></p>
<h2 id="RecyclerView局部刷新，其他控件会闪动"><a href="#RecyclerView局部刷新，其他控件会闪动" class="headerlink" title="RecyclerView局部刷新，其他控件会闪动"></a><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903506781061128">RecyclerView局部刷新，其他控件会闪动</a></h2><ol>
<li><p>怀疑是宽高重新计算导致的，但写死宽高页面还是会闪动</p>
</li>
<li><p>怀疑更新到了这个ImageView，然后glide又重新加载了一次图片</p>
<p>在xml中写入<code>android:src:&quot;@mipmap/ic_launcher&quot;</code>还会闪动，排除2</p>
</li>
<li><p>怀疑刷新到了ImageView，这个item渲染了一次。</p>
<p>源码中：默认传入的是null，表示全部刷新</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyItemRangeChanged</span><span class="params">(<span class="type">int</span> positionStart, <span class="type">int</span> itemCount, Object payload)</span> &#123;</span><br><span class="line">    <span class="comment">// since onItemRangeChanged() is implemented by the app, it could do anything, including</span></span><br><span class="line">    <span class="comment">// removing itself from &#123;@link mObservers&#125; - and that could cause problems if</span></span><br><span class="line">    <span class="comment">// an iterator is used on the ArrayList &#123;@link mObservers&#125;.</span></span><br><span class="line">    <span class="comment">// to avoid such problems, just march thru the list in the reverse order.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> mObservers.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        mObservers.get(i).onItemRangeChanged(positionStart, itemCount, payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决：</p>
<p>调用更改：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用时，换个带payload参数的</span></span><br><span class="line">notifyItemChanged(position, <span class="number">1</span>);<span class="comment">//这个1是随意的，其他值也可以</span></span><br></pre></td></tr></table></figure>

<p>adapter更改：（增加一个onBindViewHolder，带payloads参数）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(TestDownLoadHolder holder, <span class="type">int</span> position, List&lt;Object&gt; payloads)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (payloads.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">//走原来的逻辑</span></span><br><span class="line">        onBindViewHolder(holder, position);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//有payloads的时候新的逻辑</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">AppInfoBean</span> <span class="variable">appInfoBean</span> <span class="operator">=</span> data.get(position);</span><br><span class="line">        <span class="keyword">if</span> (appInfoBean != <span class="literal">null</span>) &#123;</span><br><span class="line">            holder.mPbDownProgress.setProgress(appInfoBean.getProgress());</span><br><span class="line">            holder.mBtDownLoad.setText(appInfoBean.getDownloadPerSize());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBindViewHolder</span><span class="params">(<span class="keyword">final</span> TestDownLoadHolder holder, <span class="keyword">final</span> <span class="type">int</span> position)</span> &#123;</span><br><span class="line">	<span class="comment">//原来的逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="RecyclerView嵌套滑动冲突"><a href="#RecyclerView嵌套滑动冲突" class="headerlink" title="RecyclerView嵌套滑动冲突"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c5ccf0c38186">RecyclerView嵌套滑动冲突</a></h2><p>解决方案一：</p>
<p>父recyclerView拦截并消耗了点击事件，那么就不要让父recyclerView拦截呗<br><strong>自定义父recyclerView并重写onInterceptTouchEvent()方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParentRecyclerView</span> <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ParentRecyclerView</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ParentRecyclerView</span><span class="params">(<span class="meta">@NonNull</span> Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ParentRecyclerView</span><span class="params">(<span class="meta">@NonNull</span> Context context, <span class="meta">@Nullable</span> AttributeSet attrs, <span class="type">int</span> defStyle)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs, defStyle);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不拦截，继续分发下去</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onInterceptTouchEvent</span><span class="params">(MotionEvent e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案二：</p>
<p>子布局通知父布局不要拦截事件，通过requestDisallowInterceptTouchEvent方法干预事件分发过程<br> <strong>重写dispatchTouchEvent()方法，通知通知父层ViewGroup不要拦截点击事件</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ChildPresenter <span class="keyword">extends</span> <span class="title class_">RecyclerView</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChildPresenter</span><span class="params">(<span class="meta">@NonNull</span> Context context)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChildPresenter</span><span class="params">(<span class="meta">@NonNull</span> Context context, <span class="meta">@Nullable</span> AttributeSet attrs)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChildPresenter</span><span class="params">(<span class="meta">@NonNull</span> Context context, <span class="meta">@Nullable</span> AttributeSet attrs, <span class="type">int</span> defStyle)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs, defStyle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span>&#123;</span><br><span class="line">        <span class="comment">//父层ViewGroup不要拦截点击事件</span></span><br><span class="line">        getParent().requestDisallowInterceptTouchEvent(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案三：</p>
<p>通过事件分发规则我们知道，OnTouchListener优先级很高，可以通过这个来告诉父布局，不要拦截我的事件</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">holder.recyclerView.setOnTouchListener&#123; v, event -&gt;</span><br><span class="line">     <span class="keyword">when</span>(event.action)&#123;</span><br><span class="line">         <span class="comment">//当用户按下的时候，我们告诉父组件，不要拦截我的事件（这个时候子组件是可以正常响应事件的），拿起之后就会告诉父组件可以阻止。</span></span><br><span class="line">         MotionEvent.ACTION_DOWN, MotionEvent.ACTION_MOVE -&gt; v.parent.requestDisallowInterceptTouchEvent(<span class="literal">true</span>)</span><br><span class="line">         MotionEvent.ACTION_UP -&gt; v.parent.requestDisallowInterceptTouchEvent(<span class="literal">false</span>)</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ScrollView嵌套RecycleView导致滑动冲突或者显示不全的问题"><a href="#ScrollView嵌套RecycleView导致滑动冲突或者显示不全的问题" class="headerlink" title="ScrollView嵌套RecycleView导致滑动冲突或者显示不全的问题"></a>ScrollView嵌套RecycleView导致滑动冲突或者显示不全的问题</h2><ol>
<li><p>ScrollView替换成普通布局，然后RecycleView用的BaseMultiItemQuickAdapter多布局来写，也就是整个页面只有一个RecycleView，用来取代ScrollView，但是这样比较复杂。</p>
</li>
<li><p>对ScrollView和RecycleView的isNestedScrollingEnabled的值设置成false</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scrollViewTrans.isNestedScrollingEnabled = <span class="literal">false</span></span><br><span class="line">RecyclerView.isNestedScrollingEnabled = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果方法2不行，那我们直接简单粗暴一点，用NestedScrollView替换ScrollView，保证你的recycleView滑动起来刷刷的</p>
<p>Support库引用方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.support.v4.widget.NestedScrollView</span><br></pre></td></tr></table></figure>

<p>AndroidX引用方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">androidx.core.widget.NestedScrollView</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="NestedScrollView嵌套RecyclerView导致复用失效"><a href="#NestedScrollView嵌套RecyclerView导致复用失效" class="headerlink" title="NestedScrollView嵌套RecyclerView导致复用失效"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41628386/article/details/104966038">NestedScrollView嵌套RecyclerView导致复用失效</a></h2><p>NestedScrollView嵌套RecyclerView为解决滑动冲突通常为RecyclerView设置<code>setNestedScrollingEnabled(false)</code>，这样解决了滑动冲突，但是导致RecyclerView复用回收机制失效，RecyclerView会一次性创建并加载所有item，数据量少的情况可以忽略不复用的问题，数据量多会导致页面卡顿严重。<br>解决方法：<br>一、RecyclerView设置固定高度，<code>setNestedScrollingEnabled(true)</code>。RecyclerView可以复用但是会出现<strong>滑动冲突</strong>问题。<br>二、去掉NestedScrollView，将RecyclerView作为最外层布局，其他布局作为RecyclerView的HeadView或FooterView<br>三、使用CoordinatorLayout嵌套RecyclerView，实现页面滑动。CoordinatorLayout嵌套RecyclerView会出现<strong>滑动抖动</strong>现象 <a href="#%E8%A7%A3%E5%86%B3CoordinatorLayout+AppBarLayout%E6%BB%91%E5%8A%A8%E6%8A%96%E5%8A%A8%EF%BC%88%E5%9B%9E%E5%BC%B9%EF%BC%89%E9%97%AE%E9%A2%98">解决方案</a></p>
<h2 id="解决CoordinatorLayout-AppBarLayout滑动抖动（回弹）问题"><a href="#解决CoordinatorLayout-AppBarLayout滑动抖动（回弹）问题" class="headerlink" title="解决CoordinatorLayout+AppBarLayout滑动抖动（回弹）问题"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiongyiyang/article/details/89394356?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task">解决CoordinatorLayout+AppBarLayout滑动抖动（回弹）问题</a></h2><p>最近发现项目中一个使用CoordinatorLayout+AppBarLayout的界面发生了滑动不顺畅的问题，界面中使用了CoordinatorLayout，AppBarLayout，CollapsingToolbarLayout，Toolbar，RecyclerView，当向上滑动AppBarLayout并在惯性滑动未停止的时候滑动RecyclerView发生回弹<br>一、xml布局文件 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/behavior_demo_coordinatorLayout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:theme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:elevation</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_behavior</span>=<span class="string">&quot;com.example.utils.FlingBehavior&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/main.collapsing&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;250dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:contentScrim</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleMarginEnd</span>=<span class="string">&quot;64dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleMarginStart</span>=<span class="string">&quot;48dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">&quot;scroll|exitUntilCollapsed&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--其他布局--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/main.backdrop&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:scaleType</span>=<span class="string">&quot;centerCrop&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:src</span>=<span class="string">&quot;@drawable/img_bg&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;parallax&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">&quot;pin&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:popupTheme</span>=<span class="string">&quot;@style/ThemeOverlay.AppCompat.Light&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">android:paddingTop</span>=<span class="string">&quot;15dp&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:id</span>=<span class="string">&quot;@+id/iv_back&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:paddingStart</span>=<span class="string">&quot;15dp&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:paddingEnd</span>=<span class="string">&quot;15dp&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:src</span>=<span class="string">&quot;@drawable/ic_arrow_back_white_24dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:layout_alignParentRight</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:paddingStart</span>=<span class="string">&quot;15dp&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:paddingEnd</span>=<span class="string">&quot;15dp&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">android:src</span>=<span class="string">&quot;@drawable/ic_apps_white_24dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.TabLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/tabs&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;40dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;?attr/colorPrimary&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:tabIndicatorColor</span>=<span class="string">&quot;@color/colorAccent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:tabIndicatorHeight</span>=<span class="string">&quot;4dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:tabSelectedTextColor</span>=<span class="string">&quot;#000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:tabTextColor</span>=<span class="string">&quot;#fff&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>app:layout_behavior=&quot;com.example.utils.FlingBehavior&quot;</code>这个是自定义的用来解决抖动问题_</p>
</blockquote>
<p>二、解决办法</p>
<blockquote>
<p>自定义AppBarLayout.Behavior</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FlingBehavior</span> <span class="keyword">extends</span> <span class="title class_">AppBarLayout</span>.Behavior &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">TOP_CHILD_FLING_THRESHOLD</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isPositive;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FlingBehavior</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FlingBehavior</span><span class="params">(Context context, AttributeSet attrs)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//fling上滑appbar然后迅速fling下滑recycler时, HeaderBehavior的mScroller并未停止, 会导致上下来回晃动</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onNestedPreScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, AppBarLayout child, View target, <span class="type">int</span> dx, <span class="type">int</span> dy, <span class="type">int</span>[] consumed, <span class="type">int</span> type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (type == ViewCompat.TYPE_NON_TOUCH &amp;&amp; getTopAndBottomOffset() == <span class="number">0</span>) &#123; <span class="comment">//recyclerview的惯性比较大 ,会顶在头部一会儿, 到头直接干掉它的滑动</span></span><br><span class="line">            ViewCompat.stopNestedScroll(target, type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">super</span>.onNestedPreScroll(coordinatorLayout, child, target, dx, dy, consumed, type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onInterceptTouchEvent</span><span class="params">(CoordinatorLayout parent, AppBarLayout child, MotionEvent ev)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ev.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">scroller</span> <span class="operator">=</span> getSuperSuperField(<span class="built_in">this</span>, <span class="string">&quot;mScroller&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (scroller != <span class="literal">null</span> &amp;&amp; scroller <span class="keyword">instanceof</span> OverScroller) &#123;</span><br><span class="line">                <span class="type">OverScroller</span> <span class="variable">overScroller</span> <span class="operator">=</span> (OverScroller) scroller;</span><br><span class="line">                overScroller.abortAnimation();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onInterceptTouchEvent(parent, child, ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getSuperSuperField</span><span class="params">(Object paramClass, String paramString)</span> &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            field = paramClass.getClass().getSuperclass().getSuperclass().getDeclaredField(paramString);</span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            object = field.get(paramClass);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// --------------------------- end</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="LinearLayoutManager内部对齐"><a href="#LinearLayoutManager内部对齐" class="headerlink" title="LinearLayoutManager内部对齐"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41872247/article/details/106764746">LinearLayoutManager内部对齐</a></h2><p>自定义<code>LinearLayoutManger</code>，重写<code>smoothScrollToPosition</code>方法内部的<code>getVerticalSnapPreference()</code>、<code>getHorizontalSnapPreference()</code>的值为<code>SNAP_TO_START</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SnapLayoutManager</span> <span class="keyword">extends</span> <span class="title class_">LinearLayoutManager</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SnapLayoutManager</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(context);</span><br><span class="line">        <span class="built_in">this</span>.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">smoothScrollToPosition</span><span class="params">(RecyclerView recyclerView, RecyclerView.State state, <span class="type">int</span> position)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.smoothScrollToPosition(recyclerView, state, position);</span><br><span class="line"></span><br><span class="line">        <span class="type">LinearSmoothScroller</span> <span class="variable">smoothScroller</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LinearSmoothScroller</span>(context) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getVerticalSnapPreference</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> SNAP_TO_START;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getHorizontalSnapPreference</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> SNAP_TO_START;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        smoothScroller.setTargetPosition(position);</span><br><span class="line">        startSmoothScroll(smoothScroller);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/%E5%AE%89%E5%8D%93UI/" rel="tag"># 安卓UI</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/posts/3599255197/" rel="next" title="UI-WebView">
                <i class="fa fa-chevron-left"></i> UI-WebView
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/posts/853243834/" rel="prev" title="Fragment">
                Fragment <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">291</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#RecyclerView-%E4%BC%98%E5%8C%96"><span class="nav-text">RecyclerView 优化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E7%BA%A7%E5%88%97%E8%A1%A8"><span class="nav-text">二级列表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E9%80%82%E9%85%8D%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="nav-text">可扩展适配器实现步骤</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RecyclerView"><span class="nav-text">RecyclerView</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-text">RecyclerView整体架构设计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView%E7%9A%84%E9%87%8D%E8%A6%81%E6%88%90%E5%91%98"><span class="nav-text">RecyclerView的重要成员</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ViewHolder"><span class="nav-text">ViewHolder</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%BB%E4%BA%8610%E5%BC%A0%E5%9B%BE%EF%BC%8C%E5%B8%A6%E4%BD%A0%E6%90%9E%E5%AE%9ARecyclerView%E7%9A%84%E7%BC%93%E5%AD%98%E5%A4%8D%E7%94%A8%E6%9C%BA%E5%88%B6"><span class="nav-text">画了10张图，带你搞定RecyclerView的缓存复用机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView%E6%98%AF%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E5%8A%A8%E6%80%81%E5%88%97%E8%A1%A8%E7%9A%84%EF%BC%9F"><span class="nav-text">RecyclerView是如何构建动态列表的？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Recycler%E6%98%AF%E5%A6%82%E4%BD%95%E6%9F%A5%E6%89%BEViewHolder%E5%AF%B9%E8%B1%A1%E7%9A%84%EF%BC%9F"><span class="nav-text">Recycler是如何查找ViewHolder对象的？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mChangedScrap-x2F-mAttachedScrap"><span class="nav-text">mChangedScrap&#x2F;mAttachedScrap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mCachedViews"><span class="nav-text">mCachedViews</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mViewCacheExtension"><span class="nav-text">mViewCacheExtension</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mRecyclerPool"><span class="nav-text">mRecyclerPool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9Abaseadapter-recyclerview"><span class="nav-text">代码：baseadapter-recyclerview</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%B7%A5%E5%85%B7%E7%B1%BB%E4%BB%A3%E7%A0%81"><span class="nav-text">具体工具类代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CommonRvAdapter-java"><span class="nav-text">CommonRvAdapter.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MultiItemTypeAdapter-java"><span class="nav-text">MultiItemTypeAdapter.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ItemViewDelegate-java"><span class="nav-text">ItemViewDelegate.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ItemViewDelegateManager-java"><span class="nav-text">ItemViewDelegateManager.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ViewHolder-java"><span class="nav-text">ViewHolder.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WrapperUtils-java"><span class="nav-text">WrapperUtils.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EmptyWraper-java"><span class="nav-text">EmptyWraper.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HeaderAndFooterWrapper-java"><span class="nav-text">HeaderAndFooterWrapper.java</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LoadMoreWrapper-java"><span class="nav-text">LoadMoreWrapper.java</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%EF%BC%9A%E7%BB%99RecyclerView%E6%B7%BB%E5%8A%A0footer"><span class="nav-text">使用：给RecyclerView添加footer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rv%E6%94%B9%E6%88%90%E8%87%AA%E5%8A%A8%E6%8D%A2%E8%A1%8C"><span class="nav-text">rv改成自动换行</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AC%94%E8%AE%B0"><span class="nav-text">笔记</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RecyclerView%E9%97%AE%E9%A2%98"><span class="nav-text">RecyclerView问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#recyclerView%E6%B2%A1%E6%9C%89%E6%95%B0%E6%8D%AE%E9%97%AE%E9%A2%98"><span class="nav-text">recyclerView没有数据问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView-getChildAt-position-%E7%A9%BA%E6%8C%87%E9%92%88"><span class="nav-text">RecyclerView.getChildAt(position)空指针</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView%E5%B1%80%E9%83%A8%E5%88%B7%E6%96%B0%EF%BC%8C%E5%85%B6%E4%BB%96%E6%8E%A7%E4%BB%B6%E4%BC%9A%E9%97%AA%E5%8A%A8"><span class="nav-text">RecyclerView局部刷新，其他控件会闪动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RecyclerView%E5%B5%8C%E5%A5%97%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81"><span class="nav-text">RecyclerView嵌套滑动冲突</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ScrollView%E5%B5%8C%E5%A5%97RecycleView%E5%AF%BC%E8%87%B4%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81%E6%88%96%E8%80%85%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%85%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">ScrollView嵌套RecycleView导致滑动冲突或者显示不全的问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NestedScrollView%E5%B5%8C%E5%A5%97RecyclerView%E5%AF%BC%E8%87%B4%E5%A4%8D%E7%94%A8%E5%A4%B1%E6%95%88"><span class="nav-text">NestedScrollView嵌套RecyclerView导致复用失效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3CoordinatorLayout-AppBarLayout%E6%BB%91%E5%8A%A8%E6%8A%96%E5%8A%A8%EF%BC%88%E5%9B%9E%E5%BC%B9%EF%BC%89%E9%97%AE%E9%A2%98"><span class="nav-text">解决CoordinatorLayout+AppBarLayout滑动抖动（回弹）问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LinearLayoutManager%E5%86%85%E9%83%A8%E5%AF%B9%E9%BD%90"><span class="nav-text">LinearLayoutManager内部对齐</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>