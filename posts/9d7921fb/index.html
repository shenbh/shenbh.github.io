<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="private," />










<meta name="description" content="Flutter——数据库Drift开发详细教程(一)配置项 首先，让我们将Drift添加到你的项目中pubspec.yaml。除了核心Drift依赖项（drift以及drift_dev生成代码）之外，我们还添加了一个包，用于在相应的平台上打开数据库。  12345678910dependencies:  #  数据库  drift: ^2.26.0   drift_flutter: ^0.2.4">
<meta property="og:type" content="article">
<meta property="og:title" content="Flutter——数据库Drift开发详细教程">
<meta property="og:url" content="http://shenbh.github.io/posts/9d7921fb/index.html">
<meta property="og:site_name" content="积跬步">
<meta property="og:description" content="Flutter——数据库Drift开发详细教程(一)配置项 首先，让我们将Drift添加到你的项目中pubspec.yaml。除了核心Drift依赖项（drift以及drift_dev生成代码）之外，我们还添加了一个包，用于在相应的平台上打开数据库。  12345678910dependencies:  #  数据库  drift: ^2.26.0   drift_flutter: ^0.2.4">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://shenbh.github.io/posts/9d7921fb/b5ae5077bf674ee49c49639ae684b8ad.jpeg">
<meta property="og:image" content="http://shenbh.github.io/posts/9d7921fb/eaf30cfe029d469bb1aa213640d43a98.jpeg">
<meta property="og:image" content="http://shenbh.github.io/posts/9d7921fb/4047e959e0f94c52a103985140beaae1.jpeg">
<meta property="og:image" content="http://shenbh.github.io/posts/9d7921fb/43919e7b310b476eb07678587a265605.png">
<meta property="og:image" content="http://shenbh.github.io/posts/9d7921fb/9656efed83404db29342e33a7adf8372.png">
<meta property="article:published_time" content="2025-06-27T05:50:34.000Z">
<meta property="article:modified_time" content="2025-07-02T02:05:24.222Z">
<meta property="article:author" content="阿炳">
<meta property="article:tag" content="private">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://shenbh.github.io/posts/9d7921fb/b5ae5077bf674ee49c49639ae684b8ad.jpeg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shenbh.github.io/posts/9d7921fb/"/>





  <title>Flutter——数据库Drift开发详细教程 | 积跬步</title><meta name="robots" content="noindex">
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">积跬步</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Just do IT Now.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shenbh.github.io/posts/9d7921fb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="积跬步">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Flutter——数据库Drift开发详细教程</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2025-06-27T13:50:34+08:00">
                2025-06-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Flutter%E6%89%A9%E5%B1%95/" itemprop="url" rel="index">
                    <span itemprop="name">Flutter扩展</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Flutter——数据库Drift开发详细教程-一"><a href="#Flutter——数据库Drift开发详细教程-一" class="headerlink" title="Flutter——数据库Drift开发详细教程(一)"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013290250/article/details/147657628">Flutter——数据库Drift开发详细教程(一)</a></h1><h2 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h2><blockquote>
<p>首先，让我们将Drift添加到你的项目中<strong>pubspec.yaml</strong>。除了核心Drift依赖项（drift以及drift_dev生成代码）之外，我们还添加了一个包，用于在相应的平台上打开数据库。</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  #  数据库</span><br><span class="line">  drift: ^<span class="number">2.26</span><span class="number">.0</span> </span><br><span class="line">  drift_flutter: ^<span class="number">0.2</span><span class="number">.4</span></span><br><span class="line">  path_provider: ^<span class="number">2.1</span><span class="number">.5</span></span><br><span class="line">  path: ^<span class="number">1.9</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">dev_dependencies:</span><br><span class="line">  drift_dev: ^<span class="number">2.26</span><span class="number">.0</span></span><br><span class="line">  build_runner: ^<span class="number">2.4</span><span class="number">.15</span></span><br></pre></td></tr></table></figure>

<h2 id="数据库表类"><a href="#数据库表类" class="headerlink" title="数据库表类"></a>数据库表类</h2><blockquote>
<p>  每个使用 Drift 的项目都需要至少一个类来访问数据库。在本例中，我们假设这个数据库类定义在名为 的文件中database.dart，该文件位于 目录下的某个位置<strong>lib&#x2F;<strong>。当然，您可以将此类放在任何您喜欢的 Dart 文件中。<br>  这里我们要注意，提前在</strong>database.dart</strong>，相同目录添加<strong>空文件database.g.dart</strong></p>
</blockquote>
<ul>
<li>执行<code>dart run build_runner build</code> 一次生成所有必需的代码。</li>
<li><code>dart run build_runner watch</code>监视源代码中的更改，并通过增量重建生成代码。这适用于开发会话。</li>
</ul>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:drift/drift.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">part</span> <span class="string">&#x27;database.g.dart&#x27;</span>; <span class="comment">//执行 dart run build_runner build 会生成对应的操作当前表数据库代码</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoItems</span> <span class="keyword">extends</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line">    IntColumn <span class="keyword">get</span> id =&gt; integer().autoIncrement()();</span><br><span class="line">    TextColumn <span class="keyword">get</span> title =&gt; text().withLength(min: <span class="number">6</span>, max: <span class="number">32</span>)();</span><br><span class="line">    TextColumn <span class="keyword">get</span> content =&gt; text().named(<span class="string">&#x27;body&#x27;</span>)();</span><br><span class="line">    DateTimeColumn <span class="keyword">get</span> createdAt =&gt; dateTime().nullable()();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DriftDatabase</span>(tables: [TodoItems])</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppDatabase</span> <span class="keyword">extends</span> <span class="title">_</span>$<span class="title">AppDatabase</span> </span>&#123;</span><br><span class="line">    AppDatabase([QueryExecutor? executor]) : <span class="keyword">super</span>(executor ?? _openConnection());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">int</span> <span class="keyword">get</span> schemaVersion =&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> QueryExecutor _openConnection() &#123;</span><br><span class="line">        <span class="keyword">return</span> driftDatabase(</span><br><span class="line">            name: <span class="string">&#x27;my_database&#x27;</span>,</span><br><span class="line">            native: <span class="keyword">const</span> DriftNativeOptions(</span><br><span class="line">                <span class="comment">// By default, `driftDatabase` from `package:drift_flutter` stores the</span></span><br><span class="line">                <span class="comment">// database files in `getApplicationDocumentsDirectory()`.</span></span><br><span class="line">                databaseDirectory: getApplicationSupportDirectory,</span><br><span class="line">            ),</span><br><span class="line">            <span class="comment">// If you need web support, see https://drift.simonbinder.eu/platforms/web/</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="增删改查API使用"><a href="#增删改查API使用" class="headerlink" title="增删改查API使用"></a>增删改查API使用</h2><h3 id="增"><a href="#增" class="headerlink" title="增"></a>增</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建一条新数据对象</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems</span><br><span class="line">    .create((o) =&gt; o(title: <span class="string">&#x27;Title&#x27;</span>, content: <span class="string">&#x27;Content&#x27;</span>));</span><br><span class="line"><span class="comment">//2.创建新数据对象，并且可以执行创建方式</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems.create(</span><br><span class="line">    (o) =&gt; o(title: <span class="string">&#x27;Title&#x27;</span>, content: <span class="string">&#x27;New Content&#x27;</span>),</span><br><span class="line">    mode: InsertMode.replace);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.可以同时创建多个数据对象</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems.bulkCreate(</span><br><span class="line">    (o) =&gt; [</span><br><span class="line">        o(title: <span class="string">&#x27;Title 1&#x27;</span>, content: <span class="string">&#x27;Content 1&#x27;</span>),</span><br><span class="line">        o(title: <span class="string">&#x27;Title 2&#x27;</span>, content: <span class="string">&#x27;Content 2&#x27;</span>),</span><br><span class="line">    ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="删"><a href="#删" class="headerlink" title="删"></a>删</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.删除所有数据</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems.delete();</span><br><span class="line"><span class="comment">// 2.根据id删除某一条数据</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems.filter((f) =&gt; f.id(<span class="number">5</span>)).delete();</span><br></pre></td></tr></table></figure>

<h3 id="改"><a href="#改" class="headerlink" title="改"></a>改</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.更新所有数据</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems</span><br><span class="line">    .update((o) =&gt; o(content: Value(<span class="string">&#x27;New Content&#x27;</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.根据条件更新部分数据</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems</span><br><span class="line">    .filter((f) =&gt; f.id.isIn([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br><span class="line">    .update((o) =&gt; o(content: Value(<span class="string">&#x27;New Content&#x27;</span>)));</span><br></pre></td></tr></table></figure>

<h3 id="查"><a href="#查" class="headerlink" title="查"></a>查</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.获取所有数据</span></span><br><span class="line">managers.todoItems.<span class="keyword">get</span>().then((onValue) &#123;</span><br><span class="line">    <span class="keyword">this</span>.onValue = onValue;</span><br><span class="line">    setState(() &#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2.当数据流有所改变，则会更新</span></span><br><span class="line">managers.todoItems.watch();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.根据匹配ID获取某一个数据对象</span></span><br><span class="line"><span class="keyword">await</span> managers.todoItems.filter((f) =&gt; f.id(<span class="number">1</span>)).getSingle();</span><br></pre></td></tr></table></figure>

<h2 id="Demo列子"><a href="#Demo列子" class="headerlink" title="Demo列子"></a>Demo列子</h2><h3 id="DriftPage界面代码"><a href="#DriftPage界面代码" class="headerlink" title="DriftPage界面代码"></a>DriftPage界面代码</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:drift/drift.dart&#x27;</span> <span class="keyword">as</span> drift;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_demo/drift/database.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DriftPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> DriftPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    _DriftPageState createState() =&gt; _DriftPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_DriftPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">DriftPage</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">late</span> AppDatabase appDatabase;</span><br><span class="line">    <span class="built_in">String</span> content = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">late</span> $AppDatabaseManager managers;</span><br><span class="line">    <span class="built_in">List</span>&lt;TodoItem&gt; onValue = [];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">void</span> initState() &#123;</span><br><span class="line">        <span class="keyword">super</span>.initState();</span><br><span class="line">        appDatabase = AppDatabase();</span><br><span class="line">        managers = appDatabase.managers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build(BuildContext context) &#123;</span><br><span class="line">        <span class="keyword">return</span> Scaffold(</span><br><span class="line">            appBar: AppBar(</span><br><span class="line">                title: Text(<span class="string">&quot;drift&quot;</span>),</span><br><span class="line">            ),</span><br><span class="line">            body: SingleChildScrollView(</span><br><span class="line">                child: Container(</span><br><span class="line">                    child: Column(</span><br><span class="line">                        children: [</span><br><span class="line">                            ElevatedButton(</span><br><span class="line">                                onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                                    createTodoItem();</span><br><span class="line">                                &#125;,</span><br><span class="line">                                child: <span class="keyword">const</span> Text(<span class="string">&#x27;插入 insert&#x27;</span>),</span><br><span class="line">                            ),</span><br><span class="line">                            ElevatedButton(</span><br><span class="line">                                onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                                    selectTodoItems();</span><br><span class="line">                                &#125;,</span><br><span class="line">                                child: <span class="keyword">const</span> Text(<span class="string">&#x27;查询 select&#x27;</span>),</span><br><span class="line">                            ),</span><br><span class="line">                            ElevatedButton(</span><br><span class="line">                                onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                                    updateTodoItems();</span><br><span class="line">                                    setState(() &#123;&#125;);</span><br><span class="line">                                &#125;,</span><br><span class="line">                                child: <span class="keyword">const</span> Text(<span class="string">&#x27;更新 update&#x27;</span>),</span><br><span class="line">                            ),</span><br><span class="line">                            ElevatedButton(</span><br><span class="line">                                onPressed: () <span class="keyword">async</span> &#123;</span><br><span class="line">                                    deleteTodoItems();</span><br><span class="line">                                &#125;,</span><br><span class="line">                                child: <span class="keyword">const</span> Text(<span class="string">&#x27;删除 delete&#x27;</span>),</span><br><span class="line">                            ),</span><br><span class="line">                            listWidget(onValue)</span><br><span class="line">                        ],</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    listWidget(<span class="built_in">List</span>&lt;TodoItem&gt; onValue) &#123;</span><br><span class="line">        <span class="keyword">return</span> Column(</span><br><span class="line">            children: onValue</span><br><span class="line">            .map((item) =&gt; Column(</span><br><span class="line">                children: [</span><br><span class="line">                    Text(item.id.toString()),</span><br><span class="line">                    Text(item.title),</span><br><span class="line">                    Text(item.content),</span><br><span class="line">                ],</span><br><span class="line">            ))</span><br><span class="line">            .toList(),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Future&lt;<span class="keyword">void</span>&gt; selectTodoItems() <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="comment">// Get all items</span></span><br><span class="line">        managers.todoItems.<span class="keyword">get</span>().then((onValue) &#123;</span><br><span class="line">            <span class="keyword">this</span>.onValue = onValue;</span><br><span class="line">            setState(() &#123;&#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// A stream of all the todo items, updated in real-time</span></span><br><span class="line">        managers.todoItems.watch();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// To get a single item, apply a filter and call `getSingle`</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.filter((f) =&gt; f.id(<span class="number">1</span>)).getSingle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Future&lt;<span class="keyword">void</span>&gt; updateTodoItems() <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="comment">// 更新所有数据</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems</span><br><span class="line">            .update((o) =&gt; o(content: drift.Value(<span class="string">&#x27;New Content&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据条件更新部分数据</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems</span><br><span class="line">            .filter((f) =&gt; f.id.isIn([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]))</span><br><span class="line">            .update((o) =&gt; o(content: drift.Value(<span class="string">&#x27;New Content&#x27;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Future&lt;<span class="keyword">void</span>&gt; replaceTodoItems() <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="comment">// Replace a single item</span></span><br><span class="line">        <span class="keyword">var</span> obj = <span class="keyword">await</span> managers.todoItems.filter((o) =&gt; o.id(<span class="number">1</span>)).getSingle();</span><br><span class="line">        obj = obj.copyWith(content: <span class="string">&#x27;New Content&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.replace(obj);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Replace multiple items</span></span><br><span class="line">        <span class="keyword">var</span> objs =</span><br><span class="line">            <span class="keyword">await</span> managers.todoItems.filter((o) =&gt; o.id.isIn([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])).<span class="keyword">get</span>();</span><br><span class="line">        objs = objs.map((o) =&gt; o.copyWith(content: <span class="string">&#x27;New Content&#x27;</span>)).toList();</span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.bulkReplace(objs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Future&lt;<span class="keyword">void</span>&gt; createTodoItem() <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="comment">// Create a new item</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems</span><br><span class="line">            .create((o) =&gt; o(title: <span class="string">&#x27;Title&#x27;</span>, content: <span class="string">&#x27;Content&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We can also use `mode` and `onConflict` parameters, just</span></span><br><span class="line">        <span class="comment">// like in the `[InsertStatement.insert]` method on the table</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.create(</span><br><span class="line">            (o) =&gt; o(title: <span class="string">&#x27;Title&#x27;</span>, content: <span class="string">&#x27;New Content&#x27;</span>),</span><br><span class="line">            mode: drift.InsertMode.replace);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We can also create multiple items at once</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.bulkCreate(</span><br><span class="line">            (o) =&gt; [</span><br><span class="line">                o(title: <span class="string">&#x27;Title 1&#x27;</span>, content: <span class="string">&#x27;Content 1&#x27;</span>),</span><br><span class="line">                o(title: <span class="string">&#x27;Title 2&#x27;</span>, content: <span class="string">&#x27;Content 2&#x27;</span>),</span><br><span class="line">            ],</span><br><span class="line">        );</span><br><span class="line">        setState(() &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Future&lt;<span class="keyword">void</span>&gt; deleteTodoItems() <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="comment">// Delete all items</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.delete();</span><br><span class="line"></span><br><span class="line">        setState(() &#123;</span><br><span class="line">            <span class="keyword">this</span>.onValue = [];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// Delete a single item</span></span><br><span class="line">        <span class="keyword">await</span> managers.todoItems.filter((f) =&gt; f.id(<span class="number">5</span>)).delete();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码database-g-dart，可根据2步骤自动生成"><a href="#代码database-g-dart，可根据2步骤自动生成" class="headerlink" title="代码database.g.dart，可根据2步骤自动生成"></a>代码database.g.dart，可根据2步骤自动生成</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE - DO NOT MODIFY BY HAND</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">part</span> of <span class="string">&#x27;database.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ignore_for_file: type=lint</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> $<span class="title">TodoItemsTable</span> <span class="keyword">extends</span> <span class="title">TodoItems</span></span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">TableInfo</span>&lt;$<span class="title">TodoItemsTable</span>, <span class="title">TodoItem</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">final</span> GeneratedDatabase attachedDatabase;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">String?</span> _alias;</span><br><span class="line">    $TodoItemsTable(<span class="keyword">this</span>.attachedDatabase, [<span class="keyword">this</span>._alias]);</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> VerificationMeta _idMeta = <span class="keyword">const</span> VerificationMeta(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">late</span> <span class="keyword">final</span> GeneratedColumn&lt;<span class="built_in">int</span>&gt; id = GeneratedColumn&lt;<span class="built_in">int</span>&gt;(</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>, aliasedName, <span class="keyword">false</span>,</span><br><span class="line">        hasAutoIncrement: <span class="keyword">true</span>,</span><br><span class="line">        type: DriftSqlType.<span class="built_in">int</span>,</span><br><span class="line">        requiredDuringInsert: <span class="keyword">false</span>,</span><br><span class="line">        defaultConstraints:</span><br><span class="line">        GeneratedColumn.constraintIsAlways(<span class="string">&#x27;PRIMARY KEY AUTOINCREMENT&#x27;</span>));</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> VerificationMeta _titleMeta = <span class="keyword">const</span> VerificationMeta(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">late</span> <span class="keyword">final</span> GeneratedColumn&lt;<span class="built_in">String</span>&gt; title = GeneratedColumn&lt;<span class="built_in">String</span>&gt;(</span><br><span class="line">        <span class="string">&#x27;title&#x27;</span>, aliasedName, <span class="keyword">false</span>,</span><br><span class="line">        additionalChecks:</span><br><span class="line">        GeneratedColumn.checkTextLength(minTextLength: <span class="number">0</span>, maxTextLength: <span class="number">32</span>),</span><br><span class="line">        type: DriftSqlType.string,</span><br><span class="line">        requiredDuringInsert: <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> VerificationMeta _contentMeta =</span><br><span class="line">        <span class="keyword">const</span> VerificationMeta(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">late</span> <span class="keyword">final</span> GeneratedColumn&lt;<span class="built_in">String</span>&gt; content = GeneratedColumn&lt;<span class="built_in">String</span>&gt;(</span><br><span class="line">        <span class="string">&#x27;body&#x27;</span>, aliasedName, <span class="keyword">false</span>,</span><br><span class="line">        type: DriftSqlType.string, requiredDuringInsert: <span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> VerificationMeta _createdAtMeta =</span><br><span class="line">        <span class="keyword">const</span> VerificationMeta(<span class="string">&#x27;createdAt&#x27;</span>);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="keyword">late</span> <span class="keyword">final</span> GeneratedColumn&lt;<span class="built_in">DateTime</span>&gt; createdAt = GeneratedColumn&lt;<span class="built_in">DateTime</span>&gt;(</span><br><span class="line">        <span class="string">&#x27;created_at&#x27;</span>, aliasedName, <span class="keyword">true</span>,</span><br><span class="line">        type: DriftSqlType.dateTime, requiredDuringInsert: <span class="keyword">false</span>);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">List</span>&lt;GeneratedColumn&gt; <span class="keyword">get</span> $columns =&gt; [id, title, content, createdAt];</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">String</span> <span class="keyword">get</span> aliasedName =&gt; _alias ?? actualTableName;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">String</span> <span class="keyword">get</span> actualTableName =&gt; $name;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="built_in">String</span> $name = <span class="string">&#x27;todo_items&#x27;</span>;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    VerificationContext validateIntegrity(Insertable&lt;TodoItem&gt; instance,</span><br><span class="line">                                          &#123;<span class="built_in">bool</span> isInserting = <span class="keyword">false</span>&#125;) &#123;</span><br><span class="line">        <span class="keyword">final</span> context = VerificationContext();</span><br><span class="line">        <span class="keyword">final</span> data = instance.toColumns(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (data.containsKey(<span class="string">&#x27;id&#x27;</span>)) &#123;</span><br><span class="line">            context.handle(_idMeta, id.isAcceptableOrUnknown(data[<span class="string">&#x27;id&#x27;</span>]!, _idMeta));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data.containsKey(<span class="string">&#x27; title&#x27;</span>)) &#123;</span><br><span class="line">            context.handle(</span><br><span class="line">                _titleMeta, title.isAcceptableOrUnknown(data[<span class="string">&#x27;title&#x27;</span>]!, _titleMeta));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isInserting) &#123;</span><br><span class="line">            context.missing(_titleMeta);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data.containsKey(<span class="string">&#x27;body&#x27;</span>)) &#123;</span><br><span class="line">            context.handle(_contentMeta,</span><br><span class="line">                           content.isAcceptableOrUnknown(data[<span class="string">&#x27;body&#x27;</span>]!, _contentMeta));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isInserting) &#123;</span><br><span class="line">            context.missing(_contentMeta);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (data.containsKey(<span class="string">&#x27;created_at&#x27;</span>)) &#123;</span><br><span class="line">            context.handle(_createdAtMeta,</span><br><span class="line">                           createdAt.isAcceptableOrUnknown(data[<span class="string">&#x27;created_at&#x27;</span>]!, _createdAtMeta));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Set</span>&lt;GeneratedColumn&gt; <span class="keyword">get</span> $primaryKey =&gt; &#123;id&#125;;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    TodoItem map(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; data, &#123;<span class="built_in">String?</span> tablePrefix&#125;) &#123;</span><br><span class="line">        <span class="keyword">final</span> effectivePrefix = tablePrefix != <span class="keyword">null</span> ? <span class="string">&#x27;<span class="subst">$tablePrefix</span>.&#x27;</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> TodoItem(</span><br><span class="line">            id: attachedDatabase.typeMapping</span><br><span class="line">            .read(DriftSqlType.<span class="built_in">int</span>, data[<span class="string">&#x27;<span class="subst">$&#123;effectivePrefix&#125;</span>id&#x27;</span>])!,</span><br><span class="line">            title: attachedDatabase.typeMapping</span><br><span class="line">            .read(DriftSqlType.string, data[<span class="string">&#x27;<span class="subst">$&#123;effectivePrefix&#125;</span>title&#x27;</span>])!,</span><br><span class="line">            content: attachedDatabase.typeMapping</span><br><span class="line">            .read(DriftSqlType.string, data[<span class="string">&#x27;<span class="subst">$&#123;effectivePrefix&#125;</span>body&#x27;</span>])!,</span><br><span class="line">            createdAt: attachedDatabase.typeMapping</span><br><span class="line">            .read(DriftSqlType.dateTime, data[<span class="string">&#x27;<span class="subst">$&#123;effectivePrefix&#125;</span>created_at&#x27;</span>]),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    $TodoItemsTable createAlias(<span class="built_in">String</span> alias) &#123;</span><br><span class="line">        <span class="keyword">return</span> $TodoItemsTable(attachedDatabase, alias);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoItem</span> <span class="keyword">extends</span> <span class="title">DataClass</span> <span class="keyword">implements</span> <span class="title">Insertable</span>&lt;<span class="title">TodoItem</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">String</span> title;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">String</span> content;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">DateTime?</span> createdAt;</span><br><span class="line">    <span class="keyword">const</span> TodoItem(</span><br><span class="line">        &#123;<span class="keyword">required</span> <span class="keyword">this</span>.id,</span><br><span class="line">         <span class="keyword">required</span> <span class="keyword">this</span>.title,</span><br><span class="line">         <span class="keyword">required</span> <span class="keyword">this</span>.content,</span><br><span class="line">         <span class="keyword">this</span>.createdAt&#125;);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Expression&gt; toColumns(<span class="built_in">bool</span> nullToAbsent) &#123;</span><br><span class="line">        <span class="keyword">final</span> map = &lt;<span class="built_in">String</span>, Expression&gt;&#123;&#125;;</span><br><span class="line">        map[<span class="string">&#x27;id&#x27;</span>] = Variable&lt;<span class="built_in">int</span>&gt;(id);</span><br><span class="line">        map[<span class="string">&#x27;title&#x27;</span>] = Variable&lt;<span class="built_in">String</span>&gt;(title);</span><br><span class="line">        map[<span class="string">&#x27;body&#x27;</span>] = Variable&lt;<span class="built_in">String</span>&gt;(content);</span><br><span class="line">        <span class="keyword">if</span> (!nullToAbsent || createdAt != <span class="keyword">null</span>) &#123;</span><br><span class="line">            map[<span class="string">&#x27;created_at&#x27;</span>] = Variable&lt;<span class="built_in">DateTime</span>&gt;(createdAt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TodoItemsCompanion toCompanion(<span class="built_in">bool</span> nullToAbsent) &#123;</span><br><span class="line">        <span class="keyword">return</span> TodoItemsCompanion(</span><br><span class="line">            id: Value(id),</span><br><span class="line">            title: Value(title),</span><br><span class="line">            content: Value(content),</span><br><span class="line">            createdAt: createdAt == <span class="keyword">null</span> &amp;&amp; nullToAbsent</span><br><span class="line">            ? <span class="keyword">const</span> Value.absent()</span><br><span class="line">            : Value(createdAt),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">factory</span> TodoItem.fromJson(<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; json,</span><br><span class="line">                              &#123;ValueSerializer? serializer&#125;) &#123;</span><br><span class="line">        serializer ??= driftRuntimeOptions.defaultSerializer;</span><br><span class="line">        <span class="keyword">return</span> TodoItem(</span><br><span class="line">            id: serializer.fromJson&lt;<span class="built_in">int</span>&gt;(json[<span class="string">&#x27;id&#x27;</span>]),</span><br><span class="line">            title: serializer.fromJson&lt;<span class="built_in">String</span>&gt;(json[<span class="string">&#x27;title&#x27;</span>]),</span><br><span class="line">            content: serializer.fromJson&lt;<span class="built_in">String</span>&gt;(json[<span class="string">&#x27;content&#x27;</span>]),</span><br><span class="line">            createdAt: serializer.fromJson&lt;<span class="built_in">DateTime?</span>&gt;(json[<span class="string">&#x27;createdAt&#x27;</span>]),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; toJson(&#123;ValueSerializer? serializer&#125;) &#123;</span><br><span class="line">        serializer ??= driftRuntimeOptions.defaultSerializer;</span><br><span class="line">        <span class="keyword">return</span> &lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;&#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: serializer.toJson&lt;<span class="built_in">int</span>&gt;(id),</span><br><span class="line">            <span class="string">&#x27;title&#x27;</span>: serializer.toJson&lt;<span class="built_in">String</span>&gt;(title),</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: serializer.toJson&lt;<span class="built_in">String</span>&gt;(content),</span><br><span class="line">            <span class="string">&#x27;createdAt&#x27;</span>: serializer.toJson&lt;<span class="built_in">DateTime?</span>&gt;(createdAt),</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TodoItem copyWith(</span><br><span class="line">        &#123;<span class="built_in">int?</span> id,</span><br><span class="line">         <span class="built_in">String?</span> title,</span><br><span class="line">         <span class="built_in">String?</span> content,</span><br><span class="line">         Value&lt;<span class="built_in">DateTime?</span>&gt; createdAt = <span class="keyword">const</span> Value.absent()&#125;) =&gt;</span><br><span class="line">        TodoItem(</span><br><span class="line">        id: id ?? <span class="keyword">this</span>.id,</span><br><span class="line">        title: title ?? <span class="keyword">this</span>.title,</span><br><span class="line">        content: content ?? <span class="keyword">this</span>.content,</span><br><span class="line">        createdAt: createdAt.present ? createdAt.value : <span class="keyword">this</span>.createdAt,</span><br><span class="line">    );</span><br><span class="line">    TodoItem copyWithCompanion(TodoItemsCompanion data) &#123;</span><br><span class="line">        <span class="keyword">return</span> TodoItem(</span><br><span class="line">            id: data.id.present ? data.id.value : <span class="keyword">this</span>.id,</span><br><span class="line">            title: data.title.present ? data.title.value : <span class="keyword">this</span>.title,</span><br><span class="line">            content: data.content.present ? data.content.value : <span class="keyword">this</span>.content,</span><br><span class="line">            createdAt: data.createdAt.present ? data.createdAt.value : <span class="keyword">this</span>.createdAt,</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">String</span> toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">StringBuffer</span>(<span class="string">&#x27;TodoItem(&#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;id: <span class="subst">$id</span>, &#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;title: <span class="subst">$title</span>, &#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;content: <span class="subst">$content</span>, &#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;createdAt: <span class="subst">$createdAt</span>&#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;)&#x27;</span>))</span><br><span class="line">            .toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">int</span> <span class="keyword">get</span> hashCode =&gt; <span class="built_in">Object</span>.hash(id, title, content, createdAt);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">bool</span> <span class="keyword">operator</span> ==(<span class="built_in">Object</span> other) =&gt;</span><br><span class="line">        identical(<span class="keyword">this</span>, other) ||</span><br><span class="line">        (other <span class="keyword">is</span> TodoItem &amp;&amp;</span><br><span class="line">         other.id == <span class="keyword">this</span>.id &amp;&amp;</span><br><span class="line">         other.title == <span class="keyword">this</span>.title &amp;&amp;</span><br><span class="line">         other.content == <span class="keyword">this</span>.content &amp;&amp;</span><br><span class="line">         other.createdAt == <span class="keyword">this</span>.createdAt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoItemsCompanion</span> <span class="keyword">extends</span> <span class="title">UpdateCompanion</span>&lt;<span class="title">TodoItem</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Value&lt;<span class="built_in">int</span>&gt; id;</span><br><span class="line">    <span class="keyword">final</span> Value&lt;<span class="built_in">String</span>&gt; title;</span><br><span class="line">    <span class="keyword">final</span> Value&lt;<span class="built_in">String</span>&gt; content;</span><br><span class="line">    <span class="keyword">final</span> Value&lt;<span class="built_in">DateTime?</span>&gt; createdAt;</span><br><span class="line">    <span class="keyword">const</span> TodoItemsCompanion(&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">        <span class="keyword">this</span>.title = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">        <span class="keyword">this</span>.content = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">        <span class="keyword">this</span>.createdAt = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">    &#125;);</span><br><span class="line">    TodoItemsCompanion.insert(&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">        <span class="keyword">required</span> <span class="built_in">String</span> title,</span><br><span class="line">        <span class="keyword">required</span> <span class="built_in">String</span> content,</span><br><span class="line">        <span class="keyword">this</span>.createdAt = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">    &#125;)  : title = Value(title),</span><br><span class="line">    content = Value(content);</span><br><span class="line">    <span class="keyword">static</span> Insertable&lt;TodoItem&gt; custom(&#123;</span><br><span class="line">        Expression&lt;<span class="built_in">int</span>&gt;? id,</span><br><span class="line">        Expression&lt;<span class="built_in">String</span>&gt;? title,</span><br><span class="line">        Expression&lt;<span class="built_in">String</span>&gt;? content,</span><br><span class="line">        Expression&lt;<span class="built_in">DateTime</span>&gt;? createdAt,</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> RawValuesInsertable(&#123;</span><br><span class="line">            <span class="keyword">if</span> (id != <span class="keyword">null</span>) <span class="string">&#x27;id&#x27;</span>: id,</span><br><span class="line">            <span class="keyword">if</span> (title != <span class="keyword">null</span>) <span class="string">&#x27;title&#x27;</span>: title,</span><br><span class="line">            <span class="keyword">if</span> (content != <span class="keyword">null</span>) <span class="string">&#x27;body&#x27;</span>: content,</span><br><span class="line">            <span class="keyword">if</span> (createdAt != <span class="keyword">null</span>) <span class="string">&#x27;created_at&#x27;</span>: createdAt,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TodoItemsCompanion copyWith(</span><br><span class="line">        &#123;Value&lt;<span class="built_in">int</span>&gt;? id,</span><br><span class="line">         Value&lt;<span class="built_in">String</span>&gt;? title,</span><br><span class="line">         Value&lt;<span class="built_in">String</span>&gt;? content,</span><br><span class="line">         Value&lt;<span class="built_in">DateTime?</span>&gt;? createdAt&#125;) &#123;</span><br><span class="line">        <span class="keyword">return</span> TodoItemsCompanion(</span><br><span class="line">            id: id ?? <span class="keyword">this</span>.id,</span><br><span class="line">            title: title ?? <span class="keyword">this</span>.title,</span><br><span class="line">            content: content ?? <span class="keyword">this</span>.content,</span><br><span class="line">            createdAt: createdAt ?? <span class="keyword">this</span>.createdAt,</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, Expression&gt; toColumns(<span class="built_in">bool</span> nullToAbsent) &#123;</span><br><span class="line">        <span class="keyword">final</span> map = &lt;<span class="built_in">String</span>, Expression&gt;&#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span> (id.present) &#123;</span><br><span class="line">            map[<span class="string">&#x27;id&#x27;</span>] = Variable&lt;<span class="built_in">int</span>&gt;(id.value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (title.present) &#123;</span><br><span class="line">            map[<span class="string">&#x27;title&#x27;</span>] = Variable&lt;<span class="built_in">String</span>&gt;(title.value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (content.present) &#123;</span><br><span class="line">            map[<span class="string">&#x27;body&#x27;</span>] = Variable&lt;<span class="built_in">String</span>&gt;(content.value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (createdAt.present) &#123;</span><br><span class="line">            map[<span class="string">&#x27;created_at&#x27;</span>] = Variable&lt;<span class="built_in">DateTime</span>&gt;(createdAt.value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">String</span> toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">StringBuffer</span>(<span class="string">&#x27;TodoItemsCompanion(&#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;id: <span class="subst">$id</span>, &#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;title: <span class="subst">$title</span>, &#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;content: <span class="subst">$content</span>, &#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;createdAt: <span class="subst">$createdAt</span>&#x27;</span>)</span><br><span class="line">                ..write(<span class="string">&#x27;)&#x27;</span>))</span><br><span class="line">            .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">_</span>$<span class="title">AppDatabase</span> <span class="keyword">extends</span> <span class="title">GeneratedDatabase</span> </span>&#123;</span><br><span class="line">    _$AppDatabase(QueryExecutor e) : <span class="keyword">super</span>(e);</span><br><span class="line">    $AppDatabaseManager <span class="keyword">get</span> managers =&gt; $AppDatabaseManager(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">late</span> <span class="keyword">final</span> $TodoItemsTable todoItems = $TodoItemsTable(<span class="keyword">this</span>);</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Iterable</span>&lt;TableInfo&lt;Table, <span class="built_in">Object?</span>&gt;&gt; <span class="keyword">get</span> allTables =&gt;</span><br><span class="line">        allSchemaEntities.whereType&lt;TableInfo&lt;Table, <span class="built_in">Object?</span>&gt;&gt;();</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">List</span>&lt;DatabaseSchemaEntity&gt; <span class="keyword">get</span> allSchemaEntities =&gt; [todoItems];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> $$TodoItemsTableCreateCompanionBuilder = TodoItemsCompanion <span class="built_in">Function</span>(&#123;</span><br><span class="line">    Value&lt;<span class="built_in">int</span>&gt; id,</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">String</span> title,</span><br><span class="line">    <span class="keyword">required</span> <span class="built_in">String</span> content,</span><br><span class="line">    Value&lt;<span class="built_in">DateTime?</span>&gt; createdAt,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">typedef</span> $$TodoItemsTableUpdateCompanionBuilder = TodoItemsCompanion <span class="built_in">Function</span>(&#123;</span><br><span class="line">    Value&lt;<span class="built_in">int</span>&gt; id,</span><br><span class="line">    Value&lt;<span class="built_in">String</span>&gt; title,</span><br><span class="line">    Value&lt;<span class="built_in">String</span>&gt; content,</span><br><span class="line">    Value&lt;<span class="built_in">DateTime?</span>&gt; createdAt,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> $$<span class="title">TodoItemsTableFilterComposer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">Composer</span>&lt;<span class="title">_</span>$<span class="title">AppDatabase</span>, $<span class="title">TodoItemsTable</span>&gt; </span>&#123;</span><br><span class="line">    $$TodoItemsTableFilterComposer(&#123;</span><br><span class="line">        <span class="keyword">required</span> <span class="keyword">super</span>.$db,</span><br><span class="line">        <span class="keyword">required</span> <span class="keyword">super</span>.$table,</span><br><span class="line">        <span class="keyword">super</span>.joinBuilder,</span><br><span class="line">        <span class="keyword">super</span>.$addJoinBuilderToRootComposer,</span><br><span class="line">        <span class="keyword">super</span>.$removeJoinBuilderFromRootComposer,</span><br><span class="line">    &#125;);</span><br><span class="line">    ColumnFilters&lt;<span class="built_in">int</span>&gt; <span class="keyword">get</span> id =&gt; $composableBuilder(</span><br><span class="line">        column: $table.id, builder: (column) =&gt; ColumnFilters(column));</span><br><span class="line"></span><br><span class="line">    ColumnFilters&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> title =&gt; $composableBuilder(</span><br><span class="line">        column: $table.title, builder: (column) =&gt; ColumnFilters(column));</span><br><span class="line"></span><br><span class="line">    ColumnFilters&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> content =&gt; $composableBuilder(</span><br><span class="line">        column: $table.content, builder: (column) =&gt; ColumnFilters(column));</span><br><span class="line"></span><br><span class="line">    ColumnFilters&lt;<span class="built_in">DateTime</span>&gt; <span class="keyword">get</span> createdAt =&gt; $composableBuilder(</span><br><span class="line">        column: $table.createdAt, builder: (column) =&gt; ColumnFilters(column));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> $$<span class="title">TodoItemsTableOrderingComposer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">Composer</span>&lt;<span class="title">_</span>$<span class="title">AppDatabase</span>, $<span class="title">TodoItemsTable</span>&gt; </span>&#123;</span><br><span class="line">    $$TodoItemsTableOrderingComposer(&#123;</span><br><span class="line">        <span class="keyword">required</span> <span class="keyword">super</span>.$db,</span><br><span class="line">        <span class="keyword">required</span> <span class="keyword">super</span>.$table,</span><br><span class="line">        <span class="keyword">super</span>.joinBuilder,</span><br><span class="line">        <span class="keyword">super</span>.$addJoinBuilderToRootComposer,</span><br><span class="line">        <span class="keyword">super</span>.$removeJoinBuilderFromRootComposer,</span><br><span class="line">    &#125;);</span><br><span class="line">    ColumnOrderings&lt;<span class="built_in">int</span>&gt; <span class="keyword">get</span> id =&gt; $composableBuilder(</span><br><span class="line">        column: $table.id, builder: (column) =&gt; ColumnOrderings(column));</span><br><span class="line"></span><br><span class="line">    ColumnOrderings&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> title =&gt; $composableBuilder(</span><br><span class="line">        column: $table.title, builder: (column) =&gt; ColumnOrderings(column));</span><br><span class="line"></span><br><span class="line">    ColumnOrderings&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> content =&gt; $composableBuilder(</span><br><span class="line">        column: $table.content, builder: (column) =&gt; ColumnOrderings(column));</span><br><span class="line"></span><br><span class="line">    ColumnOrderings&lt;<span class="built_in">DateTime</span>&gt; <span class="keyword">get</span> createdAt =&gt; $composableBuilder(</span><br><span class="line">        column: $table.createdAt, builder: (column) =&gt; ColumnOrderings(column));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> $$<span class="title">TodoItemsTableAnnotationComposer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">Composer</span>&lt;<span class="title">_</span>$<span class="title">AppDatabase</span>, $<span class="title">TodoItemsTable</span>&gt; </span>&#123;</span><br><span class="line">    $$TodoItemsTableAnnotationComposer(&#123;</span><br><span class="line">        <span class="keyword">required</span> <span class="keyword">super</span>.$db,</span><br><span class="line">        <span class="keyword">required</span> <span class="keyword">super</span>.$table,</span><br><span class="line">        <span class="keyword">super</span>.joinBuilder,</span><br><span class="line">        <span class="keyword">super</span>.$addJoinBuilderToRootComposer,</span><br><span class="line">        <span class="keyword">super</span>.$removeJoinBuilderFromRootComposer,</span><br><span class="line">    &#125;);</span><br><span class="line">    GeneratedColumn&lt;<span class="built_in">int</span>&gt; <span class="keyword">get</span> id =&gt;</span><br><span class="line">        $composableBuilder(column: $table.id, builder: (column) =&gt; column);</span><br><span class="line"></span><br><span class="line">    GeneratedColumn&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> title =&gt;</span><br><span class="line">        $composableBuilder(column: $table.title, builder: (column) =&gt; column);</span><br><span class="line"></span><br><span class="line">    GeneratedColumn&lt;<span class="built_in">String</span>&gt; <span class="keyword">get</span> content =&gt;</span><br><span class="line">        $composableBuilder(column: $table.content, builder: (column) =&gt; column);</span><br><span class="line"></span><br><span class="line">    GeneratedColumn&lt;<span class="built_in">DateTime</span>&gt; <span class="keyword">get</span> createdAt =&gt;</span><br><span class="line">        $composableBuilder(column: $table.createdAt, builder: (column) =&gt; column);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> $$<span class="title">TodoItemsTableTableManager</span> <span class="keyword">extends</span> <span class="title">RootTableManager</span>&lt;</span></span><br><span class="line"><span class="class">    <span class="title">_</span>$<span class="title">AppDatabase</span>,</span></span><br><span class="line"><span class="class">$<span class="title">TodoItemsTable</span>,</span></span><br><span class="line"><span class="class"><span class="title">TodoItem</span>,</span></span><br><span class="line"><span class="class">$$<span class="title">TodoItemsTableFilterComposer</span>,</span></span><br><span class="line"><span class="class">$$<span class="title">TodoItemsTableOrderingComposer</span>,</span></span><br><span class="line"><span class="class">$$<span class="title">TodoItemsTableAnnotationComposer</span>,</span></span><br><span class="line"><span class="class">$$<span class="title">TodoItemsTableCreateCompanionBuilder</span>,</span></span><br><span class="line"><span class="class">$$<span class="title">TodoItemsTableUpdateCompanionBuilder</span>,</span></span><br><span class="line"><span class="class">(<span class="title">TodoItem</span>, <span class="title">BaseReferences</span>&lt;<span class="title">_</span>$<span class="title">AppDatabase</span>, $<span class="title">TodoItemsTable</span>, <span class="title">TodoItem</span>&gt;),</span></span><br><span class="line"><span class="class"><span class="title">TodoItem</span>,</span></span><br><span class="line"><span class="class"><span class="title">PrefetchHooks</span> <span class="title">Function</span>()&gt; </span>&#123;</span><br><span class="line">    $$TodoItemsTableTableManager(_$AppDatabase db, $TodoItemsTable table)</span><br><span class="line">        : <span class="keyword">super</span>(TableManagerState(</span><br><span class="line">            db: db,</span><br><span class="line">            table: table,</span><br><span class="line">            createFilteringComposer: () =&gt;</span><br><span class="line">            $$TodoItemsTableFilterComposer($db: db, $table: table),</span><br><span class="line">            createOrderingComposer: () =&gt;</span><br><span class="line">            $$TodoItemsTableOrderingComposer($db: db, $table: table),</span><br><span class="line">            createComputedFieldComposer: () =&gt;</span><br><span class="line">            $$TodoItemsTableAnnotationComposer($db: db, $table: table),</span><br><span class="line">            updateCompanionCallback: (&#123;</span><br><span class="line">                Value&lt;<span class="built_in">int</span>&gt; id = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">                Value&lt;<span class="built_in">String</span>&gt; title = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">                Value&lt;<span class="built_in">String</span>&gt; content = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">                Value&lt;<span class="built_in">DateTime?</span>&gt; createdAt = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">            &#125;) =&gt;</span><br><span class="line">            TodoItemsCompanion(</span><br><span class="line">                id: id,</span><br><span class="line">                title: title,</span><br><span class="line">                content: content,</span><br><span class="line">                createdAt: createdAt,</span><br><span class="line">            ),</span><br><span class="line">            createCompanionCallback: (&#123;</span><br><span class="line">                Value&lt;<span class="built_in">int</span>&gt; id = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">                <span class="keyword">required</span> <span class="built_in">String</span> title,</span><br><span class="line">                <span class="keyword">required</span> <span class="built_in">String</span> content,</span><br><span class="line">                Value&lt;<span class="built_in">DateTime?</span>&gt; createdAt = <span class="keyword">const</span> Value.absent(),</span><br><span class="line">            &#125;) =&gt;</span><br><span class="line">            TodoItemsCompanion.insert(</span><br><span class="line">                id: id,</span><br><span class="line">                title: title,</span><br><span class="line">                content: content,</span><br><span class="line">                createdAt: createdAt,</span><br><span class="line">            ),</span><br><span class="line">            withReferenceMapper: (p0) =&gt; p0</span><br><span class="line">            .map((e) =&gt; (e.readTable(table), BaseReferences(db, table, e)))</span><br><span class="line">            .toList(),</span><br><span class="line">            prefetchHooksCallback: <span class="keyword">null</span>,</span><br><span class="line">        ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> $$TodoItemsTableProcessedTableManager = ProcessedTableManager&lt;</span><br><span class="line">    _$AppDatabase,</span><br><span class="line">$TodoItemsTable,</span><br><span class="line">TodoItem,</span><br><span class="line">$$TodoItemsTableFilterComposer,</span><br><span class="line">$$TodoItemsTableOrderingComposer,</span><br><span class="line">$$TodoItemsTableAnnotationComposer,</span><br><span class="line">$$TodoItemsTableCreateCompanionBuilder,</span><br><span class="line">$$TodoItemsTableUpdateCompanionBuilder,</span><br><span class="line">(TodoItem, BaseReferences&lt;_$AppDatabase, $TodoItemsTable, TodoItem&gt;),</span><br><span class="line">TodoItem,</span><br><span class="line">PrefetchHooks <span class="built_in">Function</span>()&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> $<span class="title">AppDatabaseManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> _$AppDatabase _db;</span><br><span class="line">    $AppDatabaseManager(<span class="keyword">this</span>._db);</span><br><span class="line">    $$TodoItemsTableTableManager <span class="keyword">get</span> todoItems =&gt;</span><br><span class="line">        $$TodoItemsTableTableManager(_db, _db.todoItems);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><blockquote>
<p>  默认使用方法</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">late</span> AppDatabase database;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">    database = AppDatabase();</span><br><span class="line">    runApp(MyFlutterApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  <strong>provider 供应商</strong></p>
<p>  如果您正在使用<strong>provider</strong>程序包，则可以将顶级小部件包装在管理数据库实例的提供程序中：</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">    runApp(</span><br><span class="line">        Provider&lt;AppDatabase&gt;(</span><br><span class="line">            create: (context) =&gt; AppDatabase(),</span><br><span class="line">            child: MyFlutterApp(),</span><br><span class="line">            dispose: (context, db) =&gt; db.close(),</span><br><span class="line">        ),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  <strong>GetX</strong> 则可以将其添加为管理数据库实例的服务</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">    <span class="keyword">var</span> put = Get.put(AppDatabase());</span><br><span class="line">    Get.find&lt;AppDatabase&gt;();</span><br><span class="line">    runApp(MyFlutterApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，您的小部件就可以使用 访问数据库了Get.find().your_method</p>
<h1 id="Flutter——数据库Drift开发详细教程-二"><a href="#Flutter——数据库Drift开发详细教程-二" class="headerlink" title="Flutter——数据库Drift开发详细教程(二)"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013290250/article/details/147671436">Flutter——数据库Drift开发详细教程(二)</a></h1><h2 id="核心API"><a href="#核心API" class="headerlink" title="核心API"></a>核心API</h2><h3 id="查询数据列表分页"><a href="#查询数据列表分页" class="headerlink" title="查询数据列表分页"></a>查询数据列表分页</h3><blockquote>
<p>  限制返回的结果数量<strong>limit</strong>，从某一位置开始查询<strong>offset</strong></p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///<span class="language-markdown">limit=10, offset=10</span></span></span><br><span class="line">Future&lt;<span class="built_in">List</span>&lt;TodoItem&gt;&gt; limitTodos(<span class="built_in">int</span> limit, &#123;<span class="built_in">int?</span> offset&#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> (select(todoItems)..limit(limit, offset: offset)).<span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/9d7921fb/b5ae5077bf674ee49c49639ae684b8ad.jpeg" alt="Alt"></p>
<h3 id="列表排序"><a href="#列表排序" class="headerlink" title="列表排序"></a>列表排序</h3><blockquote>
<p>  使用该<strong>orderBy</strong>方法。它需要一个函数列表，用于从表中提取各个排序项。您可以使用任何<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%A1%A8%E8%BE%BE%E5%BC%8F&spm=1001.2101.3001.7020">表达式</a>作为排序项。</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///<span class="language-markdown">根据对象字段title，字母排序</span></span></span><br><span class="line">Future&lt;<span class="built_in">List</span>&lt;TodoItem&gt;&gt; sortEntriesAlphabetically() &#123;</span><br><span class="line">    <span class="keyword">return</span> (select(todoItems)</span><br><span class="line">            ..orderBy([</span><br><span class="line">                <span class="comment">// (t) =&gt; OrderingTerm(expression: t.title, mode: OrderingMode.desc),</span></span><br><span class="line">                (t) =&gt; OrderingTerm(expression: t.title),</span><br><span class="line">            ]))</span><br><span class="line">        .<span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">///<span class="language-markdown">下图是结果，左1  mode: OrderingMode.desc 反向排序</span></span></span><br><span class="line"><span class="comment">///<span class="language-markdown">左2 默认顺序排序</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/posts/9d7921fb/eaf30cfe029d469bb1aa213640d43a98.jpeg" alt="请添加图片描述"></p>
<h3 id="推迟获取与观察"><a href="#推迟获取与观察" class="headerlink" title="推迟获取与观察"></a>推迟获取与观察</h3><blockquote>
<p>  如果您希望使查询可作为Future或 来使用，则可以使用其中一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%8A%BD%E8%B1%A1%E5%9F%BA%E7%B1%BB&spm=1001.2101.3001.7020">抽象基类</a>Stream来优化返回类型；Selectable ,返回数据对象或者流类型 自行选择</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Exposes `get` and `watch`</span></span><br><span class="line">MultiSelectable&lt;TodoItem&gt; pageOfTodos(<span class="built_in">int</span> page, &#123;<span class="built_in">int</span> pageSize = <span class="number">10</span>&#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> select(todoItems)..limit(pageSize, offset: page);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exposes `getSingle` and `watchSingle`</span></span><br><span class="line">SingleSelectable&lt;TodoItem&gt; selectableEntryById(<span class="built_in">int</span> id) &#123;</span><br><span class="line">    <span class="keyword">return</span> select(todoItems)..where((t) =&gt; t.id.equals(id));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exposes `getSingleOrNull` and `watchSingleOrNull`</span></span><br><span class="line">SingleOrNullSelectable&lt;TodoItem&gt; entryFromExternalLink(<span class="built_in">int</span> id) &#123;</span><br><span class="line">    <span class="keyword">return</span> select(todoItems)..where((t) =&gt; t.id.equals(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/posts/9d7921fb/4047e959e0f94c52a103985140beaae1.jpeg" alt="请添加图片描述"></p>
<h1 id="Flutter——数据库Drift开发详细教程-三"><a href="#Flutter——数据库Drift开发详细教程-三" class="headerlink" title="Flutter——数据库Drift开发详细教程(三)"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013290250/article/details/147724023">Flutter——数据库Drift开发详细教程(三)</a></h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drift.simonbinder.eu/dart_api/writes/#updating-with-sql-expressions">https://drift.simonbinder.eu/dart_api/writes/#updating-with-sql-expressions</a></li>
</ul>
<h2 id="正文核心API"><a href="#正文核心API" class="headerlink" title="正文核心API"></a>正文核心API</h2><h3 id="写入（更新、插入、删除）"><a href="#写入（更新、插入、删除）" class="headerlink" title="写入（更新、插入、删除）"></a>写入（更新、插入、删除）</h3><h4 id="1-更新和删除"><a href="#1-更新和删除" class="headerlink" title="1.更新和删除"></a>1.更新和删除</h4><blockquote>
<p>  您可以使用生成的类来更新任何行的单个字段：</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Future moveImportantTasksIntoCategory(Category target) &#123;</span><br><span class="line">    <span class="comment">// for updates, we use the &quot;companion&quot; version of a generated class. This wraps the</span></span><br><span class="line">    <span class="comment">// fields in a &quot;Value&quot; type which can be set to be absent using &quot;Value.absent()&quot;. This</span></span><br><span class="line">    <span class="comment">// allows us to separate between &quot;SET category = NULL&quot; (`category: Value(null)`) and not</span></span><br><span class="line">    <span class="comment">// updating the category at all: `category: Value.absent()`.</span></span><br><span class="line">    <span class="keyword">return</span> (update(todos)</span><br><span class="line">            ..where((t) =&gt; t.title.like(<span class="string">&#x27;%Important%&#x27;</span>))</span><br><span class="line">           ).write(TodosCompanion(</span><br><span class="line">        category: Value(target.id),</span><br><span class="line">    ),</span><br><span class="line">                  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future updateTodo(Todo entry) &#123;</span><br><span class="line">    <span class="comment">// using replace will update all fields from the entry that are not marked as a primary key.</span></span><br><span class="line">    <span class="comment">// it will also make sure that only the entry with the same primary key will be updated.</span></span><br><span class="line">    <span class="comment">// Here, this means that the row that has the same id as entry will be updated to reflect</span></span><br><span class="line">    <span class="comment">// the entry&#x27;s title, content and category. As its where clause is set automatically, it</span></span><br><span class="line">    <span class="comment">// cannot be used together with where.</span></span><br><span class="line">    <span class="keyword">return</span> update(todos).replace(entry);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future feelingLazy() &#123;</span><br><span class="line">    <span class="comment">// 删除id小于10的所有对象</span></span><br><span class="line">    <span class="keyword">return</span> (delete(todos)..where((t) =&gt; t.id.isSmallerThanValue(<span class="number">10</span>))).go();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：如果您没有明确添加where更新或删除子句，则该语句将影响表中的所有行！</li>
</ul>
<h4 id="使用-SQL-表达式更新"><a href="#使用-SQL-表达式更新" class="headerlink" title="使用 SQL 表达式更新"></a>使用 SQL 表达式更新</h4><blockquote>
<p>  在某些情况下，您可能需要根据当前值更新多行。一种方案是先将受影响的行选择到 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Dart&spm=1001.2101.3001.7020">Dart</a> 对象中，然后根据这些结果创建伴随对象并用于更新。如果更新可以用 SQL 描述，则可以使用更高效的方法Companion.custom：</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> db</span><br><span class="line">    .update(db.users)</span><br><span class="line">    .write(UsersCompanion.custom(username: db.users.username.lower()));</span><br></pre></td></tr></table></figure>

<p>这里，表name中users所有现有行的列均更改为小写。由于.lower()列的逐一替换功能已在数据库中实现，因此无需在语句执行过程中将行加载到 Dart 中。</p>
<h4 id="插入件"><a href="#插入件" class="headerlink" title="插入件"></a>插入件</h4><blockquote>
<p>  您可以非常轻松地将任何有效对象插入表中。由于某些值可能不存在（例如我们无需明确设置的默认值），我们再次使用配套版本。</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// returns the generated id</span></span><br><span class="line">Future&lt;<span class="built_in">int</span>&gt; addTodo(TodosCompanion entry) &#123;</span><br><span class="line">    <span class="keyword">return</span> into(todos).insert(entry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  生成的所有行类都会有一个可用于创建对象的构造函数：</p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addTodo(</span><br><span class="line">    TodosCompanion(</span><br><span class="line">        title: Value(<span class="string">&#x27;Important task&#x27;</span>),</span><br><span class="line">        content: Value(<span class="string">&#x27;Refactor persistence code&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>如果某个列可空或具有默认值（包括自增列），则可以省略该字段。所有其他字段必须已设置且非空。insert否则，该方法将抛出异常。</p>
<p>可以使用批处理高效地运行多个插入语句。为此，您可以使用insertAll中的方法batch：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="keyword">void</span>&gt; insertMultipleEntries() <span class="keyword">async</span>&#123;</span><br><span class="line">    <span class="keyword">await</span> batch((batch) &#123;</span><br><span class="line">        <span class="comment">// functions in a batch don&#x27;t have to be awaited - just</span></span><br><span class="line">        <span class="comment">// await the whole batch afterwards.</span></span><br><span class="line">        batch.insertAll(todos, [</span><br><span class="line">            TodosCompanion.insert(</span><br><span class="line">                title: <span class="string">&#x27;First entry&#x27;</span>,</span><br><span class="line">                content: <span class="string">&#x27;My content&#x27;</span>,</span><br><span class="line">            ),</span><br><span class="line">            TodosCompanion.insert(</span><br><span class="line">                title: <span class="string">&#x27;Another entry&#x27;</span>,</span><br><span class="line">                content: <span class="string">&#x27;More content&#x27;</span>,</span><br><span class="line">                <span class="comment">// columns that aren&#x27;t required for inserts are still wrapped in a Value:</span></span><br><span class="line">                category: Value(<span class="number">3</span>),</span><br><span class="line">            ),</span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        ]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>批处理与事务类似，所有更新操作都以原子方式进行，但批处理支持进一步优化，避免重复准备相同的 [SQL 语句](<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=SQL">https://so.csdn.net/so/search?q=SQL</a> 语句&amp;spm&#x3D;1001.2101.3001.7020)。这使得批处理非常适合批量插入或更新操作。</p>
<h4 id="更新插入"><a href="#更新插入" class="headerlink" title="更新插入"></a>更新插入</h4><p>Upserts 是较新版本的 sqlite3 中的一项功能，如果已经存在冲突的行，则它允许插入像更新一样运行。</p>
<p>当主键是其数据的一部分时，这允许我们创建或覆盖现有行：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Users</span> <span class="keyword">extends</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line">    TextColumn <span class="keyword">get</span> email =&gt; text()();</span><br><span class="line">    TextColumn <span class="keyword">get</span> name =&gt; text()();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Set</span>&lt;Column&gt; <span class="keyword">get</span> primaryKey =&gt; &#123;email&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">int</span>&gt; createOrUpdateUser(User user) &#123;</span><br><span class="line">    <span class="keyword">return</span> into(users).insertOnConflictUpdate(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当使用已存在的电子邮件地址进行呼叫时createOrUpdateUser()，该用户的姓名将被更新。否则，新的用户将被插入数据库。</p>
<p>插入操作也可以用于更高级的查询。例如，假设我们正在构建一个字典，并希望跟踪某个单词的出现次数。一个用于此目的的表可能如下所示</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Words</span> <span class="keyword">extends</span> <span class="title">Table</span> </span>&#123;</span><br><span class="line">    TextColumn <span class="keyword">get</span> word =&gt; text()();</span><br><span class="line">    IntColumn <span class="keyword">get</span> usages =&gt; integer().withDefault(<span class="keyword">const</span> Constant(<span class="number">1</span>))();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    <span class="built_in">Set</span>&lt;Column&gt; <span class="keyword">get</span> primaryKey =&gt; &#123;word&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过使用自定义的 upserts，我们可以插入一个新单词，或者usages 如果它已经存在则增加它的计数器：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="keyword">void</span>&gt; trackWord(<span class="built_in">String</span> word) &#123;</span><br><span class="line">    <span class="keyword">return</span> into(words).insert(</span><br><span class="line">        WordsCompanion.insert(word: word),</span><br><span class="line">        onConflict: DoUpdate(</span><br><span class="line">            (old) =&gt; WordsCompanion.custom(usages: old.usages + Constant(<span class="number">1</span>))),</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="返回"><a href="#返回" class="headerlink" title="返回"></a>返回</h4><p>您可以使用insertReturning插入一行或伴随行，并立即获取插入的行。返回的行包含所有生成的默认值和递增 ID。</p>
<p>注意：此方法使用了RETURNINGsqlite3 3.35 版新增的语法，该语法在大多数操作系统上默认不可用。使用此方法时，请确保您拥有最新的 sqlite3 版本。以下情况也是如此sqlite3_flutter_libs。</p>
<p>例如，考虑使用入门指南中的表格的以下代码片段：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> row = <span class="keyword">await</span> into(todos).insertReturning(TodosCompanion.insert(</span><br><span class="line">    title: <span class="string">&#x27;A todo entry&#x27;</span>,</span><br><span class="line">    content: <span class="string">&#x27;A description&#x27;</span>,</span><br><span class="line">));</span><br></pre></td></tr></table></figure>

<p>返回row的 具有正确的id设置。如果表有其他默认值，包括像 这样的动态值CURRENT_TIME，那么这些值也会在 所返回的行中设置insertReturning。</p>
<h1 id="Flutter——数据库Drift开发详细教程-四"><a href="#Flutter——数据库Drift开发详细教程-四" class="headerlink" title="Flutter——数据库Drift开发详细教程(四)"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013290250/article/details/147724357">Flutter——数据库Drift开发详细教程(四)</a></h1><h2 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://drift.simonbinder.eu/dart_api/expressions/">https://drift.simonbinder.eu/dart_api/expressions/</a></li>
</ul>
<h2 id="正文表达式"><a href="#正文表达式" class="headerlink" title="正文表达式"></a>正文表达式</h2><blockquote>
<p>  表达式是 SQL 的片段，数据库解释它们时会返回一个值。drift 的 dart_api 允许您在 Dart 中编写大多数表达式，然后将其转换为 SQL。表达式适用于各种情况。例如，where 期望一个返回布尔值的表达式。</p>
</blockquote>
<p>大多数情况下，你编写的表达式会将其他表达式组合起来。任何列名都是有效的表达式，因此对于大多数where子句，你会编写一个将列名包装在某种比较中的表达式。</p>
<h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><blockquote>
<p>  每个表达式都可以使用<br>  与值进行比较equals。如果要将一个表达式与另一个表达式进行比较，可以使用。对于数值和日期时间表达式，您还可以使用等equalsExpr各种方法<br>  来比较它们：<strong>isSmallerThan</strong> 和 <strong>isSmallerOrEqual</strong></p>
</blockquote>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询小于 5 的 所有对象</span></span><br><span class="line">(select(animals)..where((a) =&gt; a.amountOfLegs.isSmallerThanValue(<span class="number">5</span>))).<span class="keyword">get</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// find all animals who&#x27;s average livespan is shorter than their amount of legs (poor flies)</span></span><br><span class="line">(select(animals)</span><br><span class="line"> ..where((a) =&gt; a.averageLivespan.isSmallerThan(a.amountOfLegs)));</span><br><span class="line"></span><br><span class="line">Future&lt;<span class="built_in">List</span>&lt;Animal&gt;&gt; findAnimalsByLegs(<span class="built_in">int</span> legCount) &#123;</span><br><span class="line">    <span class="keyword">return</span> (select(animals)..where((a) =&gt; a.amountOfLegs.equals(legCount)))</span><br><span class="line">        .<span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：根据下面图圈红标记，可以看到对应的参数的用途，具体效果可以自行测试</strong></p>
<p><img src="/posts/9d7921fb/43919e7b310b476eb07678587a265605.png" alt="在这里插入图片描述">  </p>
<p><img src="/posts/9d7921fb/9656efed83404db29342e33a7adf8372.png" alt="在这里插入图片描述"></p>
<h3 id="布尔代数"><a href="#布尔代数" class="headerlink" title="布尔代数"></a>布尔代数</h3><p>您可以使用&amp;、|运算符和not漂移公开的方法来嵌套布尔表达式：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find all animals that aren&#x27;t mammals and have 4 legs</span></span><br><span class="line">select(animals)..where((a) =&gt; a.isMammal.not() &amp; a.amountOfLegs.equals(<span class="number">4</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// find all animals that are mammals or have 2 legs</span></span><br><span class="line">select(animals)..where((a) =&gt; a.isMammal | a.amountOfLegs.equals(<span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>如果您有一个谓词列表，其中一个或全部需要匹配，则可以分别使用 Expression.or和Expression.and：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Expression.and([</span><br><span class="line">    a.isMammal,</span><br><span class="line">    a.amountOfLegs.equals(<span class="number">4</span>),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="算术"><a href="#算术" class="headerlink" title="算术"></a>算术</h3><p>对于int与double表达式，可以使用+、-、*和&#x2F;运算符。要在 SQL 表达式和 Dart 值之间运行计算，请将其包装在Variable：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">List</span>&lt;Product&gt;&gt; canBeBought(<span class="built_in">int</span> amount, <span class="built_in">int</span> budget) &#123;</span><br><span class="line">  <span class="keyword">return</span> (select(products)</span><br><span class="line">        ..where((p) &#123;</span><br><span class="line">          <span class="keyword">final</span> totalPrice = p.price * Variable(amount);</span><br><span class="line">          <span class="keyword">return</span> totalPrice.isSmallerOrEqualValue(budget);</span><br><span class="line">        &#125;))</span><br><span class="line">      .<span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字符串表达式+也定义了一个运算符。正如你所期望的，它在 SQL 中执行连接操作。</p>
<p>对于整数值，可以使用~、bitwiseAnd和bitwiseOr执行按位运算：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Expression&lt;<span class="built_in">int</span>&gt; bitwiseMagic(Expression&lt;<span class="built_in">int</span>&gt; a, Expression&lt;<span class="built_in">int</span>&gt; b) &#123;</span><br><span class="line">    <span class="comment">// Generates `~(a &amp; b)` in SQL.</span></span><br><span class="line">    <span class="keyword">return</span> ~(a.bitwiseAnd(b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BigIn"><a href="#BigIn" class="headerlink" title="BigIn"></a>BigIn</h4><p>虽然 SQLite 和 Dart VM 使用 64 位整数，但编译为 JavaScript 的 Dart 应用程序却不使用。因此，为了在编译到 Web 时表示大整数结果，您可能需要将表达式转换为BigInt。</p>
<p>使用dartCast()将确保结果被解释为BigInt漂移。这不会改变生成的 SQL，漂移对所有数据库都使用 64 位整数类型。</p>
<p>示例： 对于表达式，即使和被定义为常规整数，(table.columnA * table.columnB).dartCast()drift 也会将结果值报告为。BigIntcolumnAcolumnB</p>
<h3 id="空值检查"><a href="#空值检查" class="headerlink" title="空值检查"></a>空值检查</h3><p>要检查 SQL 中表达式的计算结果是否为NULL，可以使用isNull扩展：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> withoutCategories = select(todoItems)</span><br><span class="line">    ..where((row) =&gt; row.category.isNull());</span><br></pre></td></tr></table></figure>

<p>true如果内部表达式解析为 null，则返回的表达式将解析为null，false否则解析为 null。正如你所料，isNotNull反之亦然。</p>
<p>要在表达式计算结果为 时使用后备值null，可以使用该coalesce 函数。它接受一个表达式列表，并计算第一个不为 的表达式null：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> category = coalesce([todoItems.category, <span class="keyword">const</span> Constant(<span class="number">1</span>)]);</span><br></pre></td></tr></table></figure>

<p>这对应于??Dart 中的运算符。</p>
<h3 id="日期和时间"><a href="#日期和时间" class="headerlink" title="日期和时间"></a>日期和时间</h3><p>对于返回的列和表达式，DateTime您可以使用 year、、、和getter 从该日期month中提取各个字段：dayhourminutesecond</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(users).where((u) =&gt; u.birthDate.year.isSmallerThanValue(<span class="number">1950</span>));</span><br></pre></td></tr></table></figure>

<p>year诸如、month等各个字段本身就是表达式。这意味着您可以对它们使用运算符和比较操作。要获取当前日期或当前时间作为表达式，请使用Drift 提供的currentDate 和常量。currentDateAndTime</p>
<p>您还可以使用+and-运算符在时间列中添加或减去持续时间：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="keyword">void</span>&gt; increaseDueDates() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> change = TodoItemsCompanion.custom(</span><br><span class="line">      dueDate: todoItems.dueDate + <span class="built_in">Duration</span>(days: <span class="number">1</span>));</span><br><span class="line">  <span class="keyword">await</span> update(todoItems).write(change);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于更复杂的日期时间转换，modifyandmodifyAll函数很有用。例如，这会将dueDate待办事项的每个值递增到星期一的同一时间：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="keyword">void</span>&gt; moveDueDateToNextMonday() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> change = TodoItemsCompanion.custom(</span><br><span class="line">      dueDate: todoItems.dueDate</span><br><span class="line">          .modify(DateTimeModifier.weekday(<span class="built_in">DateTime</span>.monday)));</span><br><span class="line">  <span class="keyword">await</span> update(todoItems).write(change);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="IN和NOT-IN"><a href="#IN和NOT-IN" class="headerlink" title="IN和NOT IN"></a>IN和NOT IN</h3><p>isIn您可以使用和方法检查表达式是否在值列表中isNotIn ：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(animals)..where((a) =&gt; a.amountOfLegs.isIn([<span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>]));</span><br></pre></td></tr></table></figure>

<p>再次，该isNotIn函数以相反的方式工作。</p>
<h3 id="聚合函数（例如-count-和-sum）"><a href="#聚合函数（例如-count-和-sum）" class="headerlink" title="聚合函数（例如 count 和 sum）"></a>聚合函数（例如 count 和 sum）</h3><blockquote>
<p>  Dart API 提供了聚合函数。与常规函数不同，聚合函数可以同时对多行进行操作。默认情况下，它们会将 select<br>  语句返回的所有行合并为一个值。你还可以使用 group by让它们对结果集中的不同组进行操作。</p>
</blockquote>
<h4 id="比较-1"><a href="#比较-1" class="headerlink" title="比较"></a>比较</h4><p>您可以在数值和日期时间表达式上使用min和max方法。它们分别返回结果集中的最小值或最大值。</p>
<h4 id="算术-1"><a href="#算术-1" class="headerlink" title="算术"></a>算术</h4><p>、和方法可用。例如，你可以使用以下查询avg来查看待办事项的平均长度：sumtotal</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="built_in">double</span>&gt; averageItemLength() &#123;</span><br><span class="line">  <span class="keyword">final</span> avgLength = todoItems.content.length.avg();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> query = selectOnly(todoItems)..addColumns([avgLength]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> query.map((row) =&gt; row.read(avgLength)!).watchSingle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：我们使用selectOnly而不是 ，select因为我们对任何提供的列都不感兴趣 todos——我们只关心平均长度。更多详情请见 此处。</p>
<h4 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h4><p>有时，计算一个组中有多少行很有用。通过使用 示例中的表格布局，此查询将报告每个类别关联的待办事项数量：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> amountOfTodos = todoItems.id.count();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> query = db.select(categories).join([</span><br><span class="line">  innerJoin(</span><br><span class="line">    todoItems,</span><br><span class="line">    todoItems.category.equalsExp(categories.id),</span><br><span class="line">    useColumns: <span class="keyword">false</span>,</span><br><span class="line">  )</span><br><span class="line">]);</span><br><span class="line">query</span><br><span class="line">  ..addColumns([amountOfTodos])</span><br><span class="line">  ..groupBy([categories.id]);</span><br></pre></td></tr></table></figure>

<p>如果不想计算重复值，可以使用count(distinct: true)。有时，您只需要计算符合条件的值。为此，您可以使用filter参数 on count。要计算所有行（而不是单个值），可以使用顶级countAll() 函数。</p>
<p>有关如何使用 Drift 的 Dart API 编写聚合查询的更多信息，请参见 此处</p>
<h4 id="group-concat"><a href="#group-concat" class="headerlink" title="group_concat"></a>group_concat</h4><p>该groupConcat函数可用于将多个值连接成一个字符串：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;<span class="built_in">String</span>&gt; allTodoContent() &#123;</span><br><span class="line">  <span class="keyword">final</span> allContent = todoItems.content.groupConcat();</span><br><span class="line">  <span class="keyword">final</span> query = selectOnly(todoItems)..addColumns([allContent]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> query.map((row) =&gt; row.read(allContent)!).watchSingle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分隔符默认为逗号，周围没有空格，但可以使用separator参数 on进行更改groupConcat。</p>
<h4 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h4><p>除了聚合表达式和 之外groupBy，Drift 还支持窗口函数。与将一组行折叠为单个值的常规聚合不同，窗口函数允许对与当前行相关的行子集运行聚合。例如，您可以使用它来跟踪值的累计总数：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">Returns all todo items, associating each item with the total length of all</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">titles up until (and including) each todo item.</span></span></span><br><span class="line">Selectable&lt;(TodoItem, <span class="built_in">int</span>)&gt; todosWithRunningLength() &#123;</span><br><span class="line">  <span class="keyword">final</span> runningTitleLength = WindowFunctionExpression(</span><br><span class="line">    todoItems.title.length.sum(),</span><br><span class="line">    orderBy: [OrderingTerm.asc(todoItems.id)],</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">final</span> query = select(todoItems).addColumns([runningTitleLength]);</span><br><span class="line">  query.orderBy([OrderingTerm.asc(todoItems.id)]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> query.map((row) &#123;</span><br><span class="line">    <span class="keyword">return</span> (row.readTable(todoItems)!, row.read(runningTitleLength)!);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>窗口函数的一个有趣用途是确定如果行按某列排序（实际上并不返回所有行，也不按该列排序），该行的排名。此排名可以附加到每一行：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">Returns all todo items, also reporting the index (counting from 1) each</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">todo item would have if all items were sorted by descending content</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">length.</span></span></span><br><span class="line">Selectable&lt;(TodoItem, <span class="built_in">int</span>)&gt; todosWithLengthRanking() &#123;</span><br><span class="line">  <span class="keyword">final</span> lengthRanking = WindowFunctionExpression(</span><br><span class="line">    todoItems.id.count(),</span><br><span class="line">    orderBy: [OrderingTerm.desc(todoItems.content.length)],</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">final</span> query = select(todoItems).addColumns([lengthRanking]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> query.map((row) &#123;</span><br><span class="line">    <span class="keyword">return</span> (row.readTable(todoItems)!, row.read(lengthRanking)!);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数学函数和正则表达式"><a href="#数学函数和正则表达式" class="headerlink" title="数学函数和正则表达式"></a>数学函数和正则表达式</h3><p>使用 时NativeDatabase，将提供一组基本的三角函数。它还定义了REGEXP函数，允许您a REGEXP b在 SQL 查询中使用。有关更多信息，请参阅此处的函数列表。</p>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>Drift 对表达式中的子查询有基本的支持。</p>
<h4 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h4><p>标量子查询是一个只返回一行且只有一列的选择语句。由于它只返回一个值，因此它可以在另一个查询中使用：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">List</span>&lt;TodoItem&gt;&gt; findTodosInCategory(<span class="built_in">String</span> category) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> groupId = selectOnly(categories)</span><br><span class="line">    ..addColumns([categories.id])</span><br><span class="line">    ..where(categories.name.equals(category));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">final</span> query = select(todoItems)</span><br><span class="line">    ..where((row) =&gt; row.category.equalsExp(subqueryExpression(groupId)));</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> query.<span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这groupId是一个常规的 select 语句。默认情况下，drift 会选择所有列，因此我们使用它 selectOnly来仅加载我们关注的类别的 ID。然后，我们可以使用subqueryExpression该查询嵌入到我们用作过滤器的表达式中。</p>
<h4 id="isInQuery"><a href="#isInQuery" class="headerlink" title="isInQuery"></a>isInQuery</h4><p>isIn与和isNotIn函数类似，您可以使用它isInQuery来传递子查询而不是直接传递一组值。</p>
<p>子查询必须返回一列，但允许返回多行。 isInQuery如果查询中存在该值，则返回 true。</p>
<h4 id="存在"><a href="#存在" class="headerlink" title="存在"></a>存在</h4><p>andexistsQuery函数notExistsQuery可用于检查子查询是否包含任何行。例如，我们可以用它来查找空类别：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;<span class="built_in">List</span>&lt;Category&gt;&gt; emptyCategories() &#123;</span><br><span class="line">  <span class="keyword">final</span> hasNoTodo = notExistsQuery(select(todoItems)</span><br><span class="line">    ..where((row) =&gt; row.category.equalsExp(categories.id)));</span><br><span class="line">  <span class="keyword">return</span> (select(categories)..where((row) =&gt; hasNoTodo)).<span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完整子查询"><a href="#完整子查询" class="headerlink" title="完整子查询"></a>完整子查询</h4><p>Drift 还支持出现在 s 中的子查询，这些子查询在joins 的文档JOIN中有描述 。</p>
<h3 id="自定义表达式"><a href="#自定义表达式" class="headerlink" title="自定义表达式"></a>自定义表达式</h3><p>如果要将自定义 SQL 内联到 Dart 查询中，可以使用CustomExpression类。它接受一个sql参数，允许您编写自定义表达式：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inactive =</span><br><span class="line">    CustomExpression&lt;<span class="built_in">bool</span>&gt;(<span class="string">&quot;julianday(&#x27;now&#x27;) - julianday(last_login) &gt; 60&quot;</span>);</span><br><span class="line">select(users)..where((u) =&gt; inactive);</span><br></pre></td></tr></table></figure>

<p>注意：使用过多查询很容易导致无效查询CustomExpressions。如果您觉得需要使用它们，因为您使用的功能在 Drift 中不可用，请考虑创建问题告知我们。如果您只是喜欢 SQL，也可以查看 类型安全的编译型 SQL 。</p>
<p>尤其是在自定义表达式需要嵌入子表达式时，CustomExpression会有些限制。一种更复杂的替代方案是直接实现，它可以让你完全控制代码片段如何写入 SQL 。例如，这是一个使用 Drift 查询构建器实现行值的Expression表达式：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">Writes row values (\<span class="code">`(1, 2, 3)\`</span>) into SQL. We use [Never] as a bound because</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">this expression cannot be evaluated, it&#x27;s only useful as a subexpression.</span></span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RowValues</span> <span class="keyword">extends</span> <span class="title">Expression</span>&lt;<span class="title">Never</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;Expression&gt; expressions;</span><br><span class="line"></span><br><span class="line">  RowValues(<span class="keyword">this</span>.expressions);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  Precedence <span class="keyword">get</span> precedence =&gt; Precedence.primary;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">void</span> writeInto(GenerationContext context) &#123;</span><br><span class="line">    context.buffer.write(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">final</span> (i, expr) <span class="keyword">in</span> expressions.indexed) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i != <span class="number">0</span>) context.buffer.write(<span class="string">&#x27;, &#x27;</span>);</span><br><span class="line"></span><br><span class="line">      expr.writeInto(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    context.buffer.write(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后可以像这样使用它：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> rowValuesUsage() &#123;</span><br><span class="line">  select(animals).where((row) &#123;</span><br><span class="line">    <span class="comment">// Generates (amount_of_legs, average_livespan) &lt; (?, ?)</span></span><br><span class="line">    <span class="keyword">return</span> RowValues([row.amountOfLegs, row.averageLivespan])</span><br><span class="line">        .isSmallerThan(RowValues([Variable(<span class="number">2</span>), Variable(<span class="number">10</span>)]));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Flutter——数据库Drift开发详细教程-五"><a href="#Flutter——数据库Drift开发详细教程-五" class="headerlink" title="Flutter——数据库Drift开发详细教程(五)"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013290250/article/details/147755851">Flutter——数据库Drift开发详细教程(五)</a></h1><h2 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://drift.simonbinder.eu/dart_api/schema_inspection/">https://drift.simonbinder.eu/dart_api&#x2F;schema_inspection&#x2F;</a></p>
<h2 id="正文运行时模式检查"><a href="#正文运行时模式检查" class="headerlink" title="正文运行时模式检查"></a>正文运行时模式检查</h2><blockquote>
<p>得益于 Drift 生成的类型安全表类，在 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Dart&spm=1001.2101.3001.7020">Dart</a> 中编写 SQL 查询既简单又安全。然而，这些查询通常针对特定的表。虽然 Drift 支持表的继承，但有时通过反射访问表会更容易。幸运的是，Drift 生成的代码实现了可用于执行此操作的接口。</p>
</blockquote>
<p>由于大多数漂移用户并不需要这个主题，因此本页面主要提供一些启发性的示例以及相关漂移类文档的链接。例如，您可能有多个包含同一id列的独立表。并且您可能希望按列筛选行id。当针对单个表（例如入门Todos页面中所示的表）编写此查询时，操作非常简单：</p>
<p>个人理解：其实就是针对数据库操作相关代码进行 <strong>二次封装；</strong></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Selectable&lt;Todo&gt; findTodoEntryById(<span class="built_in">int</span> id) &#123;</span><br><span class="line">  <span class="keyword">return</span> select(todos)..where((row) =&gt; row.id.equals(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，假设我们想将此查询推广到每个数据库表，该怎么办呢？以下代码片段展示了如何实现这一点（请注意，代码片段中的链接直接指向相关文档）：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> FindById&lt;Table <span class="keyword">extends</span> HasResultSet, Row&gt;</span><br><span class="line">    <span class="keyword">on</span> ResultSetImplementation&lt;Table, Row&gt; &#123;</span><br><span class="line">  Selectable&lt;Row&gt; findById(<span class="built_in">int</span> id) &#123;</span><br><span class="line">    <span class="keyword">return</span> select()</span><br><span class="line">      ..where((row) &#123;</span><br><span class="line">        <span class="keyword">final</span> idColumn = columnsByName[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (idColumn == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> ArgumentError.value(</span><br><span class="line">              <span class="keyword">this</span>, <span class="string">&#x27;this&#x27;</span>, <span class="string">&#x27;Must be a table with an id column&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (idColumn.type != DriftSqlType.<span class="built_in">int</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> ArgumentError(<span class="string">&#x27;Column \`id\` is not an integer&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> idColumn.equals(id);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于这比仅适用于单个表的查询要复杂得多，让我们详细看看每一行有趣的内容：</p>
<ul>
<li><p><strong>FindById</strong> 是 <strong>ResultSetImplementation</strong> 的扩展。此类是 Drift  </p>
<p>  生成的每个表或视图的超类。它定义了一些有用的方法来检查模式，或将Map表示数据库行的原始数据转换为生成的数据类。</p>
</li>
<li><p><strong>ResultSetImplementation</strong> 使用两个类型参数进行实例化：原始表类和生成的行类。例如，如果您定义了一个表 **class  </p>
<p>  Todos extends Table** ，drift 会生成一个继承自该表的类Todos，同时实现该类。</p>
</li>
<li><p><strong>ResultSetImplementation&lt;Todos, Todo&gt;</strong> （其中，driftTodo是生成的数据类）。</p>
</li>
<li><p><strong>ResultSetImplementation</strong> 有两个子类： <strong>TableInfo和ViewInfo</strong> ，分别混合到生成的表和视图类中。</p>
</li>
<li><p><strong>HasResultSetTable</strong> 是和的超类View，这两个类用于在drift 中声明表和视图。</p>
</li>
<li><p>**Selectable <strong>表示一个查询，您可以使用</strong> get()、watch() <strong>和</strong> getSingle() <strong>等方法</strong> watchSingle()**来运行该查询。</p>
</li>
<li><p><strong>select() ** 所使用的扩展可 ** findById</strong> 用于启动选择语句，而无需引用数据库类 - 您所需要的只是表实例。</p>
</li>
<li><p>在 SQL 中，我们可以 <strong>columnsByName</strong> 通过名称查找列。这里，我们期望int存在一个列。</p>
</li>
<li><p><strong>GeneratedColumn</strong> 类表示数据库中的一列。可以从列实例中读取诸如列约束、类型或默认值等信息。</p>
</li>
<li><p>具体来说，我们使用它来断言该表确实有一个 <strong>IntColumn</strong> 名为的 <strong>id</strong> 。</p>
</li>
</ul>
<h3 id="更新和插入"><a href="#更新和插入" class="headerlink" title="更新和插入"></a>更新和插入</h3><p>同样的方法也适用于构造更新、删除和插入语句（尽管 由于视图是只读的，这些语句需要TableInfo而不是ResultSetImplementationInsertable ）。此外，更新和插入分别使用一个对象来表示更新或插入列的部分行。对于已知表，可以使用生成的类型化Companion对象来实现。但这也可以通过模式自省来实现，这要归功于RawValuesInsertable，它可以用作Insertable由列名到值的映射支持的泛型。</p>
<p>此示例在前一个示例的基础上，title根据id列的过滤器来更新通用表的列：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> UpdateTitle <span class="keyword">on</span> DatabaseConnectionUser &#123;</span><br><span class="line">  Future&lt;Row?&gt; updateTitle&lt;T <span class="keyword">extends</span> TableInfo&lt;Table, Row&gt;, Row&gt;(</span><br><span class="line">      T table, <span class="built_in">int</span> id, <span class="built_in">String</span> newTitle) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> columnsByName = table.columnsByName;</span><br><span class="line">    <span class="keyword">final</span> stmt = update(table)</span><br><span class="line">      ..where((tbl) &#123;</span><br><span class="line">        <span class="keyword">final</span> idColumn = columnsByName[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (idColumn == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> ArgumentError.value(</span><br><span class="line">              <span class="keyword">this</span>, <span class="string">&#x27;this&#x27;</span>, <span class="string">&#x27;Must be a table with an id column&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (idColumn.type != DriftSqlType.<span class="built_in">int</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> ArgumentError(<span class="string">&#x27;Column \`id\` is not an integer&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> idColumn.equals(id);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> rows = <span class="keyword">await</span> stmt.writeReturning(RawValuesInsertable(&#123;</span><br><span class="line">      <span class="string">&#x27;title&#x27;</span>: Variable&lt;<span class="built_in">String</span>&gt;(newTitle),</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rows.singleOrNull;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在数据库或数据库访问器类中，可以像这样调用该方法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;Todo?&gt; updateTodoTitle(<span class="built_in">int</span> id, <span class="built_in">String</span> newTitle) &#123;</span><br><span class="line">  <span class="keyword">return</span> updateTitle(todos, id, newTitle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体详细使用方法，可以去学习源码</p>
<!-- flag of hidden posts -->
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/private/" rel="tag"># private</a>
          
        </div>
      

      
      
      

      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">276</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="mailto:shenbh@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/ptwenzi?spm=1010.2135.3001.5113" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-clone"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93Drift%E5%BC%80%E5%8F%91%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E4%B8%80"><span class="nav-text">Flutter——数据库Drift开发详细教程(一)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-text">配置项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%B1%BB"><span class="nav-text">数据库表类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5API%E4%BD%BF%E7%94%A8"><span class="nav-text">增删改查API使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A2%9E"><span class="nav-text">增</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0"><span class="nav-text">删</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%B9"><span class="nav-text">改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5"><span class="nav-text">查</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Demo%E5%88%97%E5%AD%90"><span class="nav-text">Demo列子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DriftPage%E7%95%8C%E9%9D%A2%E4%BB%A3%E7%A0%81"><span class="nav-text">DriftPage界面代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81database-g-dart%EF%BC%8C%E5%8F%AF%E6%A0%B9%E6%8D%AE2%E6%AD%A5%E9%AA%A4%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90"><span class="nav-text">代码database.g.dart，可根据2步骤自动生成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-text">常见问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93Drift%E5%BC%80%E5%8F%91%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E4%BA%8C"><span class="nav-text">Flutter——数据库Drift开发详细教程(二)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83API"><span class="nav-text">核心API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%88%97%E8%A1%A8%E5%88%86%E9%A1%B5"><span class="nav-text">查询数据列表分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E8%A1%A8%E6%8E%92%E5%BA%8F"><span class="nav-text">列表排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A8%E8%BF%9F%E8%8E%B7%E5%8F%96%E4%B8%8E%E8%A7%82%E5%AF%9F"><span class="nav-text">推迟获取与观察</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93Drift%E5%BC%80%E5%8F%91%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E4%B8%89"><span class="nav-text">Flutter——数据库Drift开发详细教程(三)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87%E6%A0%B8%E5%BF%83API"><span class="nav-text">正文核心API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%85%A5%EF%BC%88%E6%9B%B4%E6%96%B0%E3%80%81%E6%8F%92%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%EF%BC%89"><span class="nav-text">写入（更新、插入、删除）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4"><span class="nav-text">1.更新和删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-SQL-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9B%B4%E6%96%B0"><span class="nav-text">使用 SQL 表达式更新</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E4%BB%B6"><span class="nav-text">插入件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%8F%92%E5%85%A5"><span class="nav-text">更新插入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E"><span class="nav-text">返回</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93Drift%E5%BC%80%E5%8F%91%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E5%9B%9B"><span class="nav-text">Flutter——数据库Drift开发详细教程(四)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83-1"><span class="nav-text">参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-text">正文表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%94%E8%BE%83"><span class="nav-text">比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E4%BB%A3%E6%95%B0"><span class="nav-text">布尔代数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF"><span class="nav-text">算术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#BigIn"><span class="nav-text">BigIn</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A9%BA%E5%80%BC%E6%A3%80%E6%9F%A5"><span class="nav-text">空值检查</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4"><span class="nav-text">日期和时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IN%E5%92%8CNOT-IN"><span class="nav-text">IN和NOT IN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%EF%BC%88%E4%BE%8B%E5%A6%82-count-%E5%92%8C-sum%EF%BC%89"><span class="nav-text">聚合函数（例如 count 和 sum）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AF%94%E8%BE%83-1"><span class="nav-text">比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%97%E6%9C%AF-1"><span class="nav-text">算术</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E6%95%B0"><span class="nav-text">计数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#group-concat"><span class="nav-text">group_concat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-text">窗口函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0%E5%92%8C%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-text">数学函数和正则表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">标量子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isInQuery"><span class="nav-text">isInQuery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%98%E5%9C%A8"><span class="nav-text">存在</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">完整子查询</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-text">自定义表达式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Flutter%E2%80%94%E2%80%94%E6%95%B0%E6%8D%AE%E5%BA%93Drift%E5%BC%80%E5%8F%91%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E4%BA%94"><span class="nav-text">Flutter——数据库Drift开发详细教程(五)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83-2"><span class="nav-text">参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AD%A3%E6%96%87%E8%BF%90%E8%A1%8C%E6%97%B6%E6%A8%A1%E5%BC%8F%E6%A3%80%E6%9F%A5"><span class="nav-text">正文运行时模式检查</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%92%8C%E6%8F%92%E5%85%A5"><span class="nav-text">更新和插入</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">阿炳</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  


  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('Copied')
          else $(this).text('Copy failed')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('Copy')
        }, 300)
      }).append(e)
    })
  </script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>